<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"harmonyostech.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next&#96;s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoo">
<meta property="og:type" content="website">
<meta property="og:title" content="HarmonyOS NEXT Knowledge Charging Station">
<meta property="og:url" content="https://harmonyostech.github.io/page/25/index.html">
<meta property="og:site_name" content="HarmonyOS NEXT Knowledge Charging Station">
<meta property="og:description" content="Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next&#96;s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Qingkouwei">
<meta property="article:tag" content="HarmonyOSNext, HarmonyOS NEXT, HarmonyOS, Cangjie">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://harmonyostech.github.io/page/25/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>HarmonyOS NEXT Knowledge Charging Station</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">HarmonyOS NEXT Knowledge Charging Station</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Analysis of Core Technologies and Application Scenarios of HarmonyOS NEXT</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://harmonyostech.github.io/2025/06/26/314-Daily-HarmonyOS-Next-Knowledge-Introducing-V8-Engine-Tab-Scrolling-Cold-Start-Statistics-Basic-Component-Parameter-Passing-Video-Playlist-Dropdown-Pagination/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Qingkouwei">
      <meta itemprop="description" content="Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HarmonyOS NEXT Knowledge Charging Station">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/06/26/314-Daily-HarmonyOS-Next-Knowledge-Introducing-V8-Engine-Tab-Scrolling-Cold-Start-Statistics-Basic-Component-Parameter-Passing-Video-Playlist-Dropdown-Pagination/" class="post-title-link" itemprop="url">[Daily HarmonyOS Next Knowledge] Introducing V8 Engine, Tab Scrolling, Cold Start Statistics, Basic Component Parameter Passing, Video Playlist Dropdown Pagination</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-06-26 22:14:35 / Modified: 22:18:28" itemprop="dateCreated datePublished" datetime="2025-06-26T22:14:35+08:00">2025-06-26</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Daily-HarmonyOS-Next-Knowledge/" itemprop="url" rel="index"><span itemprop="name">Daily HarmonyOS Next Knowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Daily-HarmonyOS-Next-Knowledge-Introducing-V8-Engine-Tab-Scrolling-Cold-Start-Statistics-Basic-Component-Parameter-Passing-Video-Playlist-Dropdown-Pagination"><a href="#Daily-HarmonyOS-Next-Knowledge-Introducing-V8-Engine-Tab-Scrolling-Cold-Start-Statistics-Basic-Component-Parameter-Passing-Video-Playlist-Dropdown-Pagination" class="headerlink" title="[Daily HarmonyOS Next Knowledge] Introducing V8 Engine, Tab Scrolling, Cold Start Statistics, Basic Component Parameter Passing, Video Playlist Dropdown Pagination"></a>[Daily HarmonyOS Next Knowledge] Introducing V8 Engine, Tab Scrolling, Cold Start Statistics, Basic Component Parameter Passing, Video Playlist Dropdown Pagination</h3><h4 id="1-How-to-introduce-the-V8-engine-in-HarmonyOS"><a href="#1-How-to-introduce-the-V8-engine-in-HarmonyOS" class="headerlink" title="1. How to introduce the V8 engine in HarmonyOS?"></a>1. How to introduce the V8 engine in HarmonyOS?</h4><p>Reference: <a target="_blank" rel="noopener" href="https://gitee.com/openharmony/docs/blob/master/zh-cn/application-dev/napi/use-jsvm-runtime-task.md">https://gitee.com/openharmony/docs/blob/master/zh-cn/application-dev/napi/use-jsvm-runtime-task.md</a>  </p>
<p>Developers create a new JS basic runtime environment through the <code>createJsCore</code> method and obtain a CoreID. They use the <code>evaluateJS</code> method with the CoreID to run JS code, create promises in the JS code to asynchronously execute functions, and finally release the runtime environment corresponding to the CoreID using the <code>releaseJsCore</code> method.  </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;deque&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="comment">// Define a map to manage each independent vm environment</span></span><br><span class="line"><span class="type">static</span> map&lt;<span class="type">int</span>, JSVM_VM *&gt; g_vmMap;</span><br><span class="line"><span class="type">static</span> map&lt;<span class="type">int</span>, JSVM_Env *&gt; g_envMap;</span><br><span class="line"><span class="type">static</span> map&lt;<span class="type">int</span>, JSVM_CallbackStruct *&gt; g_callBackStructMap;</span><br><span class="line"><span class="type">static</span> <span class="type">uint32_t</span> ENVTAG_NUMBER = <span class="number">0</span>;</span><br><span class="line"><span class="type">static</span> std::mutex envMapLock;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CHECK_COND(cond)                                                                                               \</span></span><br><span class="line"><span class="meta">  do &#123;                                                                                                               \</span></span><br><span class="line"><span class="meta">      <span class="keyword">if</span> (!(cond)) &#123;                                                                                                 \</span></span><br><span class="line"><span class="meta">          OH_LOG_ERROR(LOG_APP, <span class="string">&quot;jsvm fail file: %&#123;public&#125;s line: %&#123;public&#125;d ret = false&quot;</span>, __FILE__, __LINE__);      \</span></span><br><span class="line"><span class="meta">          return -1;                                                                                                 \</span></span><br><span class="line"><span class="meta">      &#125;                                                                                                              \</span></span><br><span class="line"><span class="meta">  &#125; while (0)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Task</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="keyword">virtual</span> ~<span class="built_in">Task</span>() = <span class="keyword">default</span>;</span><br><span class="line">  <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">Run</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">static</span> map&lt;<span class="type">int</span>, deque&lt;Task *&gt;&gt; g_taskQueueMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Custom Consoleinfo method</span></span><br><span class="line"><span class="function"><span class="type">static</span> JSVM_Value <span class="title">Consoleinfo</span><span class="params">(JSVM_Env env, JSVM_CallbackInfo info)</span> </span>&#123;</span><br><span class="line">  <span class="type">size_t</span> argc = <span class="number">1</span>;</span><br><span class="line">  JSVM_Value args[<span class="number">1</span>];</span><br><span class="line">  <span class="type">char</span> log[<span class="number">256</span>] = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="type">size_t</span> log_length;</span><br><span class="line">  <span class="built_in">JSVM_CALL</span>(<span class="built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="literal">NULL</span>, <span class="literal">NULL</span>));</span><br><span class="line"></span><br><span class="line">  <span class="built_in">JSVM_CALL</span>(<span class="built_in">OH_JSVM_GetValueStringUtf8</span>(env, args[<span class="number">0</span>], log, <span class="number">255</span>, &amp;log_length));</span><br><span class="line">  log[<span class="number">255</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">OH_LOG_INFO</span>(LOG_APP, <span class="string">&quot;JSVM API TEST: %&#123;public&#125;s&quot;</span>, log);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Custom method to create a Promise for use in JS code</span></span><br><span class="line"><span class="function"><span class="type">static</span> JSVM_Value <span class="title">CreatePromise</span><span class="params">(JSVM_Env env, JSVM_CallbackInfo info)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">OH_LOG_INFO</span>(LOG_APP, <span class="string">&quot;JSVM API TEST: CreatePromise start&quot;</span>);</span><br><span class="line">  <span class="type">int</span> envID = <span class="number">-1</span>;</span><br><span class="line">  <span class="comment">// Get envID through the current env</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> it = g_envMap.<span class="built_in">begin</span>(); it != g_envMap.<span class="built_in">end</span>(); ++it) &#123;</span><br><span class="line">      <span class="keyword">if</span> (*it-&gt;second == env) &#123;</span><br><span class="line">          envID = it-&gt;first;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (envID == <span class="number">-1</span>) &#123;</span><br><span class="line">      <span class="built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="string">&quot;JSVM API TEST: CreatePromise envID failed&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  JSVM_Value promise;</span><br><span class="line">  JSVM_Deferred deferred;</span><br><span class="line">  <span class="built_in">JSVM_CALL</span>(<span class="built_in">OH_JSVM_CreatePromise</span>(env, &amp;deferred, &amp;promise));</span><br><span class="line">  <span class="comment">// Design the ReadTask class to add the deferred object of the promise to the execution queue</span></span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">ReadTask</span> : <span class="keyword">public</span> Task &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">      <span class="built_in">ReadTask</span>(JSVM_Env env, JSVM_Deferred deferred, <span class="type">int</span> envNum) : <span class="built_in">env_</span>(env), <span class="built_in">envID_</span>(envNum), <span class="built_in">deferred_</span>(deferred) &#123;&#125;</span><br><span class="line">      <span class="function"><span class="type">void</span> <span class="title">Run</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">          <span class="comment">// string str = &quot;TEST RUN OH_JSVM_ResolveDeferred&quot;;</span></span><br><span class="line">          <span class="type">int</span> envID = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">auto</span> it = g_envMap.<span class="built_in">begin</span>(); it != g_envMap.<span class="built_in">end</span>(); ++it) &#123;</span><br><span class="line">              <span class="keyword">if</span> (*it-&gt;second == env_) &#123;</span><br><span class="line">                  envID = it-&gt;first;</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="built_in">OH_LOG_INFO</span>(LOG_APP, <span class="string">&quot;JSVM API TEST: CreatePromise %&#123;public&#125;d&quot;</span>, envID);</span><br><span class="line">          JSVM_Value result;</span><br><span class="line">          <span class="keyword">if</span> (<span class="built_in">OH_JSVM_CreateInt32</span>(env_, envID, &amp;result) != JSVM_OK) &#123;</span><br><span class="line">              <span class="keyword">return</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (<span class="built_in">OH_JSVM_ResolveDeferred</span>(env_, deferred_, result) != JSVM_OK) &#123;</span><br><span class="line">              <span class="keyword">return</span>;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">      JSVM_Env env_;</span><br><span class="line">      <span class="type">int</span> envID_;</span><br><span class="line">      JSVM_Deferred deferred_;</span><br><span class="line">  &#125;;</span><br><span class="line">  g_taskQueueMap[envID].<span class="built_in">push_back</span>(<span class="keyword">new</span> <span class="built_in">ReadTask</span>(env, deferred, envID));</span><br><span class="line">  <span class="built_in">OH_LOG_INFO</span>(LOG_APP, <span class="string">&quot;JSVM API TEST: CreatePromise end&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> promise;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Custom Add method</span></span><br><span class="line"><span class="function"><span class="type">static</span> JSVM_Value <span class="title">Add</span><span class="params">(JSVM_Env env, JSVM_CallbackInfo info)</span> </span>&#123;</span><br><span class="line">  <span class="type">size_t</span> argc = <span class="number">2</span>;</span><br><span class="line">  JSVM_Value args[<span class="number">2</span>];</span><br><span class="line">  <span class="built_in">JSVM_CALL</span>(<span class="built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="literal">NULL</span>, <span class="literal">NULL</span>));</span><br><span class="line">  <span class="type">double</span> num1, num2;</span><br><span class="line">  <span class="built_in">JSVM_CALL</span>(<span class="built_in">OH_JSVM_GetValueDouble</span>(env, args[<span class="number">0</span>], &amp;num1));</span><br><span class="line">  <span class="built_in">JSVM_CALL</span>(<span class="built_in">OH_JSVM_GetValueDouble</span>(env, args[<span class="number">1</span>], &amp;num2));</span><br><span class="line">  JSVM_Value sum = <span class="literal">nullptr</span>;</span><br><span class="line">  <span class="built_in">JSVM_CALL</span>(<span class="built_in">OH_JSVM_CreateDouble</span>(env, num1 + num2, &amp;sum));</span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Custom AssertEqual method</span></span><br><span class="line"><span class="function"><span class="type">static</span> JSVM_Value <span class="title">AssertEqual</span><span class="params">(JSVM_Env env, JSVM_CallbackInfo info)</span> </span>&#123;</span><br><span class="line">  <span class="type">size_t</span> argc = <span class="number">2</span>;</span><br><span class="line">  JSVM_Value args[<span class="number">2</span>];</span><br><span class="line">  <span class="built_in">JSVM_CALL</span>(<span class="built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="literal">NULL</span>, <span class="literal">NULL</span>));</span><br><span class="line"></span><br><span class="line">  <span class="type">bool</span> isStrictEquals = <span class="literal">false</span>;</span><br><span class="line">  <span class="built_in">JSVM_CALL</span>(<span class="built_in">OH_JSVM_StrictEquals</span>(env, args[<span class="number">0</span>], args[<span class="number">1</span>], &amp;isStrictEquals));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isStrictEquals) &#123;</span><br><span class="line">      <span class="built_in">OH_LOG_INFO</span>(LOG_APP, <span class="string">&quot;JSVM API TEST RESULT: PASS&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">OH_LOG_INFO</span>(LOG_APP, <span class="string">&quot;JSVM API TEST RESULT: FAILED&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">fromOHStringValue</span><span class="params">(JSVM_Env &amp;env, JSVM_Value &amp;value, std::string &amp;result)</span> </span>&#123;</span><br><span class="line">  <span class="type">size_t</span> size;</span><br><span class="line">  <span class="built_in">CHECK_RET</span>(<span class="built_in">OH_JSVM_GetValueStringUtf8</span>(env, value, <span class="literal">nullptr</span>, <span class="number">0</span>, &amp;size));</span><br><span class="line">  <span class="type">char</span> resultStr[size + <span class="number">1</span>];</span><br><span class="line">  <span class="built_in">CHECK_RET</span>(<span class="built_in">OH_JSVM_GetValueStringUtf8</span>(env, value, resultStr, size + <span class="number">1</span>, &amp;size));</span><br><span class="line">  result = resultStr;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Provide an external interface to create a JSVM runtime environment and return the corresponding unique ID</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">CreateJsCore</span><span class="params">(<span class="type">uint32_t</span> *result)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">OH_LOG_INFO</span>(LOG_APP, <span class="string">&quot;JSVM CreateJsCore START&quot;</span>);</span><br><span class="line">  g_taskQueueMap[ENVTAG_NUMBER] = deque&lt;Task *&gt;&#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (g_aa == <span class="number">0</span>) &#123;</span><br><span class="line">      JSVM_InitOptions init_options;</span><br><span class="line">      <span class="built_in">memset</span>(&amp;init_options, <span class="number">0</span>, <span class="built_in">sizeof</span>(init_options));</span><br><span class="line">      <span class="built_in">CHECK</span>(<span class="built_in">OH_JSVM_Init</span>(&amp;init_options));</span><br><span class="line">      g_aa++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock_guard</span><span class="params">(envMapLock)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Virtual machine instance</span></span><br><span class="line">  g_vmMap[ENVTAG_NUMBER] = <span class="keyword">new</span> JSVM_VM;</span><br><span class="line">  JSVM_CreateVMOptions options;</span><br><span class="line">  JSVM_VMScope vmScope;</span><br><span class="line">  <span class="built_in">memset</span>(&amp;options, <span class="number">0</span>, <span class="built_in">sizeof</span>(options));</span><br><span class="line">  <span class="built_in">CHECK</span>(<span class="built_in">OH_JSVM_CreateVM</span>(&amp;options, g_vmMap[ENVTAG_NUMBER]));</span><br><span class="line">  <span class="built_in">CHECK</span>(<span class="built_in">OH_JSVM_OpenVMScope</span>(*g_vmMap[ENVTAG_NUMBER], &amp;vmScope));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// New environment</span></span><br><span class="line">  g_envMap[ENVTAG_NUMBER] = <span class="keyword">new</span> JSVM_Env;</span><br><span class="line">  g_callBackStructMap[ENVTAG_NUMBER] = <span class="keyword">new</span> JSVM_CallbackStruct[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Register callback function pointers and data for user-provided native functions, exposed to JS via JSVM-API</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">      g_callBackStructMap[ENVTAG_NUMBER][i].data = <span class="literal">nullptr</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  g_callBackStructMap[ENVTAG_NUMBER][<span class="number">0</span>].callback = Consoleinfo;</span><br><span class="line">  g_callBackStructMap[ENVTAG_NUMBER][<span class="number">1</span>].callback = Add;</span><br><span class="line">  g_callBackStructMap[ENVTAG_NUMBER][<span class="number">2</span>].callback = AssertEqual;</span><br><span class="line">  g_callBackStructMap[ENVTAG_NUMBER][<span class="number">3</span>].callback = CreatePromise;</span><br><span class="line">  JSVM_PropertyDescriptor descriptors[] = &#123;</span><br><span class="line">      &#123;<span class="string">&quot;consoleinfo&quot;</span>, <span class="literal">NULL</span>, &amp;g_callBackStructMap[ENVTAG_NUMBER][<span class="number">0</span>], <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, JSVM_DEFAULT&#125;,</span><br><span class="line">      &#123;<span class="string">&quot;add&quot;</span>, <span class="literal">NULL</span>, &amp;g_callBackStructMap[ENVTAG_NUMBER][<span class="number">1</span>], <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, JSVM_DEFAULT&#125;,</span><br><span class="line">      &#123;<span class="string">&quot;assertEqual&quot;</span>, <span class="literal">NULL</span>, &amp;g_callBackStructMap[ENVTAG_NUMBER][<span class="number">2</span>], <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, JSVM_DEFAULT&#125;,</span><br><span class="line">      &#123;<span class="string">&quot;createPromise&quot;</span>, <span class="literal">NULL</span>, &amp;g_callBackStructMap[ENVTAG_NUMBER][<span class="number">3</span>], <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, JSVM_DEFAULT&#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="built_in">CHECK</span>(<span class="built_in">OH_JSVM_CreateEnv</span>(*g_vmMap[ENVTAG_NUMBER], <span class="built_in">sizeof</span>(descriptors) / <span class="built_in">sizeof</span>(descriptors[<span class="number">0</span>]), descriptors,</span><br><span class="line">                          g_envMap[ENVTAG_NUMBER]));</span><br><span class="line">  <span class="built_in">CHECK</span>(<span class="built_in">OH_JSVM_CloseVMScope</span>(*g_vmMap[ENVTAG_NUMBER], vmScope));</span><br><span class="line"></span><br><span class="line">  <span class="built_in">OH_LOG_INFO</span>(LOG_APP, <span class="string">&quot;JSVM CreateJsCore END&quot;</span>);</span><br><span class="line">  *result = ENVTAG_NUMBER;</span><br><span class="line">  ENVTAG_NUMBER++;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Provide an external interface to release the JSVM environment, releasing the corresponding environment via envId</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">ReleaseJsCore</span><span class="params">(<span class="type">uint32_t</span> coreEnvId)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">OH_LOG_INFO</span>(LOG_APP, <span class="string">&quot;JSVM ReleaseJsCore START&quot;</span>);</span><br><span class="line">  <span class="built_in">CHECK_COND</span>(g_envMap.<span class="built_in">count</span>(coreEnvId) != <span class="number">0</span> &amp;&amp; g_envMap[coreEnvId] != <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">  <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock_guard</span><span class="params">(envMapLock)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">CHECK</span>(<span class="built_in">OH_JSVM_DestroyEnv</span>(*g_envMap[coreEnvId]));</span><br><span class="line">  g_envMap[coreEnvId] = <span class="literal">nullptr</span>;</span><br><span class="line">  g_envMap.<span class="built_in">erase</span>(coreEnvId);</span><br><span class="line">  <span class="built_in">CHECK</span>(<span class="built_in">OH_JSVM_DestroyVM</span>(*g_vmMap[coreEnvId]));</span><br><span class="line">  g_vmMap[coreEnvId] = <span class="literal">nullptr</span>;</span><br><span class="line">  g_vmMap.<span class="built_in">erase</span>(coreEnvId);</span><br><span class="line">  <span class="keyword">delete</span>[] g_callBackStructMap[coreEnvId];</span><br><span class="line">  g_callBackStructMap[coreEnvId] = <span class="literal">nullptr</span>;</span><br><span class="line">  g_callBackStructMap.<span class="built_in">erase</span>(coreEnvId);</span><br><span class="line">  g_taskQueueMap.<span class="built_in">erase</span>(coreEnvId);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">OH_LOG_INFO</span>(LOG_APP, <span class="string">&quot;JSVM ReleaseJsCore END&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> std::mutex mutexLock;</span><br><span class="line"><span class="comment">// Provide an external interface to execute JS code, running JS code in the corresponding JSVN environment via coreID</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int</span> <span class="title">EvaluateJS</span><span class="params">(<span class="type">uint32_t</span> envId, <span class="type">const</span> <span class="type">char</span> *source, std::string &amp;res)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">OH_LOG_INFO</span>(LOG_APP, <span class="string">&quot;JSVM EvaluateJS START&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">CHECK_COND</span>(g_envMap.<span class="built_in">count</span>(envId) != <span class="number">0</span> &amp;&amp; g_envMap[envId] != <span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">  JSVM_Env env = *g_envMap[envId];</span><br><span class="line">  JSVM_VM vm = *g_vmMap[envId];</span><br><span class="line">  JSVM_VMScope vmScope;</span><br><span class="line">  JSVM_EnvScope envScope;</span><br><span class="line">  JSVM_HandleScope handleScope;</span><br><span class="line">  JSVM_Value result;</span><br><span class="line"></span><br><span class="line">  <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock_guard</span><span class="params">(mutexLock)</span></span>;</span><br><span class="line">  &#123;</span><br><span class="line">      <span class="comment">// Create a JSVM environment</span></span><br><span class="line">      <span class="built_in">CHECK_RET</span>(<span class="built_in">OH_JSVM_OpenVMScope</span>(vm, &amp;vmScope));</span><br><span class="line">      <span class="built_in">CHECK_RET</span>(<span class="built_in">OH_JSVM_OpenEnvScope</span>(*g_envMap[envId], &amp;envScope));</span><br><span class="line">      <span class="built_in">CHECK_RET</span>(<span class="built_in">OH_JSVM_OpenHandleScope</span>(*g_envMap[envId], &amp;handleScope));</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Call test functions via script</span></span><br><span class="line">      JSVM_Script script;</span><br><span class="line">      JSVM_Value jsSrc;</span><br><span class="line">      <span class="built_in">CHECK_RET</span>(<span class="built_in">OH_JSVM_CreateStringUtf8</span>(env, source, JSVM_AUTO_LENGTH, &amp;jsSrc));</span><br><span class="line">      <span class="built_in">CHECK_RET</span>(<span class="built_in">OH_JSVM_CompileScript</span>(env, jsSrc, <span class="literal">nullptr</span>, <span class="number">0</span>, <span class="literal">true</span>, <span class="literal">nullptr</span>, &amp;script));</span><br><span class="line">      <span class="built_in">CHECK_RET</span>(<span class="built_in">OH_JSVM_RunScript</span>(env, script, &amp;result));</span><br><span class="line"></span><br><span class="line">      JSVM_ValueType type;</span><br><span class="line">      <span class="built_in">CHECK_RET</span>(<span class="built_in">OH_JSVM_Typeof</span>(env, result, &amp;type));</span><br><span class="line">      <span class="built_in">OH_LOG_INFO</span>(LOG_APP, <span class="string">&quot;JSVM API TEST type: %&#123;public&#125;d&quot;</span>, type);</span><br><span class="line">      <span class="comment">// Execute tasks in the current env event queue</span></span><br><span class="line">      <span class="keyword">while</span> (!g_taskQueueMap[envId].<span class="built_in">empty</span>()) &#123;</span><br><span class="line">          <span class="keyword">auto</span> task = g_taskQueueMap[envId].<span class="built_in">front</span>();</span><br><span class="line">          g_taskQueueMap[envId].<span class="built_in">pop_front</span>();</span><br><span class="line">          task-&gt;<span class="built_in">Run</span>();</span><br><span class="line">          <span class="keyword">delete</span> task;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (type == JSVM_STRING) &#123;</span><br><span class="line">          <span class="built_in">CHECK_COND</span>(<span class="built_in">fromOHStringValue</span>(env, result, res) != <span class="number">-1</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type == JSVM_BOOLEAN) &#123;</span><br><span class="line">          <span class="type">bool</span> ret = <span class="literal">false</span>;</span><br><span class="line">          <span class="built_in">CHECK_RET</span>(<span class="built_in">OH_JSVM_GetValueBool</span>(env, result, &amp;ret));</span><br><span class="line">          ret ? res = <span class="string">&quot;true&quot;</span> : res = <span class="string">&quot;false&quot;</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type == JSVM_NUMBER) &#123;</span><br><span class="line">          <span class="type">int32_t</span> num;</span><br><span class="line">          <span class="built_in">CHECK_RET</span>(<span class="built_in">OH_JSVM_GetValueInt32</span>(env, result, &amp;num));</span><br><span class="line">          res = std::<span class="built_in">to_string</span>(num);</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type == JSVM_OBJECT) &#123;</span><br><span class="line">          JSVM_Value objResult;</span><br><span class="line">          <span class="built_in">CHECK_RET</span>(<span class="built_in">OH_JSVM_JsonStringify</span>(env, result, &amp;objResult));</span><br><span class="line">          <span class="built_in">CHECK_COND</span>(<span class="built_in">fromOHStringValue</span>(env, objResult, res) != <span class="number">-1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  &#123;</span><br><span class="line">      <span class="type">bool</span> aal = <span class="literal">false</span>;</span><br><span class="line">      <span class="built_in">CHECK_RET</span>(<span class="built_in">OH_JSVM_PumpMessageLoop</span>(*g_vmMap[envId], &amp;aal));</span><br><span class="line">      <span class="built_in">CHECK_RET</span>(<span class="built_in">OH_JSVM_PerformMicrotaskCheckpoint</span>(*g_vmMap[envId]));</span><br><span class="line">      <span class="built_in">CHECK_RET</span>(<span class="built_in">OH_JSVM_CloseHandleScope</span>(*g_envMap[envId], handleScope));</span><br><span class="line">      <span class="built_in">CHECK_RET</span>(<span class="built_in">OH_JSVM_CloseEnvScope</span>(*g_envMap[envId], envScope));</span><br><span class="line">      <span class="built_in">CHECK_RET</span>(<span class="built_in">OH_JSVM_CloseVMScope</span>(*g_vmMap[envId], vmScope));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">OH_LOG_INFO</span>(LOG_APP, <span class="string">&quot;JSVM EvaluateJS END&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">int32_t</span> <span class="title">TestJSVM</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> source1[] = <span class="string">&quot;&#123;\</span></span><br><span class="line"><span class="string">      let a = \&quot;hello World\&quot;;\</span></span><br><span class="line"><span class="string">      consoleinfo(a);\</span></span><br><span class="line"><span class="string">      const mPromise = createPromise();\</span></span><br><span class="line"><span class="string">      mPromise.then((result) =&gt; &#123;\</span></span><br><span class="line"><span class="string">        assertEqual(result, 0);\</span></span><br><span class="line"><span class="string">      &#125;);\</span></span><br><span class="line"><span class="string">      a;\</span></span><br><span class="line"><span class="string">  &#125;;&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> source2[] = <span class="string">&quot;&#123;\</span></span><br><span class="line"><span class="string">      let a = \&quot;second hello\&quot;;\</span></span><br><span class="line"><span class="string">      consoleinfo(a);\</span></span><br><span class="line"><span class="string">      let b = add(99, 1);\</span></span><br><span class="line"><span class="string">      assertEqual(100, b);\</span></span><br><span class="line"><span class="string">      assertEqual(add(99, 1), 100);\</span></span><br><span class="line"><span class="string">      createPromise().then((result) =&gt; &#123;\</span></span><br><span class="line"><span class="string">          assertEqual(result, 1);\</span></span><br><span class="line"><span class="string">      &#125;);\</span></span><br><span class="line"><span class="string">      a;\</span></span><br><span class="line"><span class="string">  &#125;;&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create the first runtime environment and bind TS callbacks</span></span><br><span class="line">  <span class="type">uint32_t</span> coreId1;</span><br><span class="line">  <span class="built_in">CHECK_COND</span>(<span class="built_in">CreateJsCore</span>(&amp;coreId1) == <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">OH_LOG_INFO</span>(LOG_APP, <span class="string">&quot;TEST coreId: %&#123;public&#125;d&quot;</span>, coreId1);</span><br><span class="line">  <span class="comment">// Execute JS code in the first runtime environment</span></span><br><span class="line">  std::string result1;</span><br><span class="line">  <span class="built_in">CHECK_COND</span>(<span class="built_in">EvaluateJS</span>(coreId1, source1, result1) == <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">OH_LOG_INFO</span>(LOG_APP, <span class="string">&quot;TEST evaluateJS: %&#123;public&#125;s&quot;</span>, result<span class="number">1.</span><span class="built_in">c_str</span>());</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create the second runtime environment and bind TS callbacks</span></span><br><span class="line">  <span class="type">uint32_t</span> coreId2;</span><br><span class="line">  <span class="built_in">CHECK_COND</span>(<span class="built_in">CreateJsCore</span>(&amp;coreId2) == <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">OH_LOG_INFO</span>(LOG_APP, <span class="string">&quot;TEST coreId: %&#123;public&#125;d&quot;</span>, coreId2);</span><br><span class="line">  <span class="comment">// Execute JS code in the second runtime environment</span></span><br><span class="line">  std::string result2;</span><br><span class="line">  <span class="built_in">CHECK_COND</span>(<span class="built_in">EvaluateJS</span>(coreId2, source2, result2) == <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">OH_LOG_INFO</span>(LOG_APP, <span class="string">&quot;TEST evaluateJS: %&#123;public&#125;s&quot;</span>, result<span class="number">2.</span><span class="built_in">c_str</span>());</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Release the first runtime environment</span></span><br><span class="line">  <span class="built_in">CHECK_COND</span>(<span class="built_in">ReleaseJsCore</span>(coreId1) == <span class="number">0</span>);</span><br><span class="line">  <span class="comment">// Release the second runtime environment</span></span><br><span class="line">  <span class="built_in">CHECK_COND</span>(<span class="built_in">ReleaseJsCore</span>(coreId2) == <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">OH_LOG_INFO</span>(LOG_APP, <span class="string">&quot;Test NAPI end&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">#### <span class="number">2.</span> When <span class="keyword">using</span> the HarmonyOS Tabs component with many tabs, how to automatically scroll the selected tab to the middle of the page during scrolling?  </span><br><span class="line">Reference demo:  </span><br><span class="line">```typescript</span><br><span class="line">@Entry</span><br><span class="line">@Component</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">TabsExample</span> &#123;</span><br><span class="line">  @State fontColor: string = <span class="string">&#x27;#182431&#x27;</span></span><br><span class="line">  @State selectedFontColor: string = <span class="string">&#x27;#007DFF&#x27;</span></span><br><span class="line">  @State currentIndex: number = <span class="number">0</span></span><br><span class="line">  <span class="keyword">private</span> controller: TabsController = <span class="keyword">new</span> <span class="built_in">TabsController</span>()</span><br><span class="line"></span><br><span class="line">  @Builder</span><br><span class="line">  <span class="built_in">tabBuilder</span>(index: number, name: string) &#123;</span><br><span class="line">    <span class="built_in">Column</span>() &#123;</span><br><span class="line">      <span class="built_in">Text</span>(name)</span><br><span class="line">        .<span class="built_in">fontColor</span>(<span class="keyword">this</span>.currentIndex === index ? <span class="keyword">this</span>.selectedFontColor : <span class="keyword">this</span>.fontColor)</span><br><span class="line">        .<span class="built_in">fontSize</span>(<span class="number">10</span>)</span><br><span class="line">        .<span class="built_in">fontWeight</span>(<span class="keyword">this</span>.currentIndex === index ? <span class="number">500</span> : <span class="number">400</span>)</span><br><span class="line">        .<span class="built_in">lineHeight</span>(<span class="number">22</span>)</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://harmonyostech.github.io/2025/06/26/313-Daily-HarmonyOS-Next-Knowledge-Flex-Component-List-Refresh-Custom-Pop-up-Button-States-Auto-Soft-Keyboard-Pop-up/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Qingkouwei">
      <meta itemprop="description" content="Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HarmonyOS NEXT Knowledge Charging Station">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/06/26/313-Daily-HarmonyOS-Next-Knowledge-Flex-Component-List-Refresh-Custom-Pop-up-Button-States-Auto-Soft-Keyboard-Pop-up/" class="post-title-link" itemprop="url">[Daily HarmonyOS Next Knowledge] Flex Component, List Refresh, Custom Pop-up, Button States, Auto Soft Keyboard Pop-up</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-06-26 22:13:14 / Modified: 22:14:16" itemprop="dateCreated datePublished" datetime="2025-06-26T22:13:14+08:00">2025-06-26</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Daily-HarmonyOS-Next-Knowledge/" itemprop="url" rel="index"><span itemprop="name">Daily HarmonyOS Next Knowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Daily-HarmonyOS-Next-Knowledge-Flex-Component-List-Refresh-Custom-Pop-up-Button-States-Auto-Soft-Keyboard-Pop-up"><a href="#Daily-HarmonyOS-Next-Knowledge-Flex-Component-List-Refresh-Custom-Pop-up-Button-States-Auto-Soft-Keyboard-Pop-up" class="headerlink" title="[Daily HarmonyOS Next Knowledge] Flex Component, List Refresh, Custom Pop-up, Button States, Auto Soft Keyboard Pop-up"></a>[Daily HarmonyOS Next Knowledge] Flex Component, List Refresh, Custom Pop-up, Button States, Auto Soft Keyboard Pop-up</h3><h4 id="1-Issues-with-HarmonyOS-Flex-component-causing-incorrect-UI"><a href="#1-Issues-with-HarmonyOS-Flex-component-causing-incorrect-UI" class="headerlink" title="1. Issues with HarmonyOS Flex component causing incorrect UI?"></a>1. Issues with HarmonyOS Flex component causing incorrect UI?</h4><p>The expected effect is that the first child1 Flex should not fill the entire main axis.  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">Flex(&#123;</span><br><span class="line">  direction: FlexDirection.Column,</span><br><span class="line">  // wrap: FlexWrap.NoWrap,</span><br><span class="line">  // justifyContent:  FlexAlign.Center,</span><br><span class="line">  // alignItems: ItemAlign.Start,</span><br><span class="line">  // alignContent: FlexAlign.Start,</span><br><span class="line">&#125;)&#123;</span><br><span class="line">  Flex(&#123;</span><br><span class="line">    direction: FlexDirection.Column,</span><br><span class="line">    // wrap: FlexWrap.NoWrap,</span><br><span class="line">    // justifyContent: FlexAlign.Start,</span><br><span class="line">    // alignItems: ItemAlign.Start,</span><br><span class="line">    // alignContent: FlexAlign.Start,</span><br><span class="line">  &#125;) &#123;</span><br><span class="line">    Text(&quot;啊是打火机卡的黑科技abc1234567890&quot;)</span><br><span class="line">  &#125;.id(&quot;child1&quot;)</span><br><span class="line">  Text(&quot;啊是打火机卡的黑科技&quot;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Code 2:</span><br><span class="line">  Flex(&#123;</span><br><span class="line">    direction: FlexDirection.Column,</span><br><span class="line">    // wrap: FlexWrap.NoWrap,</span><br><span class="line">    // justifyContent:  FlexAlign.Center,</span><br><span class="line">    // alignItems: ItemAlign.Start,</span><br><span class="line">    // alignContent: FlexAlign.Start,</span><br><span class="line">  &#125;)&#123;</span><br><span class="line">    Flex(&#123;</span><br><span class="line">      direction: FlexDirection.Column,</span><br><span class="line">      // wrap: FlexWrap.NoWrap,</span><br><span class="line">      // justifyContent: FlexAlign.Start,</span><br><span class="line">      // alignItems: ItemAlign.Start,</span><br><span class="line">      // alignContent: FlexAlign.Start,</span><br><span class="line">    &#125;) &#123;</span><br><span class="line">      Text(&quot;啊是打火机卡的黑科技abc1234567890&quot;)</span><br><span class="line">        .flexBasis(0).flexShrink(1).flexGrow(0)</span><br><span class="line">    &#125;.flexBasis(0).flexShrink(1).flexGrow(0).id(&quot;child1&quot;)</span><br><span class="line">    Text(&quot;啊是打火机卡的黑科技&quot;)</span><br><span class="line">  &#125;</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">By default, the Flex component&#x27;s main axis fills the parent container when not explicitly set, while the Column/Row component&#x27;s main axis follows the child nodes&#x27; sizes by default.  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 2. How to refresh a List when ListItem data in HarmonyOS ListItemGroup is updated?  </span><br><span class="line">Abstract the group data into a component and pass the required parameters. Code:  </span><br></pre></td></tr></table></figure>
<p>@Observed<br>class ProjectArray extends Array<string>{<br>}</p>
<p>@Observed<br>class Subject {<br>  public title: string;<br>  public projects: ProjectArray;<br>  constructor(title, projects) {<br>    this.title &#x3D; title;<br>    this.projects &#x3D; projects;<br>  }<br>}</p>
<p>@Component<br>struct ViewA {<br>  title: string;<br>  @ObjectLink projects: ProjectArray;<br>  build() {<br>    Column() {<br>      Text(this.title)<br>      List(){<br>        ForEach(this.projects, (project) &#x3D;&gt; {<br>          ListItem() {<br>            Text(project)<br>              .width(“100%”).height(100).fontSize(20)<br>              .textAlign(TextAlign.Center).backgroundColor(0xFFFFFF)<br>          }</p>
<pre><code>    &#125;)
  &#125;
&#125;
</code></pre>
<p>  }<br>}</p>
<p>@Entry<br>@Component<br>struct ListItemGroupExample2 {<br>  @State timetable: Subject[] &#x3D; [<br>    new Subject(‘星期一’, new ProjectArray(‘语文’, ‘数学’, ‘英语’))<br>  ]<br>  build() {<br>    Column() {<br>      Button(‘change’)<br>        .onClick(() &#x3D;&gt; {<br>          console.log(‘testTag: Change’);<br>          this.timetable[0].projects.splice(0, 1, ‘英语’);<br>        })<br>      ForEach(this.timetable, (table) &#x3D;&gt; {<br>        ViewA({title: table.title, projects: table.projects})<br>      })</p>
<pre><code>&#125;.width(&#39;100%&#39;).height(&#39;100%&#39;).backgroundColor(0xDCDCDC).padding(&#123; top: 20 &#125;)
</code></pre>
<p>  }<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">#### 3. How to display a @Builder-decorated function in the description of a HarmonyOS custom dialog?  </span><br><span class="line">Refer to the following demo:  </span><br></pre></td></tr></table></figure>
<p>@Builder<br>function customDialogBuilder(price:string,id_no:string) {<br>  Column({space:15}) {<br>    Row() {<br>      Text(‘运费:’ + price)<br>        .fontSize(10)<br>    }<br>    Row() {<br>      Text(‘货单:’ + id_no)<br>        .fontSize(10)<br>    }<br>  }<br>  .width(‘100%’)<br>  .height(200)<br>  .padding(5)<br>  .backgroundColor(“#FF0000”)<br>}</p>
<p>@CustomDialog<br>struct CustomDialogExample {<br>  @Link title: string<br>  @Link price: string<br>  @Link id_no: string<br>  controller?: CustomDialogController<br>  cancel: () &#x3D;&gt; void &#x3D; () &#x3D;&gt; {<br>  }<br>  confirm: () &#x3D;&gt; void &#x3D; () &#x3D;&gt; {<br>  }</p>
<p>  build() {<br>    Column() {<br>      Text(this.title).fontSize(20).margin({ top: 10, bottom: 10 })<br>      customDialogBuilder(this.price,this.id_no)<br>      Flex({ justifyContent: FlexAlign.SpaceAround }) {<br>        Button(‘cancel’)<br>          .onClick(() &#x3D;&gt; {<br>            if (this.controller !&#x3D; undefined) {<br>              this.controller.close()<br>              this.cancel()<br>            }<br>          }).backgroundColor(0xffffff).fontColor(Color.Black)<br>        Button(‘confirm’)<br>          .onClick(() &#x3D;&gt; {<br>            if (this.controller !&#x3D; undefined) {<br>              this.controller.close()<br>              this.confirm()<br>            }<br>          }).backgroundColor(0xffffff).fontColor(Color.Red)<br>      }.margin({ bottom: 10 })<br>    }.borderRadius(10)<br>  }<br>}</p>
<p>@Entry<br>@Component<br>struct Index {</p>
<p>  @State title: string &#x3D; ‘’<br>  @State price: string &#x3D; ‘’<br>  @State id_no: string &#x3D; ‘’<br>  dialogController: CustomDialogController | null &#x3D; new CustomDialogController({<br>    builder: CustomDialogExample({<br>      cancel: () &#x3D;&gt; {<br>        this.onCancel()<br>      },<br>      confirm: () &#x3D;&gt; {<br>        this.onAccept()<br>      },<br>      title: $title,<br>      price: $price,<br>      id_no: $id_no,<br>    }),<br>    autoCancel: true,<br>    alignment: DialogAlignment.Bottom,<br>    offset: { dx: 0, dy: -20 },<br>    gridCount: 4,<br>    customStyle: false,<br>    cornerRadius: 10,<br>  })</p>
<p>  &#x2F;&#x2F; Set dialogControlle to null when the custom component is about to be destroyed<br>  aboutToDisappear() {<br>    this.dialogController &#x3D; null &#x2F;&#x2F; Set dialogController to null<br>  }</p>
<p>  onCancel() {<br>    console.info(‘Callback when the first button is clicked’)<br>  }</p>
<p>  onAccept() {<br>    console.info(‘Callback when the second button is clicked’)<br>  }</p>
<p>  build() {<br>    Row() {<br>      Column() {<br>        Button(‘自定义弹框’)<br>          .width(‘100vp’)<br>          .height(‘100vp’)<br>          .onClick(() &#x3D;&gt; {<br>            if (this.dialogController !&#x3D; null) {<br>              this.title &#x3D; ‘自定义弹框title’<br>              this.price &#x3D; ‘100元’<br>              this.id_no &#x3D; ‘1234567895549’<br>              this.dialogController.open()<br>            }<br>          })<br>      }<br>      .width(‘100%’)<br>    }<br>    .height(‘100%’)<br>  }<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">#### 4. How to set images for normal and selected states of a HarmonyOS button?  </span><br><span class="line">Set one image for the normal state and another for the selected state.  </span><br><span class="line">Refer to the demo:  </span><br></pre></td></tr></table></figure>
<p>@Entry<br>@Component<br>struct Page240605153407040 {<br>  @State message: string &#x3D; ‘app.media.photo’;</p>
<p>  build() {<br>    Row() {<br>      Column() {<br>        Button() {<br>          Image($r(this.message))<br>        }<br>        .width(40).height(40).margin({ left: 18 })<br>        .onClick(()&#x3D;&gt;{<br>          if (this.message &#x3D;&#x3D; ‘app.media.photo’ ) {<br>            this.message &#x3D; ‘app.media.startIcon’<br>          }else {<br>            this.message &#x3D; ‘app.media.photo’<br>          }</p>
<pre><code>    &#125;)
  &#125;
  .width(&#39;100%&#39;)
&#125;
.height(&#39;100%&#39;)
</code></pre>
<p>  }<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">#### 5. How to automatically pop up the soft keyboard after opening a page in HarmonyOS?  </span><br><span class="line">Use focusControl.requestFocus to control the input box&#x27;s focus. The soft keyboard will automatically pop up when the component gains focus.  </span><br><span class="line">The TextInput triggers the input method when focused and closes it when focus is lost. Use focusControl to manage focus for closing the soft keyboard.  </span><br></pre></td></tr></table></figure>
<p>build() {<br>  Column() {<br>    TextInput()<br>    Button(<code>hide</code>)<br>      .key(‘button’)<br>      .onClick(()&#x3D;&gt;{<br>        focusControl.requestFocus(‘button’)<br>      })<br>  }<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Judge by listening to the keyboard height change event:  </span><br></pre></td></tr></table></figure>
<p>window.getLastWindow(context).then(lastWindow &#x3D;&gt; {<br>  lastWindow.on(‘keyboardHeightChange’, (size: number) &#x3D;&gt; {<br>    console.warn(<code>...keyboardHeightChange: $&#123;size&#125;</code>);<br>  })<br>}).catch((err: BusinessError) &#x3D;&gt; {console.error(<code>...error message: $&#123;err.message&#125;</code>);<br>})<br>&#96;&#96;&#96;</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://harmonyostech.github.io/2025/06/26/312-Daily-Harmony-Learnings-on-HarmonyOS-Next-Anti-Hotlinking-Navigation-Title-Color-Refresh-Component-Callback-Page-Routing-Removal-Pull-to-Load-More/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Qingkouwei">
      <meta itemprop="description" content="Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HarmonyOS NEXT Knowledge Charging Station">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/06/26/312-Daily-Harmony-Learnings-on-HarmonyOS-Next-Anti-Hotlinking-Navigation-Title-Color-Refresh-Component-Callback-Page-Routing-Removal-Pull-to-Load-More/" class="post-title-link" itemprop="url">[Daily Harmony Learnings on HarmonyOS Next] Anti-Hotlinking, Navigation Title Color, Refresh Component Callback, Page Routing Removal, Pull-to-Load More</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-06-26 22:08:41 / Modified: 22:14:19" itemprop="dateCreated datePublished" datetime="2025-06-26T22:08:41+08:00">2025-06-26</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Daily-HarmonyOS-Next-Knowledge/" itemprop="url" rel="index"><span itemprop="name">Daily HarmonyOS Next Knowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Daily-Harmony-Learnings-on-HarmonyOS-Next-Anti-Hotlinking-Navigation-Title-Color-Refresh-Component-Callback-Page-Routing-Removal-Pull-to-Load-More"><a href="#Daily-Harmony-Learnings-on-HarmonyOS-Next-Anti-Hotlinking-Navigation-Title-Color-Refresh-Component-Callback-Page-Routing-Removal-Pull-to-Load-More" class="headerlink" title="[Daily Harmony Learnings on HarmonyOS Next] Anti-Hotlinking, Navigation Title Color, Refresh Component Callback, Page Routing Removal, Pull-to-Load More"></a>[Daily Harmony Learnings on HarmonyOS Next] Anti-Hotlinking, Navigation Title Color, Refresh Component Callback, Page Routing Removal, Pull-to-Load More</h3><h4 id="1-How-to-add-anti-hotlinking-to-a-network-URL-when-loading-an-image-in-HarmonyOS"><a href="#1-How-to-add-anti-hotlinking-to-a-network-URL-when-loading-an-image-in-HarmonyOS" class="headerlink" title="1. How to add anti-hotlinking to a network URL when loading an image in HarmonyOS?"></a>1. How to add anti-hotlinking to a network URL when loading an image in HarmonyOS?</h4><p>For anti-hotlinking, refer to DRM capabilities. Documentation link: <a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-drm-V5">https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-drm-V5</a>  </p>
<p>The DRM (Digital Rights Management) framework component supports the development of digital rights management functions for audio and video media services. Developers can call the system-provided DRM plug-in to complete the following functions:  </p>
<ul>
<li>DRM certificate management: Generate certificate requests, set certificate responses, and implement certificate Provision (download) functions.  </li>
<li>DRM media key management: Generate media key requests, set media key responses, and manage offline media key functions.  </li>
<li>DRM program authorization: Support DRM plug-ins to authorize DRM programs based on media key permissions.  </li>
<li>DRM program decryption: Support decryption calls for media playback functions to decrypt DRM programs.</li>
</ul>
<p>To compress images to within a specified target size: <a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/forum/topic/0203144584728486846?fid=0109140870620153026">https://developer.huawei.com/consumer/cn/forum/topic/0203144584728486846?fid=0109140870620153026</a>  </p>
<p>Currently, the Image component cannot set anti-hotlinking. The third-party library imageknife can set <code>imageKnife.addHeader(&#39;refer&#39;, &quot;http://1.94.37.200:7070/AntiT.&quot;);</code> Reference: <a target="_blank" rel="noopener" href="https://ohpm.openharmony.cn/#/cn/detail/@ohos%2Fimageknife">https://ohpm.openharmony.cn/#/cn/detail/@ohos%2Fimageknife</a>  </p>
<h4 id="2-How-to-remove-the-light-background-of-the-back-button-in-the-HarmonyOS-Navigation-title"><a href="#2-How-to-remove-the-light-background-of-the-back-button-in-the-HarmonyOS-Navigation-title" class="headerlink" title="2. How to remove the light background of the back button in the HarmonyOS Navigation title?"></a>2. How to remove the light background of the back button in the HarmonyOS Navigation title?</h4><p>When the Navigation title is set to mini mode, a back button appears. How to remove the background color of this back button?  </p>
<p>You can hide the back button and customize a back button with a custom style, using a click event to return to the previous page. Reference link: <a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-routing-V5#%E9%A1%B5%E9%9D%A2%E8%BF%94%E5%9B%9E">https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-routing-V5#%E9%A1%B5%E9%9D%A2%E8%BF%94%E5%9B%9E</a>  </p>
<p>When users complete operations on a page, they often need to return to the previous page or a specified page, which requires the page return function. During the return process, data may need to be passed to the target page, requiring data passing functions.<br>Before using page routing Router-related functions, import the Router module in the code:  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import &#123; router &#125; from &#x27;@kit.ArkUI&#x27;;</span><br><span class="line">```  </span><br><span class="line">You can return to the page in the following ways:  </span><br><span class="line"></span><br><span class="line">- **Method 1**: Return to the previous page.  </span><br></pre></td></tr></table></figure>
<p>import { router } from ‘@kit.ArkUI’;<br>router.back();</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">This method returns to the previous page (the position of the previous page in the page stack). However, the previous page must exist in the page stack to return; otherwise, the method is invalid.  </span><br><span class="line"></span><br><span class="line">- **Method 2**: Return to a specified page.  </span><br><span class="line">  - Return to a normal page.  </span><br></pre></td></tr></table></figure>
<p>import { router } from ‘@kit.ArkUI’;</p>
<p>router.back({<br>  url: ‘pages&#x2F;Home’<br>});</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- Return to a named routing page.  </span><br></pre></td></tr></table></figure>
<p>import { router } from ‘@kit.ArkUI’;</p>
<p>router.back({<br>  url: ‘myPage’ &#x2F;&#x2F; myPage is the alias of the named routing page to return to<br>});</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">This method returns to a specified page by specifying the target page path. The target page must exist in the page stack to return.  </span><br><span class="line"></span><br><span class="line">- **Method 3**: Return to a specified page and pass custom parameter information.  </span><br><span class="line">  - Return to a normal page.  </span><br></pre></td></tr></table></figure>
<p>import { router } from ‘@kit.ArkUI’;</p>
<p>router.back({<br>  url: ‘pages&#x2F;Home’,<br>  params: {<br>    info: ‘From Home page’<br>  }<br>});</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- Return to a named routing page.  </span><br></pre></td></tr></table></figure>
<p>import { router } from ‘@kit.ArkUI’;</p>
<p>router.back({<br>  url: ‘myPage’, &#x2F;&#x2F; myPage is the alias of the named routing page to return to<br>  params: {<br>    info: ‘From Home page’<br>  }<br>});</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">This method not only returns to the specified page but also passes custom parameter information, which can be obtained and parsed in the target page by calling `router.getParams`.  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 3. Inaccurate callback parameters for the HarmonyOS Refresh component&#x27;s onStateChange?  </span><br><span class="line">During the unclosed pull-down process of the Refresh component, it is called multiple times, returning abnormal RefreshStatus states (no Inactive) and showing Done before closure.  </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>.pullDownRatio(this.ratio)<br>.onRefreshing(() &#x3D;&gt; {<br>  this.ratio &#x3D; 0<br>  setTimeout(() &#x3D;&gt; {<br>    this.isRefreshing &#x3D; false;<br>  }, 2000)<br>})<br>.onOffsetChange((value: number) &#x3D;&gt; {<br>  if (value &#x3D;&#x3D; 0) {<br>    this.ratio &#x3D; undefined<br>  }<br>})</p>
<pre><code>

#### 4. How to remove pages in HarmonyOS page routing?  
Move a page in the stack to the top and remove subsequent pages before it: A-&gt;B-&gt;C-&gt;D, move B to the top and remove pages C and D.  

To remove pages, use `router.clear()` or the Single mode in RouterMode. In single-instance mode, clearing pages C and D will move B to the top by default. In multi-instance mode, adjust based on specific requirements. Reference: https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-router-V5  


#### 5. How to implement pull-to-load more in HarmonyOS?  
Reference the following link: https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-layout-development-create-list-V5  

A list is a complex container that automatically provides scrolling when the number of list items reaches a certain quantity and the content exceeds the screen size. It is suitable for presenting similar data types or data type sets, such as images and text. Displaying data collections in lists is a common requirement in many applications (e.g., address books, music lists, shopping lists, etc.).  

Lists enable efficient display of structured, scrollable information. By linearly arranging child components ListItemGroup or ListItem in the List component vertically or horizontally, you can provide single views for rows or columns in the list, use loop rendering to iterate over a group of rows or columns, or mix any number of single views and ForEach structures to build a list. The List component supports rendering control methods such as conditional rendering, loop rendering, and lazy loading to generate child components.
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://harmonyostech.github.io/2025/06/26/311-Daily-HarmonyOS-Next-Knowledge-Landscape-Portrait-Switch-Animation-Time-Date-Functions-Tabs-Routing-Return-Listening-String-Issues/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Qingkouwei">
      <meta itemprop="description" content="Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HarmonyOS NEXT Knowledge Charging Station">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/06/26/311-Daily-HarmonyOS-Next-Knowledge-Landscape-Portrait-Switch-Animation-Time-Date-Functions-Tabs-Routing-Return-Listening-String-Issues/" class="post-title-link" itemprop="url">311[Daily HarmonyOS Next Knowledge] Landscape-Portrait Switch Animation, Time-Date Functions, Tabs, Routing Return Listening, String Issues</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-06-26 22:06:33 / Modified: 22:14:23" itemprop="dateCreated datePublished" datetime="2025-06-26T22:06:33+08:00">2025-06-26</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Daily-HarmonyOS-Next-Knowledge/" itemprop="url" rel="index"><span itemprop="name">Daily HarmonyOS Next Knowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Daily-HarmonyOS-Next-Knowledge-Landscape-Portrait-Switch-Animation-Time-Date-Functions-Tabs-Routing-Return-Listening-String-Issues"><a href="#Daily-HarmonyOS-Next-Knowledge-Landscape-Portrait-Switch-Animation-Time-Date-Functions-Tabs-Routing-Return-Listening-String-Issues" class="headerlink" title="[Daily HarmonyOS Next Knowledge] Landscape-Portrait Switch Animation, Time-Date Functions, Tabs, Routing Return Listening, String Issues"></a>[Daily HarmonyOS Next Knowledge] Landscape-Portrait Switch Animation, Time-Date Functions, Tabs, Routing Return Listening, String Issues</h3><h4 id="1-How-to-listen-for-the-callback-when-the-landscape-portrait-animation-ends-in-HarmonyOS"><a href="#1-How-to-listen-for-the-callback-when-the-landscape-portrait-animation-ends-in-HarmonyOS" class="headerlink" title="1. How to listen for the callback when the landscape-portrait animation ends in HarmonyOS?"></a>1. How to listen for the callback when the landscape-portrait animation ends in HarmonyOS?</h4><p>To set landscape-portrait switching, use <code>setPreferredOrientation</code>: <a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-window-V5">https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-window-V5</a><br>Windows provide basic capabilities for managing windows, including creation, destruction, attribute settings, and scheduling between windows.<br>The module offers the following common window-related functions:  </p>
<ul>
<li><code>Window</code>: The current window instance, the basic unit managed by the window manager.  </li>
<li><code>WindowStage</code>: The window manager, responsible for managing each basic window unit.</li>
</ul>
<h4 id="2-When-creating-a-Date-class-in-HarmonyOS-and-passing-in-year-month-day-hour-minute-second-why-does-converting-the-millisecond-value-obtained-via-getTime-back-to-year-month-day-yield-different-results"><a href="#2-When-creating-a-Date-class-in-HarmonyOS-and-passing-in-year-month-day-hour-minute-second-why-does-converting-the-millisecond-value-obtained-via-getTime-back-to-year-month-day-yield-different-results" class="headerlink" title="2. When creating a Date class in HarmonyOS and passing in year-month-day-hour-minute-second, why does converting the millisecond value obtained via getTime() back to year-month-day yield different results?"></a>2. When creating a Date class in HarmonyOS and passing in year-month-day-hour-minute-second, why does converting the millisecond value obtained via getTime() back to year-month-day yield different results?</h4><p>The obtained <code>date</code> is a timestamp. During conversion, it defaults to foreign time, which may differ from domestic time (e.g., month differences). Adjustments like addition&#x2F;subtraction are needed.<br>Demo for converting <code>date</code> to time:  </p>
<pre><code class="language-typescript">class Opt &#123;
  yy: string = &#39;&#39;;
  mm: string = &#39;&#39;;
  dd: string = &#39;&#39;;
  HH: string = &#39;&#39;;
  MM: string = &#39;&#39;;
  SS: string = &#39;&#39;;
&#125;
@Entry
@Component
struct TimePage &#123;
  @State message: number = 1622422400000;
  formatDate(timestamp: number, format = &#39;yyyy-mm-dd&#39;) &#123;
    let res = &quot;&quot;;
    try &#123;
      const date = new Date(timestamp);
      const opt: Opt = &#123;
        yy: date.getFullYear().toString(),
        mm: (date.getMonth() + 1).toString(),
        dd: date.getDate().toString(),
        HH: date.getHours().toString(),
        MM: date.getMinutes().toString(),
        SS: date.getSeconds().toString(),
      &#125;;
      const regKeys: string[] = [&#39;y+&#39;, &#39;m+&#39;, &#39;d+&#39;, &#39;H+&#39;, &#39;M+&#39;, &#39;S+&#39;];
      for (let i = 0; i &lt; regKeys.length; i++) &#123;
        const regKey = regKeys[i];
        const reg = new RegExp(regKey);
        let ret = reg.exec(format);
        if (ret) &#123;
          switch (regKey) &#123;
            case &#39;y+&#39;:
              format = format.replace(reg, ret.length === 1 ? opt.yy : opt.yy.padStart(ret.length, &quot;0&quot;));
            case &#39;m+&#39;:
              format = format.replace(reg, ret.length === 1 ? opt.mm : opt.mm.padStart(ret.length, &quot;0&quot;));
            case &#39;d+&#39;:
              format = format.replace(reg, ret.length === 1 ? opt.dd : opt.dd.padStart(ret.length, &quot;0&quot;));
            case &#39;H+&#39;:
              format = format.replace(reg, ret.length === 1 ? opt.HH : opt.HH.padStart(ret.length, &quot;0&quot;));
            case &#39;M+&#39;:
              format = format.replace(reg, ret.length === 1 ? opt.MM : opt.MM.padStart(ret.length, &quot;0&quot;));
            case &#39;S+&#39;:
              format = format.replace(reg, ret.length === 1 ? opt.SS : opt.SS.padStart(ret.length, &quot;0&quot;));
          &#125;
        &#125;
      &#125;
      res = format;
    &#125; catch (error) &#123;
      console.error(&quot;ERROR formatDate&quot; + error);
    &#125;
    return res;
  &#125;
  build() &#123;
    Row() &#123;
      Column() &#123;
        Text(this.formatDate(new Date(this.message).valueOf(),&#39;yyyy/mm/dd HH:MM:SS&#39;)).fontSize(30)
      &#125;
      .width(&#39;100%&#39;)
    &#125;
    .height(&#39;100%&#39;)
  &#125;
&#125;
</code></pre>
<p>Reference documentation for the third-party library <code>dayjs</code>: <a target="_blank" rel="noopener" href="https://ohpm.openharmony.cn/#/cn/detail/dayjs">https://ohpm.openharmony.cn/#/cn/detail/dayjs</a>  </p>
<h4 id="3-How-to-set-the-font-color-and-tabBar-color-of-the-Tabs-component-in-HarmonyOS"><a href="#3-How-to-set-the-font-color-and-tabBar-color-of-the-Tabs-component-in-HarmonyOS" class="headerlink" title="3. How to set the font color and tabBar color of the Tabs component in HarmonyOS?"></a>3. How to set the font color and tabBar color of the Tabs component in HarmonyOS?</h4><p>To set the font color, use a custom navigation bar. Reference: <a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-navigation-tabs-V5#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AF%BC%E8%88%AA%E6%A0%8F">https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-navigation-tabs-V5#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AF%BC%E8%88%AA%E6%A0%8F</a><br>The bottom navigation bar, typically used to distinguish main page functions, combines text and semantic icons for better user experience. In such cases, customizing the navigation tab style is required.<br>![[Pasted image 20250310001146.png]]<br>By default, the system uses an underline to mark the active tab, while custom navigation bars must implement styles to distinguish active and inactive tabs.<br>Custom navigation bars are set via the <code>tabBar</code> parameter using a <code>CustomBuilder</code>-supported custom function component. For example, declare a custom function component <code>tabBuilder</code> that accepts parameters including tab text <code>title</code>, index <code>targetIndex</code>, and image resources for selected&#x2F;normal states. The UI style is determined by matching <code>currentIndex</code> (active index) with <code>targetIndex</code> (tab index).  </p>
<pre><code class="language-typescript">@State currentIndex: number = 0;

@Builder tabBuilder(title: string, targetIndex: number, selectedImg: Resource, normalImg: Resource) &#123;
  Column() &#123;
    Image(this.currentIndex === targetIndex ? selectedImg : normalImg)
      .size(&#123; width: 25, height: 25 &#125;)
    Text(title)
      .fontColor(this.currentIndex === targetIndex ? &#39;#1698CE&#39; : &#39;#6B6B6B&#39;)
  &#125;
  .width(&#39;100%&#39;)
  .height(50)
  .justifyContent(FlexAlign.Center)
&#125;
</code></pre>
<p>Demo:  </p>
<pre><code class="language-typescript">@Entry
@Component
struct TabsExample1 &#123;
  @State currentIndex: number = 2

  @Builder tabBuilder(title: string, targetIndex: number) &#123;
    Column() &#123;
      Text(title)
        .fontColor(this.currentIndex === targetIndex ? &#39;#FF0000&#39; : &#39;#00FF00&#39;)
    &#125;
  &#125;

  build() &#123;
    Column() &#123;
      Tabs(&#123; barPosition: BarPosition.End &#125;) &#123;
        TabContent() &#123;

        &#125;.tabBar(this.tabBuilder(&#39;Home&#39;, 0))

        TabContent() &#123;

        &#125;.tabBar(this.tabBuilder(&#39;Discover&#39;, 1))

        TabContent() &#123;

        &#125;.tabBar(this.tabBuilder(&#39;Recommend&#39;, 2))

        TabContent() &#123;

        &#125;.tabBar(this.tabBuilder(&#39;Mine&#39;, 3))
      &#125;
      .animationDuration(0)
      .backgroundColor(&#39;#F1F3F5&#39;)
      .onChange((index: number) =&gt; &#123;
        this.currentIndex = index
      &#125;)
    &#125;.width(&#39;100%&#39;)
  &#125;
&#125;
</code></pre>
<h4 id="4-Does-HarmonyOS-Navigation-support-routing-return-listening-similar-to-Flutter"><a href="#4-Does-HarmonyOS-Navigation-support-routing-return-listening-similar-to-Flutter" class="headerlink" title="4. Does HarmonyOS Navigation support routing return listening similar to Flutter?"></a>4. Does HarmonyOS Navigation support routing return listening similar to Flutter?</h4><p>Navigation supports return listening via <code>onBackPressed</code>. Refer to the official example: <a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-basic-components-navigation-V5">https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-basic-components-navigation-V5</a><br>The Navigation component is the root view container for routing, typically used as the root container of a Page. It internally includes a title bar, content area, and toolbar by default. The content area displays navigation content (Navigation’s child components) on the home page or NavDestination’s child components on non-home pages, with switching via routing.  </p>
<h4 id="5-How-to-determine-if-a-character-in-a-HarmonyOS-string-is-an-alphabet-Chinese-character-or-number"><a href="#5-How-to-determine-if-a-character-in-a-HarmonyOS-string-is-an-alphabet-Chinese-character-or-number" class="headerlink" title="5. How to determine if a character in a HarmonyOS string is an alphabet, Chinese character, or number?"></a>5. How to determine if a character in a HarmonyOS string is an alphabet, Chinese character, or number?</h4><pre><code class="language-typescript">str = &quot;AB汉字123nb&quot;
for (let i = 0; i &lt; str.length; i++) &#123;
  const c = str.charAt(i)
&#125;
</code></pre>
<p>Use <code>charCodeAt()</code> to convert each character to its ASCII value, then determine the type by comparing it with the ASCII range of alphabets, Chinese characters, and numbers.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://harmonyostech.github.io/2025/06/26/310-Daily-HarmonyOS-Next-Knowledge-Two-Font-Sizes-in-Text-Component-Left-Right-Row-Layout-JS-Engine-Multi-Level-Linkage-Centered-Navigation-Title/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Qingkouwei">
      <meta itemprop="description" content="Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HarmonyOS NEXT Knowledge Charging Station">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/06/26/310-Daily-HarmonyOS-Next-Knowledge-Two-Font-Sizes-in-Text-Component-Left-Right-Row-Layout-JS-Engine-Multi-Level-Linkage-Centered-Navigation-Title/" class="post-title-link" itemprop="url">[Daily HarmonyOS Next Knowledge] Two Font Sizes in Text Component, Left-Right Row Layout, JS Engine, Multi-Level Linkage, Centered Navigation Title</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-06-26 22:05:19 / Modified: 22:06:53" itemprop="dateCreated datePublished" datetime="2025-06-26T22:05:19+08:00">2025-06-26</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Daily-HarmonyOS-Next-Knowledge/" itemprop="url" rel="index"><span itemprop="name">Daily HarmonyOS Next Knowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Daily-HarmonyOS-Next-Knowledge-Two-Font-Sizes-in-Text-Component-Left-Right-Row-Layout-JS-Engine-Multi-Level-Linkage-Centered-Navigation-Title"><a href="#Daily-HarmonyOS-Next-Knowledge-Two-Font-Sizes-in-Text-Component-Left-Right-Row-Layout-JS-Engine-Multi-Level-Linkage-Centered-Navigation-Title" class="headerlink" title="[Daily HarmonyOS Next Knowledge] Two Font Sizes in Text Component, Left-Right Row Layout, JS Engine, Multi-Level Linkage, Centered Navigation Title"></a>[Daily HarmonyOS Next Knowledge] Two Font Sizes in Text Component, Left-Right Row Layout, JS Engine, Multi-Level Linkage, Centered Navigation Title</h3><h4 id="1-Is-there-a-way-to-display-two-font-sizes-within-a-single-Text-component-in-HarmonyOS"><a href="#1-Is-there-a-way-to-display-two-font-sizes-within-a-single-Text-component-in-HarmonyOS" class="headerlink" title="1. Is there a way to display two font sizes within a single Text component in HarmonyOS?"></a>1. Is there a way to display two font sizes within a single Text component in HarmonyOS?</h4><p>There’s a requirement to display prices with the digits before the decimal point in 18pt and those after in 12pt. How can this be achieved?  </p>
<p>This can be implemented using Text spans. Reference: <a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-basic-components-text-V5">https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-basic-components-text-V5</a>  </p>
<p>DEMO:  </p>
<pre><code class="language-typescript">Row() &#123;
  Text() &#123;
    Span(&#39;9999&#39;).fontSize(18).fontColor(Color.Orange)
    Span(&#39;.00&#39;).fontSize(12).fontColor(Color.Orange)
  &#125;
&#125;.width(&#39;100%&#39;).height(&#39;100%&#39;)
</code></pre>
<h4 id="2-In-a-HarmonyOS-Row-container-with-two-child-controls-how-to-align-one-child-left-and-the-other-centered"><a href="#2-In-a-HarmonyOS-Row-container-with-two-child-controls-how-to-align-one-child-left-and-the-other-centered" class="headerlink" title="2. In a HarmonyOS Row container with two child controls, how to align one child left and the other centered?"></a>2. In a HarmonyOS Row container with two child controls, how to align one child left and the other centered?</h4><p>There are two child controls in a Row container. How to align one child to the left and the other to the center?  </p>
<p>Two recommended solutions:  </p>
<ol>
<li>Calculate distances by setting margins on each child control.  </li>
<li>Use Flex layout with a transparent placeholder control.</li>
</ol>
<p>Demo reference:  </p>
<pre><code class="language-typescript">@Entry
@Component
struct test &#123;
  build() &#123;
    Column() &#123;
      Text(&quot;Using margin&quot;)
      Row() &#123;
        Text(&quot;Left-aligned&quot;).backgroundColor(Color.Red).height(100).width(60).margin(&#123; left: 0 &#125;)
        Text(&quot;Centered&quot;).backgroundColor(Color.Blue).height(100).width(60).margin(&#123; left: 90 &#125;)
      &#125;.width(&#39;100%&#39;)

      Text(&quot;Using flex&quot;)
      Row() &#123;
        Text(&quot;Left-aligned&quot;).backgroundColor(Color.Red).height(100).width(60)
        Text(&quot;Centered&quot;).backgroundColor(Color.Blue).height(100).width(60)
        Text(&quot;Transparent placeholder&quot;).height(100).width(60).visibility(Visibility.Hidden)
      &#125;.width(&#39;100%&#39;).justifyContent(FlexAlign.SpaceBetween)
    &#125;
  &#125;
&#125;
</code></pre>
<h4 id="3-How-to-integrate-a-JS-engine-on-HarmonyOS"><a href="#3-How-to-integrate-a-JS-engine-on-HarmonyOS" class="headerlink" title="3. How to integrate a JS engine on HarmonyOS?"></a>3. How to integrate a JS engine on HarmonyOS?</h4><p>Reference: <a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/_j_s_v_m-V5">https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/_j_s_v_m-V5</a>  </p>
<p>JSVM provides standard JavaScript engine capabilities.  </p>
<p><strong>Overview</strong>:<br>The standard JS engine strictly adheres to the EcmaScript specification, supporting the standard libraries defined therein and providing comprehensive native APIs for C++ interaction with JS. It accelerates code execution via JIT, offering secure and efficient JS execution capabilities. These capabilities are exposed through a stable ABI, the JSVM-API, which supports dynamic linking to different JS engine versions, shielding developers from interface differences. The API provides engine lifecycle management, JS context management, JS code execution, JS&#x2F;C++ interoperability, execution environment snapshots, and code caching.  </p>
<p><strong>Supported Platform</strong>: arm64  </p>
<p><strong>Usage</strong>:<br>Link <code>libjsvm.so</code> from the SDK and include the <code>ark_runtime/jsvm.h</code> header in C++ code.  </p>
<p>The API offers independent, standard, and complete JavaScript engine capabilities, including managing engine lifecycle, compiling and running JS code, implementing cross-language calls between JS and C++, and taking snapshots.  </p>
<h4 id="4-Display-issues-with-multi-level-linkage-in-HarmonyOS-TextPicker"><a href="#4-Display-issues-with-multi-level-linkage-in-HarmonyOS-TextPicker" class="headerlink" title="4. Display issues with multi-level linkage in HarmonyOS TextPicker?"></a>4. Display issues with multi-level linkage in HarmonyOS TextPicker?</h4><p>When using two-level linkage, text may be truncated due to excessive length.  </p>
<ol>
<li>Can the width of first&#x2F;second-level items be adjusted?  </li>
<li>Can item content be displayed in multiple lines?</li>
</ol>
<p>Simple example to maximize text display:  </p>
<pre><code class="language-typescript">build() &#123;
  Column() &#123;
    TextPicker(&#123; range: this.multi &#125;)
      .onChange((value: string | string[], index: number | number[]) =&gt; &#123;
        console.info(&#39;TextPicker multi-column: onChange &#39; + JSON.stringify(value) + &#39;, index: &#39; + JSON.stringify(index))
      &#125;)
      .width(&#39;100%&#39;)   // Set .width(&#39;100%&#39;) to maximize text display
  &#125;
&#125;
</code></pre>
<h4 id="5-How-to-center-the-title-in-HarmonyOS-NavDestination"><a href="#5-How-to-center-the-title-in-HarmonyOS-NavDestination" class="headerlink" title="5. How to center the title in HarmonyOS NavDestination?"></a>5. How to center the title in HarmonyOS NavDestination?</h4><p>By default, the title in NavDestination is left-aligned. How to center it?  </p>
<p>NavDestination supports custom title styles. Reference demo:  </p>
<pre><code class="language-typescript">@Entry
@Component
struct NavRouterExample &#123;
  @State isActiveWLAN: boolean = false
  @State isActiveBluetooth: boolean = false
  
  @Builder titleStyle()&#123;
    Text(&#39;Title&#39;)
      .textAlign(TextAlign.Center)
      .fontSize(30)
      .position(&#123; x: &#39;50%&#39;&#125;)
      .translate(&#123;x:&#39;-50%&#39;&#125;)
  &#125;
  
  build() &#123;
    Column() &#123;
      Navigation() &#123;
        NavRouter() &#123;
          Row() &#123;
            Row().width(30).height(30).borderRadius(30).margin(&#123; left: 3, right: 10 &#125;).backgroundColor(Color.Pink)
            Text(`WLAN`)
              .fontSize(22)
              .fontWeight(500)
              .textAlign(TextAlign.Center)
          &#125;
          .width(&#39;90%&#39;)
          .height(72)
          
          NavDestination() &#123;
            Flex(&#123; direction: FlexDirection.Row &#125;) &#123;
              Text(&#39;No available WLAN found&#39;).fontSize(30).padding(&#123; left: 15 &#125;)
            &#125;
          &#125;
          .title(this.titleStyle())
          .hideTitleBar(false).backgroundColor(&#39;#0c182431&#39;)
        &#125;.backgroundColor(this.isActiveWLAN ? &#39;#ccc&#39; : &#39;#fff&#39;)
        .borderRadius(24)
        .onStateChange((isActivated: boolean) =&gt; &#123;
          this.isActiveWLAN = isActivated
        &#125;)

        NavRouter() &#123;
          Row() &#123;
            Row().width(30).height(30).borderRadius(30).margin(&#123; left: 3, right: 10 &#125;).backgroundColor(Color.Pink)
            Text(`Bluetooth`)
              .fontSize(22)
              .fontWeight(500)
              .textAlign(TextAlign.Center)
          &#125;
          .width(&#39;90%&#39;)
          .height(72)

          NavDestination() &#123;
            Flex(&#123; direction: FlexDirection.Row &#125;) &#123;
              Text(&#39;No available Bluetooth found&#39;).fontSize(30).padding(&#123; left: 15 &#125;)
            &#125;
          &#125;.hideTitleBar(false).backgroundColor(&#39;#0c182431&#39;)
        &#125;.backgroundColor(this.isActiveBluetooth ? &#39;#ccc&#39; : &#39;#fff&#39;)
        .borderRadius(24)
        .onStateChange((isActivated: boolean) =&gt; &#123;
          this.isActiveBluetooth = isActivated
        &#125;)
      &#125;
      .title(&#39;Settings&#39;)
      .titleMode(NavigationTitleMode.Free)
      .mode(NavigationMode.Auto)
      .hideTitleBar(false)
      .hideToolBar(true)
    &#125;.height(&#39;100%&#39;)
  &#125;
&#125;
</code></pre>
<p>Reference: <a target="_blank" rel="noopener" href="http://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-basic-components-navdestination-V5">http://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-basic-components-navdestination-V5</a>  </p>
<p>NavDestination serves as the root container for child pages, displaying the content area of Navigation.  </p>
<ul>
<li>NavDestination must be used with Navigation as the root node of Navigation’s destination pages. When used alone, it functions as a regular container without routing capabilities.  </li>
<li>If the lifecycle of an intermediate page in the page stack changes, the lifecycle events (onWillShow, onShown, onHidden, onWillDisappear) of both the previous and new top Destination pages trigger last.  </li>
<li>The title bar is hidden if NavDestination has no main&#x2F;subtitle and no back button.</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://harmonyostech.github.io/2025/06/26/309-Daily-HarmonyOS-Next-Knowledge-Text-Component-Navigation-Top-Right-Button-Simulated-Dialog-Left-Aligned-Tabs-Offscreen-Rendering/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Qingkouwei">
      <meta itemprop="description" content="Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HarmonyOS NEXT Knowledge Charging Station">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/06/26/309-Daily-HarmonyOS-Next-Knowledge-Text-Component-Navigation-Top-Right-Button-Simulated-Dialog-Left-Aligned-Tabs-Offscreen-Rendering/" class="post-title-link" itemprop="url">[Daily HarmonyOS Next Knowledge] Text Component, Navigation Top-Right Button, Simulated Dialog, Left-Aligned Tabs, Offscreen Rendering</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-06-26 22:01:48 / Modified: 22:06:43" itemprop="dateCreated datePublished" datetime="2025-06-26T22:01:48+08:00">2025-06-26</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Daily-HarmonyOS-Next-Knowledge/" itemprop="url" rel="index"><span itemprop="name">Daily HarmonyOS Next Knowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Daily-HarmonyOS-Next-Knowledge-Text-Component-Navigation-Top-Right-Button-Simulated-Dialog-Left-Aligned-Tabs-Offscreen-Rendering"><a href="#Daily-HarmonyOS-Next-Knowledge-Text-Component-Navigation-Top-Right-Button-Simulated-Dialog-Left-Aligned-Tabs-Offscreen-Rendering" class="headerlink" title="[Daily HarmonyOS Next Knowledge] Text Component, Navigation Top-Right Button, Simulated Dialog, Left-Aligned Tabs, Offscreen Rendering"></a>[Daily HarmonyOS Next Knowledge] Text Component, Navigation Top-Right Button, Simulated Dialog, Left-Aligned Tabs, Offscreen Rendering</h3><h4 id="1-HarmonyOS-Text-Component-UI-Styling"><a href="#1-HarmonyOS-Text-Component-UI-Styling" class="headerlink" title="1. HarmonyOS Text Component UI Styling?"></a>1. HarmonyOS Text Component UI Styling?</h4><p>How to implement a Text control with a small icon at the header, limited to 2 lines, with ellipsis and a differently colored “View More” when content overflows.  </p>
<p>Use the RichEditor component. Reference: <a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-basic-components-richeditor-V5">https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-basic-components-richeditor-V5</a>  </p>
<p>Main supported attributes:<br><strong>customKeyboard</strong><br>customKeyboard(value: CustomBuilder, options?: KeyboardOptions)<br>Sets a custom keyboard. When a custom keyboard is set, the system input method does not open after the input box is activated; instead, the specified custom component is loaded. The height of the custom keyboard can be set via the height attribute of the custom component’s root node; the width uses the system default and cannot be set. The custom keyboard cannot obtain focus but intercepts gesture events, and it closes by default when the input control loses focus. If the device supports camera input, setting a custom keyboard disables camera input for the input box.  </p>
<p><strong>bindSelectionMenu</strong><br>bindSelectionMenu(spanType: RichEditorSpanType, content: CustomBuilder, responseType: ResponseType | RichEditorResponseType, options?: SelectionMenuOptions)<br>Sets a custom selection menu. When the custom menu is too long, nesting a Scroll component is recommended to avoid keyboard obstruction.  </p>
<p><strong>copyOptions</strong><br>copyOptions(value: CopyOptions)<br>Sets whether the component supports text copy-paste. When copyOptions is not CopyOptions.None, long-pressing the component content pops up a text selection dialog. If a custom selection menu is set via bindSelectionMenu, the custom menu is displayed. Setting copyOptions to CopyOptions.None disables copy and cut functions.  </p>
<p><strong>enableDataDetector11+</strong><br>enableDataDetector(enable: boolean)<br>Enables&#x2F;disables special entity recognition in text. This interface relies on the device’s underlying text recognition capability; otherwise, the setting is ineffective. When enableDataDetector is true and dataDetectorConfig is not set, all entity types are recognized by default, with their color and decoration changed to:  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">color: &#x27;#ff007dff&#x27;</span><br><span class="line">decoration:&#123;</span><br><span class="line">  type: TextDecorationType.Underline,</span><br><span class="line">  color: &#x27;#ff007dff&#x27;,</span><br><span class="line">  style: TextDecorationStyle.SOLID</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Tapping or right-clicking an entity pops up a corresponding operation menu based on the entity type; left-clicking directly triggers the first menu option. This function does not apply to text in addBuilderSpan nodes. When copyOption is CopyOptions.None, the entity menu lacks text selection and copy functions.  </p>
<p><strong>dataDetectorConfig11+</strong><br>dataDetectorConfig(config: TextDataDetectorConfig)<br>Sets text recognition configuration, which takes effect only when enableDataDetector is true. When two entities A and B overlap:  </p>
<ol>
<li>If A ⊂ B, retain B; otherwise, retain A.  </li>
<li>If neither A ⊂ B nor B ⊂ A, retain the entity with the smaller start index.</li>
</ol>
<h4 id="2-How-to-Add-a-Top-Right-Button-to-NavDestination-in-HarmonyOS"><a href="#2-How-to-Add-a-Top-Right-Button-to-NavDestination-in-HarmonyOS" class="headerlink" title="2. How to Add a Top-Right Button to NavDestination in HarmonyOS?"></a>2. How to Add a Top-Right Button to NavDestination in HarmonyOS?</h4><p>NavDestination supports adding top-right buttons via menus. Refer to: <a target="_blank" rel="noopener" href="https://gitee.com/openharmony/docs/blob/master/zh-cn/application-dev/reference/apis-arkui/arkui-ts/ts-basic-components-navigation.md#%E7%A4%BA%E4%BE%8B2">https://gitee.com/openharmony/docs/blob/master/zh-cn/application-dev/reference/apis-arkui/arkui-ts/ts-basic-components-navigation.md#%E7%A4%BA%E4%BE%8B2</a>  </p>
<pre><code class="language-typescript">@Entry
@Component
struct Index &#123;
  pathStack: NavPathStack = new NavPathStack()

  private menuItems: Array&lt;NavigationMenuItem&gt; = [
    &#123;
      value: &quot;1&quot;,
      icon: &#39;resources/base/media/startIcon.png&#39;,
    &#125;,
    &#123;
      value: &quot;2&quot;,
      icon: &#39;resources/base/media/startIcon.png&#39;,
      isEnabled: false,
    &#125;,
    &#123;
      value: &quot;3&quot;,
      icon: &#39;resources/base/media/startIcon.png&#39;,
      isEnabled: true,
    &#125;
  ]

  build() &#123;
    NavDestination() &#123;
      Column() &#123;
        Button(&#39;pushPathByName&#39;, &#123; stateEffect: true, type: ButtonType.Capsule &#125;)
          .width(&#39;80%&#39;)
          .height(40)
          .margin(20)
          .onClick(() =&gt; &#123;
            this.pathStack.pushPathByName(&#39;pageOne&#39;, null)
          &#125;)
      &#125;.width(&#39;100%&#39;).height(&#39;100%&#39;)
    &#125;.title(&#39;pageTwo&#39;)
    .menus(this.menuItems)
    .onBackPressed(() =&gt; &#123;
      this.pathStack.pop()
      return true
    &#125;)
    .onReady((context: NavDestinationContext) =&gt; &#123;
      this.pathStack = context.pathStack;
      console.log(&quot;current page config info is &quot; + JSON.stringify(context.getConfigInRouteMap()))
    &#125;)
  &#125;
&#125;
</code></pre>
<h4 id="3-Simulating-a-Dialog-with-window-createWindow-in-HarmonyOS"><a href="#3-Simulating-a-Dialog-with-window-createWindow-in-HarmonyOS" class="headerlink" title="3. Simulating a Dialog with window.createWindow in HarmonyOS?"></a>3. Simulating a Dialog with window.createWindow in HarmonyOS?</h4><p>Using window.createWindow to simulate a dialog causes physical back buttons to fail in secondary pages. Use createSubWindow to avoid this. Refer to the demo:  </p>
<pre><code class="language-typescript">// EntryAbility.ets
onWindowStageCreate(windowStage: window.WindowStage): void &#123;
  hilog.info(0x0000, &#39;testTag&#39;, &#39;%&#123;public&#125;s&#39;, &#39;Ability onWindowStageCreate&#39;);

  windowStage.loadContent(&#39;pages/Index&#39;, (err, data) =&gt; &#123;
    if (err.code) &#123;
      hilog.error(0x0000, &#39;testTag&#39;, &#39;Failed to load the content. Cause: %&#123;public&#125;s&#39;, JSON.stringify(err) ?? &#39;&#39;);
      return;
    &#125;
    AppStorage.setOrCreate(&quot;windowStage&quot;, windowStage);
    hilog.info(0x0000, &#39;testTag&#39;, &#39;Succeeded in loading the content. Data: %&#123;public&#125;s&#39;, JSON.stringify(data) ?? &#39;&#39;);
  &#125;);
&#125;

// Index.ets (main page)
import &#123; window &#125; from &#39;@kit.ArkUI&#39;;

@Entry
@Component
struct Index &#123;
  @State message: string = &#39;Create Subwindow&#39;;
  @State windowStage: window.WindowStage = AppStorage.get(&quot;windowStage&quot;) as window.WindowStage
  build() &#123;
    Row() &#123;
      Column() &#123;
        Text(this.message)
          .fontSize(50)
          .fontWeight(FontWeight.Bold)
          .onClick(() =&gt; &#123;
            this.windowStage.createSubWindow(&quot;mySubWindow&quot;, (err, windowClass) =&gt; &#123;
              if (err.code &gt; 0) &#123;
                console.error(&quot;failed to create subWindow Cause:&quot; + err.message)
                return;
              &#125;
              try &#123;
                windowClass.setUIContent(&quot;pages/subPage&quot;, () =&gt; &#123;
                  windowClass.setWindowBackgroundColor(&quot;#00000000&quot;)
                &#125;);
                windowClass.moveWindowTo(0, 200)
                windowClass.resize(vp2px(300), vp2px(300))
                windowClass.showWindow();
                windowClass.setWindowLayoutFullScreen(true);
              &#125; catch (err) &#123;
                console.error(&quot;failed to create subWindow Cause:&quot; + err)
              &#125;
            &#125;)
          &#125;)
      &#125;
      .width(&#39;100%&#39;)
    &#125;
    .height(&#39;100%&#39;)
  &#125;
&#125;

// subPage.ets (subwindow page)
import &#123; router, window &#125; from &#39;@kit.ArkUI&#39;;
import &#123; BusinessError &#125; from &#39;@kit.BasicServicesKit&#39;;

@Entry
@Component
struct SubPage &#123;
  @State message: string = &#39;SUBPAGE&#39;;
  @State windowStage: window.WindowStage = AppStorage.get(&quot;windowStage&quot;) as window.WindowStage;

  build() &#123;
    Row() &#123;
      Column() &#123;
        Text(this.message)
          .fontSize(20)
          .fontWeight(FontWeight.Bold)
        Button(&quot;Jump&quot;)
          .onClick(() =&gt; &#123;
            let subWindowID: number = window.findWindow(&quot;mySubWindow&quot;).getWindowProperties().id
            let mainWindowID: number = this.windowStage.getMainWindowSync().getWindowProperties().id
            let promise = window.shiftAppWindowFocus(subWindowID, mainWindowID);
            promise.then(() =&gt; &#123;
              console.info(&#39;Succeeded in shifting app window focus&#39;);
            &#125;).catch((err: BusinessError) =&gt; &#123;
              console.error(&#39;Failed to shift app window focus. Cause: &#39; + JSON.stringify(err));
            &#125;)
            this.windowStage.getMainWindowSync().getUIContext().getRouter().pushUrl(&#123; url: &quot;pages/routerPage&quot; &#125;, router.RouterMode.Single);
          &#125;)
      &#125;
      .width(&#39;100%&#39;)
    &#125;
    .height(&#39;100%&#39;)
    .backgroundColor(Color.Red)
  &#125;
&#125;

// routerPage.ets (jumped page)
@Entry
@Component
struct RouterPage &#123;
  @State message: string = &#39;RouterPage&#39;;

  build() &#123;
    Row() &#123;
      Column() &#123;
        Text(this.message)
          .fontSize(50)
          .fontWeight(FontWeight.Bold)
      &#125;
      .width(&#39;100%&#39;)
    &#125;
    .height(&#39;100%&#39;)
    .backgroundColor(Color.Pink)
  &#125;
&#125;
</code></pre>
<h4 id="4-How-to-Left-Align-Tabs-in-HarmonyOS-When-tabs-width-‘100-’-barWidth-‘90-’-Centers-the-Tab-Bar-by-Default"><a href="#4-How-to-Left-Align-Tabs-in-HarmonyOS-When-tabs-width-‘100-’-barWidth-‘90-’-Centers-the-Tab-Bar-by-Default" class="headerlink" title="4. How to Left-Align Tabs in HarmonyOS When tabs.width(‘100%’).barWidth(‘90%’) Centers the Tab Bar by Default?"></a>4. How to Left-Align Tabs in HarmonyOS When tabs.width(‘100%’).barWidth(‘90%’) Centers the Tab Bar by Default?</h4><p>Refer to the demo:  </p>
<pre><code class="language-typescript">@Entry
@Component
struct TabsExample1 &#123;
  @State tabArray: Array&lt;number&gt; = [0, 1, 2]
  @State focusIndex: number = 0
  @State pre: number = 0
  @State index: number = 0
  private controller: TabsController = new TabsController()
  @State test: boolean = false

  @Builder
  Tab(tabName: string, tabItem: number, tabIndex: number) &#123;
    Row(&#123; space: 20 &#125;) &#123;
      Text(tabName).fontSize(18)
    &#125;
    .justifyContent(FlexAlign.Center)
    .constraintSize(&#123; minWidth: 35 &#125;)
    .width(100)
    .height(60)
    .borderRadius(&#123; topLeft: 10, topRight: 10 &#125;)
    .onClick(() =&gt; &#123;
      this.controller.changeIndex(tabIndex)
      this.focusIndex = tabIndex
    &#125;)
  &#125;

  build() &#123;
    Column() &#123;
      Column() &#123;
        Row(&#123; space: 7 &#125;) &#123;
          Scroll() &#123;
            Row() &#123;
              ForEach(this.tabArray, (item: number, index: number) =&gt; &#123;
                this.Tab(&quot;Tab &quot; + item, item, index)
              &#125;)
            &#125;
            .justifyContent(FlexAlign.Start)
          &#125;
          .align(Alignment.Start)
          .scrollable(ScrollDirection.Horizontal)
          .scrollBar(BarState.Off)
          .width(&#39;90%&#39;)
        &#125;
        .alignItems(VerticalAlign.Bottom)
        .width(&#39;100%&#39;)
      &#125;
      .alignItems(HorizontalAlign.Start)
      .width(&#39;100%&#39;)

      Tabs(&#123; barPosition: BarPosition.Start, controller: this.controller &#125;) &#123;
        ForEach(this.tabArray, (item: number, index: number) =&gt; &#123;
          TabContent() &#123;
            Text(&#39;Content of Page &#39; + item)
              .height(300)
              .width(&#39;100%&#39;)
              .fontSize(30)
          &#125;
          .backgroundColor(Color.Pink)
        &#125;)
      &#125;
      .width(&#39;100%&#39;)
      .barHeight(0)
      .animationDuration(100)
      .onChange((index: number) =&gt; &#123;
        console.log(&#39;foo change&#39;)
        this.focusIndex = index
      &#125;)
    &#125;
    .height(&#39;100%&#39;)
  &#125;
&#125;
</code></pre>
<h4 id="5-Does-OffscreenCanvasRenderingContext2D-in-HarmonyOS-Support-Automatic-Line-Breaks-for-Text-Drawing"><a href="#5-Does-OffscreenCanvasRenderingContext2D-in-HarmonyOS-Support-Automatic-Line-Breaks-for-Text-Drawing" class="headerlink" title="5. Does OffscreenCanvasRenderingContext2D in HarmonyOS Support Automatic Line Breaks for Text Drawing?"></a>5. Does OffscreenCanvasRenderingContext2D in HarmonyOS Support Automatic Line Breaks for Text Drawing?</h4><p>Yes. Consider the following methods:  </p>
<ol>
<li><strong>Multi-line text drawing</strong>: The OffscreenCanvasRenderingContext2D object provides fillText and strokeText methods. Set lineHeight and maxWidth to achieve automatic line breaks.  </li>
<li><strong>Path drawing</strong>: Define a path and use fillText&#x2F;strokeText to draw text along the path for line breaks.  </li>
<li><strong>Layout management</strong>: Use layout managers (e.g., Flexbox or Grid) in the offscreen canvas component, setting appropriate width and height to ensure multi-line text displays correctly.</li>
</ol>
<p>These methods enable automatic line breaks when drawing text with OffscreenCanvasRenderingContext2D.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://harmonyostech.github.io/2025/06/26/308-Daily-HarmonyOS-Next-Knowledge-Custom-Pop-up-Closure-List-Sorting-Crash-Persistent-Storage-Collapsible-List-Staking/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Qingkouwei">
      <meta itemprop="description" content="Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HarmonyOS NEXT Knowledge Charging Station">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/06/26/308-Daily-HarmonyOS-Next-Knowledge-Custom-Pop-up-Closure-List-Sorting-Crash-Persistent-Storage-Collapsible-List-Staking/" class="post-title-link" itemprop="url">[Daily HarmonyOS Next Knowledge] Custom Pop-up Closure, List Sorting Crash, Persistent Storage, Collapsible List, Staking</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-06-26 20:17:55 / Modified: 22:06:45" itemprop="dateCreated datePublished" datetime="2025-06-26T20:17:55+08:00">2025-06-26</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Daily-HarmonyOS-Next-Knowledge/" itemprop="url" rel="index"><span itemprop="name">Daily HarmonyOS Next Knowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Daily-HarmonyOS-Next-Knowledge-Custom-Pop-up-Closure-List-Sorting-Crash-Persistent-Storage-Collapsible-List-Staking"><a href="#Daily-HarmonyOS-Next-Knowledge-Custom-Pop-up-Closure-List-Sorting-Crash-Persistent-Storage-Collapsible-List-Staking" class="headerlink" title="[Daily HarmonyOS Next Knowledge] Custom Pop-up Closure, List Sorting Crash, Persistent Storage, Collapsible List, Staking"></a>[Daily HarmonyOS Next Knowledge] Custom Pop-up Closure, List Sorting Crash, Persistent Storage, Collapsible List, Staking</h3><h4 id="1-HarmonyOS-custom-dialog-cannot-call-the-close-function-to-close-in-its-own-struct"><a href="#1-HarmonyOS-custom-dialog-cannot-call-the-close-function-to-close-in-its-own-struct" class="headerlink" title="1. HarmonyOS custom dialog cannot call the close function to close in its own struct?"></a>1. HarmonyOS custom dialog cannot call the close function to close in its own struct?</h4><p>If you new CustomDialogController at the beginning of page construction, the internal close function can be executed. If it is dynamic, such as clicking a button to new CustomDialogController and assign it to a variable, the internal close cannot be called.  </p>
<p>In ArkUI, CustomDialogController is a page-level component whose lifecycle is bound to the page. The use of CustomDialogController in the page is managed by the page’s lifecycle, such as initialization after the page is loaded and destruction when the page exits. If created in build, it cannot be guaranteed to be initialized and destroyed at the correct lifecycle stage, resulting in unexpected behavior. In addition, some properties and methods of CustomDialogController are related to the page’s lifecycle. For example, the build method is used to build UI components in the page, while the lifecycle-related logic cannot be reused in the function. It is not initialized before build and loses the binding relationship with the page.  </p>
<h4 id="2-cppCrash-occurs-when-the-HarmonyOS-list-component-drags-and-sorts-subcomponents"><a href="#2-cppCrash-occurs-when-the-HarmonyOS-list-component-drags-and-sorts-subcomponents" class="headerlink" title="2. cppCrash occurs when the HarmonyOS list component drags and sorts subcomponents?"></a>2. cppCrash occurs when the HarmonyOS list component drags and sorts subcomponents?</h4><p>You can refer to the following demo, and the list follows the sliding code when dragged to the bottom:  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line">import curves from &#x27;@ohos.curves&#x27;;</span><br><span class="line">import Curves from &#x27;@ohos.curves&#x27;</span><br><span class="line">// xxx.ets</span><br><span class="line">@Entry</span><br><span class="line">@Component</span><br><span class="line">struct ListItemExample &#123;</span><br><span class="line">  @State private arr: number[] = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span><br><span class="line">  @State dragItem: number = -1</span><br><span class="line">  @State scaleItem: number = -1</span><br><span class="line">  @State neighborItem: number = -1</span><br><span class="line">  @State neighborScale: number = -1</span><br><span class="line">  private dragRefOffset: number = 0</span><br><span class="line">  @State offsetX: number = 0</span><br><span class="line">  @State offsetY: number = 0</span><br><span class="line">  private ITEM_INTV: number = 120</span><br><span class="line">  @State slide:boolean = false</span><br><span class="line">  private listScroller: ListScroller = new ListScroller()</span><br><span class="line">  // list component specifications</span><br><span class="line">  private listArea: Area = &#123;</span><br><span class="line">    width: 0,</span><br><span class="line">    height: 0,</span><br><span class="line">    position: &#123;&#125;,</span><br><span class="line">    globalPosition: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  scaleSelect(item: number): number &#123;</span><br><span class="line">    if (this.scaleItem == item) &#123;</span><br><span class="line">      return 1.05</span><br><span class="line">    &#125; else if (this.neighborItem == item) &#123;</span><br><span class="line">      return this.neighborScale</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      return 1</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  itemMove(index: number, newIndex: number): void &#123;</span><br><span class="line">    let tmp = this.arr.splice(index, 1)</span><br><span class="line">    this.arr.splice(newIndex, 0, tmp[0])</span><br><span class="line">  &#125;</span><br><span class="line">  build() &#123;</span><br><span class="line">    Stack() &#123;</span><br><span class="line">      List(&#123; space: 20, initialIndex: 0, scroller: this.listScroller &#125;) &#123;</span><br><span class="line">        ForEach(this.arr, (item: number) =&gt; &#123;</span><br><span class="line">          ListItem() &#123;</span><br><span class="line">            Text(&#x27;&#x27; + item)</span><br><span class="line">              .width(&#x27;100%&#x27;)</span><br><span class="line">              .height(100)</span><br><span class="line">              .fontSize(16)</span><br><span class="line">              .textAlign(TextAlign.Center)</span><br><span class="line">              .borderRadius(10)</span><br><span class="line">              .backgroundColor(0xFFFFFF)</span><br><span class="line">              .shadow(this.scaleItem == item ? &#123; radius: 70, color: &#x27;#15000000&#x27;, offsetX: 0, offsetY: 0 &#125; :</span><br><span class="line">                &#123; radius: 0, color: &#x27;#15000000&#x27;, offsetX: 0, offsetY: 0 &#125;)</span><br><span class="line">              .animation(&#123; curve: Curve.Sharp, duration: 300 &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">          .margin(&#123; left: 12, right: 12 &#125;)</span><br><span class="line">          .scale(&#123; x: this.scaleSelect(item), y: this.scaleSelect(item) &#125;)</span><br><span class="line">          .zIndex(this.dragItem == item ? 1 : 0)</span><br><span class="line">          .translate(this.dragItem == item ? &#123; y: this.offsetY &#125; : &#123; y: 0 &#125;)</span><br><span class="line">          .gesture(</span><br><span class="line">          // The following combined gestures are sequentially recognized, and the drag gesture will not be triggered if the long-press gesture event is not triggered normally</span><br><span class="line">            GestureGroup(GestureMode.Sequence,</span><br><span class="line">              LongPressGesture(&#123; repeat: true &#125;)</span><br><span class="line">                .onAction((event?: GestureEvent) =&gt; &#123;</span><br><span class="line">                  animateTo(&#123; curve: Curve.Friction, duration: 300 &#125;, () =&gt; &#123;</span><br><span class="line">                    this.scaleItem = item</span><br><span class="line">                  &#125;)</span><br><span class="line">                &#125;)</span><br><span class="line">                .onActionEnd(() =&gt; &#123;</span><br><span class="line">                  animateTo(&#123; curve: Curve.Friction, duration: 300 &#125;, () =&gt; &#123;</span><br><span class="line">                    this.scaleItem = -1</span><br><span class="line">                  &#125;)</span><br><span class="line">                &#125;),</span><br><span class="line">              PanGesture(&#123; fingers: 1, direction: null, distance: 0 &#125;)</span><br><span class="line">                .onActionStart(() =&gt; &#123;</span><br><span class="line">                  this.dragItem = item</span><br><span class="line">                  this.dragRefOffset = 0</span><br><span class="line">                &#125;)</span><br><span class="line">                .onActionUpdate((event: GestureEvent) =&gt; &#123;</span><br><span class="line">                  this.offsetY = event.offsetY - this.dragRefOffset</span><br><span class="line">                  // console.log(&#x27;Y:&#x27; + this.offsetY.toString())</span><br><span class="line">                  this.neighborItem = -1</span><br><span class="line">                  let index = this.arr.indexOf(item)</span><br><span class="line">                  let curveValue = Curves.initCurve(Curve.Sharp)</span><br><span class="line">                  let value: number = 0</span><br><span class="line">                  // Calculate the scaling of adjacent items based on displacement</span><br><span class="line">                  if (this.offsetY &lt; 0) &#123;</span><br><span class="line">                    value = curveValue.interpolate(-this.offsetY / this.ITEM_INTV)</span><br><span class="line">                    this.neighborItem = this.arr[index-1]</span><br><span class="line">                    this.neighborScale = 1 - value / 20;</span><br><span class="line">                    console.log(&#x27;neighborScale:&#x27; + this.neighborScale.toString())</span><br><span class="line">                  &#125; else if (this.offsetY &gt; 0) &#123;</span><br><span class="line">                    value = curveValue.interpolate(this.offsetY / this.ITEM_INTV)</span><br><span class="line">                    this.neighborItem = this.arr[index+1]</span><br><span class="line">                    this.neighborScale = 1 - value / 20;</span><br><span class="line">                  &#125;</span><br><span class="line">                  // Prevent offsetY from triggering out-of-bounds logic</span><br><span class="line">                  if (index === 0) &#123;</span><br><span class="line">                    this.offsetY = Math.max(0, this.offsetY)</span><br><span class="line">                  &#125; else if (index === this.arr.length - 1) &#123;</span><br><span class="line">                    this.offsetY = Math.min(0, this.offsetY)</span><br><span class="line">                  &#125;</span><br><span class="line">                  // Get finger information</span><br><span class="line">                  let fingerInfo = event.fingerList[0]</span><br><span class="line">                  let clickPercentY = (fingerInfo.globalY - Number(this.listArea.globalPosition</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">#### 3. Which is better for HarmonyOS user login information persistent storage, PersistentStorage or preference?  </span><br><span class="line">For storing user login tokens, is it better to use `@ohos.data.preferences` or PersistentStorage?  </span><br><span class="line"></span><br><span class="line">Persistent storage of user login information can be done using PersistentStorage or Preference, and the specific choice depends on the specific needs and usage scenarios.  </span><br><span class="line">- **PersistentStorage** is used to persistently store selected AppStorage attributes to ensure that these attributes remain consistent when the application restarts. Its main features include:  </span><br><span class="line">  - **Persistence**: Save attributes in AppStorage to the device disk to ensure that data is still available after the application restarts.  </span><br><span class="line">  - **Bidirectional synchronization**: PersistentStorage establishes bidirectional synchronization with attributes in AppStorage to ensure data consistency and synchronization.  </span><br><span class="line">  - **Limitations**: Support simple types (such as number, string, boolean, etc.) and objects that can be reconstructed by JSON.stringify() and JSON.parse(), but do not support nested objects.  </span><br><span class="line">- **Preference** is used to store user preference data and is suitable for data that needs to be read and written frequently. Its main features include:  </span><br><span class="line">  - **Reading and writing**: Data can be read and written quickly, suitable for scenarios requiring efficient reading and writing.  </span><br><span class="line">  - **Lightweight**: Occupy less storage space, suitable for storing simple key-value pair data.  </span><br><span class="line">  - **Sharing**: Multiple HAP packages can share Preference data and communicate through ApplicationContext.  </span><br><span class="line"></span><br><span class="line">**Selection suggestions**:  </span><br><span class="line">- **Data type**: If the data to be stored is complex, including nested objects or arrays, PersistentStorage is recommended.  </span><br><span class="line">- **Reading and writing needs**: If data needs to be read and written frequently and the data is simple, Preference is recommended.  </span><br><span class="line">- **Application scenarios**: If you need to maintain the consistency of specific attributes when the application restarts, PersistentStorage is recommended. If you need to store user preference data, Preference is recommended.  </span><br><span class="line"></span><br><span class="line">In summary, the choice between PersistentStorage and Preference to store user login information depends on the specific data type, reading and writing needs, and application scenarios.  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 4. HarmonyOS implements a list component similar to ExpandList that can be collapsed and opened?  </span><br><span class="line">Reference code:  </span><br></pre></td></tr></table></figure>
<p>interface IRowItem {<br>  id?: number;<br>  title?: string;<br>  name1?: string;<br>  name2?: string;<br>  name3?: string;<br>  flag?: boolean;<br>  type?: string;<br>  onFlagChange?: () &#x3D;&gt; void;<br>}</p>
<p>@Entry<br>@Component<br>struct CollapseAndExpandDemo {<br>  @Provide(“flag”) flag: boolean &#x3D; false<br>  private onFlagChange &#x3D; () &#x3D;&gt; {<br>    animateTo({<br>      duration: 650,<br>      curve: Curve.Smooth<br>    }, () &#x3D;&gt; {<br>      this.flag &#x3D; !this.flag;<br>    })<br>  }</p>
<p>  build() {<br>    Column() {<br>      Row() {<br>        Image($r(“app.media.ic_public_back”)).width(20).height(20)<br>        Text(‘Title’).fontSize(18).fontWeight(FontWeight.Bold).margin({ left: 10 })<br>      }.width(‘100%’).margin({ bottom: 30 })</p>
<pre><code>  Column() &#123;
    RowItem(&#123; props: &#123; title: &#39;All Types&#39;, name1: &#39;Romance Novels&#39;, name2: &#39;Mystery Suspense&#39;, name3: &#39;Emotional Family&#39; &#125; &#125;)
    RowItem(&#123;
      props: &#123; name1: &#39;Fantasy Novels&#39;, name2: &#39;Thriller/Horror&#39;, name3: &#39;Martial Arts Novels&#39;, type: &#39;DOWN&#39;, onFlagChange: this.onFlagChange
      &#125;
    &#125;)
    // Directly call the collapse and expand component
    CollapseAndExpand(&#123;
      items: [
        &#123; id: 0, name1: &#39;Science Fiction Novels&#39;, name2: &#39;Officialdom&#39;, name3: &#39;History/Fictional&#39; &#125;,
        &#123; id: 1, name1: &#39;Workplace Business War&#39;, name2: &#39;Military Spy War&#39;, name3: &#39;World Masterpieces&#39; &#125;,
        &#123; id: 2, name1: &#39;Social Novels&#39;, name2: &#39;Local Novels&#39;, name3: &#39;Modern and Contemporary China&#39; &#125;,
        &#123; id: 3, name1: &#39;Chinese Classics&#39;, name2: &#39;Foreign Novels&#39;, name3: &#39;Novel Works Collection&#39;, type: &#39;UP&#39;, onFlagChange: this.onFlagChange &#125;
      ],
    &#125;)

    RowItem(&#123; props: &#123; title: &#39;All Prices&#39;, name1: &#39;Free&#39;, name2: &#39;Special Price&#39;, name3: &#39;VIP&#39; &#125; &#125;)
    RowItem(&#123; props: &#123; title: &#39;By Popularity&#39;, name1: &#39;By Latest&#39;, name2: &#39;By Favorites&#39;, name3: &#39;By Word Count&#39; &#125; &#125;)
  &#125;.width(&#39;100%&#39;)

&#125;
.height(&#39;100%&#39;)
.padding(&#123; top: 30, right: 30, left: 30 &#125;)
</code></pre>
<p>  }<br>}</p>
<p>@Component<br>struct RowItem {<br>  private props: IRowItem;<br>  @Consume(“flag”) flag: boolean<br>  build() {<br>    Flex() {<br>      Text(this.props.title)<br>        .fontSize(14)<br>        .fontWeight(FontWeight.Bold)<br>        .layoutWeight(1)<br>        .fontColor(Color.Red)<br>        .margin({ right: 10 })<br>      Flex({ alignItems: ItemAlign.Center }) {<br>        Text(this.props.name1).fontSize(14).margin({ right: 10 })<br>        Text(this.props.name2).fontSize(14).margin({ right: 10 })<br>        Text(this.props.name3).fontSize(14).margin({ right: 10 })</p>
<pre><code>    if (!this.flag &amp;&amp; this.props.type === &#39;DOWN&#39; || this.flag &amp;&amp; this.props.type === &#39;UP&#39;) &#123;
      Image($r(&quot;app.media.ic_public_arrow_down_0&quot;))
        .width(16)
        .height(16)
        .objectFit(ImageFit.Contain)
        .rotate(&#123; angle: !this.flag &amp;&amp; this.props.type === &#39;DOWN&#39; ? 0 : 180 &#125;) // Rotate 180° after clicking the expand button to display the collapse button
        .onClick(() =&gt; this.props.onFlagChange())
        .transition(&#123; type: TransitionType.All, opacity: 0 &#125;)
    &#125;
  &#125;
  .layoutWeight(3)
&#125;.width(&#39;100%&#39;).height(16).margin(&#123; top: 15 &#125;)
</code></pre>
<p>  }<br>}</p>
<p>@Component<br>struct CollapseAndExpand {<br>  private items: IRowItem[] &#x3D; [];<br>  @Consume(“flag”) flag: boolean;</p>
<p>  build() {<br>    Column() {<br>      ForEach(this.items, (item: IRowItem) &#x3D;&gt; {<br>        RowItem({ props: item })<br>      }, (item: IRowItem) &#x3D;&gt; item.id.toString())<br>    }<br>    .width(‘100%’)<br>    .clip(true)<br>    .height(this.flag ? 130 : 0)<br>  }<br>}</p>
<pre><code>

#### 5. HarmonyOS login logic judgment?  
Is there an API implementation similar to View-layer aspect-oriented programming (AOP)? Now there is a requirement that all page clicks need to first determine whether the user is logged in. If logged in, the jump function can be performed. If not logged in, jump to the login page.  

Refer to the document: https://developer.huawei.com/consumer/cn/doc/best-practices-V5/bpta-application-aspect-programming-design-V5  

Aspect-oriented programming (AOP) is a technology that realizes the unified maintenance of program functions through pre-compilation and dynamic proxy during runtime. The core idea of AOP is to separate the concerns of the program and insert code into the program to realize cross-cutting concerns, so as to isolate each part of the business logic, reduce the coupling between them, improve the maintainability and reusability of the program, and improve the development efficiency.  

In AOP, developers can encapsulate cross-cutting concerns by defining aspects without directly modifying the business logic code. This method requires adding functions without modifying the source code, and is often used to separate business code from non-business code, such as parameter verification, log recording, performance statistics and other non-business code, so as to achieve better code decoupling.  

HarmonyOS mainly realizes aspect-oriented programming through the staking mechanism and provides the Aspect class, including addBefore, addAfter and replace interfaces. These interfaces can perform pre-staking, post-staking and replacement implementations on class methods at runtime, providing developers with more flexible operation methods. In specific business scenarios, different requirements may require different埋点 functions and log records. By calling the addBefore, addAfter and replace interfaces, various function enhancements and customized requirements for class methods can be realized:  
- For method verification requirements, parameter verification can be carried out before or after method execution to ensure the legitimacy of parameters, return values, etc.  
- For the requirements of method execution time and frequency statistics, we can insert statistical logic before and after method execution to record the execution time and frequency of the method. Through the combined use of addBefore and addAfter interfaces, the monitoring and statistics of method execution can be easily realized, providing data support for performance optimization.  
- For the requirements of replacing classes, we can use the replace interface of AOP to dynamically replace the implementation logic of the original method. This flexible replacement mechanism can realize the replacement or enhancement of method functions without changing the original method call, providing convenience for the function extension of the project.  
- For the requirement of obtaining the target package name information when拉起 the application, we can obtain the target package name information and record the log when the application starts. By calling the addBefore interface when the application starts, the monitoring and recording of the application startup process can be realized, providing help for application performance optimization and fault troubleshooting.  

Staking principle: The principles of addBefore, addAfter and replace interfaces are based on the ECMAScript semantics of class, that is, the static methods of the class are the attributes of the class, and the instance methods of the class are the attributes of the prototype object of the class.  
![](../images/【每日学点HarmonyOS%20Next知识】25.03.08.png)
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://harmonyostech.github.io/2025/06/26/307-Daily-HarmonyOS-Next-Knowledge-Screen-Parameters-Semi-Modal-Related-Three-Level-Linkage-Partial-Card-Display-Custom-Drawing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Qingkouwei">
      <meta itemprop="description" content="Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HarmonyOS NEXT Knowledge Charging Station">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/06/26/307-Daily-HarmonyOS-Next-Knowledge-Screen-Parameters-Semi-Modal-Related-Three-Level-Linkage-Partial-Card-Display-Custom-Drawing/" class="post-title-link" itemprop="url">[Daily HarmonyOS Next Knowledge] Screen Parameters, Semi-Modal Related, Three-Level Linkage, Partial Card Display, Custom Drawing</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-06-26 20:16:58 / Modified: 22:06:54" itemprop="dateCreated datePublished" datetime="2025-06-26T20:16:58+08:00">2025-06-26</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Daily-HarmonyOS-Next-Knowledge/" itemprop="url" rel="index"><span itemprop="name">Daily HarmonyOS Next Knowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Daily-HarmonyOS-Next-Knowledge-Screen-Parameters-Semi-Modal-Related-Three-Level-Linkage-Partial-Card-Display-Custom-Drawing"><a href="#Daily-HarmonyOS-Next-Knowledge-Screen-Parameters-Semi-Modal-Related-Three-Level-Linkage-Partial-Card-Display-Custom-Drawing" class="headerlink" title="[Daily HarmonyOS Next Knowledge] Screen Parameters, Semi-Modal Related, Three-Level Linkage, Partial Card Display, Custom Drawing"></a>[Daily HarmonyOS Next Knowledge] Screen Parameters, Semi-Modal Related, Three-Level Linkage, Partial Card Display, Custom Drawing</h3><h4 id="1-How-to-obtain-screen-xdpi-and-ydpi-data-in-HarmonyOS"><a href="#1-How-to-obtain-screen-xdpi-and-ydpi-data-in-HarmonyOS" class="headerlink" title="1. How to obtain screen xdpi and ydpi data in HarmonyOS?"></a>1. How to obtain screen xdpi and ydpi data in HarmonyOS?</h4><p>You can use <code>display.getDefaultDisplaySync</code>. Reference link: <a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-display-V5">https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-display-V5</a>  </p>
<p>@ohos.display (Screen Properties): Screen properties provide basic capabilities for managing display devices, including obtaining information about the default display device, obtaining information about all display devices, and monitoring the plugging and unplugging behavior of display devices.<br>Import module: <code>import &#123; display &#125; from &#39;@kit.ArkUI&#39;;</code>  </p>
<h4 id="2-How-to-use-semi-modal-in-HarmonyOS"><a href="#2-How-to-use-semi-modal-in-HarmonyOS" class="headerlink" title="2. How to use semi-modal in HarmonyOS?"></a>2. How to use semi-modal in HarmonyOS?</h4><ol>
<li>The transition mode for the login page should be semi-modal, but based on research, it can only be bound via the <code>bindSheet</code> attribute, which requires declaring a <code>builder</code> (a custom build function for a custom component). Treating the login page as a custom build function for another component is unreasonable. Are there other ways to achieve semi-modal?  </li>
<li>When clicking certain items in a List, a pop-up window is expected to appear in a semi-modal effect. Using <code>bindSheet</code> to implement this may result in two pop-up windows.</li>
</ol>
<p><strong>Issue 1</strong> Reference demo: <a target="_blank" rel="noopener" href="https://gitee.com/harmonyos-cases/cases/tree/master/CommonAppDevelopment/feature/multimodaltransion">https://gitee.com/harmonyos-cases/cases/tree/master/CommonAppDevelopment/feature/multimodaltransion</a><br><strong>Issue 2</strong> Using <code>ForEach</code> to bind a semi-modal page to each ListItem, with all semi-modal page display controls using the same field <code>isShow1</code>. This causes multiple semi-modal pages to display when <code>isShow1</code> changes.  </p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> arrData &#123;</span><br><span class="line">  <span class="attr">itemData</span>: <span class="title class_">ItemInData</span>[];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ItemInData</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="attr">name</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">SheetTransitionExample</span> &#123;</span><br><span class="line">  <span class="attr">showItem</span>: <span class="title class_">ItemInData</span> = <span class="keyword">new</span> <span class="title class_">ItemInData</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line">  <span class="attr">arrData</span>: arrData[] = [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">itemData</span>: [<span class="keyword">new</span> <span class="title class_">ItemInData</span>(<span class="string">&#x27;1组1&#x27;</span>)]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">itemData</span>: [<span class="keyword">new</span> <span class="title class_">ItemInData</span>(<span class="string">&#x27;2组1&#x27;</span>), <span class="keyword">new</span> <span class="title class_">ItemInData</span>(<span class="string">&#x27;2组2&#x27;</span>), <span class="keyword">new</span> <span class="title class_">ItemInData</span>(<span class="string">&#x27;2组3&#x27;</span>)]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">isShow</span>: <span class="built_in">boolean</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Builder</span></span><br><span class="line">  <span class="title function_">myBuilder</span>(<span class="params"><span class="attr">name</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Button</span>(name)</span><br><span class="line">        .<span class="title function_">margin</span>(<span class="number">10</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * <span class="doctag">TODO:</span> Knowledge point: Bind a semi-modal page to a component via the bindSheet attribute. Since the semi-modal must be bound to a component,</span></span><br><span class="line"><span class="comment">       * a styleless Text component is bound here to display the splash semi-modal.</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="title class_">Text</span>().<span class="title function_">bindSheet</span>($$this.<span class="property">isShow</span>, <span class="variable language_">this</span>.<span class="title function_">myBuilder</span>(<span class="variable language_">this</span>.<span class="property">showItem</span>.<span class="property">name</span>), &#123;</span><br><span class="line">        <span class="attr">showClose</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">preferType</span>: <span class="title class_">SheetType</span>.<span class="property">CENTER</span>,</span><br><span class="line">        <span class="attr">onWillAppear</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;BindSheet onWillAppear.&quot;</span> + <span class="variable language_">this</span>.<span class="property">showItem</span>.<span class="property">name</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onWillDisappear</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;BindSheet onWillDisappear.&quot;</span>+ <span class="variable language_">this</span>.<span class="property">showItem</span>.<span class="property">name</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="title class_">List</span>(&#123; <span class="attr">space</span>: <span class="number">20</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">arrData</span>, <span class="function">(<span class="params"><span class="attr">item</span>: arrData, <span class="attr">groupId</span>: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">ListItemGroup</span>() &#123;</span><br><span class="line">            <span class="title class_">ForEach</span>(item.<span class="property">itemData</span>, <span class="function">(<span class="params"><span class="attr">project</span>: <span class="title class_">ItemInData</span>, <span class="attr">rowIdOfGroup</span>: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">                <span class="title class_">Button</span>(project.<span class="property">name</span>).<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Black</span>)</span><br><span class="line">                  .<span class="title function_">width</span>(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">                  .<span class="title function_">padding</span>(<span class="number">10</span>)</span><br><span class="line">              &#125;</span><br><span class="line">              .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">isShow</span> = <span class="literal">true</span>;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">showItem</span> = project;</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;, <span class="function">(<span class="params"><span class="attr">item</span>: <span class="built_in">string</span></span>) =&gt;</span> item)</span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">divider</span>(&#123; <span class="attr">strokeWidth</span>: <span class="number">0.5</span>, <span class="attr">color</span>: <span class="string">&#x27;#CFD6D6&#x27;</span> &#125;) <span class="comment">// Divider between each row</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;.<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Green</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">Start</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#### 3. How to create a province-city-district selector with three-level linkage in HarmonyOS?  </span></span><br><span class="line"><span class="string">This can be implemented using `</span><span class="title class_">TextPicker</span><span class="string">`. Reference document: https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-basic-components-textpicker-V5  </span></span><br><span class="line"><span class="string">Sample code:  </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>typescript</span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">TextPickerExample</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">cascade</span>: <span class="title class_">TextCascadePickerRangeContent</span>[] = [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">text</span>: <span class="string">&#x27;辽宁省&#x27;</span>,</span><br><span class="line">      <span class="attr">children</span>: [&#123; <span class="attr">text</span>: <span class="string">&#x27;沈阳市&#x27;</span>, <span class="attr">children</span>: [&#123; <span class="attr">text</span>: <span class="string">&#x27;沈河区&#x27;</span> &#125;, &#123; <span class="attr">text</span>: <span class="string">&#x27;和平区&#x27;</span> &#125;, &#123; <span class="attr">text</span>: <span class="string">&#x27;浑南区&#x27;</span> &#125;] &#125;,</span><br><span class="line">        &#123; <span class="attr">text</span>: <span class="string">&#x27;大连市&#x27;</span>, <span class="attr">children</span>: [&#123; <span class="attr">text</span>: <span class="string">&#x27;中山区&#x27;</span> &#125;, &#123; <span class="attr">text</span>: <span class="string">&#x27;金州区&#x27;</span> &#125;, &#123; <span class="attr">text</span>: <span class="string">&#x27;长海县&#x27;</span> &#125;] &#125;]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">text</span>: <span class="string">&#x27;吉林省&#x27;</span>,</span><br><span class="line">      <span class="attr">children</span>: [&#123; <span class="attr">text</span>: <span class="string">&#x27;长春市&#x27;</span>, <span class="attr">children</span>: [&#123; <span class="attr">text</span>: <span class="string">&#x27;南关区&#x27;</span> &#125;, &#123; <span class="attr">text</span>: <span class="string">&#x27;宽城区&#x27;</span> &#125;, &#123; <span class="attr">text</span>: <span class="string">&#x27;朝阳区&#x27;</span> &#125;] &#125;,</span><br><span class="line">        &#123; <span class="attr">text</span>: <span class="string">&#x27;四平市&#x27;</span>, <span class="attr">children</span>: [&#123; <span class="attr">text</span>: <span class="string">&#x27;铁西区&#x27;</span> &#125;, &#123; <span class="attr">text</span>: <span class="string">&#x27;铁东区&#x27;</span> &#125;, &#123; <span class="attr">text</span>: <span class="string">&#x27;梨树县&#x27;</span> &#125;] &#125;]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">text</span>: <span class="string">&#x27;黑龙江省&#x27;</span>,</span><br><span class="line">      <span class="attr">children</span>: [&#123; <span class="attr">text</span>: <span class="string">&#x27;哈尔滨市&#x27;</span>, <span class="attr">children</span>: [&#123; <span class="attr">text</span>: <span class="string">&#x27;道里区&#x27;</span> &#125;, &#123; <span class="attr">text</span>: <span class="string">&#x27;道外区&#x27;</span> &#125;, &#123; <span class="attr">text</span>: <span class="string">&#x27;南岗区&#x27;</span> &#125;] &#125;,</span><br><span class="line">        &#123; <span class="attr">text</span>: <span class="string">&#x27;牡丹江市&#x27;</span>, <span class="attr">children</span>: [&#123; <span class="attr">text</span>: <span class="string">&#x27;东安区&#x27;</span> &#125;, &#123; <span class="attr">text</span>: <span class="string">&#x27;西安区&#x27;</span> &#125;, &#123; <span class="attr">text</span>: <span class="string">&#x27;爱民区&#x27;</span> &#125;] &#125;]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">TextPicker</span>(&#123; <span class="attr">range</span>: <span class="variable language_">this</span>.<span class="property">cascade</span> &#125;)</span><br><span class="line">        .<span class="title function_">onChange</span>(<span class="function">(<span class="params"><span class="attr">value</span>: <span class="built_in">string</span> | <span class="built_in">string</span>[], <span class="attr">index</span>: <span class="built_in">number</span> | <span class="built_in">number</span>[]</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;TextPicker multi-column linkage: onChange &#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(value) + <span class="string">&#x27;, &#x27;</span> + <span class="string">&#x27;index: &#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(index))</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="title class_">TextPicker</span>(<span class="attr">options</span>?: <span class="title class_">TextPickerOptions</span>)<span class="string">`  </span></span><br><span class="line"><span class="string">Creates a text picker based on the selection range specified by `</span>range<span class="string">`.  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">| Parameter name | Type                | Required | Description       |</span></span><br><span class="line"><span class="string">| :--------- | :---------------- | :-- | :------------ |</span></span><br><span class="line"><span class="string">| options    | TextPickerOptions | No    | Parameters for configuring the text picker. |</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">| Name       | Type                                                                                                            | Required | Description                                                                                                                                                                                                                                                                                   |</span></span><br><span class="line"><span class="string">| :------- | :------------------------------------------------------------------------------------------------------------ | :-- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |</span></span><br><span class="line"><span class="string">| range    | `</span><span class="built_in">string</span>[] \| <span class="built_in">string</span>[] []<span class="number">10</span>+ \| <span class="title class_">Resource</span> \|<span class="title class_">TextPickerRangeContent</span>)[]<span class="number">10</span>+ \| <span class="title class_">TextCascadePickerRangeContent</span>[]<span class="number">10</span>+<span class="string">` | Yes    | Data selection list for the picker. Cannot be an empty array; if set to empty, it will not display; if dynamically changed to empty, it will maintain the current normal display.&lt;br&gt;&lt;br&gt;**Note**: Use `</span><span class="built_in">string</span>[]<span class="string">`, `</span><span class="title class_">Resource</span><span class="string">`, or `</span><span class="title class_">TextPickerRangeContent</span>[]<span class="string">` for single-column pickers.&lt;br&gt;Use `</span><span class="built_in">string</span>[][]<span class="string">` for multi-column pickers.&lt;br&gt;Use `</span><span class="title class_">TextCascadePickerRangeContent</span>[]<span class="string">` for multi-column linked pickers.&lt;br&gt;`</span><span class="title class_">Resource</span><span class="string">` type only supports `</span>strarray.<span class="property">json</span><span class="string">`.&lt;br&gt;The type and number of columns in `</span>range<span class="string">` cannot be modified dynamically. |</span></span><br><span class="line"><span class="string">| selected | `</span><span class="built_in">number</span> \| <span class="built_in">number</span>[]<span class="number">10</span>+<span class="string">`                                                                                       | No    | Sets the index of the default selected item in the array.&lt;br&gt;&lt;br&gt;Default: 0&lt;br&gt;&lt;br&gt;**Note**: Use `</span><span class="built_in">number</span><span class="string">` for single-column pickers.&lt;br&gt;Use `</span><span class="built_in">number</span>[]<span class="string">` for multi-column and multi-column linked pickers.&lt;br&gt;Starting from API version 10, this parameter supports `</span>$$<span class="string">` two-way binding variables.                                                                                                                                          |</span></span><br><span class="line"><span class="string">| value    | `</span><span class="built_in">string</span> \| <span class="built_in">string</span>[]<span class="number">10</span>+<span class="string">`                                                                                       | No    | Sets the value of the default selected item, with lower priority than `</span>selected<span class="string">`.&lt;br&gt;&lt;br&gt;Default: Value of the first element&lt;br&gt;&lt;br&gt;**Note**: Valid only for text lists. Invalid for image or image+text lists.&lt;br&gt;Use `</span><span class="built_in">string</span><span class="string">` for single-column pickers.&lt;br&gt;Use `</span><span class="built_in">string</span>[]<span class="string">` for multi-column and multi-column linked pickers.&lt;br&gt;Starting from API version 10, this parameter supports `</span>$$<span class="string">` two-way binding variables.                                                                                   |</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#### 4. When the HarmonyOS List component exceeds its size, the last CardView only partially displays?  </span></span><br><span class="line"><span class="string">Adding a fixed-size View in a Column, with the List filling the remaining space. When the List content exceeds one screen, the last CardView cannot be fully displayed.  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Replace the Column component with a Flex elastic layout, and other settings (e.g., `</span><span class="title class_">NavigationBar</span>.<span class="title function_">height</span>(90vp)<span class="string">`) remain fixed.  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#### 5. Dynamically setting `</span>lineto<span class="string">` in HarmonyOS Canvas?  </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>typescript</span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">CanvasDemo</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">settings</span>: <span class="title class_">RenderingContextSettings</span> = <span class="keyword">new</span> <span class="title class_">RenderingContextSettings</span>(<span class="literal">true</span>)</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">context</span>: <span class="title class_">CanvasRenderingContext2D</span> = <span class="keyword">new</span> <span class="title class_">CanvasRenderingContext2D</span>(<span class="variable language_">this</span>.<span class="property">settings</span>)</span><br><span class="line">  <span class="meta">@State</span> <span class="meta">@Watch</span>(<span class="string">&#x27;draw&#x27;</span>)<span class="attr">content</span>: <span class="built_in">string</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">context</span>.<span class="title function_">clearRect</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200</span>, <span class="number">200</span>) <span class="comment">// Clear canvas content</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">context</span>.<span class="title function_">fillText</span>(<span class="variable language_">this</span>.<span class="property">content</span>, <span class="number">50</span>, <span class="number">50</span>) <span class="comment">// Repaint</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Canvas</span>(<span class="variable language_">this</span>.<span class="property">context</span>)</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">&#x27;25%&#x27;</span>)</span><br><span class="line">        .<span class="title function_">backgroundColor</span>(<span class="string">&#x27;#F5DC62&#x27;</span>)</span><br><span class="line">        .<span class="title function_">onReady</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// Draw content here.</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">context</span>.<span class="property">font</span> = <span class="string">&#x27;55px sans-serif&#x27;</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">context</span>.<span class="title function_">fillText</span>(<span class="variable language_">this</span>.<span class="property">content</span>, <span class="number">50</span>, <span class="number">50</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="title class_">TextInput</span>(&#123;</span><br><span class="line">        <span class="attr">text</span>:$$this.<span class="property">content</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">borderColor</span>(<span class="string">&#x27;#31525B&#x27;</span>)</span><br><span class="line">    .<span class="title function_">borderWidth</span>(<span class="number">12</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://harmonyostech.github.io/2025/06/26/306%E3%80%90Daily-HarmonyOS-Next-Knowledge%E3%80%91Pull-up-Pull-down-List-Stop-Infinite-Loop-Animation-Page-List-Following-Scroll-OTF-Font-Date-Picker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Qingkouwei">
      <meta itemprop="description" content="Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HarmonyOS NEXT Knowledge Charging Station">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/06/26/306%E3%80%90Daily-HarmonyOS-Next-Knowledge%E3%80%91Pull-up-Pull-down-List-Stop-Infinite-Loop-Animation-Page-List-Following-Scroll-OTF-Font-Date-Picker/" class="post-title-link" itemprop="url">【Daily HarmonyOS Next Knowledge】Pull-up/Pull-down List, Stop Infinite Loop Animation, Page List Following Scroll, OTF Font, Date Picker</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-06-26 20:15:31 / Modified: 22:06:56" itemprop="dateCreated datePublished" datetime="2025-06-26T20:15:31+08:00">2025-06-26</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Daily-HarmonyOS-Next-Knowledge/" itemprop="url" rel="index"><span itemprop="name">Daily HarmonyOS Next Knowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="【Daily-HarmonyOS-Next-Knowledge】Pull-up-Pull-down-List-Stop-Infinite-Loop-Animation-Page-List-Following-Scroll-OTF-Font-Date-Picker"><a href="#【Daily-HarmonyOS-Next-Knowledge】Pull-up-Pull-down-List-Stop-Infinite-Loop-Animation-Page-List-Following-Scroll-OTF-Font-Date-Picker" class="headerlink" title="【Daily HarmonyOS Next Knowledge】Pull-up&#x2F;Pull-down List, Stop Infinite Loop Animation, Page List Following Scroll, OTF Font, Date Picker"></a>【Daily HarmonyOS Next Knowledge】Pull-up&#x2F;Pull-down List, Stop Infinite Loop Animation, Page List Following Scroll, OTF Font, Date Picker</h3><h4 id="1-How-to-implement-only-pull-up-to-load-more-without-pull-down-to-refresh-in-HarmonyOS"><a href="#1-How-to-implement-only-pull-up-to-load-more-without-pull-down-to-refresh-in-HarmonyOS" class="headerlink" title="1. How to implement only pull-up to load more without pull-down to refresh in HarmonyOS?"></a>1. How to implement only pull-up to load more without pull-down to refresh in HarmonyOS?</h4><p>Refresh uses the <code>refreshing</code> parameter to determine if the component is refreshing, and you can control this parameter to trigger pull-down refresh: <a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-container-refresh-V5#ZH-CN_TOPIC_0000001930756929__refreshoptions%E5%AF%B9%E8%B1%A1%E8%AF%B4%E6%98%8E">https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-container-refresh-V5#ZH-CN_TOPIC_0000001930756929__refreshoptions%E5%AF%B9%E8%B1%A1%E8%AF%B4%E6%98%8E</a>  </p>
<p>Demo:  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">@Entry</span><br><span class="line">@Component</span><br><span class="line">struct RefreshExample &#123;</span><br><span class="line">  @State isRefreshing: boolean = false</span><br><span class="line">  @State arr: String[] = [&#x27;0&#x27;, &#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;, &#x27;4&#x27;,&#x27;5&#x27;,&#x27;6&#x27;,&#x27;7&#x27;,&#x27;8&#x27;,&#x27;9&#x27;,&#x27;10&#x27;]</span><br><span class="line"></span><br><span class="line">  build() &#123;</span><br><span class="line">    Column() &#123;</span><br><span class="line">      Button(&#x27;Refresh&#x27;).onClick(()=&gt;&#123;</span><br><span class="line">        this.isRefreshing = true</span><br><span class="line">      &#125;)</span><br><span class="line">      Refresh(&#123; refreshing: $$this.isRefreshing&#125;) &#123;</span><br><span class="line">        List() &#123;</span><br><span class="line">          ForEach(this.arr, (item: string) =&gt; &#123;</span><br><span class="line">            ListItem() &#123;</span><br><span class="line">              Text(&#x27;&#x27; + item)</span><br><span class="line">                .width(&#x27;100%&#x27;).height(100).fontSize(16)</span><br><span class="line">                .textAlign(TextAlign.Center).borderRadius(10).backgroundColor(0xFFFFFF)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;, (item: string) =&gt; item)</span><br><span class="line">        &#125;</span><br><span class="line">        .onScrollIndex((first: number) =&gt; &#123;</span><br><span class="line">          console.info(first.toString())</span><br><span class="line">        &#125;)</span><br><span class="line">        .width(&#x27;100%&#x27;)</span><br><span class="line">        .height(&#x27;100%&#x27;)</span><br><span class="line">        .divider(&#123;strokeWidth:1,color:Color.Yellow,startMargin:10,endMargin:10&#125;)</span><br><span class="line">        .scrollBar(BarState.Off)</span><br><span class="line">      &#125;</span><br><span class="line">      .onStateChange((refreshStatus: RefreshStatus) =&gt; &#123;</span><br><span class="line">        console.info(&#x27;Refresh onStatueChange state is &#x27; + refreshStatus)</span><br><span class="line">      &#125;)</span><br><span class="line">      .onOffsetChange((value: number) =&gt; &#123;</span><br><span class="line">        console.info(&#x27;Refresh onOffsetChange offset:&#x27; + value)</span><br><span class="line">      &#125;)</span><br><span class="line">      .onRefreshing(() =&gt; &#123;</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">          this.isRefreshing = false</span><br><span class="line">        &#125;, 2000)</span><br><span class="line">        console.log(&#x27;onRefreshing test&#x27;)</span><br><span class="line">      &#125;)</span><br><span class="line">      .backgroundColor(0x89CFF0)</span><br><span class="line">      .refreshOffset(64)</span><br><span class="line">      .pullToRefresh(true)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">#### 2. How to stop an infinite loop animation in HarmonyOS?  </span><br><span class="line">How to stop an infinite loop animation  </span><br><span class="line"></span><br><span class="line">After triggering an infinite loop animation for the first time, quickly clicking to interrupt it makes the animation invisible on subsequent clicks. **Cause**: The animation doesn’t stop but overlays continuously, making changes less obvious. **Solution**: Set an animation with `duration: 0` to stop the previous animation, ensuring the target value differs from the last end value, then create the desired animation. Simple example:  </span><br></pre></td></tr></table></figure>
<p>@Entry<br>@Component<br>struct Page240119142354017 {<br>  @State message: string &#x3D; “Hello World”;<br>  @State opacityValue: number &#x3D; 0.5<br>  @State isRecording: boolean &#x3D; false;</p>
<p>  build() {<br>    Row() {<br>      Column() {<br>        Text(this.message)<br>          .fontSize(50)<br>          .fontWeight(FontWeight.Bold)<br>          .opacity(this.opacityValue)<br>          .onClick(() &#x3D;&gt; {<br>            if(this.isRecording) {<br>              &#x2F;&#x2F; Set an animation with duration 0 to stop the previous animation<br>              animateTo({ duration: 0, iterations: 1, playMode: PlayMode.Normal }, () &#x3D;&gt; {<br>                &#x2F;&#x2F; opacityValue must differ from the previous end value (0.1)<br>                this.opacityValue &#x3D; 0.2<br>              })<br>              this.isRecording &#x3D; false;<br>              &#x2F;&#x2F; Create the desired animation<br>              animateTo({ duration: 0, iterations: 1, playMode: PlayMode.Normal }, () &#x3D;&gt; {<br>                this.opacityValue &#x3D; 1<br>              })<br>            } else {<br>              this.isRecording &#x3D; true<br>              animateTo({ duration: 1500, iterations: -1, }, () &#x3D;&gt; {<br>                this.opacityValue &#x3D; 0.1<br>              })<br>            }<br>          })<br>      }<br>      .width(“100%”)<br>    }<br>    .height(“100%”)<br>  }<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 3. How to make one list follow another list&#x27;s scroll on the same page in HarmonyOS?  </span><br><span class="line">How to make two lists on the same page scroll in sync?  </span><br><span class="line"></span><br><span class="line">Reference demo:  </span><br></pre></td></tr></table></figure>
<p>@Entry<br>@Component<br>struct index240426171014042 {<br>  @State dataList: Array<number> &#x3D; [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19]</p>
<p>  private leftListScroller: Scroller &#x3D; new Scroller()<br>  private rightListScroller: Scroller &#x3D; new Scroller()<br>  private scrollFlag &#x3D; -1 &#x2F;&#x2F; 1&#x3D;Left, 2&#x3D;Right</p>
<p>  build() {<br>    Row() {<br>      this.left()<br>      this.right()<br>    }<br>    .width(‘100%’)<br>    .height(‘100%’)<br>    .backgroundColor(‘#a68765’)<br>  }</p>
<p>  &#x2F;&#x2F; Left list<br>  @Builder<br>  left() {<br>    Column() {<br>      Text(‘Header’).width(100).height(100)<br>      List({ scroller: this.leftListScroller }) {<br>        ForEach(this.dataList, (item: number, index) &#x3D;&gt; {<br>          ListItem() {<br>            Row() {<br>              Text(<code>Left$&#123;item&#125;</code>).width(100).textAlign(TextAlign.Center)<br>            }<br>            .width(“100%”)<br>            .height(100)<br>            .backgroundColor(Color.Blue)<br>          }<br>        })<br>      }<br>      .width(100)<br>      .height(“100%”)<br>      .cachedCount(5)<br>      .edgeEffect(EdgeEffect.None)<br>      .onScrollStart(() &#x3D;&gt; {<br>        this.scrollFlag &#x3D; 1<br>      })<br>      .onScrollStop(() &#x3D;&gt; {<br>        this.scrollFlag &#x3D; -1<br>      })<br>      .onScrollFrameBegin((offset: number, state: ScrollState) &#x3D;&gt; {<br>        if (this.scrollFlag &#x3D;&#x3D; 1) {<br>          let yOffset &#x3D; this.leftListScroller.currentOffset().yOffset + offset<br>          this.rightListScroller.scrollTo({ xOffset: 0, yOffset: yOffset })<br>        } return { offsetRemain: offset }<br>      })<br>    }<br>  }</p>
<p>  &#x2F;&#x2F; Right list<br>  @Builder<br>  right() {<br>    Scroll() {<br>      Column() {<br>        Text(‘Header’).width(700).height(100)<br>        this.rightList()<br>      }<br>      .width(700)<br>      .height(‘100%’)<br>      .alignItems(HorizontalAlign.Start)<br>      .backgroundColor(Color.Orange)<br>    }<br>    .width(700)<br>    .height(‘100%’)<br>    .scrollable(ScrollDirection.Horizontal)<br>    .backgroundColor(Color.Pink)<br>  }</p>
<p>  &#x2F;&#x2F; Right list content<br>  @Builder<br>  rightList() {<br>    List({ scroller: this.rightListScroller }) {<br>      ForEach(this.dataList, (item: number, index) &#x3D;&gt; {<br>        ListItem() {<br>          Row() {<br>            Text(<code>Column1$&#123;item&#125;</code>).width(100).textAlign(TextAlign.Center)<br>            Text(<code>Column2$&#123;item&#125;</code>).width(100).textAlign(TextAlign.Center)<br>            Text(<code>Column3$&#123;item&#125;</code>).width(100).textAlign(TextAlign.Center)<br>            Text(<code>Column4$&#123;item&#125;</code>).width(100).textAlign(TextAlign.Center)<br>            Text(<code>Column5$&#123;item&#125;</code>).width(100).textAlign(TextAlign.Center)<br>            Text(<code>Column6$&#123;item&#125;</code>).width(100).textAlign(TextAlign.Center)<br>            Text(<code>Column7$&#123;item&#125;</code>).width(100).textAlign(TextAlign.Center)<br>          }<br>          .width(‘100%’)<br>          .height(100)<br>        }<br>      })<br>    }<br>    .width(700)<br>    .height(‘100%’)<br>    .edgeEffect(EdgeEffect.None)<br>    .backgroundColor(Color.Yellow)<br>    .onScrollStart(() &#x3D;&gt; {<br>      this.scrollFlag &#x3D; 2<br>    })<br>    .onScrollStop(() &#x3D;&gt; {<br>      this.scrollFlag &#x3D; -1<br>    })<br>    .onScrollFrameBegin((offset: number, state: ScrollState) &#x3D;&gt; {<br>      if (this.scrollFlag &#x3D;&#x3D; 2) {<br>        let yOffset &#x3D; this.rightListScroller.currentOffset().yOffset + offset<br>        this.leftListScroller.scrollTo({ xOffset: 0, yOffset: yOffset })<br>      } return { offsetRemain: offset }<br>    })<br>  }<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 4. Does HarmonyOS ArkUI&#x27;s Text support OTF font files?  </span><br><span class="line">Use `$rawfile` as shown in the document: https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-font-V5  </span><br><span class="line"></span><br><span class="line">Font file path: `src/main/resources/rawfile/font/gealova.otf`  </span><br><span class="line"></span><br><span class="line">Code example:  </span><br></pre></td></tr></table></figure>
<p>font.registerFont({<br>  familyName: ‘Gealova’,<br>  familySrc: $rawfile(‘font&#x2F;gealova.otf’)<br>})</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Register fonts in `onWindowStageCreate` of EntryAbility and run on the emulator:  </span><br></pre></td></tr></table></figure>
<p>&#x2F;&#x2F; In EntryAbility’s onWindowStageCreate:<br>windowStage.getMainWindow().then(res&#x3D;&gt;{<br>  &#x2F;&#x2F; Register fonts<br>  const uiCtc&#x3D;res.getUIContext()<br>  uiCtc.getFont().registerFont({<br>    familyName:’mediumRawFile’,<br>    familySrc:$rawfile(‘font&#x2F;BLACKTW-Bold.otf’)<br>  })<br>  uiCtc.getFont().registerFont({<br>    familyName:’twrafile’,<br>    familySrc:$rawfile(‘font&#x2F;TW-Bold.otf’)<br>  })<br>})</p>
<p>&#x2F;&#x2F; index.ets<br>@Entry<br>@Component<br>struct index{<br>  @State message: string &#x3D; ‘Hello World’<br>  build() {<br>    Column() {<br>      Text(this.message)<br>        .align(Alignment.Center)<br>        .fontSize(20)<br>        .fontFamily(‘mediumRawFile’) &#x2F;&#x2F; mediumRawFile: Registered custom font name<br>      Text(‘eeeee’)<br>        .align(Alignment.Center)<br>        .fontSize(20)<br>        .fontFamily(‘twrafile’)<br>    }.width(‘100%’)<br>  }<br>}</p>
<pre><code>
#### 5. HarmonyOS DatePicker: How to display only year and month?  
To display only year and month, use `TextPickerDialog` and set可选年月 (optional year-month) in the `range` field. Refer to: https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-basic-components-textpicker-V5  

`TextPicker(options?: TextPickerOptions)`  
Creates a text picker based on the selection range specified by `range`.  

**TextPickerOptions object description**:  

| Name     | Type                                                                                                        | Required | Description                                                                                                                                                                                                                                                                                  |
| :------- | :-------------------------------------------------------------------------------------------------------- | :------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| range    | `string[] \| string[] []10+ \| Resource \|&lt;br&gt;TextPickerRangeContent[]\| TextCascadePickerRangeContent[]` | Yes     | Data selection list for the picker. Cannot be an empty array; if set to empty, it will not display; if dynamically changed to empty, it will maintain the current normal display.&lt;br&gt;&lt;br&gt;**Note**: Use `string[]`, `Resource`, or `TextPickerRangeContent[]` for single-column pickers.&lt;br&gt;Use `string[][]` for multi-column pickers.&lt;br&gt;Use `TextCascadePickerRangeContent[]` for multi-column linked pickers.&lt;br&gt;`Resource` type only supports `strarray.json`.&lt;br&gt;The type and number of columns in `range` cannot be modified dynamically. |
| selected | number \| number[]10+                                                                                     | No      | Sets the index of the default selected item in the array.&lt;br&gt;&lt;br&gt;Default: 0&lt;br&gt;&lt;br&gt;**Note**: Use `number` for single-column pickers.&lt;br&gt;Use `number[]` for multi-column and multi-column linked pickers.&lt;br&gt;Starting from API version 10, this parameter supports `$$` two-way binding variables.                                                                                                                                        |
| value    | string \| string[]10+                                                                                     | No      | Sets the value of the default selected item, with lower priority than `selected`.&lt;br&gt;&lt;br&gt;Default: Value of the first element&lt;br&gt;&lt;br&gt;**Note**: Valid only for text lists. Invalid for image or image+text lists.&lt;br&gt;Use `string` for single-column pickers.&lt;br&gt;Use `string[]` for multi-column and multi-column linked pickers.&lt;br&gt;Starting from API version 10, this parameter supports `$$` two-way binding variables.                                                                                  |
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://harmonyostech.github.io/2025/06/26/305-Daily-HarmonyOS-Next-Knowledge-Image-Dragging-Animation-Zoom-List-Height-Back-Button-Listening-Divider-Color/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Qingkouwei">
      <meta itemprop="description" content="Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HarmonyOS NEXT Knowledge Charging Station">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/06/26/305-Daily-HarmonyOS-Next-Knowledge-Image-Dragging-Animation-Zoom-List-Height-Back-Button-Listening-Divider-Color/" class="post-title-link" itemprop="url">[Daily HarmonyOS Next Knowledge] Image Dragging, Animation Zoom, List Height, Back Button Listening, Divider Color</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-06-26 20:13:16 / Modified: 22:06:57" itemprop="dateCreated datePublished" datetime="2025-06-26T20:13:16+08:00">2025-06-26</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Daily-HarmonyOS-Next-Knowledge/" itemprop="url" rel="index"><span itemprop="name">Daily HarmonyOS Next Knowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="Daily-HarmonyOS-Next-Knowledge-Image-Dragging-Animation-Zoom-List-Height-Back-Button-Listening-Divider-Color"><a href="#Daily-HarmonyOS-Next-Knowledge-Image-Dragging-Animation-Zoom-List-Height-Back-Button-Listening-Divider-Color" class="headerlink" title="[Daily HarmonyOS Next Knowledge] Image Dragging, Animation Zoom, List Height, Back Button Listening, Divider Color"></a>[Daily HarmonyOS Next Knowledge] Image Dragging, Animation Zoom, List Height, Back Button Listening, Divider Color</h3><h4 id="1-Can-images-in-HarmonyOS-Image-components-be-dragged-freely"><a href="#1-Can-images-in-HarmonyOS-Image-components-be-dragged-freely" class="headerlink" title="1. Can images in HarmonyOS Image components be dragged freely?"></a>1. Can images in HarmonyOS Image components be dragged freely?</h4><p>The Image component supports default dragging effects. When <code>draggable</code> is set to <code>true</code>, the component can be dragged. Refer to the document: <a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/image-V5">https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/image-V5</a><br><img src="/../images/%E3%80%90%E6%AF%8F%E6%97%A5%E5%AD%A6%E7%82%B9HarmonyOS%20Next%E7%9F%A5%E8%AF%86%E3%80%9125.03.05.png" alt="alt text"><br>In HarmonyOS, the Image component natively supports long-press to trigger dragging events. Specifically, the dragging capability is achieved by setting the <code>draggable</code> attribute. By default, <code>draggable</code> is <code>true</code> for Text, TextInput, TextArea, Hyperlink, Image, and RichEditor components, meaning they can be long-pressed and dragged. You can customize Image-related components to disable dragging for specific cases.  </p>
<h4 id="2-Why-can’t-animation-zoom-be-achieved-after-switching-to-a-model-in-HarmonyOS"><a href="#2-Why-can’t-animation-zoom-be-achieved-after-switching-to-a-model-in-HarmonyOS" class="headerlink" title="2. Why can’t animation zoom be achieved after switching to a model in HarmonyOS?"></a>2. Why can’t animation zoom be achieved after switching to a model in HarmonyOS?</h4><p>When ListItem content is an object, direct comparison with <code>==</code> for the current item is invalid. Use the index to determine the clicked item instead. Modify as follows: (For other cases, refer to: <a target="_blank" rel="noopener" href="https://gitee.com/harmonyos-cases/cases/tree/master/CommonAppDevelopment/feature/listexchange">https://gitee.com/harmonyos-cases/cases/tree/master/CommonAppDevelopment/feature/listexchange</a>)  </p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> curves <span class="keyword">from</span> <span class="string">&#x27;@ohos.curves&#x27;</span>;</span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct model &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="keyword">private</span> <span class="attr">arr</span>: titleStrModel[] = []</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">dragItem</span>: titleStrModel = <span class="keyword">new</span> <span class="title function_">titleStrModel</span>()</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">scaleItem</span>: titleStrModel = <span class="keyword">new</span> <span class="title function_">titleStrModel</span>()</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">neighborItem</span>: titleStrModel = <span class="keyword">new</span> <span class="title function_">titleStrModel</span>()</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">selectedIndex</span>: <span class="built_in">number</span> = -<span class="number">1</span></span><br><span class="line">  <span class="meta">@State</span> <span class="attr">neighborScale</span>: <span class="built_in">number</span> = -<span class="number">1</span></span><br><span class="line">  <span class="keyword">private</span> <span class="attr">dragRefOffset</span>: <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">  <span class="meta">@State</span> <span class="attr">offsetX</span>: <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">  <span class="meta">@State</span> <span class="attr">offsetY</span>: <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">  <span class="keyword">private</span> <span class="attr">ITEM_INTV</span>: <span class="built_in">number</span> = <span class="number">120</span></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> d = <span class="keyword">new</span> <span class="title function_">titleStrModel</span>()</span><br><span class="line">    d.<span class="property">name</span> = <span class="string">&#x27;wewewe&#x27;</span></span><br><span class="line">    <span class="keyword">const</span> b = <span class="keyword">new</span> <span class="title function_">titleStrModel</span>()</span><br><span class="line">    b.<span class="property">name</span> = <span class="string">&#x27;adadad&#x27;</span></span><br><span class="line">    <span class="keyword">const</span> h = <span class="keyword">new</span> <span class="title function_">titleStrModel</span>()</span><br><span class="line">    h.<span class="property">name</span> = <span class="string">&#x27;dfdfdf&#x27;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">arr</span>.<span class="title function_">push</span>(d)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">arr</span>.<span class="title function_">push</span>(b)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">arr</span>.<span class="title function_">push</span>(h)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Determine if the item should be scaled based on the current index</span></span><br><span class="line">  <span class="title function_">scaleSelect</span>(<span class="attr">item</span>: titleStrModel): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">selectedIndex</span> = <span class="variable language_">this</span>.<span class="property">arr</span>.<span class="title function_">indexOf</span>(item)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">arr</span>[<span class="variable language_">this</span>.<span class="property">selectedIndex</span>].<span class="property">scale</span> = <span class="number">1.05</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">itemMove</span>(<span class="attr">index</span>: <span class="built_in">number</span>, <span class="attr">newIndex</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> tmp = <span class="variable language_">this</span>.<span class="property">arr</span>.<span class="title function_">splice</span>(index, <span class="number">1</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">arr</span>.<span class="title function_">splice</span>(newIndex, <span class="number">0</span>, tmp[<span class="number">0</span>])</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Stack</span>() &#123;</span><br><span class="line">      <span class="title class_">List</span>(&#123; <span class="attr">space</span>: <span class="number">20</span>, <span class="attr">initialIndex</span>: <span class="number">0</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">arr</span>, <span class="function">(<span class="params"><span class="attr">item</span>: titleStrModel</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">            <span class="title class_">Row</span>() &#123;</span><br><span class="line">              <span class="title class_">Text</span>(<span class="string">&#x27;&#x27;</span> + item.<span class="property">name</span>)</span><br><span class="line">                .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">                .<span class="title function_">height</span>(<span class="number">100</span>)</span><br><span class="line">                .<span class="title function_">fontSize</span>(<span class="number">16</span>)</span><br><span class="line">                .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">                .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">                .<span class="title function_">backgroundColor</span>(<span class="number">0xFFFFFF</span>)</span><br><span class="line">              <span class="title class_">Image</span>($r(<span class="string">&#x27;app.media.app_icon&#x27;</span>))</span><br><span class="line">                .<span class="title function_">width</span>(<span class="number">100</span>)</span><br><span class="line">                .<span class="title function_">height</span>(<span class="number">100</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            .<span class="title function_">shadow</span>(<span class="variable language_">this</span>.<span class="property">scaleItem</span>.<span class="property">name</span> == item.<span class="property">name</span> ? &#123; <span class="attr">radius</span>: <span class="number">70</span>, <span class="attr">color</span>: <span class="title class_">Color</span>.<span class="property">Blue</span>, <span class="attr">offsetX</span>: <span class="number">0</span>, <span class="attr">offsetY</span>: <span class="number">0</span> &#125; :</span><br><span class="line">              &#123; <span class="attr">radius</span>: <span class="number">0</span>, <span class="attr">color</span>: <span class="title class_">Color</span>.<span class="property">Blue</span>, <span class="attr">offsetX</span>: <span class="number">0</span>, <span class="attr">offsetY</span>: <span class="number">0</span> &#125;)</span><br><span class="line">            .<span class="title function_">animation</span>(&#123; <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">Sharp</span>, <span class="attr">duration</span>: <span class="number">300</span> &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">margin</span>(&#123; <span class="attr">left</span>: <span class="number">12</span>, <span class="attr">right</span>: <span class="number">12</span> &#125;)</span><br><span class="line">          .<span class="title function_">scale</span>(&#123; <span class="attr">x</span>: item.<span class="property">scale</span>, <span class="attr">y</span>: item.<span class="property">scale</span> &#125;)</span><br><span class="line">          .<span class="title function_">zIndex</span>(<span class="variable language_">this</span>.<span class="property">dragItem</span>.<span class="property">name</span> == item.<span class="property">name</span> ? <span class="number">1</span> : <span class="number">0</span>)</span><br><span class="line">          .<span class="title function_">translate</span>(<span class="variable language_">this</span>.<span class="property">dragItem</span>.<span class="property">name</span> == item.<span class="property">name</span> ? &#123; <span class="attr">y</span>: <span class="variable language_">this</span>.<span class="property">offsetY</span> &#125; : &#123; <span class="attr">y</span>: <span class="number">0</span> &#125;)</span><br><span class="line">          .<span class="title function_">gesture</span>(</span><br><span class="line"></span><br><span class="line">            <span class="comment">// The following combined gesture is sequentially recognized; the drag gesture will not trigger if the long-press gesture fails</span></span><br><span class="line">            <span class="title class_">GestureGroup</span>(<span class="title class_">GestureMode</span>.<span class="property">Sequence</span>,</span><br><span class="line">              <span class="title class_">LongPressGesture</span>(&#123; <span class="attr">repeat</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">                .<span class="title function_">onAction</span>(<span class="function">(<span class="params"><span class="attr">event</span>?: <span class="title class_">GestureEvent</span></span>) =&gt;</span> &#123;</span><br><span class="line">                  <span class="title function_">animateTo</span>(&#123; <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">Friction</span>, <span class="attr">duration</span>: <span class="number">300</span> &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">scaleItem</span> = item</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">scaleSelect</span>(item)</span><br><span class="line">                  &#125;)</span><br><span class="line">                &#125;)</span><br><span class="line">                .<span class="title function_">onActionEnd</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                  <span class="title function_">animateTo</span>(&#123; <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">Friction</span>, <span class="attr">duration</span>: <span class="number">300</span> &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">scaleItem</span> = <span class="keyword">new</span> <span class="title function_">titleStrModel</span>()</span><br><span class="line">                  &#125;)</span><br><span class="line">                &#125;),</span><br><span class="line">              <span class="title class_">PanGesture</span>(&#123; <span class="attr">fingers</span>: <span class="number">1</span>, <span class="attr">direction</span>: <span class="literal">null</span>, <span class="attr">distance</span>: <span class="number">0</span> &#125;)</span><br><span class="line">                .<span class="title function_">onActionStart</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                  <span class="variable language_">this</span>.<span class="property">dragItem</span> = item</span><br><span class="line">                  <span class="variable language_">this</span>.<span class="property">dragRefOffset</span> = <span class="number">0</span></span><br><span class="line">                &#125;)</span><br><span class="line">                .<span class="title function_">onActionUpdate</span>(<span class="function">(<span class="params"><span class="attr">event</span>: <span class="title class_">GestureEvent</span></span>) =&gt;</span> &#123;</span><br><span class="line">                  <span class="variable language_">this</span>.<span class="property">offsetY</span> = event.<span class="property">offsetY</span> - <span class="variable language_">this</span>.<span class="property">dragRefOffset</span></span><br><span class="line">                  <span class="comment">// console.log(&#x27;Y:&#x27; + this.offsetY.toString())</span></span><br><span class="line">                  <span class="variable language_">this</span>.<span class="property">neighborItem</span> = <span class="keyword">new</span> <span class="title function_">titleStrModel</span>()</span><br><span class="line">                  <span class="keyword">let</span> index = <span class="variable language_">this</span>.<span class="property">arr</span>.<span class="title function_">indexOf</span>(item)</span><br><span class="line">                  <span class="keyword">let</span> curveValue = curves.<span class="title function_">initCurve</span>(<span class="title class_">Curve</span>.<span class="property">Sharp</span>)</span><br><span class="line">                  <span class="keyword">let</span> <span class="attr">value</span>: <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">                  <span class="comment">// Calculate the scale of adjacent items based on displacement</span></span><br><span class="line">                  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">offsetY</span> &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                    value = curveValue.<span class="title function_">interpolate</span>(-<span class="variable language_">this</span>.<span class="property">offsetY</span> / <span class="variable language_">this</span>.<span class="property">ITEM_INTV</span>)</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">neighborItem</span> = <span class="variable language_">this</span>.<span class="property">arr</span>[index - <span class="number">1</span>]</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">neighborScale</span> = <span class="number">1</span> - value / <span class="number">20</span>;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;neighborScale:&#x27;</span> + <span class="variable language_">this</span>.<span class="property">neighborScale</span>.<span class="title function_">toString</span>())</span><br><span class="line">                  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">offsetY</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    value = curveValue.<span class="title function_">interpolate</span>(<span class="variable language_">this</span>.<span class="property">offsetY</span> / <span class="variable language_">this</span>.<span class="property">ITEM_INTV</span>)</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">neighborItem</span> = <span class="variable language_">this</span>.<span class="property">arr</span>[index + <span class="number">1</span>]</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">neighborScale</span> = <span class="number">1</span> - value / <span class="number">20</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">                  <span class="comment">// Swap排序 based on displacement</span></span><br><span class="line">                  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">offsetY</span> &gt; <span class="variable language_">this</span>.<span class="property">ITEM_INTV</span> / <span class="number">2</span>) &#123;</span><br><span class="line">                    <span class="title function_">animateTo</span>(&#123; <span class="attr">curve</span>: curves.<span class="title function_">interpolatingSpring</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">400</span>, <span class="number">38</span>) &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                      <span class="variable language_">this</span>.<span class="property">offsetY</span> -= <span class="variable language_">this</span>.<span class="property">ITEM_INTV</span></span><br><span class="line">                      <span class="variable language_">this</span>.<span class="property">dragRefOffset</span> += <span class="variable language_">this</span>.<span class="property">ITEM_INTV</span></span><br><span class="line">                      <span class="variable language_">this</span>.<span class="title function_">itemMove</span>(index, index + <span class="number">1</span>)</span><br><span class="line">                    &#125;)</span><br><span class="line">                  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">offsetY</span> &lt; -<span class="variable language_">this</span>.<span class="property">ITEM_INTV</span> / <span class="number">2</span>) &#123;</span><br><span class="line">                    <span class="title function_">animateTo</span>(&#123; <span class="attr">curve</span>: curves.<span class="title function_">interpolatingSpring</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">400</span>, <span class="number">38</span>) &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                      <span class="variable language_">this</span>.<span class="property">offsetY</span> += <span class="variable language_">this</span>.<span class="property">ITEM_INTV</span></span><br><span class="line">                      <span class="variable language_">this</span>.<span class="property">dragRefOffset</span> -= <span class="variable language_">this</span>.<span class="property">ITEM_INTV</span></span><br><span class="line">                      <span class="variable language_">this</span>.<span class="title function_">itemMove</span>(index, index - <span class="number">1</span>)</span><br><span class="line">                    &#125;)</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .<span class="title function_">onActionEnd</span>(<span class="function">(<span class="params"><span class="attr">event</span>: <span class="title class_">GestureEvent</span></span>) =&gt;</span> &#123;</span><br><span class="line">                  <span class="title function_">animateTo</span>(&#123; <span class="attr">curve</span>: curves.<span class="title function_">interpolatingSpring</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">400</span>, <span class="number">38</span>) &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">dragItem</span> = <span class="keyword">new</span> <span class="title function_">titleStrModel</span>()</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">neighborItem</span> = <span class="keyword">new</span> <span class="title function_">titleStrModel</span>()</span><br><span class="line">                    <span class="comment">// Restore the scale after the animation ends</span></span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">arr</span>[<span class="variable language_">this</span>.<span class="property">arr</span>.<span class="title function_">indexOf</span>(<span class="variable language_">this</span>.<span class="property">scaleItem</span>)].<span class="property">scale</span> = <span class="number">1</span></span><br><span class="line">                  &#125;)</span><br><span class="line">                  <span class="title function_">animateTo</span>(&#123;</span><br><span class="line">                    <span class="attr">curve</span>: curves.<span class="title function_">interpolatingSpring</span>(<span class="number">14</span>, <span class="number">1</span>, <span class="number">170</span>, <span class="number">17</span>), <span class="attr">delay</span>: <span class="number">150</span></span><br><span class="line">                  &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">scaleItem</span> = <span class="keyword">new</span> <span class="title function_">titleStrModel</span>()</span><br><span class="line">                  &#125;)</span><br><span class="line">                &#125;)</span><br><span class="line">            )</span><br><span class="line">              .<span class="title function_">onCancel</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">animateTo</span>(&#123; <span class="attr">curve</span>: curves.<span class="title function_">interpolatingSpring</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">400</span>, <span class="number">38</span>) &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                  <span class="variable language_">this</span>.<span class="property">dragItem</span> = <span class="keyword">new</span> <span class="title function_">titleStrModel</span>()</span><br><span class="line">                  <span class="variable language_">this</span>.<span class="property">neighborItem</span> = <span class="keyword">new</span> <span class="title function_">titleStrModel</span>()</span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="title function_">animateTo</span>(&#123;</span><br><span class="line">                  <span class="attr">curve</span>: curves.<span class="title function_">interpolatingSpring</span>(<span class="number">14</span>, <span class="number">1</span>, <span class="number">170</span>, <span class="number">17</span>), <span class="attr">delay</span>: <span class="number">150</span></span><br><span class="line">                &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                  <span class="variable language_">this</span>.<span class="property">scaleItem</span> = <span class="keyword">new</span> <span class="title function_">titleStrModel</span>()</span><br><span class="line">                &#125;)</span><br><span class="line">              &#125;)</span><br><span class="line">          )</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">backgroundColor</span>(<span class="number">0xDCDCDC</span>).<span class="title function_">padding</span>(&#123; <span class="attr">top</span>: <span class="number">5</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">titleStrModel</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="attr">scale</span>: <span class="built_in">number</span> = <span class="number">1</span> <span class="comment">// Add the scale attribute, each item has a corresponding scale value</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#### 3. Why doesn&#x27;t setting List height to 100% display completely in HarmonyOS?  </span></span><br><span class="line"><span class="string">The issue is resolved by adding `</span><span class="title function_">layoutWeight</span>(<span class="number">1</span>)<span class="string">` to both the child Column and List. Here’s the explanation:  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1. **Principle of layoutWeight**: When the parent container&#x27;s size is fixed, child elements with `</span>layoutWeight<span class="string">` distribute the main-axis space proportionally based on their weights. For example, three elements with `</span><span class="title function_">layoutWeight</span>(<span class="number">1</span>)<span class="string">` each will divide the parent container&#x27;s main-axis space in a 1:1:1 ratio, similar to `</span>.<span class="title function_">width</span>(<span class="string">&#x27;33%&#x27;</span>)<span class="string">`, `</span>.<span class="title function_">width</span>(<span class="string">&#x27;34%&#x27;</span>)<span class="string">`, `</span>.<span class="title function_">width</span>(<span class="string">&#x27;33%&#x27;</span>)<span class="string">`.  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2. **Tabs behavior**: Tabs by default occupy the full screen height, making explicit height calculations (e.g., `</span><span class="title class_">TNAppUIData</span>.<span class="title function_">getPageHeight</span>()<span class="string">`) ineffective as they override the computed height.  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#### 4. How to listen for physical back button presses in HarmonyOS?  </span></span><br><span class="line"><span class="string">When a CustomDialog is open, pressing the physical back button should not close the dialog. Use `</span>onBackPress<span class="string">`, which triggers when the back button is clicked and only works for `</span><span class="meta">@Entry</span><span class="string">`-decorated custom components. Return `</span><span class="literal">true</span><span class="string">` to handle the back logic locally without routing; return `</span><span class="literal">false</span><span class="string">` (or no return value) to use default routing. Refer to: https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-custom-component-lifecycle-V5#onbackpress  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span>onBackPress?(): <span class="built_in">void</span> | <span class="built_in">boolean</span><span class="string">`  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Example:  </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>typescript</span><br><span class="line"><span class="comment">// xxx.ets</span></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">IndexComponent</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">textColor</span>: <span class="title class_">Color</span> = <span class="title class_">Color</span>.<span class="property">Black</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onPageShow</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">textColor</span> = <span class="title class_">Color</span>.<span class="property">Blue</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;IndexComponent onPageShow&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onPageHide</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">textColor</span> = <span class="title class_">Color</span>.<span class="property">Transparent</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;IndexComponent onPageHide&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onBackPress</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">textColor</span> = <span class="title class_">Color</span>.<span class="property">Red</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;IndexComponent onBackPress&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// Handle back logic locally, prevent default routing</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">&#x27;Hello World&#x27;</span>)</span><br><span class="line">        .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">30</span>)</span><br><span class="line">        .<span class="title function_">margin</span>(<span class="number">30</span>)</span><br><span class="line">    &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#### 5. How to match the color before startMargin in List divider with ListItem in HarmonyOS?  </span></span><br><span class="line"><span class="string">The built-in `</span>divider<span class="string">` attribute of List cannot meet this requirement. Customize the divider as follows:  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>typescript</span><br><span class="line"><span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title class_">Row</span>() &#123;</span><br><span class="line">    <span class="title class_">List</span>() &#123;</span><br><span class="line">      <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">        <span class="title class_">Flex</span>(&#123; <span class="attr">direction</span>: <span class="title class_">FlexDirection</span>.<span class="property">Column</span>, <span class="attr">justifyContent</span>: <span class="title class_">FlexAlign</span>.<span class="property">SpaceBetween</span> &#125;) &#123;</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;test&#x27;</span>)</span><br><span class="line">          <span class="title class_">Divider</span>()</span><br><span class="line">            .<span class="title function_">color</span>(<span class="title class_">Color</span>.<span class="property">Red</span>)</span><br><span class="line">            .<span class="title function_">strokeWidth</span>(<span class="number">5</span>)</span><br><span class="line">            .<span class="title function_">margin</span>(&#123; <span class="attr">left</span>: <span class="number">50</span> &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;.<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Blue</span>)</span><br><span class="line">      .<span class="title function_">height</span>(<span class="number">100</span>)</span><br><span class="line">      <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">        <span class="title class_">Flex</span>(&#123; <span class="attr">direction</span>: <span class="title class_">FlexDirection</span>.<span class="property">Column</span>, <span class="attr">justifyContent</span>: <span class="title class_">FlexAlign</span>.<span class="property">SpaceBetween</span> &#125;) &#123;</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;test&#x27;</span>)</span><br><span class="line">          <span class="title class_">Divider</span>()</span><br><span class="line">            .<span class="title function_">color</span>(<span class="title class_">Color</span>.<span class="property">Red</span>)</span><br><span class="line">            .<span class="title function_">strokeWidth</span>(<span class="number">5</span>)</span><br><span class="line">            .<span class="title function_">margin</span>(&#123; <span class="attr">left</span>: <span class="number">50</span>, <span class="attr">bottom</span>: <span class="number">0</span> &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;.<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Orange</span>)</span><br><span class="line">      .<span class="title function_">height</span>(<span class="number">100</span>)</span><br><span class="line">      <span class="title class_">ListItem</span>() &#123;</span><br><span class="line">        <span class="title class_">Flex</span>(&#123; <span class="attr">direction</span>: <span class="title class_">FlexDirection</span>.<span class="property">Column</span>, <span class="attr">justifyContent</span>: <span class="title class_">FlexAlign</span>.<span class="property">SpaceBetween</span> &#125;) &#123;</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;test&#x27;</span>)</span><br><span class="line">          <span class="title class_">Divider</span>()</span><br><span class="line">            .<span class="title function_">color</span>(<span class="title class_">Color</span>.<span class="property">Red</span>)</span><br><span class="line">            .<span class="title function_">strokeWidth</span>(<span class="number">5</span>)</span><br><span class="line">            .<span class="title function_">margin</span>(&#123; <span class="attr">left</span>: <span class="number">50</span> &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;.<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Yellow</span>)</span><br><span class="line">      .<span class="title function_">height</span>(<span class="number">100</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Gray</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/24/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/24/">24</a><span class="page-number current">25</span><a class="page-number" href="/page/26/">26</a><span class="space">&hellip;</span><a class="page-number" href="/page/35/">35</a><a class="extend next" rel="next" href="/page/26/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Qingkouwei</p>
  <div class="site-description" itemprop="description">Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">347</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Qingkouwei</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>

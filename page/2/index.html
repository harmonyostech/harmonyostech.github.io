<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"harmonyostech.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next&#96;s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoo">
<meta property="og:type" content="website">
<meta property="og:title" content="HarmonyOS NEXT Knowledge Charging Station">
<meta property="og:url" content="https://harmonyostech.github.io/page/2/index.html">
<meta property="og:site_name" content="HarmonyOS NEXT Knowledge Charging Station">
<meta property="og:description" content="Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next&#96;s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Qingkouwei">
<meta property="article:tag" content="HarmonyOSNext, HarmonyOS NEXT, HarmonyOS, Cangjie">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://harmonyostech.github.io/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>HarmonyOS NEXT Knowledge Charging Station</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">HarmonyOS NEXT Knowledge Charging Station</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Analysis of Core Technologies and Application Scenarios of HarmonyOS NEXT</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://harmonyostech.github.io/2025/06/30/4824-Daily-HarmonyOS-Next-Knowledge-View-Touch-Hotspot-Range-Direct-Clipboard-Assignment-Component-Screenshot-Portrait-Landscape-Switch-Screenshot-Prevention-etc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Qingkouwei">
      <meta itemprop="description" content="Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HarmonyOS NEXT Knowledge Charging Station">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/06/30/4824-Daily-HarmonyOS-Next-Knowledge-View-Touch-Hotspot-Range-Direct-Clipboard-Assignment-Component-Screenshot-Portrait-Landscape-Switch-Screenshot-Prevention-etc/" class="post-title-link" itemprop="url">[Daily HarmonyOS Next Knowledge] View Touch Hotspot Range, Direct Clipboard Assignment, Component Screenshot, Portrait/Landscape Switch, Screenshot Prevention, etc.</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-06-30 17:29:58 / Modified: 17:30:55" itemprop="dateCreated datePublished" datetime="2025-06-30T17:29:58+08:00">2025-06-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Daily-HarmonyOS-Next-Knowledge/" itemprop="url" rel="index"><span itemprop="name">Daily HarmonyOS Next Knowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Daily-HarmonyOS-Next-Knowledge-View-Touch-Hotspot-Range-Direct-Clipboard-Assignment-Component-Screenshot-Portrait-Landscape-Switch-Screenshot-Prevention-etc"><a href="#Daily-HarmonyOS-Next-Knowledge-View-Touch-Hotspot-Range-Direct-Clipboard-Assignment-Component-Screenshot-Portrait-Landscape-Switch-Screenshot-Prevention-etc" class="headerlink" title="[Daily HarmonyOS Next Knowledge] View Touch Hotspot Range, Direct Clipboard Assignment, Component Screenshot, Portrait&#x2F;Landscape Switch, Screenshot Prevention, etc."></a>[Daily HarmonyOS Next Knowledge] View Touch Hotspot Range, Direct Clipboard Assignment, Component Screenshot, Portrait&#x2F;Landscape Switch, Screenshot Prevention, etc.</h1><h2 id="1-How-to-view-the-touch-hotspot-range"><a href="#1-How-to-view-the-touch-hotspot-range" class="headerlink" title="1. How to view the touch hotspot range?"></a>1. How to view the touch hotspot range?</h2><p>Currently, the <code>responseRegion</code> can only be obtained through customization.<br>Reference document: <a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-universal-attributes-touch-target-V5">Touch Hotspot Settings</a>  </p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">TouchTargetExample</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">text</span>: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="meta">@State</span> <span class="attr">x</span>: <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">  <span class="meta">@State</span> <span class="attr">y</span>: <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">  <span class="meta">@State</span> <span class="attr">reg_width</span>: <span class="built_in">string</span> = <span class="string">&#x27;50%&#x27;</span></span><br><span class="line">  <span class="meta">@State</span> <span class="attr">reg_height</span>: <span class="built_in">string</span> = <span class="string">&#x27;100%&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">20</span> &#125;) &#123;</span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">&quot;&#123;x:0,y:0,width:&#x27;50%&#x27;,height:&#x27;100%&#x27;&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// The hotspot width is half of the button; clicking the right side has no response.</span></span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;button&#x27;</span>)</span><br><span class="line">        .<span class="title function_">responseRegion</span>(&#123; <span class="attr">x</span>: <span class="variable language_">this</span>.<span class="property">x</span>, <span class="attr">y</span>: <span class="variable language_">this</span>.<span class="property">y</span>, <span class="attr">width</span>: <span class="variable language_">this</span>.<span class="property">reg_width</span>, <span class="attr">height</span>: <span class="variable language_">this</span>.<span class="property">reg_height</span> &#125;)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">text</span> = <span class="string">&#x27;button clicked&#x27;</span></span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;button clicked: &#x27;</span> + <span class="variable language_">this</span>.<span class="property">x</span> + <span class="string">&#x27; &#x27;</span> + <span class="variable language_">this</span>.<span class="property">y</span> + <span class="string">&#x27; &#x27;</span> + <span class="variable language_">this</span>.<span class="property">reg_width</span> + <span class="string">&#x27; &#x27;</span> + <span class="variable language_">this</span>.<span class="property">reg_height</span>)</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">text</span>).<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">10</span> &#125;)</span><br><span class="line">    &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">100</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 2. How to directly copy content to the clipboard?  </span></span><br><span class="line"><span class="string">Directly add text to the clipboard without popping up a text selection dialog.  </span></span><br><span class="line"><span class="string">Reference code:  </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>typescript</span><br><span class="line"><span class="keyword">import</span> &#123; pasteboard &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.BasicServicesKit&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; promptAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">CopyText</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">textContent</span>: <span class="built_in">string</span> = <span class="string">&#x27;复制我&#x27;</span>  <span class="comment">// &quot;Copy Me&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">textContent</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>($r(<span class="string">&#x27;sys.float.ohos_id_text_size_body3&#x27;</span>))</span><br><span class="line">        .<span class="title function_">borderRadius</span>(<span class="number">9</span>)</span><br><span class="line">        .<span class="title function_">borderWidth</span>(<span class="number">1</span>)</span><br><span class="line">        .<span class="title function_">padding</span>(&#123; <span class="attr">left</span>: <span class="number">8</span>, <span class="attr">right</span>: <span class="number">8</span> &#125;)</span><br><span class="line">        .<span class="title function_">fontColor</span>($r(<span class="string">&#x27;sys.color.ohos_id_color_text_primary&#x27;</span>))</span><br><span class="line">        .<span class="title function_">fontWeight</span>(<span class="title class_">FontWeight</span>.<span class="property">Medium</span>)</span><br><span class="line">        .<span class="title function_">opacity</span>($r(<span class="string">&#x27;sys.float.ohos_id_alpha_content_secondary&#x27;</span>))</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> <span class="title function_">copyText</span>(<span class="variable language_">this</span>.<span class="property">textContent</span>))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">copyText</span>(<span class="params"><span class="attr">text</span>: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> pasteboardData = pasteboard.<span class="title function_">createData</span>(pasteboard.<span class="property">MIMETYPE_TEXT_PLAIN</span>, text)</span><br><span class="line">  <span class="keyword">const</span> systemPasteboard = pasteboard.<span class="title function_">getSystemPasteboard</span>()</span><br><span class="line">  systemPasteboard.<span class="title function_">setData</span>(pasteboardData)  <span class="comment">// Put data into the clipboard</span></span><br><span class="line">  systemPasteboard.<span class="title function_">getData</span>().<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (data) &#123;</span><br><span class="line">      promptAction.<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">&#x27;复制成功&#x27;</span> &#125;)  <span class="comment">// &quot;Copy successful&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      promptAction.<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">&#x27;复制失败&#x27;</span> &#125;)  <span class="comment">// &quot;Copy failed&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 3. How to save component screenshots? Store PixelMap in the system album or app sandbox.  </span></span><br><span class="line"><span class="string">**Step 1: Confirm the capability required for component screenshotting: `</span>componentSnapshot<span class="string">`**  </span></span><br><span class="line"><span class="string">Screenshot capabilities include window screenshot (`</span><span class="variable language_">window</span>.<span class="title function_">snapshot</span>()<span class="string">`) and component screenshot (`</span><span class="meta">@ohos</span>.<span class="property">arkui</span>.<span class="property">componentSnapshot</span><span class="string">`). Choose the appropriate API based on business needs.  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**Step 2: Application authorization and configuration**  </span></span><br><span class="line"><span class="string">To save to the system album, apply for the album management permission in `</span><span class="variable language_">module</span>.<span class="property">json5</span><span class="string">`:  </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>json</span><br><span class="line"><span class="string">&quot;requestPermissions&quot;</span>: [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;ohos.permission.WRITE_IMAGEVIDEO&quot;</span>,</span><br><span class="line">    <span class="string">&quot;reason&quot;</span>: <span class="string">&quot;$string:reason&quot;</span>,</span><br><span class="line">    <span class="string">&quot;usedScene&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;abilities&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;EntryFormAbility&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&quot;when&quot;</span>: <span class="string">&quot;inuse&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string">Obtain permissions at the page entry:  </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>typescript</span><br><span class="line"><span class="keyword">import</span> &#123; abilityAccessCtrl, common, <span class="title class_">Permissions</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.AbilityKit&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="attr">permissions</span>: <span class="title class_">Array</span>&lt;<span class="title class_">Permissions</span>&gt; = [<span class="string">&#x27;ohos.permission.WRITE_IMAGEVIDEO&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">reqPermissionsFromUser</span>(<span class="params"><span class="attr">permissions</span>: <span class="title class_">Array</span>&lt;<span class="title class_">Permissions</span>&gt;, <span class="attr">context</span>: common.<span class="title class_">UIAbilityContext</span></span>): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">atManager</span>: abilityAccessCtrl.<span class="property">AtManager</span> =</span><br><span class="line">    abilityAccessCtrl.<span class="title function_">createAtManager</span>();</span><br><span class="line">  atManager.<span class="title function_">requestPermissionsFromUser</span>(context, permissions).<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">grantStatus</span>: <span class="title class_">Array</span>&lt;<span class="built_in">number</span>&gt; = data.<span class="property">authResults</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">length</span>: <span class="built_in">number</span> = grantStatus.<span class="property">length</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (grantStatus[i] === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// User authorized, proceed with the target operation</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// User denied authorization, prompt for mandatory authorization and guide to settings</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Authorization successful</span></span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params"><span class="attr">err</span>: <span class="title class_">BusinessError</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`Failed to request permissions from user. Code is <span class="subst">$&#123;err.code&#125;</span>, message is <span class="subst">$&#123;err.message&#125;</span>`</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">aboutToAppear</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">  <span class="title function_">reqPermissionsFromUser</span>(permissions, <span class="variable language_">this</span>.<span class="property">context</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**Step 3: Call component screenshot to get PixelMap**  </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>typescript</span><br><span class="line"><span class="comment">/* Component screenshot */</span></span><br><span class="line"><span class="title function_">clickToComponentSnapshot</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// &quot;root&quot; is the component ID</span></span><br><span class="line">  componentSnapshot.<span class="title function_">get</span>(<span class="string">&quot;root&quot;</span>, <span class="function">(<span class="params"><span class="attr">error</span>: <span class="title class_">Error</span>, <span class="attr">pixmap</span>: image.<span class="title class_">PixelMap</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;error: &quot;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(error))</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;截图成功&#x27;</span>)  <span class="comment">// &quot;Screenshot successful&quot;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">pixmap</span> = pixmap</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**Step 4: Save to system album or app sandbox**  </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>typescript</span><br><span class="line"><span class="comment">// Save to system album</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">savePixmap2SysHelper</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">pixmap</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> imgBuffer = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">transferPixelMap2Buffer</span>(<span class="variable language_">this</span>.<span class="property">pixmap</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Get the photo access helper instance for album operations */</span></span><br><span class="line">  <span class="keyword">let</span> helper = photoAccessHelper.<span class="title function_">getPhotoAccessHelper</span>(<span class="title function_">getContext</span>(<span class="variable language_">this</span>))</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Create image/video assets with specified type and suffix, return result via callback */</span></span><br><span class="line">  <span class="keyword">const</span> uri = <span class="keyword">await</span> helper.<span class="title function_">createAsset</span>(photoAccessHelper.<span class="property">PhotoType</span>.<span class="property">IMAGE</span>, <span class="string">&#x27;png&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> file = <span class="keyword">await</span> fs.<span class="title function_">open</span>(uri, fs.<span class="property">OpenMode</span>.<span class="property">READ_WRITE</span> | fs.<span class="property">OpenMode</span>.<span class="property">CREATE</span>)</span><br><span class="line">  <span class="keyword">await</span> fs.<span class="title function_">write</span>(file.<span class="property">fd</span>, imgBuffer)</span><br><span class="line">  <span class="comment">/* Close the file */</span></span><br><span class="line">  <span class="keyword">await</span> fs.<span class="title function_">close</span>(file.<span class="property">fd</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Convert PixelMap to image buffer */</span></span><br><span class="line"><span class="title function_">transferPixelMap2Buffer</span>(<span class="attr">pixelMap</span>: image.<span class="property">PixelMap</span>): <span class="title class_">Promise</span>&lt;<span class="title class_">ArrayBuffer</span>&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/* Packing options: format (only jpg/webp), quality, buffer size (default 10M) */</span></span><br><span class="line">    <span class="keyword">let</span> <span class="attr">packOpts</span>: image.<span class="property">PackingOption</span> = &#123; <span class="attr">format</span>: <span class="string">&quot;image/jpeg&quot;</span>, <span class="attr">quality</span>: <span class="number">98</span> &#125;</span><br><span class="line">    <span class="keyword">const</span> imagePackerApi = image.<span class="title function_">createImagePacker</span>()</span><br><span class="line">    imagePackerApi.<span class="title function_">packing</span>(pixelMap, packOpts).<span class="title function_">then</span>(<span class="function">(<span class="params"><span class="attr">buffer</span>: <span class="title class_">ArrayBuffer</span></span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">resolve</span>(buffer)</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params"><span class="attr">err</span>: <span class="title class_">BusinessError</span></span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">reject</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Save to app sandbox */</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">savePixmal2SystemFileManager</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">pixmap</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> imgBuffer = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">transferPixelMap2Buffer</span>(<span class="variable language_">this</span>.<span class="property">pixmap</span>)</span><br><span class="line">  <span class="keyword">const</span> file = fs.<span class="title function_">openSync</span>(<span class="variable language_">this</span>.<span class="property">filesDir</span> + <span class="string">`/<span class="subst">$&#123;DateUtil.getTimeStamp()&#125;</span>.png`</span>, fs.<span class="property">OpenMode</span>.<span class="property">READ_WRITE</span> | fs.<span class="property">OpenMode</span>.<span class="property">CREATE</span>);</span><br><span class="line">  <span class="keyword">await</span> fs.<span class="title function_">write</span>(file.<span class="property">fd</span>, imgBuffer)</span><br><span class="line">  <span class="comment">/* Close the file */</span></span><br><span class="line">  <span class="keyword">await</span> fs.<span class="title function_">close</span>(file.<span class="property">fd</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 4. How to implement portrait/landscape switching for a page?  </span></span><br><span class="line"><span class="string">Use `</span>setPreferredOrientation<span class="string">` to switch between portrait and landscape: [setPreferredOrientation](https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-window-V5#setpreferredorientation9)  </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>typescript</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable language_">window</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">Index</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">message</span>: <span class="built_in">string</span> = <span class="string">&#x27;Hello World&#x27;</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">portrait</span>: <span class="built_in">boolean</span> = <span class="literal">true</span></span><br><span class="line">  changeOrientation = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Get the current page context</span></span><br><span class="line">    <span class="keyword">let</span> context = <span class="title function_">getContext</span>(<span class="variable language_">this</span>)</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">getLastWindow</span>(context).<span class="title function_">then</span>(<span class="function">(<span class="params">mainWindow</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">changeOrientationInternal</span>(mainWindow)</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params"><span class="attr">error</span>: <span class="title class_">ESObject</span></span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;getMainWindow error: &#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(error))</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">changeOrientationInternal</span>(<span class="params"><span class="attr">lastWindow</span>: <span class="variable language_">window</span>.<span class="title class_">Window</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">portrait</span>) &#123;</span><br><span class="line">      <span class="comment">// Switch to landscape</span></span><br><span class="line">      lastWindow.<span class="title function_">setPreferredOrientation</span>(<span class="variable language_">window</span>.<span class="property">Orientation</span>.<span class="property">LANDSCAPE</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;setPreferredOrientation success&#x27;</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">portrait</span> = !<span class="variable language_">this</span>.<span class="property">portrait</span></span><br><span class="line">      &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params"><span class="attr">error</span>: <span class="title class_">ESObject</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;setPreferredOrientation failure&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(error))</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// Switch to portrait</span></span><br><span class="line">      lastWindow.<span class="title function_">setPreferredOrientation</span>(<span class="variable language_">window</span>.<span class="property">Orientation</span>.<span class="property">PORTRAIT</span>).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;setPreferredOrientation success&#x27;</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">portrait</span> = !<span class="variable language_">this</span>.<span class="property">portrait</span></span><br><span class="line">      &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params"><span class="attr">error</span>: <span class="title class_">ESObject</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;setPreferredOrientation failure: &#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(error))</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">message</span>)</span><br><span class="line">        .<span class="title function_">id</span>(<span class="string">&#x27;Index19HelloWorld&#x27;</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">50</span>)</span><br><span class="line">        .<span class="title function_">fontWeight</span>(<span class="title class_">FontWeight</span>.<span class="property">Bold</span>)</span><br><span class="line">        .<span class="title function_">alignRules</span>(&#123;</span><br><span class="line">          <span class="attr">center</span>: &#123; <span class="attr">anchor</span>: <span class="string">&#x27;__container__&#x27;</span>, <span class="attr">align</span>: <span class="title class_">VerticalAlign</span>.<span class="property">Center</span> &#125;,</span><br><span class="line">          <span class="attr">middle</span>: &#123; <span class="attr">anchor</span>: <span class="string">&#x27;__container__&#x27;</span>, <span class="attr">align</span>: <span class="title class_">HorizontalAlign</span>.<span class="property">Center</span> &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;横竖屏切换&#x27;</span>)  <span class="comment">// &quot;Switch Portrait/Landscape&quot;</span></span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">changeOrientation</span>()</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Green</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 5. How to implement screenshot prevention?  </span></span><br><span class="line"><span class="string">1. When setting the window to privacy mode, add relevant permissions in the `</span><span class="variable language_">module</span>.<span class="property">json5</span><span class="string">` file of the entry:  </span></span><br><span class="line"><span class="string">   ![Permission configuration screenshot](【每日学点鸿蒙知识】24.08.24.png)  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2. Use `</span>setWindowPrivacyMode<span class="string">` to enable privacy mode:  </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>typescript</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable language_">window</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BusinessError</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.BasicServicesKit&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">Index20</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">message</span>: <span class="built_in">string</span> = <span class="string">&#x27;Hello World&#x27;</span>;</span><br><span class="line">  <span class="attr">window</span>?: <span class="variable language_">window</span>.<span class="property">Window</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">getLastWindow</span>(<span class="title function_">getContext</span>(<span class="variable language_">this</span>)).<span class="title function_">then</span>(<span class="function">(<span class="params">mainWindow</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setWindowPrivacyMode</span>(mainWindow, <span class="literal">true</span>)</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params"><span class="attr">error</span>: <span class="title class_">ESObject</span></span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;getMainWindow error: &quot;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(error))</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setWindowPrivacyMode</span>(<span class="params"><span class="attr">windowClass</span>: <span class="variable language_">window</span>.<span class="title class_">Window</span>, <span class="attr">isPrivacyMode</span>: <span class="built_in">boolean</span></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// Set the window to privacy mode (prevents screenshot/screen recording)</span></span><br><span class="line">      <span class="keyword">let</span> promise = windowClass.<span class="title function_">setWindowPrivacyMode</span>(isPrivacyMode);</span><br><span class="line">      promise.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;Succeeded in setting the window to privacy mode.&#x27;</span>);</span><br><span class="line">      &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params"><span class="attr">err</span>: <span class="title class_">BusinessError</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Failed to set the window to privacy mode. Cause: &#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(err));</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">`setWindowPrivacyMode 已执行`</span>);  <span class="comment">// &quot;setWindowPrivacyMode executed&quot;</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (exception) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Failed to set the window to the privacy mode. Cause:&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(exception));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">message</span>)</span><br><span class="line">        .<span class="title function_">id</span>(<span class="string">&#x27;Index20HelloWorld&#x27;</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">50</span>)</span><br><span class="line">        .<span class="title function_">fontWeight</span>(<span class="title class_">FontWeight</span>.<span class="property">Bold</span>)</span><br><span class="line">        .<span class="title function_">alignRules</span>(&#123;</span><br><span class="line">          <span class="attr">center</span>: &#123; <span class="attr">anchor</span>: <span class="string">&#x27;__container__&#x27;</span>, <span class="attr">align</span>: <span class="title class_">VerticalAlign</span>.<span class="property">Center</span> &#125;,</span><br><span class="line">          <span class="attr">middle</span>: &#123; <span class="attr">anchor</span>: <span class="string">&#x27;__container__&#x27;</span>, <span class="attr">align</span>: <span class="title class_">HorizontalAlign</span>.<span class="property">Center</span> &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://harmonyostech.github.io/2025/06/30/4823-Daily-HarmonyOS-Next-Knowledge-Opening-Half-Screen-via-Routing-Custom-Grid-Gestures-etc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Qingkouwei">
      <meta itemprop="description" content="Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HarmonyOS NEXT Knowledge Charging Station">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/06/30/4823-Daily-HarmonyOS-Next-Knowledge-Opening-Half-Screen-via-Routing-Custom-Grid-Gestures-etc/" class="post-title-link" itemprop="url">[Daily HarmonyOS Next Knowledge] Opening Half-Screen via Routing, Custom Grid, Gestures, etc.</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-06-30 17:28:18 / Modified: 17:29:11" itemprop="dateCreated datePublished" datetime="2025-06-30T17:28:18+08:00">2025-06-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Daily-HarmonyOS-Next-Knowledge/" itemprop="url" rel="index"><span itemprop="name">Daily HarmonyOS Next Knowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Daily-HarmonyOS-Next-Knowledge-Opening-Half-Screen-via-Routing-Custom-Grid-Gestures-etc"><a href="#Daily-HarmonyOS-Next-Knowledge-Opening-Half-Screen-via-Routing-Custom-Grid-Gestures-etc" class="headerlink" title="[Daily HarmonyOS Next Knowledge] Opening Half-Screen via Routing, Custom Grid, Gestures, etc."></a>[Daily HarmonyOS Next Knowledge] Opening Half-Screen via Routing, Custom Grid, Gestures, etc.</h1><h2 id="1-How-to-open-a-half-screen-via-routing"><a href="#1-How-to-open-a-half-screen-via-routing" class="headerlink" title="1. How to open a half-screen via routing?"></a>1. How to open a half-screen via routing?</h2><p>Use component navigation (Navigation) uniformly and refer to the page display type NavDestinationMode.DIALOG in the article: <a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-navigation-navigation-V5">Component Navigation</a>.  </p>
<h2 id="2-Are-there-alternative-solutions-for-setting-Grid-onItemDragStart-time-and-universal-examples-for-multi-column-Grid-Items"><a href="#2-Are-there-alternative-solutions-for-setting-Grid-onItemDragStart-time-and-universal-examples-for-multi-column-Grid-Items" class="headerlink" title="2. Are there alternative solutions for setting Grid onItemDragStart time and universal examples for multi-column Grid Items?"></a>2. Are there alternative solutions for setting Grid onItemDragStart time and universal examples for multi-column Grid Items?</h2><p>The default onItemDragStart time for Grid dragging is 170 milliseconds. Currently, the onItemDragStart time cannot be set directly. You can customize the Grid and use the duration of the LongPressGesture in the long-press gesture to control the long-press trigger time for GridItem dragging.  </p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; curves &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">Page</span> &#123;</span><br><span class="line">  <span class="comment">// Element array</span></span><br><span class="line">  <span class="meta">@State</span> <span class="attr">numbers</span>: <span class="built_in">number</span>[] = []</span><br><span class="line">  <span class="comment">// row sets the number of grid columns</span></span><br><span class="line">  <span class="keyword">private</span> <span class="attr">str</span>: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="meta">@State</span> <span class="attr">row</span>: <span class="built_in">number</span> = <span class="number">4</span></span><br><span class="line">  <span class="comment">// Index of the last element in the element array</span></span><br><span class="line">  <span class="meta">@State</span> <span class="attr">lastIndex</span>: <span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">dragItem</span>: <span class="built_in">number</span> = -<span class="number">1</span></span><br><span class="line">  <span class="meta">@State</span> <span class="attr">scaleItem</span>: <span class="built_in">number</span> = -<span class="number">1</span></span><br><span class="line">  <span class="meta">@State</span> <span class="attr">item</span>: <span class="built_in">number</span> = -<span class="number">1</span></span><br><span class="line">  <span class="keyword">private</span> <span class="attr">dragRefOffsetx</span>: <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">  <span class="keyword">private</span> <span class="attr">dragRefOffsety</span>: <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">  <span class="meta">@State</span> <span class="attr">offsetX</span>: <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">  <span class="meta">@State</span> <span class="attr">offsetY</span>: <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line">  <span class="keyword">private</span> <span class="attr">FIX_VP_X</span>: <span class="built_in">number</span> = <span class="number">108</span></span><br><span class="line">  <span class="keyword">private</span> <span class="attr">FIX_VP_Y</span>: <span class="built_in">number</span> = <span class="number">120</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= <span class="number">110</span>; i++) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">numbers</span>.<span class="title function_">push</span>(i)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">lastIndex</span> = <span class="variable language_">this</span>.<span class="property">numbers</span>.<span class="property">length</span> - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Multi-column</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">row</span>; i++) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">str</span> = <span class="variable language_">this</span>.<span class="property">str</span> + <span class="string">&#x27;1fr &#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">itemMove</span>(<span class="attr">index</span>: <span class="built_in">number</span>, <span class="attr">newIndex</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="title function_">isDraggable</span>(newIndex)) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> tmp = <span class="variable language_">this</span>.<span class="property">numbers</span>.<span class="title function_">splice</span>(index, <span class="number">1</span>)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">numbers</span>.<span class="title function_">splice</span>(newIndex, <span class="number">0</span>, tmp[<span class="number">0</span>])</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Swipe down</span></span><br><span class="line">  <span class="title function_">down</span>(<span class="attr">index</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// Specify that fixed GridItems do not respond to events</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="title function_">isDraggable</span>(index + <span class="variable language_">this</span>.<span class="property">row</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">offsetY</span> -= <span class="variable language_">this</span>.<span class="property">FIX_VP_Y</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dragRefOffsety</span> += <span class="variable language_">this</span>.<span class="property">FIX_VP_Y</span></span><br><span class="line">    <span class="comment">// Multi-column</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">itemMove</span>(index, index + <span class="variable language_">this</span>.<span class="property">row</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Swipe down (empty lower right corner)</span></span><br><span class="line">  <span class="title function_">down2</span>(<span class="attr">index</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="title function_">isDraggable</span>(index + <span class="number">3</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">offsetY</span> -= <span class="variable language_">this</span>.<span class="property">FIX_VP_Y</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dragRefOffsety</span> += <span class="variable language_">this</span>.<span class="property">FIX_VP_Y</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">itemMove</span>(index, index + <span class="number">3</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Swipe up</span></span><br><span class="line">  <span class="title function_">up</span>(<span class="attr">index</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="title function_">isDraggable</span>(index - <span class="variable language_">this</span>.<span class="property">row</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">offsetY</span> += <span class="variable language_">this</span>.<span class="property">FIX_VP_Y</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dragRefOffsety</span> -= <span class="variable language_">this</span>.<span class="property">FIX_VP_Y</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">itemMove</span>(index, index - <span class="variable language_">this</span>.<span class="property">row</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Swipe left</span></span><br><span class="line">  <span class="title function_">left</span>(<span class="attr">index</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="title function_">isDraggable</span>(index - <span class="number">1</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">offsetX</span> += <span class="variable language_">this</span>.<span class="property">FIX_VP_X</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dragRefOffsetx</span> -= <span class="variable language_">this</span>.<span class="property">FIX_VP_X</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">itemMove</span>(index, index - <span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Swipe right</span></span><br><span class="line">  <span class="title function_">right</span>(<span class="attr">index</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="title function_">isDraggable</span>(index + <span class="number">1</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">offsetX</span> -= <span class="variable language_">this</span>.<span class="property">FIX_VP_X</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dragRefOffsetx</span> += <span class="variable language_">this</span>.<span class="property">FIX_VP_X</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">itemMove</span>(index, index + <span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Swipe down-right</span></span><br><span class="line">  <span class="title function_">lowerRight</span>(<span class="attr">index</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="title function_">isDraggable</span>(index + <span class="variable language_">this</span>.<span class="property">row</span> + <span class="number">1</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">offsetX</span> -= <span class="variable language_">this</span>.<span class="property">FIX_VP_X</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dragRefOffsetx</span> += <span class="variable language_">this</span>.<span class="property">FIX_VP_X</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">offsetY</span> -= <span class="variable language_">this</span>.<span class="property">FIX_VP_Y</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dragRefOffsety</span> += <span class="variable language_">this</span>.<span class="property">FIX_VP_Y</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">itemMove</span>(index, index + <span class="variable language_">this</span>.<span class="property">row</span> + <span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Swipe up-right</span></span><br><span class="line">  <span class="title function_">upperRight</span>(<span class="attr">index</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="title function_">isDraggable</span>(index - (<span class="variable language_">this</span>.<span class="property">row</span> - <span class="number">1</span>))) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">offsetX</span> -= <span class="variable language_">this</span>.<span class="property">FIX_VP_X</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dragRefOffsetx</span> += <span class="variable language_">this</span>.<span class="property">FIX_VP_X</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">offsetY</span> += <span class="variable language_">this</span>.<span class="property">FIX_VP_Y</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dragRefOffsety</span> -= <span class="variable language_">this</span>.<span class="property">FIX_VP_Y</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">itemMove</span>(index, index - (<span class="variable language_">this</span>.<span class="property">row</span> - <span class="number">1</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Swipe down-left</span></span><br><span class="line">  <span class="title function_">lowerLeft</span>(<span class="attr">index</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="title function_">isDraggable</span>(index + (<span class="variable language_">this</span>.<span class="property">row</span> - <span class="number">1</span>))) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">offsetX</span> += <span class="variable language_">this</span>.<span class="property">FIX_VP_X</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dragRefOffsetx</span> -= <span class="variable language_">this</span>.<span class="property">FIX_VP_X</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">offsetY</span> -= <span class="variable language_">this</span>.<span class="property">FIX_VP_Y</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dragRefOffsety</span> += <span class="variable language_">this</span>.<span class="property">FIX_VP_Y</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">itemMove</span>(index, index + (<span class="variable language_">this</span>.<span class="property">row</span> - <span class="number">1</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Swipe up-left</span></span><br><span class="line">  <span class="title function_">upperLeft</span>(<span class="attr">index</span>: <span class="built_in">number</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="title function_">isDraggable</span>(index - (<span class="variable language_">this</span>.<span class="property">row</span> + <span class="number">1</span>))) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">offsetX</span> += <span class="variable language_">this</span>.<span class="property">FIX_VP_X</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dragRefOffsetx</span> -= <span class="variable language_">this</span>.<span class="property">FIX_VP_X</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">offsetY</span> += <span class="variable language_">this</span>.<span class="property">FIX_VP_Y</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">dragRefOffsety</span> -= <span class="variable language_">this</span>.<span class="property">FIX_VP_Y</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">itemMove</span>(index, index - (<span class="variable language_">this</span>.<span class="property">row</span> + <span class="number">1</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Control whether an element can be moved and sorted by its index</span></span><br><span class="line">  <span class="title function_">isDraggable</span>(<span class="attr">index</span>: <span class="built_in">number</span>): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> index &gt; -<span class="number">1</span> <span class="comment">// Always true, all elements can be moved and sorted</span></span><br><span class="line">    <span class="comment">// return index &gt; 1 // Elements 1 and 2 are fixed and cannot be moved or sorted</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Grid</span>() &#123;</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">numbers</span>, <span class="function">(<span class="params"><span class="attr">item</span>: <span class="built_in">number</span></span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">GridItem</span>() &#123;</span><br><span class="line">            <span class="title class_">Text</span>(item + <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">              .<span class="title function_">fontSize</span>(<span class="number">16</span>)</span><br><span class="line">              .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">              .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">              .<span class="title function_">height</span>(<span class="number">100</span>)</span><br><span class="line">              .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">              .<span class="title function_">backgroundColor</span>(<span class="number">0xFFFFFF</span>)</span><br><span class="line">              .<span class="title function_">shadow</span>(<span class="variable language_">this</span>.<span class="property">scaleItem</span> == item ? &#123;</span><br><span class="line">                <span class="attr">radius</span>: <span class="number">70</span>,</span><br><span class="line">                <span class="attr">color</span>: <span class="string">&#x27;#15000000&#x27;</span>,</span><br><span class="line">                <span class="attr">offsetX</span>: <span class="number">0</span>,</span><br><span class="line">                <span class="attr">offsetY</span>: <span class="number">0</span></span><br><span class="line">              &#125; :</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="attr">radius</span>: <span class="number">0</span>,</span><br><span class="line">                  <span class="attr">color</span>: <span class="string">&#x27;#15000000&#x27;</span>,</span><br><span class="line">                  <span class="attr">offsetX</span>: <span class="number">0</span>,</span><br><span class="line">                  <span class="attr">offsetY</span>: <span class="number">0</span></span><br><span class="line">                &#125;)</span><br><span class="line">              .<span class="title function_">animation</span>(&#123; <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">Sharp</span>, <span class="attr">duration</span>: <span class="number">300</span> &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">onAreaChange</span>(<span class="function">(<span class="params">oldVal, newVal</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// Multi-column</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">FIX_VP_X</span> = <span class="title class_">Math</span>.<span class="title function_">round</span>(newVal.<span class="property">width</span> <span class="keyword">as</span> <span class="built_in">number</span>)</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">FIX_VP_Y</span> = <span class="title class_">Math</span>.<span class="title function_">round</span>(newVal.<span class="property">height</span> <span class="keyword">as</span> <span class="built_in">number</span>)</span><br><span class="line">          &#125;)</span><br><span class="line">          <span class="comment">// Specify that fixed GridItems do not respond to events</span></span><br><span class="line">          .<span class="title function_">hitTestBehavior</span>(<span class="variable language_">this</span>.<span class="title function_">isDraggable</span>(<span class="variable language_">this</span>.<span class="property">numbers</span>.<span class="title function_">indexOf</span>(item)) ? <span class="title class_">HitTestMode</span>.<span class="property">Default</span> : <span class="title class_">HitTestMode</span>.<span class="property">None</span>)</span><br><span class="line">          .<span class="title function_">scale</span>(&#123; <span class="attr">x</span>: <span class="variable language_">this</span>.<span class="property">scaleItem</span> == item ? <span class="number">1.05</span> : <span class="number">1</span>, <span class="attr">y</span>: <span class="variable language_">this</span>.<span class="property">scaleItem</span> == item ? <span class="number">1.05</span> : <span class="number">1</span> &#125;)</span><br><span class="line">          .<span class="title function_">zIndex</span>(<span class="variable language_">this</span>.<span class="property">dragItem</span> == item ? <span class="number">1</span> : <span class="number">0</span>)</span><br><span class="line">          .<span class="title function_">translate</span>(<span class="variable language_">this</span>.<span class="property">dragItem</span> == item ? &#123; <span class="attr">x</span>: <span class="variable language_">this</span>.<span class="property">offsetX</span>, <span class="attr">y</span>: <span class="variable language_">this</span>.<span class="property">offsetY</span> &#125; : &#123; <span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="number">0</span> &#125;)</span><br><span class="line">          .<span class="title function_">padding</span>(<span class="number">10</span>)</span><br><span class="line">          .<span class="title function_">gesture</span>(</span><br><span class="line">            <span class="comment">// The following combined gestures are recognized in sequence. If the long-press gesture event is not triggered normally, the drag gesture event will not be triggered.</span></span><br><span class="line">            <span class="title class_">GestureGroup</span>(<span class="title class_">GestureMode</span>.<span class="property">Sequence</span>,</span><br><span class="line">              <span class="title class_">LongPressGesture</span>(&#123; <span class="attr">repeat</span>: <span class="literal">true</span>, <span class="attr">duration</span>: <span class="number">50</span> &#125;) <span class="comment">// Control the long-press event time for triggering dragging, default 500ms. Setting less than 0 uses the default; here set to 50ms</span></span><br><span class="line">                .<span class="title function_">onAction</span>(<span class="function">(<span class="params"><span class="attr">event</span>?: <span class="title class_">GestureEvent</span></span>) =&gt;</span> &#123;</span><br><span class="line">                  <span class="title function_">animateTo</span>(&#123; <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">Friction</span>, <span class="attr">duration</span>: <span class="number">300</span> &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">scaleItem</span> = item</span><br><span class="line">                  &#125;)</span><br><span class="line">                &#125;)</span><br><span class="line">                .<span class="title function_">onActionEnd</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                  <span class="title function_">animateTo</span>(&#123; <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">Friction</span>, <span class="attr">duration</span>: <span class="number">300</span> &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">scaleItem</span> = -<span class="number">1</span></span><br><span class="line">                  &#125;)</span><br><span class="line">                &#125;),</span><br><span class="line">              <span class="title class_">PanGesture</span>(&#123; <span class="attr">fingers</span>: <span class="number">1</span>, <span class="attr">direction</span>: <span class="literal">null</span>, <span class="attr">distance</span>: <span class="number">0</span> &#125;)</span><br><span class="line">                .<span class="title function_">onActionStart</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                  <span class="variable language_">this</span>.<span class="property">dragItem</span> = item</span><br><span class="line">                  <span class="variable language_">this</span>.<span class="property">dragRefOffsetx</span> = <span class="number">0</span></span><br><span class="line">                  <span class="variable language_">this</span>.<span class="property">dragRefOffsety</span> = <span class="number">0</span></span><br><span class="line">                &#125;)</span><br><span class="line">                .<span class="title function_">onActionUpdate</span>(<span class="function">(<span class="params"><span class="attr">event</span>: <span class="title class_">GestureEvent</span></span>) =&gt;</span> &#123;</span><br><span class="line">                  <span class="variable language_">this</span>.<span class="property">offsetY</span> = event.<span class="property">offsetY</span> - <span class="variable language_">this</span>.<span class="property">dragRefOffsety</span></span><br><span class="line">                  <span class="variable language_">this</span>.<span class="property">offsetX</span> = event.<span class="property">offsetX</span> - <span class="variable language_">this</span>.<span class="property">dragRefOffsetx</span></span><br><span class="line"></span><br><span class="line">                  <span class="title function_">animateTo</span>(&#123; <span class="attr">curve</span>: curves.<span class="title function_">interpolatingSpring</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">400</span>, <span class="number">38</span>) &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">let</span> index = <span class="variable language_">this</span>.<span class="property">numbers</span>.<span class="title function_">indexOf</span>(<span class="variable language_">this</span>.<span class="property">dragItem</span>)</span><br><span class="line">                    <span class="comment">// 44 Half width minus spacing</span></span><br><span class="line">                    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">offsetY</span> &gt;= <span class="variable language_">this</span>.<span class="property">FIX_VP_Y</span> / <span class="number">2</span> &amp;&amp;</span><br><span class="line">                      (<span class="variable language_">this</span>.<span class="property">offsetX</span> &lt;= <span class="variable language_">this</span>.<span class="property">FIX_VP_X</span> / <span class="number">2</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">offsetX</span> &gt;= -<span class="variable language_">this</span>.<span class="property">FIX_VP_X</span> / <span class="number">2</span>)</span><br><span class="line">                      &amp;&amp; (index + <span class="variable language_">this</span>.<span class="property">row</span> &lt;= <span class="variable language_">this</span>.<span class="property">lastIndex</span>)) &#123;</span><br><span class="line">                      <span class="comment">// Swipe down</span></span><br><span class="line">                      <span class="variable language_">this</span>.<span class="title function_">down</span>(index)</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">offsetY</span> &lt;= -<span class="variable language_">this</span>.<span class="property">FIX_VP_Y</span> / <span class="number">2</span> &amp;&amp;</span><br><span class="line">                      (<span class="variable language_">this</span>.<span class="property">offsetX</span> &lt;= <span class="variable language_">this</span>.<span class="property">FIX_VP_X</span> / <span class="number">2</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">offsetX</span> &gt;= -<span class="variable language_">this</span>.<span class="property">FIX_VP_X</span> / <span class="number">2</span>)</span><br><span class="line">                      &amp;&amp; index - <span class="variable language_">this</span>.<span class="property">row</span> &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                      <span class="comment">// Swipe up</span></span><br><span class="line">                      <span class="variable language_">this</span>.<span class="title function_">up</span>(index)</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">offsetX</span> &gt;= <span class="variable language_">this</span>.<span class="property">FIX_VP_X</span> / <span class="number">2</span> &amp;&amp;</span><br><span class="line">                      (<span class="variable language_">this</span>.<span class="property">offsetY</span> &lt;= <span class="variable language_">this</span>.<span class="property">FIX_VP_Y</span> / <span class="number">2</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">offsetY</span> &gt;= -<span class="variable language_">this</span>.<span class="property">FIX_VP_Y</span> / <span class="number">2</span>)</span><br><span class="line">                      &amp;&amp; !(((index - (<span class="variable language_">this</span>.<span class="property">row</span> - <span class="number">1</span>)) % <span class="variable language_">this</span>.<span class="property">row</span> == <span class="number">0</span>) || index == <span class="variable language_">this</span>.<span class="property">lastIndex</span>)) &#123;</span><br><span class="line">                      <span class="comment">// ) &#123;</span></span><br><span class="line">                      <span class="comment">// Swipe right</span></span><br><span class="line">                      <span class="variable language_">this</span>.<span class="title function_">right</span>(index)</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">offsetX</span> &lt;= -<span class="variable language_">this</span>.<span class="property">FIX_VP_X</span> / <span class="number">2</span> &amp;&amp;</span><br><span class="line">                      (<span class="variable language_">this</span>.<span class="property">offsetY</span> &lt;= <span class="variable language_">this</span>.<span class="property">FIX_VP_Y</span> / <span class="number">2</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">offsetY</span> &gt;= -<span class="variable language_">this</span>.<span class="property">FIX_VP_Y</span> / <span class="number">2</span>)</span><br><span class="line">                      &amp;&amp; !(index % <span class="variable language_">this</span>.<span class="property">row</span> == <span class="number">0</span>)) &#123;</span><br><span class="line">                      <span class="comment">// Swipe left</span></span><br><span class="line">                      <span class="variable language_">this</span>.<span class="title function_">left</span>(index)</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">offsetX</span> &gt;= <span class="variable language_">this</span>.<span class="property">FIX_VP_X</span> / <span class="number">2</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">offsetY</span> &gt;= <span class="variable language_">this</span>.<span class="property">FIX_VP_Y</span> / <span class="number">2</span></span><br><span class="line">                      &amp;&amp; ((index + <span class="variable language_">this</span>.<span class="property">row</span> + <span class="number">1</span> &lt;= <span class="variable language_">this</span>.<span class="property">lastIndex</span> &amp;&amp; !((index - (<span class="variable language_">this</span>.<span class="property">row</span> - <span class="number">1</span>)) % <span class="variable language_">this</span>.<span class="property">row</span> == <span class="number">0</span>)) ||</span><br><span class="line">                        !((index - (<span class="variable language_">this</span>.<span class="property">row</span> - <span class="number">1</span>)) % <span class="variable language_">this</span>.<span class="property">row</span> == <span class="number">0</span>))) &#123;</span><br><span class="line">                      <span class="comment">// Swipe down-right</span></span><br><span class="line">                      <span class="variable language_">this</span>.<span class="title function_">lowerRight</span>(index)</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">offsetX</span> &gt;= <span class="variable language_">this</span>.<span class="property">FIX_VP_X</span> / <span class="number">2</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">offsetY</span> &lt;= -<span class="variable language_">this</span>.<span class="property">FIX_VP_Y</span> / <span class="number">2</span></span><br><span class="line">                      &amp;&amp; !((index - <span class="variable language_">this</span>.<span class="property">row</span> &lt; <span class="number">0</span>) || ((index - (<span class="variable language_">this</span>.<span class="property">row</span> - <span class="number">1</span>)) % <span class="variable language_">this</span>.<span class="property">row</span> == <span class="number">0</span>))) &#123;</span><br><span class="line">                      <span class="comment">// Swipe up-right</span></span><br><span class="line">                      <span class="variable language_">this</span>.<span class="title function_">upperRight</span>(index)</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">offsetX</span> &lt;= -<span class="variable language_">this</span>.<span class="property">FIX_VP_X</span> / <span class="number">2</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">offsetY</span> &gt;= <span class="variable language_">this</span>.<span class="property">FIX_VP_Y</span> / <span class="number">2</span></span><br><span class="line">                      &amp;&amp; (!(index % <span class="variable language_">this</span>.<span class="property">row</span> == <span class="number">0</span>) &amp;&amp; (index + (<span class="variable language_">this</span>.<span class="property">row</span> - <span class="number">1</span>) &lt;= <span class="variable language_">this</span>.<span class="property">lastIndex</span>))) &#123;</span><br><span class="line">                      <span class="comment">// Swipe down-left</span></span><br><span class="line">                      <span class="variable language_">this</span>.<span class="title function_">lowerLeft</span>(index)</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">offsetX</span> &lt;= -<span class="variable language_">this</span>.<span class="property">FIX_VP_X</span> / <span class="number">2</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">offsetY</span> &lt;= -<span class="variable language_">this</span>.<span class="property">FIX_VP_Y</span> / <span class="number">2</span></span><br><span class="line">                      &amp;&amp; !((index &lt;= <span class="variable language_">this</span>.<span class="property">row</span> - <span class="number">1</span>) || (index % <span class="variable language_">this</span>.<span class="property">row</span> == <span class="number">0</span>))) &#123;</span><br><span class="line">                      <span class="comment">// Swipe up-left</span></span><br><span class="line">                      <span class="variable language_">this</span>.<span class="title function_">upperLeft</span>(index)</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">offsetX</span> &gt;= <span class="variable language_">this</span>.<span class="property">FIX_VP_X</span> / <span class="number">2</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">offsetY</span> &gt;= <span class="variable language_">this</span>.<span class="property">FIX_VP_Y</span> / <span class="number">2</span></span><br><span class="line">                      &amp;&amp; (index == <span class="variable language_">this</span>.<span class="property">lastIndex</span>)) &#123;</span><br><span class="line">                      <span class="comment">// Swipe down-right (empty lower right corner)</span></span><br><span class="line">                      <span class="variable language_">this</span>.<span class="title function_">down2</span>(index)</span><br><span class="line">                    &#125;</span><br><span class="line">                  &#125;)</span><br><span class="line">                &#125;)</span><br><span class="line">                .<span class="title function_">onActionEnd</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                  <span class="title function_">animateTo</span>(&#123; <span class="attr">curve</span>: curves.<span class="title function_">interpolatingSpring</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">400</span>, <span class="number">38</span>) &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">dragItem</span> = -<span class="number">1</span></span><br><span class="line">                  &#125;)</span><br><span class="line">                  <span class="title function_">animateTo</span>(&#123;</span><br><span class="line">                    <span class="attr">curve</span>: curves.<span class="title function_">interpolatingSpring</span>(<span class="number">14</span>, <span class="number">1</span>, <span class="number">170</span>, <span class="number">17</span>), <span class="attr">delay</span>: <span class="number">150</span></span><br><span class="line">                  &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">scaleItem</span> = -<span class="number">1</span></span><br><span class="line">                  &#125;)</span><br><span class="line">                &#125;)</span><br><span class="line">            )</span><br><span class="line">              .<span class="title function_">onCancel</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="title function_">animateTo</span>(&#123; <span class="attr">curve</span>: curves.<span class="title function_">interpolatingSpring</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">400</span>, <span class="number">38</span>) &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                  <span class="variable language_">this</span>.<span class="property">dragItem</span> = -<span class="number">1</span></span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="title function_">animateTo</span>(&#123;</span><br><span class="line">                  <span class="attr">curve</span>: curves.<span class="title function_">interpolatingSpring</span>(<span class="number">14</span>, <span class="number">1</span>, <span class="number">170</span>, <span class="number">17</span>)</span><br><span class="line">                &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                  <span class="variable language_">this</span>.<span class="property">scaleItem</span> = -<span class="number">1</span></span><br><span class="line">                &#125;)</span><br><span class="line">              &#125;)</span><br><span class="line">          )</span><br><span class="line">        &#125;, <span class="function">(<span class="params"><span class="attr">item</span>: <span class="built_in">number</span></span>) =&gt;</span> item.<span class="title function_">toString</span>())</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;90%&#x27;</span>)</span><br><span class="line">      .<span class="title function_">editMode</span>(<span class="literal">true</span>)</span><br><span class="line">      .<span class="title function_">scrollBar</span>(<span class="title class_">BarState</span>.<span class="property">Off</span>)</span><br><span class="line">      <span class="comment">// Multi-column</span></span><br><span class="line">      .<span class="title function_">columnsTemplate</span>(<span class="variable language_">this</span>.<span class="property">str</span>)</span><br><span class="line">    &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">backgroundColor</span>(<span class="string">&#x27;#0D182431&#x27;</span>).<span class="title function_">padding</span>(&#123; <span class="attr">top</span>: <span class="number">5</span> &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 3. When List, Scroll, Swiper, Web, etc., are nested, there is a sliding conflict. For example, nesting a horizontally sliding Swipe in a List, and nesting a Web in the Swipe, when setting gesture priority, the Web cannot interact with the List.  </span></span><br><span class="line"><span class="string">The problem may be caused by sliding conflicts when the List component is nested with the Web component. Touch test control can be used to avoid this situation.  </span></span><br><span class="line"><span class="string">Reference document: [Multi-Level Gesture Events](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-gesture-events-multi-level-gesture-V5).  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 4. How to disable the function of closing a custom popup by clicking on empty space?  </span></span><br><span class="line"><span class="string">Set the autoCancel of the custom popup to false to disable closing the popup by clicking on empty space.  </span></span><br><span class="line"><span class="string">Reference document: [@ohos.promptAction (Popup)](https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-promptaction-V5#ZH-CN_TOPIC_0000001884757698__basedialogoptions11).  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 5. For basic gestures of single-tap and double-tap, how to recognize only double-tap without recognizing single-tap?  </span></span><br><span class="line"><span class="string">Use the exclusive recognition mode of the combined gesture GestureGroup. The double-tap event should be placed before the single-tap event. Exclusive recognition is based on the order of arrangement. If the single-tap event is placed first, only the single-tap event will be recognized.  </span></span><br><span class="line"><span class="string">Reference document: [Combined Gestures](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/arkts-gesture-events-combined-gestures-V5#ZH-CN_TOPIC_0000001884756578__%E4%BA%92%E6%96%A5%E8%AF%86%E5%88%AB).  </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>typescript</span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">TapGestureExample</span> &#123;</span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">&#x27;Click twice&#x27;</span>).<span class="title function_">fontSize</span>(<span class="number">28</span>)</span><br><span class="line">        .<span class="title function_">gesture</span>(<span class="title class_">GestureGroup</span>(<span class="title class_">GestureMode</span>.<span class="property">Exclusive</span>,</span><br><span class="line">          <span class="comment">// Note: Double-tap is placed first</span></span><br><span class="line">          <span class="title class_">TapGesture</span>(&#123; <span class="attr">count</span>: <span class="number">2</span> &#125;)</span><br><span class="line">            .<span class="title function_">onAction</span>(<span class="function">(<span class="params"><span class="attr">event</span>?: <span class="title class_">GestureEvent</span></span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;TapGesture 2&#x27;</span>)</span><br><span class="line">            &#125;),</span><br><span class="line">          <span class="title class_">TapGesture</span>(&#123; <span class="attr">count</span>: <span class="number">1</span> &#125;)</span><br><span class="line">            .<span class="title function_">onAction</span>(<span class="function">(<span class="params"><span class="attr">event</span>?: <span class="title class_">GestureEvent</span></span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;TapGesture 1&#x27;</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">        )</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://harmonyostech.github.io/2025/06/30/4822-Daily-HarmonyOS-Next-Knowledge-Video-Playback-Failure-Toggle-Dragging-Image-Cropping-Rotation-etc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Qingkouwei">
      <meta itemprop="description" content="Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HarmonyOS NEXT Knowledge Charging Station">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/06/30/4822-Daily-HarmonyOS-Next-Knowledge-Video-Playback-Failure-Toggle-Dragging-Image-Cropping-Rotation-etc/" class="post-title-link" itemprop="url">[Daily HarmonyOS Next Knowledge] Video Playback Failure, Toggle Dragging, Image Cropping/Rotation, etc.</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-06-30 17:26:40 / Modified: 17:27:31" itemprop="dateCreated datePublished" datetime="2025-06-30T17:26:40+08:00">2025-06-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Daily-HarmonyOS-Next-Knowledge/" itemprop="url" rel="index"><span itemprop="name">Daily HarmonyOS Next Knowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Daily-HarmonyOS-Next-Knowledge-Video-Playback-Failure-Toggle-Dragging-Image-Cropping-Rotation-etc"><a href="#Daily-HarmonyOS-Next-Knowledge-Video-Playback-Failure-Toggle-Dragging-Image-Cropping-Rotation-etc" class="headerlink" title="[Daily HarmonyOS Next Knowledge] Video Playback Failure, Toggle Dragging, Image Cropping&#x2F;Rotation, etc."></a>[Daily HarmonyOS Next Knowledge] Video Playback Failure, Toggle Dragging, Image Cropping&#x2F;Rotation, etc.</h1><h2 id="1-How-to-change-the-size-color-and-position-of-the-passwordIcon-in-TextInput’s-password-input-mode"><a href="#1-How-to-change-the-size-color-and-position-of-the-passwordIcon-in-TextInput’s-password-input-mode" class="headerlink" title="1. How to change the size, color, and position of the passwordIcon in TextInput’s password input mode?"></a>1. How to change the size, color, and position of the passwordIcon in TextInput’s password input mode?</h2><p>Use a Stack container as the parent and an Image component as the child to customize the passwordIcon. This allows you to adjust the Image’s position, size, and color.  </p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">TextInputExample</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">text</span>: <span class="built_in">string</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="meta">@State</span> <span class="attr">changeType</span>: <span class="title class_">InputType</span> = <span class="title class_">InputType</span>.<span class="property">Password</span></span><br><span class="line">  <span class="meta">@State</span> <span class="attr">isVisible</span>: <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line">  <span class="meta">@State</span> <span class="attr">changeState</span>: <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line">  <span class="attr">controller</span>: <span class="title class_">TextInputController</span> = <span class="keyword">new</span> <span class="title class_">TextInputController</span>()</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Flex</span>(&#123; <span class="attr">direction</span>: <span class="title class_">FlexDirection</span>.<span class="property">Row</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">Stack</span>() &#123;</span><br><span class="line">          <span class="title class_">TextInput</span>(&#123; <span class="attr">text</span>: <span class="variable language_">this</span>.<span class="property">text</span>, <span class="attr">controller</span>: <span class="variable language_">this</span>.<span class="property">controller</span> &#125;)</span><br><span class="line">            .<span class="title function_">type</span>(<span class="variable language_">this</span>.<span class="property">changeType</span>)</span><br><span class="line">            .<span class="title function_">placeholderFont</span>(&#123; <span class="attr">size</span>: <span class="number">16</span>, <span class="attr">weight</span>: <span class="number">400</span> &#125;)</span><br><span class="line">            .<span class="title function_">showPasswordIcon</span>(<span class="literal">false</span>)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="number">336</span>)</span><br><span class="line">            .<span class="title function_">height</span>(<span class="number">56</span>) <span class="comment">// Set padding to prevent input from overlapping the icon</span></span><br><span class="line">            .<span class="title function_">padding</span>(&#123;</span><br><span class="line">              <span class="attr">right</span>: <span class="number">50</span></span><br><span class="line">            &#125;)</span><br><span class="line">            .<span class="title function_">onChange</span>(<span class="function">(<span class="params"><span class="attr">value</span>: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">text</span> = value</span><br><span class="line">            &#125;)</span><br><span class="line">          <span class="comment">// Override passwordIcon with custom Image</span></span><br><span class="line">          <span class="title class_">Image</span>($r(<span class="variable language_">this</span>.<span class="property">isVisible</span> ? <span class="string">&#x27;app.media.visible&#x27;</span> : <span class="string">&#x27;app.media.Invisible&#x27;</span>))</span><br><span class="line">            .<span class="title function_">margin</span>(&#123;</span><br><span class="line">              <span class="attr">left</span>: <span class="number">280</span></span><br><span class="line">              <span class="comment">// left: 200</span></span><br><span class="line">            &#125;)</span><br><span class="line">            .<span class="title function_">backgroundColor</span>(<span class="string">&#x27;#E7E8EA&#x27;</span>)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="number">20</span>)</span><br><span class="line">            .<span class="title function_">height</span>(<span class="number">20</span>)</span><br><span class="line">            .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">changeState</span> = !<span class="variable language_">this</span>.<span class="property">changeState</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">isVisible</span> = !<span class="variable language_">this</span>.<span class="property">isVisible</span></span><br><span class="line">              <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">changeState</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">changeType</span> = <span class="title class_">InputType</span>.<span class="property">Normal</span></span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">changeType</span> = <span class="title class_">InputType</span>.<span class="property">Password</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">backgroundColor</span>(<span class="string">&#x27;#F1F3F5&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 2. How to disable the default click gesture when dragging the Toggle component?  </span></span><br><span class="line"><span class="string">Manually control the Toggle&#x27;s state by creating a custom boolean variable (e.g., `</span>toggleIsOn<span class="string">`) and updating it in the `</span>onChange<span class="string">` callback.  </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>typescript</span><br><span class="line"><span class="keyword">import</span> &#123; hilog &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.PerformanceAnalysisKit&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">TestDragToggle</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">offsetX</span>: <span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">offsetY</span>: <span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">positionX</span>: <span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">positionY</span>: <span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">toggleIsOn</span>: <span class="built_in">boolean</span> = <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="attr">isDragging</span>: <span class="built_in">boolean</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Flex</span>(&#123; <span class="attr">direction</span>: <span class="title class_">FlexDirection</span>.<span class="property">Column</span>, <span class="attr">alignItems</span>: <span class="title class_">ItemAlign</span>.<span class="property">Center</span> &#125;) &#123;</span><br><span class="line">      <span class="title class_">Toggle</span>(&#123; <span class="attr">type</span>: <span class="title class_">ToggleType</span>.<span class="property">Button</span>, <span class="attr">isOn</span>: <span class="variable language_">this</span>.<span class="property">toggleIsOn</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;Toggle&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">selectedColor</span>(<span class="title class_">Color</span>.<span class="property">Pink</span>)</span><br><span class="line">      <span class="comment">// onchange callback fires before onActionEnd</span></span><br><span class="line">      .<span class="title function_">onChange</span>(<span class="function">(<span class="params"><span class="attr">isOn</span>: <span class="built_in">boolean</span></span>) =&gt;</span> &#123;</span><br><span class="line">        hilog.<span class="title function_">info</span>(<span class="number">0x0000</span>, <span class="string">&#x27;testTag&#x27;</span>, <span class="string">&#x27;xxx %&#123;public&#125;s&#x27;</span>, <span class="string">`onClick Toggle, isOn: <span class="subst">$&#123;isOn&#125;</span>`</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;isDragging======&#x27;</span> + <span class="variable language_">this</span>.<span class="property">isDragging</span>)</span><br><span class="line">        <span class="keyword">if</span> (isOn == <span class="variable language_">this</span>.<span class="property">toggleIsOn</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">toggleIsOn</span> = isOn</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isDragging</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">toggleIsOn</span> = !<span class="variable language_">this</span>.<span class="property">toggleIsOn</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">translate</span>(&#123; <span class="attr">x</span>: <span class="variable language_">this</span>.<span class="property">offsetX</span>, <span class="attr">y</span>: <span class="variable language_">this</span>.<span class="property">offsetY</span> &#125;)</span><br><span class="line">      .<span class="title function_">gesture</span>(</span><br><span class="line">        <span class="title class_">PanGesture</span>()</span><br><span class="line">          .<span class="title function_">onActionStart</span>(<span class="function">(<span class="params"><span class="attr">event</span>: <span class="title class_">GestureEvent</span></span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isDragging</span> = <span class="literal">true</span>;</span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">onActionUpdate</span>(<span class="function">(<span class="params"><span class="attr">event</span>: <span class="title class_">GestureEvent</span></span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">offsetX</span> = <span class="variable language_">this</span>.<span class="property">positionX</span> + event.<span class="property">offsetX</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">offsetY</span> = <span class="variable language_">this</span>.<span class="property">positionY</span> + event.<span class="property">offsetY</span>;</span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">onActionEnd</span>(<span class="function">(<span class="params"><span class="attr">event</span>: <span class="title class_">GestureEvent</span></span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">positionX</span> = <span class="variable language_">this</span>.<span class="property">offsetX</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">positionY</span> = <span class="variable language_">this</span>.<span class="property">offsetY</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isDragging</span> = <span class="literal">false</span>;</span><br><span class="line">          &#125;)</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 3. Why does Video fail to play immediately after setting a local video source?  </span></span><br><span class="line"><span class="string">There is a loading delay between setting the video source and being able to play. Playback should be triggered in the `</span>onPrepared<span class="string">` callback after the video is ready.  </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>typescript</span><br><span class="line"><span class="keyword">import</span> &#123; common &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.AbilityKit&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">LocalSource</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">videoUrl</span>: <span class="title class_">ResourceStr</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">currentTime</span>: <span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">private</span> context = <span class="title function_">getContext</span>(<span class="variable language_">this</span>) <span class="keyword">as</span> common.<span class="property">UIAbilityContext</span>;</span><br><span class="line">  <span class="meta">@State</span> prepared : <span class="built_in">boolean</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>  videoVC = <span class="keyword">new</span> <span class="title class_">VideoController</span>();</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>(&#123;<span class="attr">space</span>: <span class="number">20</span>&#125;) &#123;</span><br><span class="line">      <span class="title class_">Video</span>(&#123;</span><br><span class="line">        <span class="attr">src</span>: <span class="variable language_">this</span>.<span class="property">videoUrl</span>,</span><br><span class="line">        <span class="comment">// src: &#x27;file:///data/storage/el2/base/files/xxxx.mp4&#x27;,</span></span><br><span class="line">        <span class="attr">controller</span>: <span class="variable language_">this</span>.<span class="property">videoVC</span></span><br><span class="line">      &#125;)</span><br><span class="line">        .<span class="title function_">onPrepared</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">prepared</span> = <span class="literal">true</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">videoVC</span>.<span class="title function_">start</span>()</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;onPrepared&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">onError</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;onError&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">objectFit</span>(<span class="title class_">ImageFit</span>.<span class="property">Contain</span>)</span><br><span class="line">        .<span class="title function_">onUpdate</span>(<span class="function">(<span class="params">e</span>)=&gt;</span>&#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">currentTime</span> = e.<span class="property">time</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">controls</span>(<span class="literal">false</span>)</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;70%&#x27;</span>)</span><br><span class="line">        .<span class="title function_">height</span>(<span class="number">300</span>)</span><br><span class="line"></span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">`Current playback time: <span class="subst">$&#123;<span class="variable language_">this</span>.currentTime&#125;</span>`</span>)</span><br><span class="line">      </span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;Play immediately&#x27;</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">videoUrl</span> === <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// Set URL to local video path in app sandbox</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">videoUrl</span> = <span class="string">&#x27;file:///data/storage/el2/base/files/xxxx.mp4&#x27;</span>;</span><br><span class="line">            <span class="comment">// Problem: Calling start() immediately after setting source fails to play</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">prepared</span> === <span class="literal">true</span>) &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">videoVC</span>.<span class="title function_">start</span>();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;Play after 100ms delay&#x27;</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">videoUrl</span> === <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">videoUrl</span> = <span class="string">&#x27;file:///data/storage/el2/base/files/xxxx.mp4&#x27;</span>;</span><br><span class="line">            <span class="comment">// Delay starting playback slightly (100ms) after setting source</span></span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">videoVC</span>.<span class="title function_">start</span>();</span><br><span class="line">            &#125;, <span class="number">100</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;Reset playback&#x27;</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">10</span>)</span><br><span class="line">        .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">videoVC</span>.<span class="title function_">stop</span>();</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">videoUrl</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 4. How to implement image cropping and rotation?  </span></span><br><span class="line"><span class="string">Use Canvas combined with media image processing. Layer three Canvases:  </span></span><br><span class="line"><span class="string">1. Draw the original image and get its container coordinates via `</span><span class="title class_">OnAreaChange</span><span class="string">`.  </span></span><br><span class="line"><span class="string">2. Draw a mask to distinguish the cropping area.  </span></span><br><span class="line"><span class="string">3. Draw a resizable crop frame with drag gestures to define the crop area.  </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>typescript</span><br><span class="line"><span class="comment">// Draw background image</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">drawImage</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="title function_">initData</span>(<span class="string">&#x27;test.jpg&#x27;</span>)</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">imageInfo</span> != <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">canvasContext</span>.<span class="title function_">drawImage</span>(<span class="variable language_">this</span>.<span class="property">pixelMap</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="title function_">px2vp</span>(<span class="variable language_">this</span>.<span class="property">imageInfo</span>.<span class="property">size</span>.<span class="property">width</span>),</span><br><span class="line">      <span class="title function_">px2vp</span>(<span class="variable language_">this</span>.<span class="property">imageInfo</span>.<span class="property">size</span>.<span class="property">height</span>));</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">canvasContext</span>.<span class="title function_">save</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Draw mask layer</span></span><br><span class="line"><span class="title function_">drawMask</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">canvasContext3</span>.<span class="title function_">clearRect</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="variable language_">this</span>.<span class="property">imageInfo</span>?.<span class="property">size</span>.<span class="property">width</span>, <span class="variable language_">this</span>.<span class="property">imageInfo</span>?.<span class="property">size</span>.<span class="property">height</span>);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">canvasContext3</span>.<span class="property">fillStyle</span> = <span class="string">&#x27;rgba(0,0,0,0.7)&#x27;</span>;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">canvasContext3</span>.<span class="title function_">fillRect</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="title function_">px2vp</span>(<span class="variable language_">this</span>.<span class="property">imageInfo</span>?.<span class="property">size</span>.<span class="property">width</span>), <span class="title function_">px2vp</span>(<span class="variable language_">this</span>.<span class="property">imageInfo</span>?.<span class="property">size</span>.<span class="property">height</span>));</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">canvasContext3</span>.<span class="title function_">clearRect</span>(<span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">x</span> - <span class="variable language_">this</span>.<span class="property">initPosition</span>.<span class="property">x</span>, <span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">y</span> - <span class="variable language_">this</span>.<span class="property">initPosition</span>.<span class="property">y</span>,</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">width</span>, <span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">height</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Draw crop frame</span></span><br><span class="line"><span class="title function_">drawClipImage</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">canvasContext2</span>.<span class="title function_">clearRect</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">width</span>, <span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">height</span>);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">canvasContext2</span>.<span class="property">lineWidth</span> = <span class="number">6</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">canvasContext2</span>.<span class="property">strokeStyle</span> = <span class="string">&#x27;#ffffff&#x27;</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">canvasContext2</span>.<span class="title function_">beginPath</span>()</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">canvasContext2</span>.<span class="title function_">moveTo</span>(<span class="number">0</span>, <span class="number">20</span>)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">canvasContext2</span>.<span class="title function_">lineTo</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">canvasContext2</span>.<span class="title function_">lineTo</span>(<span class="number">20</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">canvasContext2</span>.<span class="title function_">moveTo</span>(<span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">width</span> - <span class="number">20</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">canvasContext2</span>.<span class="title function_">lineTo</span>(<span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">width</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">canvasContext2</span>.<span class="title function_">lineTo</span>(<span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">width</span>, <span class="number">20</span>);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">canvasContext2</span>.<span class="title function_">moveTo</span>(<span class="number">0</span>, <span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">height</span> - <span class="number">20</span>);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">canvasContext2</span>.<span class="title function_">lineTo</span>(<span class="number">0</span>, <span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">height</span>);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">canvasContext2</span>.<span class="title function_">lineTo</span>(<span class="number">20</span>, <span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">height</span>);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">canvasContext2</span>.<span class="title function_">moveTo</span>(<span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">width</span> - <span class="number">20</span>, <span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">height</span>);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">canvasContext2</span>.<span class="title function_">lineTo</span>(<span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">width</span>, <span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">height</span>);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">canvasContext2</span>.<span class="title function_">lineTo</span>(<span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">width</span>, <span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">height</span> - <span class="number">20</span>);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">canvasContext2</span>.<span class="title function_">stroke</span>()</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">canvasContext2</span>.<span class="title function_">beginPath</span>();</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">canvasContext2</span>.<span class="property">lineWidth</span> = <span class="number">0.5</span>;</span><br><span class="line">  <span class="keyword">let</span> height = <span class="title class_">Math</span>.<span class="title function_">round</span>(<span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">height</span> / <span class="number">3</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt;= <span class="number">3</span>; index++) &#123;</span><br><span class="line">    <span class="keyword">let</span> y = index === <span class="number">3</span> ? <span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">height</span> : height * index;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">canvasContext2</span>.<span class="title function_">moveTo</span>(<span class="number">0</span>, y);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">canvasContext2</span>.<span class="title function_">lineTo</span>(<span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">width</span>, y);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> width = <span class="title class_">Math</span>.<span class="title function_">round</span>(<span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">width</span> / <span class="number">3</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt;= <span class="number">3</span>; index++) &#123;</span><br><span class="line">    <span class="keyword">let</span> x = index === <span class="number">3</span> ? <span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">width</span> : width * index;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">canvasContext2</span>.<span class="title function_">moveTo</span>(x, <span class="number">0</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">canvasContext2</span>.<span class="title function_">lineTo</span>(x, <span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">height</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">canvasContext2</span>.<span class="title function_">stroke</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Crop image</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">clipImage</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> x = <span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">x</span> - <span class="variable language_">this</span>.<span class="property">initPosition</span>.<span class="property">x</span>;</span><br><span class="line">  <span class="keyword">let</span> y = <span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">y</span> - <span class="variable language_">this</span>.<span class="property">initPosition</span>.<span class="property">y</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;x= &#x27;</span> + x + <span class="string">&#x27;  y = &#x27;</span> + y + <span class="string">&#x27;height = &#x27;</span> + <span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">height</span> + <span class="string">&#x27;width = &#x27;</span> + <span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">width</span>)</span><br><span class="line">  <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">pixelMap</span>?.<span class="title function_">crop</span>(&#123;</span><br><span class="line">    <span class="attr">x</span>: <span class="title function_">vp2px</span>(x),</span><br><span class="line">    <span class="attr">y</span>: <span class="title function_">vp2px</span>(y),</span><br><span class="line">    <span class="attr">size</span>: &#123; <span class="attr">height</span>: <span class="title function_">vp2px</span>(<span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">height</span>), <span class="attr">width</span>: <span class="title function_">vp2px</span>(<span class="variable language_">this</span>.<span class="property">clipRect</span>.<span class="property">width</span>) &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">cropImageInfo</span> = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">pixelMap</span>?.<span class="title function_">getImageInfo</span>();</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">isCrop</span> = <span class="literal">true</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">rotateOn</span> = <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Rotate image</span></span><br><span class="line"><span class="keyword">async</span> <span class="title function_">rotateImage</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">rotateOn</span>) &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">pixelMap</span>?.<span class="title function_">rotate</span>(<span class="number">90</span>)</span><br><span class="line">    <span class="keyword">const</span> info = <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">pixelMap</span>?.<span class="title function_">getImageInfo</span>()</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cropImageInfo</span> = info</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">pixelMapChange</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">pixelMapChange</span> = <span class="literal">false</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">pixelMapChange</span> = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 5. How to access sandbox paths?  </span></span><br><span class="line"><span class="string">The Image component requires a sandbox URI instead of a direct sandbox path. Convert the path using `</span>fileuri.<span class="title function_">getUriFromPath</span>()<span class="string">`.  </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>typescript</span><br><span class="line"><span class="keyword">import</span> &#123; common &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.AbilityKit&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BusinessError</span>, request &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.BasicServicesKit&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; fileUri &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.CoreFileKit&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get app file directory</span></span><br><span class="line"><span class="keyword">let</span> context = <span class="title function_">getContext</span>(<span class="variable language_">this</span>) <span class="keyword">as</span> common.<span class="property">UIAbilityContext</span>;</span><br><span class="line"><span class="keyword">let</span> filesDir = context.<span class="property">filesDir</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">Index11</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">message</span>: <span class="built_in">string</span> = <span class="string">&#x27;Hello World&#x27;</span>;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">urlImage</span>: <span class="title class_">ResourceStr</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Row</span>() &#123;</span><br><span class="line">      <span class="title class_">Column</span>() &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">message</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">50</span>)</span><br><span class="line">          .<span class="title function_">fontWeight</span>(<span class="title class_">FontWeight</span>.<span class="property">Bold</span>)</span><br><span class="line">        <span class="title class_">Button</span>(<span class="string">&#x27;Show Image&#x27;</span>)</span><br><span class="line">          .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="comment">// Convert file path to sandbox URI</span></span><br><span class="line">              <span class="keyword">let</span> filePath = filesDir + <span class="string">&#x27;/pic.jpg&#x27;</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">urlImage</span> = fileUri.<span class="title function_">getUriFromPath</span>(filePath);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">              <span class="keyword">let</span> <span class="attr">err</span>: <span class="title class_">BusinessError</span> = error <span class="keyword">as</span> <span class="title class_">BusinessError</span>;</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`Invoke downloadTask downloadFile failed, code is <span class="subst">$&#123;err.code&#125;</span>, message is <span class="subst">$&#123;err.message&#125;</span>`</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">        <span class="title class_">Image</span>(<span class="variable language_">this</span>.<span class="property">urlImage</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://harmonyostech.github.io/2025/06/30/4821-Daily-HarmonyOS-Next-Knowledge-Custom-Popup-for-Sharing-Badge-Flicker-Fix-etc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Qingkouwei">
      <meta itemprop="description" content="Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HarmonyOS NEXT Knowledge Charging Station">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/06/30/4821-Daily-HarmonyOS-Next-Knowledge-Custom-Popup-for-Sharing-Badge-Flicker-Fix-etc/" class="post-title-link" itemprop="url">[Daily HarmonyOS Next Knowledge] Custom Popup for Sharing, Badge Flicker Fix, etc.</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-06-30 17:25:27 / Modified: 17:26:07" itemprop="dateCreated datePublished" datetime="2025-06-30T17:25:27+08:00">2025-06-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Daily-HarmonyOS-Next-Knowledge/" itemprop="url" rel="index"><span itemprop="name">Daily HarmonyOS Next Knowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Daily-HarmonyOS-Next-Knowledge-Custom-Popup-for-Sharing-Badge-Flicker-Fix-etc"><a href="#Daily-HarmonyOS-Next-Knowledge-Custom-Popup-for-Sharing-Badge-Flicker-Fix-etc" class="headerlink" title="[Daily HarmonyOS Next Knowledge] Custom Popup for Sharing, Badge Flicker Fix, etc."></a>[Daily HarmonyOS Next Knowledge] Custom Popup for Sharing, Badge Flicker Fix, etc.</h1><h2 id="1-How-to-implement-a-custom-sharing-popup"><a href="#1-How-to-implement-a-custom-sharing-popup" class="headerlink" title="1. How to implement a custom sharing popup?"></a>1. How to implement a custom sharing popup?</h2><p><strong>Requirements</strong>:  </p>
<ol>
<li>A bottom-up sharing panel with two rows, supporting horizontal swiping.  </li>
<li>A base component for bottom popups with customizable content.</li>
</ol>
<p><strong>Reference Code</strong>:  </p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BusinessError</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@ohos.base&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">ComponentContent</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@ohos.arkui.node&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">PromptAction</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Params</span> &#123;</span><br><span class="line">  <span class="title class_">ApplicationSharings</span>: <span class="built_in">string</span>[] = [];</span><br><span class="line">  <span class="title class_">Sharings</span>: <span class="built_in">string</span>[] = [];</span><br><span class="line">  <span class="attr">promptAction</span>: <span class="title class_">PromptAction</span>;</span><br><span class="line">  <span class="attr">numss</span>: <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"><span class="title class_">ApplicationSharings</span>: <span class="built_in">string</span>[], <span class="title class_">Sharings</span>: <span class="built_in">string</span>[] = [], <span class="attr">promptAction</span>: <span class="title class_">PromptAction</span>, <span class="attr">numss</span>: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ApplicationSharings</span> = <span class="title class_">ApplicationSharings</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">Sharings</span> = <span class="title class_">Sharings</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">promptAction</span> = promptAction;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">numss</span> = numss;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">buildText</span>(<span class="params"><span class="attr">$$</span>: <span class="title class_">Params</span></span>) &#123;</span><br><span class="line">  <span class="title class_">Column</span>() &#123;</span><br><span class="line">    <span class="title class_">Text</span>(<span class="string">&#x27;网页由mp.xxx.xxx.com提供&#x27;</span>)</span><br><span class="line">      .<span class="title function_">fontSize</span>(<span class="number">10</span>)</span><br><span class="line">    <span class="comment">// .fontWeight(FontWeight.Bold)</span></span><br><span class="line">    <span class="comment">// .margin(&#123;bottom: 36&#125;)</span></span><br><span class="line">    <span class="title class_">Grid</span>() &#123;</span><br><span class="line">      <span class="title class_">ForEach</span>($$.<span class="property">ApplicationSharings</span>, <span class="function">(<span class="params"><span class="attr">item</span>: <span class="built_in">string</span>, index</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title class_">GridItem</span>() &#123;</span><br><span class="line">          <span class="title class_">Column</span>() &#123;</span><br><span class="line">            <span class="title class_">Image</span>($r(<span class="string">&#x27;app.media.app_icon&#x27;</span>))</span><br><span class="line">              .<span class="title function_">height</span>(<span class="number">50</span>).<span class="title function_">width</span>(<span class="number">50</span>)</span><br><span class="line">            <span class="title class_">Text</span>(item)</span><br><span class="line">              .<span class="title function_">fontSize</span>(<span class="number">10</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="number">100</span>)</span><br><span class="line">    .<span class="title function_">rowsGap</span>(<span class="number">20</span>)</span><br><span class="line">    .<span class="title function_">columnsGap</span>(<span class="number">20</span>)</span><br><span class="line">    .<span class="title function_">scrollBar</span>(<span class="title class_">BarState</span>.<span class="property">Off</span>)</span><br><span class="line">    .<span class="title function_">rowsTemplate</span>(<span class="string">&#x27;1fr&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Grid</span>() &#123;</span><br><span class="line">      <span class="title class_">ForEach</span>($$.<span class="property">Sharings</span>, <span class="function">(<span class="params"><span class="attr">item</span>: <span class="built_in">string</span>, index</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title class_">GridItem</span>() &#123;</span><br><span class="line">          <span class="title class_">Column</span>() &#123;</span><br><span class="line">            <span class="title class_">Image</span>($r(<span class="string">&#x27;app.media.app_icon&#x27;</span>))</span><br><span class="line">              .<span class="title function_">height</span>(<span class="number">50</span>).<span class="title function_">width</span>(<span class="number">50</span>)</span><br><span class="line">            <span class="title class_">Text</span>(item)</span><br><span class="line">              .<span class="title function_">fontSize</span>(<span class="number">10</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="number">100</span>)</span><br><span class="line">    .<span class="title function_">rowsGap</span>(<span class="number">20</span>)</span><br><span class="line">    .<span class="title function_">columnsGap</span>(<span class="number">20</span>)</span><br><span class="line">    .<span class="title function_">scrollBar</span>(<span class="title class_">BarState</span>.<span class="property">Off</span>)</span><br><span class="line">    .<span class="title function_">rowsTemplate</span>(<span class="string">&#x27;1fr&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="title class_">Button</span>(<span class="string">&#x27;取消&#x27;</span>)</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">      .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">Black</span>)</span><br><span class="line">      .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">      .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">/*let sasasa1 = LocalStorage.getShared()?.get(&#x27;uiContext&#x27;) as UIContext</span></span><br><span class="line"><span class="comment">        let sasasa = LocalStorage.getShared()?.get(&#x27;PropAA&#x27;) as ComponentContent&lt;Params&gt;</span></span><br><span class="line"><span class="comment">        try &#123;</span></span><br><span class="line"><span class="comment">        $$.promptAction.closeCustomDialog(sasasa);</span></span><br><span class="line"><span class="comment">        &#125; catch (error) &#123;</span></span><br><span class="line"><span class="comment">        let message = (error as BusinessError).message;</span></span><br><span class="line"><span class="comment">        let code = (error as BusinessError).code;</span></span><br><span class="line"><span class="comment">        console.error(`:::OpenCustomDialog args error code is $&#123;code&#125;, message is $&#123;message&#125;`);</span></span><br><span class="line"><span class="comment">        &#125;;*/</span></span><br><span class="line">        <span class="keyword">let</span> <span class="attr">link1</span>: <span class="title class_">SubscribedAbstractProperty</span>&lt;<span class="built_in">number</span>&gt; = storage.<span class="title function_">link</span>(<span class="string">&#x27;PropA&#x27;</span>);</span><br><span class="line">        <span class="keyword">let</span> numsss = link1.<span class="title function_">get</span>()</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;:::numsss&#x27;</span>, link1.<span class="title function_">get</span>())</span><br><span class="line">        link1.<span class="title function_">set</span>(++numsss)</span><br><span class="line">        <span class="comment">// $$.numss++</span></span><br><span class="line">        <span class="comment">// console.log(&#x27;:::$$.numss&#x27;,$$.numss)</span></span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  .<span class="title function_">backgroundColor</span>(<span class="string">&#x27;#FFF0F0F0&#x27;</span>)</span><br><span class="line">  .<span class="title function_">width</span>(<span class="string">&#x27;90%&#x27;</span>)</span><br><span class="line">  .<span class="title function_">height</span>(<span class="string">&#x27;30%&#x27;</span>)</span><br><span class="line">  .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">para</span>: <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="built_in">number</span>&gt; = &#123; <span class="string">&#x27;PropA&#x27;</span>: <span class="number">1</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">storage</span>: <span class="title class_">LocalStorage</span> = <span class="keyword">new</span> <span class="title class_">LocalStorage</span>(para); <span class="comment">// Create new instance and initialize with given object</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// let globalBuilder: WrappedBuilder&lt;[Params]&gt; = wrapBuilder(buildText);</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span>(storage)</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">CustomDialogDemo</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">message</span>: <span class="built_in">string</span> = <span class="string">&quot;hello&quot;</span></span><br><span class="line">  <span class="meta">@State</span> <span class="title class_">ApplicationSharings</span>: <span class="built_in">string</span>[] =</span><br><span class="line">    [<span class="string">&#x27;转发&#x27;</span>, <span class="string">&#x27;群发给客户&#x27;</span>, <span class="string">&#x27;群发到客户群&#x27;</span>, <span class="string">&#x27;分享到同事吧&#x27;</span>, <span class="string">&#x27;收藏&#x27;</span>, <span class="string">&#x27;群发到客户群&#x27;</span>, <span class="string">&#x27;分享到同事吧&#x27;</span>, <span class="string">&#x27;收藏&#x27;</span>, <span class="string">&#x27;刷新&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;翻译&#x27;</span>, <span class="string">&#x27;复制链接&#x27;</span>, <span class="string">&#x27;调整字体&#x27;</span>, <span class="string">&#x27;刷新&#x27;</span>, <span class="string">&#x27;翻译&#x27;</span>]</span><br><span class="line">  <span class="meta">@State</span> <span class="title class_">Sharings</span>: <span class="built_in">string</span>[] = [<span class="string">&#x27;最小化&#x27;</span>, <span class="string">&#x27;复制链接&#x27;</span>, <span class="string">&#x27;调整字体&#x27;</span>, <span class="string">&#x27;刷新&#x27;</span>, <span class="string">&#x27;翻译&#x27;</span>, <span class="string">&#x27;复制链接&#x27;</span>, <span class="string">&#x27;调整字体&#x27;</span>, <span class="string">&#x27;刷新&#x27;</span>, <span class="string">&#x27;翻译&#x27;</span>]</span><br><span class="line">  <span class="meta">@LocalStorageLink</span>(<span class="string">&#x27;PropA&#x27;</span>) <span class="meta">@Watch</span>(<span class="string">&#x27;onchang&#x27;</span>) <span class="attr">nums</span>: <span class="built_in">number</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// @State @Watch(&#x27;onchang&#x27;) nums :number = 0;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="meta">@LocalStorageLink</span>(<span class="string">&#x27;uiContext&#x27;</span>) <span class="attr">aaa</span>: <span class="title class_">UIContext</span> = <span class="variable language_">this</span>.<span class="title function_">getUIContext</span>();</span><br><span class="line">  <span class="meta">@LocalStorageLink</span>(<span class="string">&#x27;PropAA&#x27;</span>) <span class="attr">shjsh</span>: <span class="title class_">ComponentContent</span>&lt;<span class="title class_">Params</span>&gt; | <span class="literal">null</span> =</span><br><span class="line">    <span class="literal">null</span> <span class="comment">//new ComponentContent(this.aaa,wrapBuilder(ssss));</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// @LocalStorageLink(&#x27;PropAA&#x27;) shjsh:ComponentContent&lt;Params&gt; = new ComponentContent(this.aaa, globalBuilder);</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// setInterval(()=&gt;&#123;</span></span><br><span class="line">    <span class="comment">// console.log(&quot;:::nums&quot;,this.nums)</span></span><br><span class="line">    <span class="comment">// &#125;,1000)</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">onchang</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;::: onchang&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">aaa</span>.<span class="title function_">getPromptAction</span>().<span class="title function_">closeCustomDialog</span>(<span class="variable language_">this</span>.<span class="property">shjsh</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="keyword">let</span> message = (error <span class="keyword">as</span> <span class="title class_">BusinessError</span>).<span class="property">message</span>;</span><br><span class="line">      <span class="keyword">let</span> code = (error <span class="keyword">as</span> <span class="title class_">BusinessError</span>).<span class="property">code</span>;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`OpenCustomDialog args error code is <span class="subst">$&#123;code&#125;</span>, message is <span class="subst">$&#123;message&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Row</span>() &#123;</span><br><span class="line">      <span class="title class_">Column</span>() &#123;</span><br><span class="line">        <span class="title class_">TextInput</span>()</span><br><span class="line">          .<span class="title function_">id</span>(<span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line">          .<span class="title function_">visibility</span>(<span class="title class_">Visibility</span>.<span class="property">None</span>)</span><br><span class="line">        <span class="title class_">Button</span>(<span class="string">&quot;click me&quot;</span>)</span><br><span class="line">          .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> uiContext = <span class="variable language_">this</span>.<span class="title function_">getUIContext</span>();</span><br><span class="line">            <span class="keyword">let</span> promptAction = uiContext.<span class="title function_">getPromptAction</span>();</span><br><span class="line">            <span class="keyword">let</span> contentNode = <span class="keyword">new</span> <span class="title class_">ComponentContent</span>(uiContext, <span class="title function_">wrapBuilder</span>(buildText),</span><br><span class="line">              <span class="keyword">new</span> <span class="title class_">Params</span>(<span class="variable language_">this</span>.<span class="property">ApplicationSharings</span>, <span class="variable language_">this</span>.<span class="property">Sharings</span>, promptAction, <span class="variable language_">this</span>.<span class="property">nums</span>));</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">shjsh</span> = contentNode</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">              promptAction.<span class="title function_">openCustomDialog</span>(contentNode);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">              <span class="keyword">let</span> message = (error <span class="keyword">as</span> <span class="title class_">BusinessError</span>).<span class="property">message</span>;</span><br><span class="line">              <span class="keyword">let</span> code = (error <span class="keyword">as</span> <span class="title class_">BusinessError</span>).<span class="property">code</span>;</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`OpenCustomDialog args error code is <span class="subst">$&#123;code&#125;</span>, message is <span class="subst">$&#123;message&#125;</span>`</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            ;</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">      .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 2. Badge flickers when switching between numeric and non-numeric states?  </span></span><br><span class="line"><span class="string">**Scenarios causing flickering**:  </span></span><br><span class="line"><span class="string">- Switching between Badge with/without a numeric value.  </span></span><br><span class="line"><span class="string">- Toggle Badge visibility.  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**Solution**: Use the `</span>onComplete<span class="string">` callback to ensure images load before updating the Badge.  </span></span><br><span class="line"><span class="string">Reference: [https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/development-intro-api-V5?catalogVersion=V5](https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/development-intro-api-V5?catalogVersion=V5)  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**Reference Code**:  </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>typescript</span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">BadgeDemo</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">message</span>: <span class="built_in">string</span> = <span class="string">&#x27;Hello World&#x27;</span>;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">sizes</span>: <span class="built_in">string</span> = <span class="string">&#x27;0&#x27;</span></span><br><span class="line">  <span class="meta">@State</span> <span class="attr">isDnd</span>: <span class="built_in">boolean</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Row</span>() &#123;</span><br><span class="line">      <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">message</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">50</span>)</span><br><span class="line">        .<span class="title function_">fontWeight</span>(<span class="title class_">FontWeight</span>.<span class="property">Bold</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isDnd</span> = !<span class="variable language_">this</span>.<span class="property">isDnd</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">      <span class="title class_">Stack</span>() &#123;</span><br><span class="line">        <span class="title class_">Badge</span>(&#123;</span><br><span class="line">          <span class="attr">value</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">          <span class="attr">position</span>: &#123; <span class="attr">x</span>: <span class="number">40</span>, <span class="attr">y</span>: <span class="number">0</span> &#125;,</span><br><span class="line">          <span class="attr">style</span>: &#123; <span class="attr">badgeSize</span>: <span class="number">15</span>, <span class="attr">badgeColor</span>: <span class="title class_">Color</span>.<span class="property">Red</span> &#125;</span><br><span class="line">        &#125;) &#123;</span><br><span class="line">          <span class="title class_">Image</span>($r(<span class="string">&#x27;app.media.icon&#x27;</span>))</span><br><span class="line">            .<span class="title function_">width</span>(<span class="number">50</span>)</span><br><span class="line">            .<span class="title function_">height</span>(<span class="number">50</span>)</span><br><span class="line">            .<span class="title function_">onComplete</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">isDnd</span> = !<span class="variable language_">this</span>.<span class="property">isDnd</span>;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">visibility</span>(<span class="variable language_">this</span>.<span class="property">isDnd</span> ? <span class="title class_">Visibility</span>.<span class="property">Visible</span> : <span class="title class_">Visibility</span>.<span class="property">None</span>)</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Badge</span>(&#123;</span><br><span class="line">          <span class="attr">count</span>: <span class="number">98</span>,</span><br><span class="line">          <span class="attr">maxCount</span>: <span class="number">99</span>,</span><br><span class="line">          <span class="attr">position</span>: &#123; <span class="attr">x</span>: <span class="number">30</span>, <span class="attr">y</span>: <span class="number">0</span> &#125;,</span><br><span class="line">          <span class="attr">style</span>: &#123; <span class="attr">fontSize</span>: <span class="number">15</span>, <span class="attr">badgeSize</span>: <span class="number">15</span>, <span class="attr">badgeColor</span>: <span class="title class_">Color</span>.<span class="property">Red</span> &#125;</span><br><span class="line">        &#125;) &#123;</span><br><span class="line">          <span class="title class_">Image</span>($r(<span class="string">&#x27;app.media.icon&#x27;</span>))</span><br><span class="line">            .<span class="title function_">width</span>(<span class="number">50</span>)</span><br><span class="line">            .<span class="title function_">height</span>(<span class="number">50</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">visibility</span>(<span class="variable language_">this</span>.<span class="property">isDnd</span> ? <span class="title class_">Visibility</span>.<span class="property">None</span> : <span class="title class_">Visibility</span>.<span class="property">Visible</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 3. How to delay toggling a switch and its callback?  </span></span><br><span class="line"><span class="string">**Current Behavior**: The toggle state changes immediately with an instant callback.  </span></span><br><span class="line"><span class="string">**Scenario**: When turning on a toggle, if an error occurs during the process, resetting the toggle triggers the state change callback unintentionally.  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">**Solution**: Use `</span>hitTestBehavior<span class="string">` and `</span><span class="built_in">setTimeout</span><span class="string">`:  </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>typescript</span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">Index</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">isDarkMode</span>: <span class="built_in">boolean</span> = <span class="literal">false</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Column</span>() &#123;</span><br><span class="line">        <span class="title class_">Toggle</span>(&#123; <span class="attr">type</span>: <span class="title class_">ToggleType</span>.<span class="property">Switch</span>, <span class="attr">isOn</span>: $$this.<span class="property">isDarkMode</span> &#125;)</span><br><span class="line"></span><br><span class="line">          .<span class="title function_">onChange</span>(<span class="function">(<span class="params"><span class="attr">isOn</span>: <span class="built_in">boolean</span></span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;Toggle.onChange:isOn&#x27;</span> + isOn)</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isDarkMode</span> = isOn</span><br><span class="line">            <span class="title function_">getContext</span>(<span class="variable language_">this</span>).<span class="title function_">getApplicationContext</span>().<span class="title function_">setColorMode</span>(<span class="variable language_">this</span>.<span class="property">isDarkMode</span> ? <span class="number">0</span> : <span class="number">1</span>)</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">hitTestBehavior</span>(<span class="title class_">HitTestMode</span>.<span class="property">Block</span>)</span><br><span class="line">      .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isDarkMode</span> = !<span class="variable language_">this</span>.<span class="property">isDarkMode</span></span><br><span class="line">        &#125;, <span class="number">10000</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">padding</span>(<span class="number">32</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 4. `</span><span class="title function_">getColorSync</span>(resource)<span class="string">` returns light mode color in dark mode?  </span></span><br><span class="line"><span class="string">**Solutions**:  </span></span><br><span class="line"><span class="string">1. Pass the resource ID directly:  </span></span><br><span class="line"><span class="string">   `</span><span class="string">``</span>typescript</span><br><span class="line">   <span class="title function_">getContext</span>(component).<span class="property">resourceManager</span>.<span class="title function_">getColorSync</span>($r(<span class="string">&quot;app.color.xxx&quot;</span>).<span class="property">id</span>)</span><br><span class="line">   <span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string">2. Add configuration to `</span><span class="variable language_">module</span>.<span class="property">json5</span><span class="string">` in the package with dark mode resources:  </span></span><br><span class="line"><span class="string">   `</span><span class="string">``</span>json</span><br><span class="line">   <span class="string">&quot;metadata&quot;</span>: [</span><br><span class="line">     &#123;</span><br><span class="line">       <span class="string">&quot;name&quot;</span>: <span class="string">&quot;ContextResourceConfigLoadFromParentTemp&quot;</span>,</span><br><span class="line">       <span class="string">&quot;value&quot;</span>: <span class="string">&quot;true&quot;</span></span><br><span class="line">     &#125;</span><br><span class="line">   ]</span><br><span class="line">   <span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## 5. How to remove tones from pinyin when converting Chinese characters?  </span></span><br><span class="line"><span class="string">**Solution**: Convert characters to pinyin first, then remove tones:  </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>typescript</span><br><span class="line"><span class="keyword">let</span> transliterator = i18n.<span class="property">Transliterator</span>.<span class="title function_">getInstance</span>(<span class="string">&#x27;Any-Latn&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> res = transliterator.<span class="title function_">transform</span>(<span class="string">&#x27;中国&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> transliterator2 = i18n.<span class="property">Transliterator</span>.<span class="title function_">getInstance</span>(<span class="string">&#x27;Latin-ASCII&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> res2 = transliterator2.<span class="title function_">transform</span>(res);</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://harmonyostech.github.io/2025/06/30/4820-Daily-HarmonyOS-Next-Knowledge-List-Collapse-Animation-Obfuscation-Issue-%E5%AE%9A%E4%BD%8D%EF%BC%8CbindPopup-Problems-etc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Qingkouwei">
      <meta itemprop="description" content="Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HarmonyOS NEXT Knowledge Charging Station">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/06/30/4820-Daily-HarmonyOS-Next-Knowledge-List-Collapse-Animation-Obfuscation-Issue-%E5%AE%9A%E4%BD%8D%EF%BC%8CbindPopup-Problems-etc/" class="post-title-link" itemprop="url">[Daily HarmonyOS Next Knowledge] List Collapse Animation, Obfuscation Issue 定位，bindPopup Problems, etc.</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-06-30 17:24:29 / Modified: 17:24:53" itemprop="dateCreated datePublished" datetime="2025-06-30T17:24:29+08:00">2025-06-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Daily-HarmonyOS-Next-Knowledge/" itemprop="url" rel="index"><span itemprop="name">Daily HarmonyOS Next Knowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Daily-HarmonyOS-Next-Knowledge-List-Collapse-Animation-Obfuscation-Issue定位-bindPopup-Problems-etc"><a href="#Daily-HarmonyOS-Next-Knowledge-List-Collapse-Animation-Obfuscation-Issue定位-bindPopup-Problems-etc" class="headerlink" title="[Daily HarmonyOS Next Knowledge] List Collapse Animation, Obfuscation Issue定位, bindPopup Problems, etc."></a>[Daily HarmonyOS Next Knowledge] List Collapse Animation, Obfuscation Issue定位, bindPopup Problems, etc.</h1><h2 id="1-How-to-implement-list-collapse-animation-effects"><a href="#1-How-to-implement-list-collapse-animation-effects" class="headerlink" title="1. How to implement list collapse animation effects?"></a>1. How to implement list collapse animation effects?</h2><ul>
<li>When the height of listItem is known, collapse animation can be achieved by controlling height changes.  </li>
<li>When the height of listItem is unknown, collapse animation can be achieved by adding&#x2F;removing data in <code>animateTo</code>.</li>
</ul>
<h2 id="2-How-to-add-compilation-parameters-in-HarmonyOS"><a href="#2-How-to-add-compilation-parameters-in-HarmonyOS" class="headerlink" title="2. How to add compilation parameters in HarmonyOS?"></a>2. How to add compilation parameters in HarmonyOS?</h2><ol>
<li>Add in CMakeLists.txt:</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Set build type to Release, which disables debug information</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_BUILD_TYPE Release)</span><br><span class="line"></span><br><span class="line"><span class="comment"># The -s flag optimizes compilation to generate shorter code</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_FLAGS <span class="string">&quot;$&#123;CMAKE_CXX_FLAGS&#125; -s&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Solve symbol conflicts</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_SHARED_LINKER_FLAGS <span class="string">&quot;-Wl,-Bsymbolic&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Unified additions:</span></span><br><span class="line"><span class="comment"># Enable stack protection; capture buffer overflow security issues; code optimization; integer overflow checks, etc.</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_FLAGS <span class="string">&quot;-fstack-protector-all -D_FORTIFY_SOURCE=2 -O2 -ftrapv -s&quot;</span>)</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line"><span class="number">2</span>. Add in externalnativeoptions configuration:  </span><br><span class="line">The `externalNativeOptions` parameter in the module-level `build-profile.json5` is the entry for compiling C/C++ files in NDK projects. You can specify the CMake script path via `path`, configure CMake parameters via `arguments`, <span class="keyword">set</span> C++ compiler parameters via `cppFlags`, <span class="keyword">and</span> configure compilation architectures via `abiFilters`:  </span><br><span class="line">```json</span><br><span class="line"><span class="string">&quot;externalNativeOptions&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;path&quot;</span>: <span class="string">&quot;./src/main/cpp/CMakeLists.txt&quot;</span>,</span><br><span class="line">  <span class="string">&quot;arguments&quot;</span>: <span class="string">&quot;-DCMAKE_BUILD_TYPE=Release&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cppFlags&quot;</span>: <span class="string">&quot;-fstack-protector-all -D_FORTIFY_SOURCE=2 -O2 -ftrapv -s&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 3. bindPopup style issues?  </span></span><br><span class="line">**Problems**:  </span><br><span class="line"><span class="number">1</span>. Inability to change the rounded corner size of the Popup window.  </span><br><span class="line"><span class="number">2</span>. When `enableArrow` is `<span class="keyword">true</span>`, the arrow color is white. Can the arrow color be changed?  </span><br><span class="line"></span><br><span class="line">**Solutions**:  </span><br><span class="line">- **Problem <span class="number">1</span>**: <span class="keyword">Set</span> `radius` to change the rounded corner size of the Popup window. For details, see [https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-popup-<span class="number">0000001774121186</span>\<span class="comment">#ZH-CN_TOPIC_0000001774121186__bindpopup](https://link.segmentfault.com/?enc=yB8il0OnpBxydJs%2BDo6WIg%3D%3D.e0ZleM%2FBZQFjlOyVeg8Oo1KiZIx9JlebfYAtmlMEoAvtRJFEiiMcDpKa9mHdD3HgFw2we0KxlS%2FEg1d%2FaL1BmTXU5YJeOvlSpidgQsxdFRlENn1dxsyPH0ULRjAPTKKqSOgJkOWM%2BhPjrL7kEQol%2B%2BjJf17DRP%2B%2Fa95%2FFcKuONHPZdeqOi1w3p7zEQmqyavNvHaoV9Ti9zxEd633ZXn0cw%3D%3D).  </span></span><br><span class="line">- **Problem <span class="number">2</span>**: The arrow color cannot be modified currently; only the bubble background color can be <span class="keyword">set</span> via `popupColor`.  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 4. How to locate obfuscation issues?  </span></span><br><span class="line">**Scenario**: Debugging works, but Release mode reports errors <span class="keyword">or</span> crashes.  </span><br><span class="line"></span><br><span class="line">**定位Means**:  </span><br><span class="line"><span class="number">1</span>. Add obfuscation configuration `-disable-obfuscation` to turn <span class="keyword">off</span> all obfuscation.  </span><br><span class="line"><span class="number">2</span>. Compile in Release mode. <span class="keyword">If</span> the exception disappears, confirm it is caused by obfuscation.  </span><br><span class="line"><span class="number">3</span>. Comment out the `-compact` obfuscation configuration to check the specific error location.  </span><br><span class="line"></span><br><span class="line">**Compilation Output Directory**: `build/default/cache/default/default@HarCompileArkTS/esmodule/release`  </span><br><span class="line">**Cause**: Issues arise because attribute names, method names, <span class="keyword">or</span> parameter names are obfuscated. Use `-keep-property-name`, `-keep-global-name`, <span class="keyword">or</span> `-keep` to prevent obfuscation of specific elements.  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 5. Based on what positioning is the offset attribute of BindPopup offset?  </span></span><br><span class="line">What is the reference point for the `offset` of `bindpopup`? For example, <span class="keyword">if</span> `offset` is <span class="keyword">set</span> to `x: <span class="number">100</span>, y: <span class="number">100</span>`, based <span class="keyword">on</span> which point are `x` <span class="keyword">and</span> `y` offset when touching the screen?  </span><br><span class="line"></span><br><span class="line">**Answer**: The reference point is the top-left anchor of the bound component.  </span><br><span class="line">- Note: The specifications of `bindpopup` have changed in <span class="number">5.0</span>. The写法 in current Webview documents is no longer fully compatible with the long-press menu <span class="keyword">function</span>. To use `bindpopup`, add a component with size <span class="number">0</span> before the Webview component (at the same layer) to carry `bindpopup`.  </span><br><span class="line">- According to current UX specifications, a horizontal offset of <span class="number">7</span>vp is required to ensure the popup menu stays within the screen range.  </span><br><span class="line"></span><br><span class="line">**Sample Code**:  </span><br><span class="line">```typescript</span><br><span class="line">import web_webview from &#x27;@ohos.web.webview&#x27;</span><br><span class="line">import pasteboard from &#x27;@ohos.pasteboard&#x27;</span><br><span class="line"></span><br><span class="line">const TAG = &#x27;ContextMenu&#x27;;</span><br><span class="line"></span><br><span class="line">@Entry</span><br><span class="line">@Component</span><br><span class="line">struct WebComponent &#123;</span><br><span class="line">  controller: web_webview.WebviewController = new web_webview.WebviewController()</span><br><span class="line">  private result: WebContextMenuResult | undefined = undefined;</span><br><span class="line">  @State linkUrl: <span class="keyword">string</span> = &#x27;&#x27;;</span><br><span class="line">  @State offsetX: number = <span class="number">0</span>;</span><br><span class="line">  @State offsetY: number = <span class="number">0</span>;</span><br><span class="line">  @State showMenu: boolean = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">  @Builder</span><br><span class="line">  // Build custom menu <span class="keyword">and</span> trigger <span class="keyword">function</span> interface</span><br><span class="line">  MenuBuilder() &#123;</span><br><span class="line">    // Menu displayed as a vertical <span class="keyword">list</span>.</span><br><span class="line">    Menu() &#123;</span><br><span class="line">      // Display specific item menu items in Menu.</span><br><span class="line">      MenuItem(&#123;</span><br><span class="line">        content: &#x27;复制图片&#x27;,</span><br><span class="line">      &#125;)</span><br><span class="line">        .width(<span class="number">100</span>)</span><br><span class="line">        .height(<span class="number">50</span>)</span><br><span class="line">        .onClick(() =&gt; &#123;</span><br><span class="line">          this.result?.copyImage();</span><br><span class="line">          this.showMenu = <span class="keyword">false</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">      MenuItem(&#123;</span><br><span class="line">        content: &#x27;剪切&#x27;,</span><br><span class="line">      &#125;)</span><br><span class="line">        .width(<span class="number">100</span>)</span><br><span class="line">        .height(<span class="number">50</span>)</span><br><span class="line">        .onClick(() =&gt; &#123;</span><br><span class="line">          this.result?.cut();</span><br><span class="line">          this.showMenu = <span class="keyword">false</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">      MenuItem(&#123;</span><br><span class="line">        content: &#x27;复制&#x27;,</span><br><span class="line">      &#125;)</span><br><span class="line">        .width(<span class="number">100</span>)</span><br><span class="line">        .height(<span class="number">50</span>)</span><br><span class="line">        .onClick(() =&gt; &#123;</span><br><span class="line">          this.result?.copy();</span><br><span class="line">          this.showMenu = <span class="keyword">false</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">      MenuItem(&#123;</span><br><span class="line">        content: &#x27;粘贴&#x27;,</span><br><span class="line">      &#125;)</span><br><span class="line">        .width(<span class="number">100</span>)</span><br><span class="line">        .height(<span class="number">50</span>)</span><br><span class="line">        .onClick(() =&gt; &#123;</span><br><span class="line">          this.result?.paste();</span><br><span class="line">          this.showMenu = <span class="keyword">false</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">      MenuItem(&#123;</span><br><span class="line">        content: &#x27;复制链接&#x27;,</span><br><span class="line">      &#125;)</span><br><span class="line">        .width(<span class="number">100</span>)</span><br><span class="line">        .height(<span class="number">50</span>)</span><br><span class="line">        .onClick(() =&gt; &#123;</span><br><span class="line">          let pasteData = pasteboard.createData(&#x27;text/plain&#x27;, this.linkUrl);</span><br><span class="line">          pasteboard.getSystemPasteboard().setData(pasteData, (error) =&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (error) &#123;</span><br><span class="line">              <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">          this.showMenu = <span class="keyword">false</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">      MenuItem(&#123;</span><br><span class="line">        content: &#x27;全选&#x27;,</span><br><span class="line">      &#125;)</span><br><span class="line">        .width(<span class="number">100</span>)</span><br><span class="line">        .height(<span class="number">50</span>)</span><br><span class="line">        .onClick(() =&gt; &#123;</span><br><span class="line">          this.result?.selectAll();</span><br><span class="line">          this.showMenu = <span class="keyword">false</span>;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .width(<span class="number">150</span>)</span><br><span class="line">    .height(<span class="number">300</span>)</span><br><span class="line">    .backgroundColor(<span class="string">&quot;#eeeeee&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  build() &#123;</span><br><span class="line">    Column() &#123;</span><br><span class="line">      Row()</span><br><span class="line">        .width(<span class="number">0</span>)</span><br><span class="line">        .height(<span class="number">0</span>)</span><br><span class="line">        .position(&#123; x: <span class="number">0</span>, y: <span class="number">0</span> &#125;)</span><br><span class="line">        .bindPopup(this.showMenu,</span><br><span class="line">          &#123;</span><br><span class="line">            builder: this.MenuBuilder(),</span><br><span class="line">            enableArrow: <span class="keyword">false</span>,</span><br><span class="line">            placement: Placement.LeftTop,</span><br><span class="line">            targetSpace: <span class="number">0</span>,</span><br><span class="line">            shadow: &#123;</span><br><span class="line">              radius: <span class="number">0</span></span><br><span class="line">            &#125;,</span><br><span class="line">            offset: &#123; x: this.offsetX - <span class="number">7</span>, y: this.offsetY &#125;,</span><br><span class="line">            mask: <span class="keyword">false</span>,</span><br><span class="line">            onStateChange: (e) =&gt; &#123;</span><br><span class="line">              <span class="keyword">if</span> (!e.isVisible) &#123;</span><br><span class="line">                this.showMenu = <span class="keyword">false</span>;</span><br><span class="line">                this.result!.closeContextMenu();</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line"></span><br><span class="line">      Web(&#123; src: &#x27;&#x27;, controller: this.controller &#125;)// Trigger custom popup</span><br><span class="line">        .onControllerAttached(() =&gt; &#123;</span><br><span class="line">          this.controller.setCustomUserAgent(this.controller.getUserAgent() + <span class="string">&quot; Android&quot;</span>)</span><br><span class="line">          this.controller.loadUrl($rawfile(<span class="string">&quot;OnContextMenuShow/index.html&quot;</span>))</span><br><span class="line">        &#125;)// Trigger custom popup</span><br><span class="line">        .onContextMenuShow((event) =&gt; &#123;</span><br><span class="line">          <span class="keyword">if</span> (event) &#123;</span><br><span class="line">            this.result = event.result</span><br><span class="line">            console.info(<span class="string">&quot;x coord = &quot;</span> + event.param.x())</span><br><span class="line">            console.info(<span class="string">&quot;link url = &quot;</span> + event.param.getLinkUrl())</span><br><span class="line">            this.linkUrl = event.param.getLinkUrl()</span><br><span class="line">          &#125;</span><br><span class="line">          console.info(TAG, `x: <span class="variable">$&#123;this.offsetX&#125;</span>, y: <span class="variable">$&#123;this.offsetY&#125;</span>`);</span><br><span class="line">          this.showMenu = <span class="keyword">true</span>;</span><br><span class="line">          this.offsetX = <span class="keyword">Math</span>.max(px2vp(event?.param.x() ?? <span class="number">0</span>) - <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">          this.offsetY = <span class="keyword">Math</span>.max(px2vp(event?.param.y() ?? <span class="number">0</span>) - <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">true</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://harmonyostech.github.io/2025/06/30/4819-Learn-HarmonyOS-Next-Knowledge-Daily-ASON-Tool-Custom-Tabbar-musl-Text-Abnormal-Truncation-etc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Qingkouwei">
      <meta itemprop="description" content="Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HarmonyOS NEXT Knowledge Charging Station">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/06/30/4819-Learn-HarmonyOS-Next-Knowledge-Daily-ASON-Tool-Custom-Tabbar-musl-Text-Abnormal-Truncation-etc/" class="post-title-link" itemprop="url">[Learn HarmonyOS Next Knowledge Daily] ASON Tool, Custom Tabbar, musl, Text Abnormal Truncation, etc.</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-06-30 17:23:35 / Modified: 17:23:50" itemprop="dateCreated datePublished" datetime="2025-06-30T17:23:35+08:00">2025-06-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Daily-HarmonyOS-Next-Knowledge/" itemprop="url" rel="index"><span itemprop="name">Daily HarmonyOS Next Knowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Learn-HarmonyOS-Next-Knowledge-Daily-ASON-Tool-Custom-Tabbar-musl-Text-Abnormal-Truncation-etc"><a href="#Learn-HarmonyOS-Next-Knowledge-Daily-ASON-Tool-Custom-Tabbar-musl-Text-Abnormal-Truncation-etc" class="headerlink" title="[Learn HarmonyOS Next Knowledge Daily] ASON Tool, Custom Tabbar, musl, Text Abnormal Truncation, etc."></a>[Learn HarmonyOS Next Knowledge Daily] ASON Tool, Custom Tabbar, musl, Text Abnormal Truncation, etc.</h1><h2 id="1-How-to-use-the-ASON-tool-to-implement-conversion-between-Sendable-types-and-JSON-data"><a href="#1-How-to-use-the-ASON-tool-to-implement-conversion-between-Sendable-types-and-JSON-data" class="headerlink" title="1. How to use the ASON tool to implement conversion between Sendable types and JSON data?"></a>1. How to use the ASON tool to implement conversion between Sendable types and JSON data?</h2><p>ASON supports developers in parsing JSON strings and generating shared data for cross-concurrency domain transmission. Meanwhile, ASON also supports converting shared data into JSON strings.  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import &#123; ArkTSUtils, collections, lang &#125; from &#x27;@kit.ArkTS&#x27;;</span><br><span class="line"></span><br><span class="line">// Parse JSON to Sendable data</span><br><span class="line">type ISendable = lang.ISendable;</span><br><span class="line">let jsonText = &#x27;&#123;&quot;name&quot;: &quot;John&quot;, &quot;age&quot;: 30, &quot;city&quot;: &quot;ChongQing&quot;&#125;&#x27;;</span><br><span class="line">let obj = ArkTSUtils.ASON.parse(jsonText) as ISendable;</span><br><span class="line"></span><br><span class="line">// Serialize Sendable data to JSON</span><br><span class="line">let arr = new collections.Array(1, 2, 3);</span><br><span class="line">let str = ArkTSUtils.ASON.stringify(arr);</span><br><span class="line">```  </span><br><span class="line">Reference address: https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-arkts-utils-V5#arktsutilsason  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 2. How to add other components to the tabBar in Tabs?  </span><br><span class="line">Currently, many Tabs components have a filter/more icon in the rightmost tabBar. However, the system Tabs component cannot add other components to the tabBar. Customization can be used to implement adding other components to the tabBar in Tabs.  </span><br></pre></td></tr></table></figure>
<p>import componentUtils from ‘@ohos.arkui.componentUtils’;</p>
<p>@Entry<br>@Component<br>struct TabsExample22 {<br>  @State tabArray: Array<number> &#x3D; [0, 1, 2]<br>  private controller: TabsController &#x3D; new TabsController()<br>  @State currentIndex: number &#x3D; 0<br>  @State animationDuration: number &#x3D; 300<br>  @State indicatorLeftMargin: number &#x3D; 0<br>  @State indicatorWidth: number &#x3D; 0<br>  private tabsWidth: number &#x3D; 0</p>
<p>  &#x2F;&#x2F; Individual tab<br>  @Builder<br>  Tab(tabName: string, tabItem: number, tabIndex: number) {<br>    Row({ space: 20 }) {<br>      Text(tabName).fontSize(18)<br>        .fontColor(tabItem &#x3D;&#x3D;&#x3D; this.currentIndex ? Color.Red : Color.Black)<br>        .id(tabIndex.toString())<br>        .onAreaChange((oldValue: Area, newValue: Area) &#x3D;&gt; {<br>          if (this.currentIndex &#x3D;&#x3D;&#x3D; tabIndex &amp;&amp; (this.indicatorLeftMargin &#x3D;&#x3D;&#x3D; 0 || this.indicatorWidth &#x3D;&#x3D;&#x3D; 0)) {<br>            if (newValue.position.x !&#x3D; undefined) {<br>              let positionX &#x3D; Number.parseFloat(newValue.position.x.toString())<br>              this.indicatorLeftMargin &#x3D; Number.isNaN(positionX) ? 0 : positionX<br>            }<br>            let width &#x3D; Number.parseFloat(newValue.width.toString())<br>            this.indicatorWidth &#x3D; Number.isNaN(width) ? 0 : width<br>          }<br>        })<br>    }<br>    .justifyContent(FlexAlign.Center)<br>    .constraintSize({ minWidth: 35 })<br>    .width(80)<br>    .height(35)<br>    .borderRadius({ topLeft: 10, topRight: 10 })<br>    .onClick(() &#x3D;&gt; {<br>      this.controller.changeIndex(tabIndex)<br>      this.currentIndex &#x3D; tabIndex<br>    })</p>
<p>  }</p>
<p>  build() {<br>    Column() {<br>      &#x2F;&#x2F; Tab bar<br>      Stack({ alignContent: Alignment.TopStart }) {<br>        Scroll() {<br>          Row() {<br>            ForEach(this.tabArray, (item: number, index: number) &#x3D;&gt; {<br>              this.Tab(“页签 “ + item, item, index)<br>            })</p>
<pre><code>        Text(&#39;+&#39;)
          .width(36)
          .height(50)
          .fontSize(28)
          .borderRadius(5)
          .margin(&#123; left: 88 &#125;)
          .padding(&#123; left: 5, bottom: 2 &#125;)
      &#125;
      .justifyContent(FlexAlign.Start)
    &#125;
    .align(Alignment.Start)
    .scrollable(ScrollDirection.Horizontal)
    .scrollBar(BarState.Off)
    .width(&#39;100%&#39;)

    Column()
      .width(this.indicatorWidth)
      .height(2)
      .backgroundColor(Color.Red)
      .borderRadius(2)
      .margin(&#123; left: this.indicatorLeftMargin, top: 38 &#125;)
  &#125;
  .width(&#39;100%&#39;)

  .width(&#39;100%&#39;)

  // Tabs
  Tabs(&#123; barPosition: BarPosition.Start, controller: this.controller &#125;) &#123;
    ForEach(this.tabArray, (item: number, index: number) =&gt; &#123;
      TabContent() &#123;
        Text(&#39;我是页面 &#39; + item + &quot; 的内容&quot;)
          .height(300)
          .width(&#39;100%&#39;)
          .fontSize(30)
      &#125;
      .backgroundColor(Color.Pink)
    &#125;)
  &#125;
  .onAreaChange((oldValue: Area, newValue: Area) =&gt; &#123;
    let width = Number.parseFloat(newValue.width.toString())
    this.tabsWidth = Number.isNaN(width) ? 0 : width
  &#125;)
  .barWidth(&#39;100%&#39;)
  .barHeight(0)
  .width(&#39;100%&#39;)
  .height(&#39;100%&#39;)
  .backgroundColor(&#39;#F1F3F5&#39;)
  .animationDuration(this.animationDuration)
  .onChange((index: number) =&gt; &#123;
    this.currentIndex = index // Listen to changes in index to switch tab content.
  &#125;)
  .onAnimationStart((index: number, targetIndex: number, event: TabsAnimationEvent) =&gt; &#123;
    // Triggered when the switching animation starts. The underline slides with the page while the width fades.
    this.currentIndex = targetIndex
    let targetIndexInfo = this.getTextInfo(targetIndex)
    this.startAnimateTo(this.animationDuration, targetIndexInfo.left, targetIndexInfo.width)
  &#125;)
  .onAnimationEnd((index: number, event: TabsAnimationEvent) =&gt; &#123;
    // Triggered when the switching animation ends. The underline animation stops.
    let currentIndicatorInfo = this.getCurrentIndicatorInfo(index, event)
    this.startAnimateTo(0, currentIndicatorInfo.left, currentIndicatorInfo.width)
  &#125;)
  .onGestureSwipe((index: number, event: TabsAnimationEvent) =&gt; &#123;
    // Triggered frame-by-frame during page swiping.
    let currentIndicatorInfo = this.getCurrentIndicatorInfo(index, event)
    this.currentIndex = currentIndicatorInfo.index
    this.indicatorLeftMargin = currentIndicatorInfo.left
    this.indicatorWidth = currentIndicatorInfo.width
  &#125;)
&#125;
.height(&#39;100%&#39;)
</code></pre>
<p>  }</p>
<p>  &#x2F;&#x2F; Get component size, position, translation, scaling, rotation, and affine matrix attribute information.<br>  private getTextInfo(index: number): Record&lt;string, number&gt; {<br>    let modePosition: componentUtils.ComponentInfo &#x3D; componentUtils.getRectangleById(index.toString());<br>    return { ‘left’: px2vp(modePosition.windowOffset.x), ‘width’: px2vp(modePosition.size.width) }<br>  }</p>
<p>  private getCurrentIndicatorInfo(index: number, event: TabsAnimationEvent): Record&lt;string, number&gt; {<br>    let nextIndex &#x3D; index<br>    if (index &gt; 0 &amp;&amp; event.currentOffset &gt; 0) {<br>      nextIndex–<br>    } else if (index &lt; 3 &amp;&amp; event.currentOffset &lt; 0) {<br>      nextIndex++<br>    }<br>    let indexInfo &#x3D; this.getTextInfo(index)<br>    let nextIndexInfo &#x3D; this.getTextInfo(nextIndex)<br>    let swipeRatio &#x3D; Math.abs(event.currentOffset &#x2F; this.tabsWidth)<br>    let currentIndex &#x3D; swipeRatio &gt; 0.5 ? nextIndex : index &#x2F;&#x2F; When the page swipes more than half, the tabBar switches to the next page.<br>    let currentLeft &#x3D; indexInfo.left + (nextIndexInfo.left - indexInfo.left) * swipeRatio<br>    let currentWidth &#x3D; indexInfo.width + (nextIndexInfo.width - indexInfo.width) * swipeRatio<br>    return { ‘index’: currentIndex, ‘left’: currentLeft, ‘width’: currentWidth }<br>  }</p>
<p>  private startAnimateTo(duration: number, leftMargin: number, width: number) {<br>    animateTo({<br>      duration: duration, &#x2F;&#x2F; Animation duration<br>      curve: Curve.Linear, &#x2F;&#x2F; Animation curve<br>      iterations: 1, &#x2F;&#x2F; Number of plays<br>      playMode: PlayMode.Normal, &#x2F;&#x2F; Animation mode<br>      onFinish: () &#x3D;&gt; {<br>        console.info(‘play end’)<br>      }<br>    }, () &#x3D;&gt; {<br>      this.indicatorLeftMargin &#x3D; leftMargin<br>      this.indicatorWidth &#x3D; width<br>    })<br>  }<br>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">## 3. What is the support status of the C/musl library?  </span><br><span class="line">HarmonyOS uses musl as the C standard library. The musl library is a lightweight, fast, simple, and free open-source libc library. For detailed introduction, refer to the [musl official reference manual](https://musl.libc.org/manual.html). For differences between musl and glibc, refer to [musl vs glibc functional comparison](https://wiki.musl-libc.org/functional-differences-from-glibc.html).  </span><br><span class="line"></span><br><span class="line">**musl version numbers**:  </span><br><span class="line">- Starting from HarmonyOS 4.0, the version was upgraded to 1.2.3.  </span><br><span class="line">- Starting from HarmonyOS 5.0, the version was upgraded to 1.2.5.  </span><br><span class="line"></span><br><span class="line">**Supported capabilities**:  </span><br><span class="line">Provides header files and library function interfaces compatible with C99, C11, and POSIX standards, but not fully compatible.  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 4. How to solve the abnormal ellipsis truncation when the Text component&#x27;s text content is a mix of Chinese, numbers, and English?  </span><br><span class="line">When using the Text component with content mixing Chinese, numbers, and English, setting TextOverFlow to show an ellipsis for overflowing text may cause abnormal truncation.  </span><br><span class="line"></span><br><span class="line">When the Text component sets the wordBreak(WordBreak.BREAK_ALL) property, for Non-CJK text, line breaks can be made between any two characters to achieve normal truncation.  </span><br></pre></td></tr></table></figure>
<p>@Entry<br>@Component<br>struct Index {<br>  @State text: string &#x3D; ‘2年·VIP会员 3个月期·8GB·230mm·花漾粉’</p>
<p>  build() {<br>    Column() {<br>      Text(this.text)<br>        .width(200)&#x2F;&#x2F; Set maximum width<br>        .maxLines(1)&#x2F;&#x2F; Single line display<br>        .textOverflow({ overflow: TextOverflow.Ellipsis })&#x2F;&#x2F; Show ellipsis for overflow<br>        .ellipsisMode(EllipsisMode.END)&#x2F;&#x2F; After setting word break rule to WordBreak.BREAK_ALL<br>        .wordBreak(WordBreak.BREAK_ALL)<br>        .textAlign(TextAlign.JUSTIFY)<br>        .backgroundColor(Color.Green)<br>        .fontSize(16)<br>        .fontColor(Color.Red)<br>    }<br>  }<br>}</p>
<pre><code>

## 5. What is the standard for HarmonyOS encoding and decoding interfaces?  
encodeURIComponent is a built-in capability of TS. URI encoding is based on the RFC 3986 standard.
</code></pre>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://harmonyostech.github.io/2025/06/30/4818-Daily-HarmonyOS-Next-Knowledge-HAP-Installation-Failure-ArkTS-and-C-Array-Conversion-Gradient-Mask-Effect-etc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Qingkouwei">
      <meta itemprop="description" content="Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HarmonyOS NEXT Knowledge Charging Station">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/06/30/4818-Daily-HarmonyOS-Next-Knowledge-HAP-Installation-Failure-ArkTS-and-C-Array-Conversion-Gradient-Mask-Effect-etc/" class="post-title-link" itemprop="url">[Daily HarmonyOS Next Knowledge] HAP Installation Failure, ArkTS and C++ Array Conversion, Gradient Mask Effect, etc.</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-06-30 17:21:40 / Modified: 17:22:07" itemprop="dateCreated datePublished" datetime="2025-06-30T17:21:40+08:00">2025-06-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Daily-HarmonyOS-Next-Knowledge/" itemprop="url" rel="index"><span itemprop="name">Daily HarmonyOS Next Knowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Daily-HarmonyOS-Next-Knowledge-HAP-Installation-Failure-ArkTS-and-C-Array-Conversion-Gradient-Mask-Effect-etc"><a href="#Daily-HarmonyOS-Next-Knowledge-HAP-Installation-Failure-ArkTS-and-C-Array-Conversion-Gradient-Mask-Effect-etc" class="headerlink" title="[Daily HarmonyOS Next Knowledge] HAP Installation Failure, ArkTS and C++ Array Conversion, Gradient Mask Effect, etc."></a>[Daily HarmonyOS Next Knowledge] HAP Installation Failure, ArkTS and C++ Array Conversion, Gradient Mask Effect, etc.</h1><h2 id="1-When-starting-debugging-or-running-an-application-service-an-error-occurs-during-HAP-installation-with-the-message-“error-install-failed-due-to-older-sdk-version-in-the-device”"><a href="#1-When-starting-debugging-or-running-an-application-service-an-error-occurs-during-HAP-installation-with-the-message-“error-install-failed-due-to-older-sdk-version-in-the-device”" class="headerlink" title="1. When starting debugging or running an application&#x2F;service, an error occurs during HAP installation with the message “error: install failed due to older sdk version in the device”."></a>1. When starting debugging or running an application&#x2F;service, an error occurs during HAP installation with the message “error: install failed due to older sdk version in the device”.</h2><p>This is caused by a mismatch between the SDK version used for compilation and packaging and the device image version. Mismatch scenarios include:  </p>
<p><strong>Scenario 1</strong>: The device image version is lower than the SDK version used for compilation. Update the device image version. Command to query the device image version:  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br></pre></td><td class="code"><pre><span class="line">hdc shell param get const.ohos.apiversion</span><br><span class="line">```  </span><br><span class="line">If the API version provided by the image is 10 and the SDK version used for application compilation is also 10, but the error still occurs, it may be because the image version is too low to comply with the new SDK verification rules. Update the image version to the latest.  </span><br><span class="line"></span><br><span class="line">**Scenario 2**: For applications that need to run on OpenHarmony devices, confirm that `runtimeOS` has been changed to OpenHarmony.  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 2. When starting debugging or running an application/service, an error occurs during HAP installation with the message &quot;error: install sign info inconsistent&quot;.  </span><br><span class="line">This is due to inconsistent signatures between the installed application on the device and the new application to be installed. If &quot;Keep Application Data&quot; (overwrite installation without uninstalling the application) is checked in Edit Configurations and the signature is renewed, this error will occur.  </span><br><span class="line"></span><br><span class="line">**Solution**: Uninstall the installed application on the device, or uncheck &quot;Keep Application Data&quot; and reinstall the new application.  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 3. How to integrate RichEditor and a Component as a whole?  </span><br><span class="line">There is a Component above RichEditor, and the goal is to integrate RichEditor and the Component to enable adaptive scrolling based on the cursor position. Currently, using a Scroller cannot obtain the specific coordinates of the cursor in RichEditor (cursor x and y positions relative to RichEditor), making scrolling impossible.  </span><br><span class="line"></span><br><span class="line">**Solution**: Wrap RichEditor and the Component with a Scroll component. Use the `onAreaChange` callback to call `scroller.scrollBy` to adjust the height of the scrolling component.  </span><br><span class="line"></span><br><span class="line">**Reference code**:  </span><br><span class="line">```typescript</span><br><span class="line">@Entry</span><br><span class="line">@Component</span><br><span class="line">struct Index &#123;</span><br><span class="line">  editorController = new RichEditorController()</span><br><span class="line">  scroller: Scroller = new Scroller()</span><br><span class="line"></span><br><span class="line">  build() &#123;</span><br><span class="line">    Column() &#123;</span><br><span class="line">      Scroll(this.scroller) &#123;</span><br><span class="line">        Column() &#123;</span><br><span class="line">          Image($r(&#x27;app.media.startIcon&#x27;))</span><br><span class="line">            .width(&#x27;100%&#x27;)</span><br><span class="line">            .height(200)</span><br><span class="line">            .margin(&#123; bottom: 20 &#125;)</span><br><span class="line">          RichEditor(&#123; controller: this.editorController &#125;)</span><br><span class="line">            .id(&#x27;RichEditor&#x27;)</span><br><span class="line">            .width(&#x27;100%&#x27;)</span><br><span class="line">            .backgroundColor(Color.Yellow)</span><br><span class="line">            .onReady(() =&gt; &#123;</span><br><span class="line">              this.editorController.addImageSpan($r(&quot;app.media.startIcon&quot;),</span><br><span class="line">                &#123;</span><br><span class="line">                  imageStyle:</span><br><span class="line">                  &#123;</span><br><span class="line">                    size: [&quot;100px&quot;, &quot;100px&quot;]</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">              this.editorController.addTextSpan(&#x27;男生女生向前冲&#x27;,</span><br><span class="line">                &#123;</span><br><span class="line">                  style:</span><br><span class="line">                  &#123;</span><br><span class="line">                    fontColor: Color.Blue,</span><br><span class="line">                    fontSize: 30</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">            .onAreaChange((_, value) =&gt; &#123;</span><br><span class="line">              if (_.height !== value.height) &#123;</span><br><span class="line">                this.scroller.scrollBy(0, Number(value.height) - 200)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">          Button(&#x27;getSpans-文字&#x27;).onClick((event: ClickEvent) =&gt; &#123;</span><br><span class="line">            let getSpans = this.editorController.getSpans(&#123; start: 0 &#125;)</span><br><span class="line">            // Type casting is required to obtain text or image information</span><br><span class="line">            let span0 = getSpans[0] as RichEditorTextSpanResult</span><br><span class="line">          &#125;)</span><br><span class="line">          Button(&#x27;getSpans-图片&#x27;).onClick((event: ClickEvent) =&gt; &#123;</span><br><span class="line">            let getSpans = this.editorController.getSpans(&#123; start: 0 &#125;)</span><br><span class="line">            let span1 = getSpans[1] as RichEditorImageSpanResult</span><br><span class="line">          &#125;)</span><br><span class="line">          Button(&#x27;RichEditor获焦&#x27;).onClick(() =&gt; &#123;</span><br><span class="line">            focusControl.requestFocus(&#x27;RichEditor&#x27;)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      .scrollable(ScrollDirection.Vertical) // Vertical scrolling direction</span><br><span class="line">      .scrollBar(BarState.On) // Scrollbar always visible</span><br><span class="line">      .scrollBarColor(Color.Gray) // Scrollbar color</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 4. How to implement array conversion between ArkTS and C/C++?  </span><br><span class="line">### TS2NAPI  </span><br><span class="line">**TS-side code**:  </span><br><span class="line">```typescript</span><br><span class="line">Button(&quot;TS2NAPI&quot;)</span><br><span class="line">  .fontSize(50)</span><br><span class="line">  .fontWeight(FontWeight.Bold)</span><br><span class="line">  .onClick(() =&gt; &#123;</span><br><span class="line">    let napiArray: Int32Array = new Int32Array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</span><br><span class="line">    console.info(&quot;TS2NAPI: JS   &quot; + napiArray)</span><br><span class="line">    testNapi.TS2NAPI(napiArray)</span><br><span class="line">  &#125;)</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">**NAPI-side code**:  </span><br><span class="line">```cpp</span><br><span class="line">// Transmit TS array to NAPI layer</span><br><span class="line">static napi_value TS2NAPI(napi_env env, napi_callback_info info) &#123;</span><br><span class="line">  // Get parameters from TS layer</span><br><span class="line">  size_t argc = 1;</span><br><span class="line">  napi_value args;</span><br><span class="line">  napi_get_cb_info(env, info, &amp;argc, &amp;args, NULL, NULL);</span><br><span class="line">  napi_value input_array = args;</span><br><span class="line"></span><br><span class="line">  // Get typedarray information to generate input_buffer</span><br><span class="line">  napi_typedarray_type type; // Data type</span><br><span class="line">  napi_value input_buffer;</span><br><span class="line">  size_t byte_offset; // Data offset</span><br><span class="line">  size_t i, length;   // Data byte size</span><br><span class="line">  napi_get_typedarray_info(env, input_array, &amp;type, &amp;length, NULL, &amp;input_buffer, &amp;byte_offset);</span><br><span class="line"></span><br><span class="line">  // Get array data</span><br><span class="line">  void *data;</span><br><span class="line">  size_t byte_length;</span><br><span class="line">  napi_get_arraybuffer_info(env, input_buffer, &amp;data, &amp;byte_length);</span><br><span class="line"></span><br><span class="line">  if (type == napi_int32_array) &#123;</span><br><span class="line">    int32_t *data_bytes = (int32_t *)(data);</span><br><span class="line">    int32_t num = length / sizeof(int32_t);</span><br><span class="line"></span><br><span class="line">    string str = &quot;&quot;;</span><br><span class="line">    for (int32_t i = 0; i &lt; num; i++) &#123;</span><br><span class="line">      int32_t tmp = *((int32_t *)(data_bytes) + i);</span><br><span class="line">      str += (to_string(tmp) + &#x27; &#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    OH_LOG_INFO(LOG_APP, &quot;TS2NAPI: C++  %&#123;public&#125;s&quot;, str.c_str());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return NULL;</span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">### NAPI2TS  </span><br><span class="line">**TS-side code**:  </span><br><span class="line">```typescript</span><br><span class="line">Button(&quot;NAPI2TS&quot;)</span><br><span class="line">  .fontSize(50)</span><br><span class="line">  .fontWeight(FontWeight.Bold)</span><br><span class="line">  .onClick(() =&gt; &#123;</span><br><span class="line">    let napiArray: Int32Array = testNapi.NAPI2TS()</span><br><span class="line">    console.info(&quot;NAPI2TS: JS   &quot; + napiArray)</span><br><span class="line">  &#125;)</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">**NAPI-side code**:  </span><br><span class="line">```cpp</span><br><span class="line">// Transmit NAPI layer array to TS layer</span><br><span class="line">static napi_value NAPI2TS(napi_env env, napi_callback_info info) &#123;</span><br><span class="line">  // Number of data items</span><br><span class="line">  int num = 10;</span><br><span class="line"></span><br><span class="line">  // Create output_buffer</span><br><span class="line">  napi_value output_buffer;</span><br><span class="line">  void *output_ptr = NULL;</span><br><span class="line">  napi_create_arraybuffer(env, num * sizeof(int32_t), &amp;output_ptr, &amp;output_buffer);</span><br><span class="line"></span><br><span class="line">  // Create output_array</span><br><span class="line">  napi_value output_array;</span><br><span class="line">  napi_create_typedarray(env, napi_int32_array, num, output_buffer, 0, &amp;output_array);</span><br><span class="line"></span><br><span class="line">  // Assign values to output_ptr and output_buffer</span><br><span class="line">  int32_t *output_bytes = (int32_t *)output_ptr;</span><br><span class="line">  for (int32_t i = 0; i &lt; num; i++) &#123;</span><br><span class="line">    output_bytes[i] = i;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  string str = &quot;&quot;;</span><br><span class="line">  for (int32_t i = 0; i &lt; num; i++) &#123;</span><br><span class="line">    int32_t tmp = *((int32_t *)(output_ptr) + i);</span><br><span class="line">    str += (to_string(tmp) + &#x27; &#x27;);</span><br><span class="line">  &#125;</span><br><span class="line">  OH_LOG_INFO(LOG_APP, &quot;NAPI2TS: C++  %&#123;public&#125;s&quot;, str.c_str());</span><br><span class="line"></span><br><span class="line">  return output_array;</span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">### Practical scenario:  </span><br><span class="line">ArkTS reads a rawfile image, transmits it to the NAPI layer for processing, and then returns it to ArkTS for display:  </span><br><span class="line">```typescript</span><br><span class="line">Button(&quot;Test&quot;)</span><br><span class="line">  .fontSize(50)</span><br><span class="line">  .fontWeight(FontWeight.Bold)</span><br><span class="line">  .onClick(() =&gt; &#123;</span><br><span class="line"></span><br><span class="line">    getContext().resourceManager.getRawFileContent(&#x27;test.png&#x27;).then(value =&gt; &#123;</span><br><span class="line">      hilog.info(0x0000, &#x27;getRawFileContent&#x27;, &#x27;%&#123;public&#125;s&#x27;, &#x27;OK&#x27;);</span><br><span class="line">      const fileData: Uint8Array = value;</span><br><span class="line">      // Get the ArrayBuffer of the image</span><br><span class="line">      let buffer = fileData.buffer;</span><br><span class="line"></span><br><span class="line">      let input = new Uint8Array(buffer)</span><br><span class="line">      let output = testNapi.TEST(input);</span><br><span class="line"></span><br><span class="line">      let decodingOptions: image.DecodingOptions = &#123;</span><br><span class="line">        editable: true,</span><br><span class="line">        desiredPixelFormat: 3,</span><br><span class="line">      &#125;</span><br><span class="line">      let imageSource = image.createImageSource(output.buffer);</span><br><span class="line">      imageSource.createPixelMap(decodingOptions).then(map =&gt; &#123;</span><br><span class="line">        this.imageSrc = map;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;).catch((err: BusinessError) =&gt; &#123;</span><br><span class="line">      hilog.error(0x0000, &#x27;getRawFileContent&#x27;, &#x27;%&#123;public&#125;s&#x27;, err.message);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">Image(this.imageSrc)</span><br><span class="line">  .height(100)</span><br><span class="line">  .width(100)</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 5. How to implement a top gradient mask effect?  </span><br><span class="line">How to implement a gradient mask effect for the bullet comment list at the top of a live broadcast room?  </span><br><span class="line"></span><br><span class="line">**Solution**: Use `overlay` with the `linearGradient` property and `blendMode` to mix the current overlay with the underlying list for a gradient mask effect.  </span><br><span class="line">**Effect diagram**:  </span><br><span class="line">![[【每日学点鸿蒙知识】24.08.18.png]]  </span><br><span class="line"></span><br><span class="line">**Reference code**:  </span><br><span class="line">```typescript</span><br><span class="line">@Entry</span><br><span class="line">@Component</span><br><span class="line">struct Index &#123;</span><br><span class="line">  private arr: number[] = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span><br><span class="line"></span><br><span class="line">  @Builder</span><br><span class="line">  overlayBuilder() &#123;</span><br><span class="line">    Stack()</span><br><span class="line">      .height(&quot;100%&quot;)</span><br><span class="line">      .width(&quot;100%&quot;)</span><br><span class="line">      .linearGradient(&#123;</span><br><span class="line">        direction: GradientDirection.Bottom, // Gradient direction</span><br><span class="line">        colors: [[&quot;#00FFFFFF&quot;, 0.0], [&quot;#FFFFFFFF&quot;, 0.3]] // When the proportion of the last array element is less than 1, it satisfies the repeated coloring effect</span><br><span class="line">      &#125;)</span><br><span class="line">      .blendMode(BlendMode.DST_IN, BlendApplyType.OFFSCREEN)</span><br><span class="line">      .hitTestBehavior(HitTestMode.None)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  build() &#123;</span><br><span class="line">    Column() &#123;</span><br><span class="line">      List(&#123; space: 20, initialIndex: 0 &#125;) &#123;</span><br><span class="line">        ForEach(this.arr, (item: number) =&gt; &#123;</span><br><span class="line">          ListItem() &#123;</span><br><span class="line">            Text(&#x27;&#x27; + item)</span><br><span class="line">              .width(&#x27;100%&#x27;)</span><br><span class="line">              .height(100)</span><br><span class="line">              .fontSize(16)</span><br><span class="line">              .textAlign(TextAlign.Center)</span><br><span class="line">              .borderRadius(10)</span><br><span class="line">              .backgroundColor(0xFFFFFF)</span><br><span class="line">          &#125;</span><br><span class="line">          .onClick(() =&gt; &#123;</span><br><span class="line">            console.log(&#x27;is click&#x27;)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;, (item: string) =&gt; item)</span><br><span class="line">      &#125;.width(&#x27;90%&#x27;)</span><br><span class="line">      .scrollBar(BarState.Off)</span><br><span class="line">      .overlay(this.overlayBuilder())</span><br><span class="line">      .blendMode(BlendMode.SRC_OVER, BlendApplyType.OFFSCREEN)</span><br><span class="line">    &#125;.width(&#x27;100%&#x27;).height(&#x27;100%&#x27;).backgroundColor(0xDCDCDC).padding(&#123; top: 5 &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://harmonyostech.github.io/2025/06/30/4817-Daily-HarmonyOS-Next-Knowledge-Multiple-har-Dependencies-Specifying-Compilation-Architecture-Mutual-Calls-Between-ArkTS-and-C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Qingkouwei">
      <meta itemprop="description" content="Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HarmonyOS NEXT Knowledge Charging Station">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/06/30/4817-Daily-HarmonyOS-Next-Knowledge-Multiple-har-Dependencies-Specifying-Compilation-Architecture-Mutual-Calls-Between-ArkTS-and-C/" class="post-title-link" itemprop="url">[Daily HarmonyOS Next Knowledge] Multiple har Dependencies, Specifying Compilation Architecture, Mutual Calls Between ArkTS and C++</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-06-30 17:19:42 / Modified: 17:20:10" itemprop="dateCreated datePublished" datetime="2025-06-30T17:19:42+08:00">2025-06-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Daily-HarmonyOS-Next-Knowledge/" itemprop="url" rel="index"><span itemprop="name">Daily HarmonyOS Next Knowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Daily-HarmonyOS-Next-Knowledge-Multiple-har-Dependencies-Specifying-Compilation-Architecture-Mutual-Calls-Between-ArkTS-and-C"><a href="#Daily-HarmonyOS-Next-Knowledge-Multiple-har-Dependencies-Specifying-Compilation-Architecture-Mutual-Calls-Between-ArkTS-and-C" class="headerlink" title="[Daily HarmonyOS Next Knowledge] Multiple har Dependencies, Specifying Compilation Architecture, Mutual Calls Between ArkTS and C++"></a>[Daily HarmonyOS Next Knowledge] Multiple har Dependencies, Specifying Compilation Architecture, Mutual Calls Between ArkTS and C++</h1><h2 id="1-Issues-with-Multiple-har-Dependencies"><a href="#1-Issues-with-Multiple-har-Dependencies" class="headerlink" title="1. Issues with Multiple har Dependencies"></a>1. Issues with Multiple har Dependencies</h2><p>If harA depends on harB and harC, and harB depends on harC, how to build such dependency relationships?  </p>
<ol>
<li>Both direct and indirect dependencies are hosted on a remote repository, relying on version numbers.  </li>
<li>If not hosted on a remote repository, it is recommended to place both direct and indirect har packages into the project and use <code>overrides</code> to point to the local har package paths.  </li>
<li>If sub-dependencies are local har dependencies, they need to be placed in the direct dependency module for building .har packages for other projects. For example, if A depends on B.har and B.har depends on C.har, C.har must be included in module B during the construction of B.har.</li>
</ol>
<h2 id="2-How-to-Specify-or-Determine-the-Current-Compilation-Architecture"><a href="#2-How-to-Specify-or-Determine-the-Current-Compilation-Architecture" class="headerlink" title="2. How to Specify or Determine the Current Compilation Architecture?"></a>2. How to Specify or Determine the Current Compilation Architecture?</h2><p><strong>Specify the compilation architecture</strong>:  </p>
<ol>
<li>Add <code>abiFilters</code> configuration in the <code>build-profile.json5</code> file:</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;externalNativeOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./src/main/cpp/CMakeLists.txt&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;arguments&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;cppFlags&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;abiFilters&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;arm64-v8a&quot;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">```  </span><br><span class="line"><span class="number">2.</span> Add compilation parameters in the `arguments` of `build-profile.json5` or via the command line<span class="punctuation">:</span>  </span><br></pre></td></tr></table></figure>
<p>-DOHOS_ARCH&#x3D;armeabi-v7a</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**Determine the compilation architecture**:  </span><br><span class="line">The `OHOS_ARCH` macro in `CMakeList.txt` represents the current compilation architecture:  </span><br><span class="line">```cmake</span><br><span class="line">if ($&#123;OHOS_ARCH&#125; STREQUAL &quot;armeabi-v7a&quot;)</span><br><span class="line">message(&#x27;armeabi-v7a&#x27;)</span><br><span class="line">elseif ($&#123;OHOS_ARCH&#125; STREQUAL &quot;arm64-v8a&quot;)</span><br><span class="line">message(&#x27;arm64-v8a&#x27;)</span><br><span class="line">else()</span><br><span class="line">message(&quot;unkonow&quot;)</span><br><span class="line">endif()</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 3. When starting debugging or running an application/service, an error occurs during HAP installation, prompting &quot;error: install failed due to grant request permissions failed&quot;.  </span><br><span class="line"></span><br><span class="line">The default app level is `normal`, which can only use `normal`-level permissions. Using `system_basic` or `system_core`-level permissions will cause an error.  </span><br><span class="line">Modify the APL level in the `UnsgnedDebugProfileTemplate.json` file to `system_basic` or `system_core`, then re-sign and package.  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 4. How to Achieve Object Passing Between ArkTS and C/C++?  </span><br><span class="line">**ArkTS calls C/C++**:  </span><br><span class="line">1. ArkTS class objects are passed to the NAPI side.  </span><br><span class="line">2. NAPI retrieves and outputs object properties.  </span><br><span class="line">3. NAPI calls object methods.  </span><br><span class="line"></span><br><span class="line">```typescript</span><br><span class="line">// Animals class</span><br><span class="line">class Animals &#123;</span><br><span class="line">  name: string</span><br><span class="line">  age: number</span><br><span class="line"></span><br><span class="line">  constructor(name: string, age: number) &#123;</span><br><span class="line">    this.name = name;</span><br><span class="line">    this.age = age;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  add(a: number, b: number): number &#123;</span><br><span class="line">    return a + b;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">```typescript</span><br><span class="line">// Passing objects in ArkTS</span><br><span class="line">Button(&quot;TestObject&quot;)</span><br><span class="line">  .onClick(() =&gt; &#123;</span><br><span class="line">    let ani: Animals = new Animals(&#x27;Bob&#x27;, 5)</span><br><span class="line">    testNapi.TestObject(ani)</span><br><span class="line">  &#125;)</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">```cpp</span><br><span class="line">// NAPI accepts and processes objects</span><br><span class="line">static napi_value TestObject(napi_env env, napi_callback_info info) &#123;</span><br><span class="line">  size_t argc = 1;</span><br><span class="line">  napi_value args[1] = &#123;nullptr&#125;;</span><br><span class="line">  napi_get_cb_info(env, info, &amp;argc, args, nullptr, nullptr);</span><br><span class="line"></span><br><span class="line">  napi_value name, age;</span><br><span class="line">  napi_get_named_property(env, args[0], &quot;name&quot;, &amp;name);</span><br><span class="line">  napi_get_named_property(env, args[0], &quot;age&quot;, &amp;age);</span><br><span class="line"></span><br><span class="line">  size_t itemLength;</span><br><span class="line">  napi_get_value_string_utf8(env, name, nullptr, 0, &amp;itemLength);</span><br><span class="line">  char *str = new char[itemLength + 1];</span><br><span class="line">  napi_get_value_string_utf8(env, name, &amp;str[0], itemLength + 1, &amp;itemLength);</span><br><span class="line">  OH_LOG_INFO(LOG_APP, &quot;name is %&#123;public&#125;s&quot;, str);</span><br><span class="line">  uint32_t num;</span><br><span class="line">  napi_get_value_uint32(env, age, &amp;num);</span><br><span class="line">  OH_LOG_INFO(LOG_APP, &quot;age is %&#123;public&#125;d&quot;, num);</span><br><span class="line"></span><br><span class="line">  napi_value add;</span><br><span class="line">  napi_get_named_property(env, args[0], &quot;add&quot;, &amp;add);</span><br><span class="line"></span><br><span class="line">  // Create parameter array</span><br><span class="line">  napi_value arr[2];</span><br><span class="line">  napi_create_int32(env, 10, &amp;arr[0]);</span><br><span class="line">  napi_create_int32(env, 5, &amp;arr[1]);</span><br><span class="line"></span><br><span class="line">  napi_value result;</span><br><span class="line">  uint32_t res;</span><br><span class="line">  napi_call_function(env, args[0], add, 2, arr, &amp;result);</span><br><span class="line">  napi_get_value_uint32(env, result, &amp;res);</span><br><span class="line">  OH_LOG_INFO(LOG_APP, &quot;res is %&#123;public&#125;d&quot;, res);</span><br><span class="line"></span><br><span class="line">  return nullptr;</span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">**C/C++ calls ArkTS**:  </span><br><span class="line">1. ArkTS passes callback methods to the NAPI side.  </span><br><span class="line">2. NAPI creates a `napi_value` pointer-type object as a parameter for the callback method.  </span><br><span class="line">3. ArkTS invokes the callback method to obtain and modify parameters passed from the NAPI side.  </span><br><span class="line">4. The NAPI side retrieves and outputs the modified parameters.  </span><br><span class="line"></span><br><span class="line">```typescript</span><br><span class="line">Button(&quot;CallbackToArkTs&quot;)</span><br><span class="line">  .onClick(() =&gt; &#123;</span><br><span class="line">    let da: Record&lt;string, number&gt; = testNapi.CallbackToArkTs((value: object) =&gt; &#123;</span><br><span class="line">      let data: Record&lt;string, number&gt; = value as Record&lt;string, number&gt;;</span><br><span class="line">      console.info(&quot;修改前type: &quot; + data[&quot;type&quot;].toString())</span><br><span class="line">      console.info(JSON.stringify(value))</span><br><span class="line">      data[&quot;type&quot;] += 10</span><br><span class="line">      return value;</span><br><span class="line">    &#125;);</span><br><span class="line">    console.info(JSON.stringify(da))</span><br><span class="line">  &#125;)</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">```cpp</span><br><span class="line">static bool Napi_AddPropertyInt32(napi_env env, napi_value obj, const char *key, int32_t value) &#123;</span><br><span class="line">  napi_value key_napi = nullptr;</span><br><span class="line">  napi_status status = napi_create_string_utf8(env, key, NAPI_AUTO_LENGTH, &amp;key_napi);</span><br><span class="line"></span><br><span class="line">  napi_value value_napi = nullptr;</span><br><span class="line">  status = napi_create_int32(env, value, &amp;value_napi);</span><br><span class="line">  status = napi_set_property(env, obj, key_napi, value_napi);</span><br><span class="line">  return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static napi_value CallbackToArkTs(napi_env env, napi_callback_info info) &#123;</span><br><span class="line"></span><br><span class="line">  // Get ArkTS parameters</span><br><span class="line">  size_t argc = 1;</span><br><span class="line">  napi_value js_cb = nullptr;</span><br><span class="line">  napi_get_cb_info(env, info, &amp;argc, &amp;js_cb, nullptr, nullptr);</span><br><span class="line"></span><br><span class="line">  // Native callback object to TS layer</span><br><span class="line">  napi_value argv = nullptr;</span><br><span class="line">  napi_create_object(env, &amp;argv);</span><br><span class="line">  Napi_AddPropertyInt32(env, argv, &quot;type&quot;, 1);</span><br><span class="line">  Napi_AddPropertyInt32(env, argv, &quot;index&quot;, 2);</span><br><span class="line"></span><br><span class="line">  // Native callback to TS layer</span><br><span class="line">  napi_value result = nullptr;</span><br><span class="line">  napi_call_function(env, NULL, js_cb, 1, &amp;argv, &amp;result);</span><br><span class="line"></span><br><span class="line">  // Get the object modified by TS</span><br><span class="line">  napi_value typeNumber = nullptr;</span><br><span class="line">  napi_get_named_property(env, result, &quot;type&quot;, &amp;typeNumber);</span><br><span class="line">  int32_t number;</span><br><span class="line">  napi_get_value_int32(env, typeNumber, &amp;number);</span><br><span class="line">  OH_LOG_INFO(LOG_APP, &quot;修改后type: %&#123;public&#125;d&quot;, number);</span><br><span class="line"></span><br><span class="line">  // Return the modified object</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 5. How to Make a Horizontally Laid-out List Adapt to Content Height Automatically?  </span><br><span class="line"></span><br><span class="line">How to solve the problem that the height of a List component with horizontal ListItems does not adapt to the content automatically?  </span><br><span class="line"></span><br><span class="line">Achieve adaptive height by nesting a horizontal List within a vertical Scroll component:  </span><br><span class="line">```typescript</span><br><span class="line">@Entry</span><br><span class="line">@Component</span><br><span class="line">struct Index &#123;</span><br><span class="line">  build() &#123;</span><br><span class="line">    Column() &#123;</span><br><span class="line">      Flex() &#123;</span><br><span class="line">        // Nest a Scroll component to make the horizontally laid-out List adapt to content height</span><br><span class="line">        Scroll() &#123;</span><br><span class="line">          List() &#123;</span><br><span class="line">            ListItem() &#123;</span><br><span class="line">              Text(&#x27;测试1&#x27;)</span><br><span class="line">            &#125;</span><br><span class="line">            .backgroundColor(Color.Red)</span><br><span class="line">            .height(80)</span><br><span class="line"></span><br><span class="line">            ListItem() &#123;</span><br><span class="line">              Text(&#x27;测试2&#x27;)</span><br><span class="line">            &#125;</span><br><span class="line">            .backgroundColor(Color.Gray)</span><br><span class="line">            .height(80)</span><br><span class="line"></span><br><span class="line">            ListItem() &#123;</span><br><span class="line">              Text(&#x27;测试3&#x27;)</span><br><span class="line">            &#125;</span><br><span class="line">            .backgroundColor(Color.Yellow)</span><br><span class="line">            .height(80)</span><br><span class="line"></span><br><span class="line">            ListItem() &#123;</span><br><span class="line">              Text(&#x27;测试4&#x27;)</span><br><span class="line">            &#125;</span><br><span class="line">            .backgroundColor(Color.White)</span><br><span class="line">            .height(80)</span><br><span class="line">          &#125;</span><br><span class="line">          .listDirection(Axis.Horizontal)</span><br><span class="line">          .alignListItem(ListItemAlign.Center)</span><br><span class="line">          .scrollBar(BarState.Off)</span><br><span class="line">          .backgroundColor(Color.Blue)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      .backgroundColor(Color.Green)</span><br><span class="line">      .width(&#x27;100%&#x27;)</span><br><span class="line">      .height(&#x27;200&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://harmonyostech.github.io/2025/06/30/4815-Learn-HarmonyOS-Next-Knowledge-Daily-Jumping-to-Third-party-Maps-getStringSync-Performance-Keyboard-Avoidance-Mode-etc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Qingkouwei">
      <meta itemprop="description" content="Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HarmonyOS NEXT Knowledge Charging Station">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/06/30/4815-Learn-HarmonyOS-Next-Knowledge-Daily-Jumping-to-Third-party-Maps-getStringSync-Performance-Keyboard-Avoidance-Mode-etc/" class="post-title-link" itemprop="url">[Learn HarmonyOS Next Knowledge Daily] Jumping to Third-party Maps, getStringSync Performance, Keyboard Avoidance Mode, etc.</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-06-30 17:18:50 / Modified: 17:31:07" itemprop="dateCreated datePublished" datetime="2025-06-30T17:18:50+08:00">2025-06-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Daily-HarmonyOS-Next-Knowledge/" itemprop="url" rel="index"><span itemprop="name">Daily HarmonyOS Next Knowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Learn-HarmonyOS-Next-Knowledge-Daily-Jumping-to-Third-party-Maps-getStringSync-Performance-Keyboard-Avoidance-Mode-etc"><a href="#Learn-HarmonyOS-Next-Knowledge-Daily-Jumping-to-Third-party-Maps-getStringSync-Performance-Keyboard-Avoidance-Mode-etc" class="headerlink" title="[Learn HarmonyOS Next Knowledge Daily] Jumping to Third-party Maps, getStringSync Performance, Keyboard Avoidance Mode, etc."></a>[Learn HarmonyOS Next Knowledge Daily] Jumping to Third-party Maps, getStringSync Performance, Keyboard Avoidance Mode, etc.</h1><h2 id="1-Jumping-to-Third-party-Map-Navigation-Pages"><a href="#1-Jumping-to-Third-party-Map-Navigation-Pages" class="headerlink" title="1. Jumping to Third-party Map Navigation Pages"></a>1. Jumping to Third-party Map Navigation Pages</h2><p>Similar to jumping to a map APP navigation page in Android:  </p>
<pre><code class="language-java">// Latitude and longitude of the destination and its name
double destinationLat = 36.547901;
double destinationLon = 104.258354;
String destinationName = &quot;Destination Name&quot;;
// Build the URI
Uri uri = Uri.parse(&quot;amapuri://route/plan/?dlat=&quot; + destinationLat + &quot;&amp;dlon=&quot; + destinationLon + &quot;&amp;dname=&quot; + destinationName + &quot;&amp;dev=0&amp;t=0&quot;);
// Create and start the intent
Intent intent = new Intent(Intent.ACTION_VIEW, uri);
intent.addCategory(Intent.CATEGORY_DEFAULT);
intent.setPackage(&quot;com.autonavi.minimap&quot;);
if (intent.resolveActivity(getPackageManager()) != null) &#123;
    startActivity(intent);
&#125; else &#123;
    // Prompt the user that Amap is not installed
    Toast.makeText(this, &quot;Please install Amap first&quot;, Toast.LENGTH_LONG).show();
&#125;
</code></pre>
<p>For jumping to Petal Maps, refer to: <a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/map-petalmaps-V5">https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/map-petalmaps-V5</a>  </p>
<pre><code class="language-typescript">import &#123; common, Want &#125; from &#39;@kit.AbilityKit&#39;;
let petalMapWant: Want = &#123;
  bundleName: &#39;com.huawei.hmos.maps.app&#39;,
  uri: &#39;maps://routes&#39;,
  parameters: &#123;
    linkSource: &#39;com.other.app&#39;,
    destinationLatitude: 31.983015468224288,
    destinationLongitude: 118.78058590757131,
    destinationPoiId: &#39;2031694785326435456&#39;,
    destinationName: &#39;南京(雨花)国际软件外包产业园&#39;
  &#125;
&#125;

let context = getContext(this) as common.UIAbilityContext;
context.startAbility(petalMapWant);
</code></pre>
<p>For jumping to Amap, refer to: <a target="_blank" rel="noopener" href="https://lbs.amap.com/api/amap-mobile/gettingstarted">https://lbs.amap.com/api/amap-mobile/gettingstarted</a>  </p>
<pre><code class="language-typescript">let want: Want = &#123;
  uri: &#39;amapuri://route/plan?sid=BGVIS1&amp;dlat=39.98848272&amp;dname=B&amp;slat=39.92848272&amp;dlon=116.47560823&amp;did=BGVIS2&amp;slon=116.39560823&amp;sname=A&amp;t=0&#39;
&#125;
// this.context: Typically obtained by calling getContext(this) as common.UIAbilityContext in a Component
this.context.startAbility(want, (err: BusinessError) =&gt; &#123;
  if (err.code) &#123;
    // Handle business logic errors
    console.error(`startAbility failed,code is $&#123;err.code&#125;,message is $&#123;err.message&#125;`);
    return
  &#125;
  // Execute normal business logic
  console.info(&#39;startAbility succeed&#39;)
&#125;)
</code></pre>
<h2 id="2-Limiting-the-Maximum-Byte-Count-of-Input-Fields"><a href="#2-Limiting-the-Maximum-Byte-Count-of-Input-Fields" class="headerlink" title="2. Limiting the Maximum Byte Count of Input Fields"></a>2. Limiting the Maximum Byte Count of Input Fields</h2><p>The TextArea input field can set the maximum number of input characters via <code>maxLength</code>, but how to set the maximum number of input bytes? Since each character in UTF-8 occupies a different number of bytes and cannot be directly converted, Android EditText provides the <code>setFilters</code> method:  </p>
<pre><code class="language-java">InputFilter[] inputFilters = new InputFilter[1];
inputFilters[0] = new ByteLengthInputFilter(MSG_LENGTH_LIMIT_BYTES);
mEditText.setFilters(inputFilters);

public class ByteLengthInputFilter implements InputFilter &#123;
  private final int mMax;
  private final Charset mCharset;
  private final CharsetDecoder mCharsetDecoder;

...
&#125;
</code></pre>
<p>HarmonyOS currently does not provide this mechanism, and we look forward to updates in future versions.  </p>
<h2 id="3-Performance-Issues-with-getStringSync"><a href="#3-Performance-Issues-with-getStringSync" class="headerlink" title="3. Performance Issues with getStringSync"></a>3. Performance Issues with getStringSync</h2><p>Using the system-provided <code>getStringSync</code> is slightly time-consuming (taking several milliseconds). Must an asynchronous callback be used?  </p>
<pre><code class="language-typescript">static getStringSync(context: common.Context | undefined, resource: Resource): string &#123;
  let rscManager = (context ?? getContext() as common.UIAbilityContext).resourceManager;
    return rscManager.getStringSync(resource)
&#125;
</code></pre>
<p>Change it to <code>rscManager.getStringSync(resource.id)</code> to reduce the time to 40 microseconds.  </p>
<h2 id="4-How-to-Set-the-Keyboard-Avoidance-Mode"><a href="#4-How-to-Set-the-Keyboard-Avoidance-Mode" class="headerlink" title="4. How to Set the Keyboard Avoidance Mode"></a>4. How to Set the Keyboard Avoidance Mode</h2><p>The keyboard avoidance mode can be set (default is <code>KeyboardAvoidMode.OFFSET</code>):  </p>
<pre><code class="language-typescript">this.getUIContext().setKeyboardAvoidMode(KeyboardAvoidMode.RESIZE)
</code></pre>
<h2 id="5-Error-When-Calling-C-Methods-in-NAPI-Cannot-read-property-encodeLame-of-undefined"><a href="#5-Error-When-Calling-C-Methods-in-NAPI-Cannot-read-property-encodeLame-of-undefined" class="headerlink" title="5. Error When Calling C Methods in NAPI: Cannot read property encodeLame of undefined"></a>5. Error When Calling C Methods in NAPI: <code>Cannot read property encodeLame of undefined</code></h2><p>When creating a Native C++ module, running the Add Demo works fine, but after using a precompiled MP3 encoder SO, all NAPI method calls throw the error: <code>Cannot read property encodeLame of undefined</code>. The Add method works successfully without depending on the MP3 SO library. The MP3 SO library is intact:  </p>
<pre><code class="language-bash">$ ls -la
total 1648
drwxr-xr-x@ 7 shen  staff     224  8 12 23:29 .
drwxr-xr-x@ 6 shen  staff     192  8 12 23:29 ..
-rw-r--r--@ 1 shen  staff  484466  8 12 23:29 libmp3lame.a
-rwxr-xr-x@ 1 shen  staff    1007  8 12 23:29 libmp3lame.la
lrwxr-xr-x@ 1 shen  staff      19  8 12 23:29 libmp3lame.so -&gt; libmp3lame.so.0.0.0
lrwxr-xr-x@ 1 shen  staff      19  8 12 23:29 libmp3lame.so.0 -&gt; libmp3lame.so.0.0.0
-rwxr-xr-x@ 1 shen  staff  348448  8 12 23:29 libmp3lame.so.0.0.0
</code></pre>
<p>Dependency configuration:  </p>
<pre><code class="language-cmake">add_library(lame SHARED IMPORTED)
set_target_properties(lame
    PROPERTIES
    IMPORTED_LOCATION $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/third_party/lame/libs/$&#123;OHOS_ARCH&#125;/libmp3lame.so)

add_library(audio_engine SHARED napi_init.cpp)
target_link_libraries(audio_engine PUBLIC libace_napi.z.so lame)
</code></pre>
<p><strong>Cause of the issue</strong>: Do not directly rename <code>libmp3lame.so.0.0.0</code> to <code>libmp3lame.so</code>; use <code>libmp3lame.so.0</code> instead. The current app’s SO is included in the IDE-side packaging, allowing the app to provide SO in the form of <code>libxxx.so.x</code>. If two SO versions need to be included, the real name and SO name must be the same, specified to the major version number <code>libxxx.x</code> (without <code>.y.z</code>). Therefore, <code>libxxx.so</code> is usable, and <code>libxxx.3.1</code> or <code>libxxx.so.3.1.0</code> should be renamed to <code>libxxx.x</code>. Then, reconfigure and compile in the CMakeLists.txt file.  </p>
<p>Reference: <a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-faqs-V5/faqs-ndk-36-V5">https://developer.huawei.com/consumer/cn/doc/harmonyos-faqs-V5/faqs-ndk-36-V5</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://harmonyostech.github.io/2025/06/30/4813-Learn-HarmonyOS-Next-Knowledge-Daily-SO-Library-Slimming-IDE-Memory-Configuration-Foreground-Background-Detection/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Qingkouwei">
      <meta itemprop="description" content="Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HarmonyOS NEXT Knowledge Charging Station">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/06/30/4813-Learn-HarmonyOS-Next-Knowledge-Daily-SO-Library-Slimming-IDE-Memory-Configuration-Foreground-Background-Detection/" class="post-title-link" itemprop="url">[Learn HarmonyOS Next Knowledge Daily] SO Library Slimming, IDE Memory Configuration, Foreground/Background Detection</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-06-30 17:17:57 / Modified: 17:18:12" itemprop="dateCreated datePublished" datetime="2025-06-30T17:17:57+08:00">2025-06-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Daily-HarmonyOS-Next-Knowledge/" itemprop="url" rel="index"><span itemprop="name">Daily HarmonyOS Next Knowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Learn-HarmonyOS-Next-Knowledge-Daily-SO-Library-Slimming-IDE-Memory-Configuration-Foreground-Background-Detection"><a href="#Learn-HarmonyOS-Next-Knowledge-Daily-SO-Library-Slimming-IDE-Memory-Configuration-Foreground-Background-Detection" class="headerlink" title="[Learn HarmonyOS Next Knowledge Daily] SO Library Slimming, IDE Memory Configuration, Foreground&#x2F;Background Detection"></a>[Learn HarmonyOS Next Knowledge Daily] SO Library Slimming, IDE Memory Configuration, Foreground&#x2F;Background Detection</h1><h2 id="1-How-to-Reduce-the-Size-of-Compiled-SO-Files"><a href="#1-How-to-Reduce-the-Size-of-Compiled-SO-Files" class="headerlink" title="1. How to Reduce the Size of Compiled SO Files?"></a>1. How to Reduce the Size of Compiled SO Files?</h2><p>When building with CMake commands, add CMake compilation parameters and C++ compiler parameters in CMakeLists.txt:  </p>
<ol>
<li>Set the build type to Release, which disables debug information:</li>
</ol>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(CMAKE_BUILD_TYPE Release)</span><br><span class="line">```  </span><br><span class="line"><span class="number">2</span>. `-s` strips symbol table information:  </span><br><span class="line">```cmake</span><br><span class="line"><span class="keyword">set</span>(CMAKE_C_FLAGS <span class="string">&quot;$&#123;CMAKE_C_FLAGS&#125; -s&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_FLAGS <span class="string">&quot;$&#123;CMAKE_CXX_FLAGS&#125; -s&quot;</span>)</span><br><span class="line">```  </span><br><span class="line">For integration in DevEco Studio IDE, configure compilation parameters <span class="keyword">and</span> compiler parameters in `externalnativeoptions`:  </span><br><span class="line">The `externalNativeOptions` parameter in the module-level `build-profile.json5` is the entry for compiling C/C++ files in NDK projects. You can specify the CMake script path via `path`, configure CMake parameters via `arguments`, <span class="keyword">set</span> C++ compiler parameters via `cppFlags`, <span class="keyword">and</span> configure compilation architectures via `abiFilters`:  </span><br><span class="line">```json</span><br><span class="line"><span class="string">&quot;externalNativeOptions&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;path&quot;</span>: <span class="string">&quot;./src/main/cpp/CMakeLists.txt&quot;</span>,</span><br><span class="line">  <span class="string">&quot;arguments&quot;</span>: <span class="string">&quot;-DCMAKE_BUILD_TYPE=Release&quot;</span>,</span><br><span class="line">  <span class="string">&quot;cppFlags&quot;</span>: <span class="string">&quot;-s&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 2. How to Determine if an App is in the Foreground or Background?  </span></span><br><span class="line">Is there an API to determine foreground/background status, <span class="keyword">and</span> are there callbacks when switching between them?  </span><br><span class="line">- Use `ApplicationContext.<span class="keyword">on</span>` to register a listener for foreground/background changes of the current app:  </span><br><span class="line">https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-inner-application-applicationcontext-V5  </span><br><span class="line">- <span class="keyword">Or</span> use `appManager.getRunningProcessInformation` to obtain information about currently running processes:  </span><br><span class="line">https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-app-ability-appmanager-V5<span class="comment">#ZH-CN_TOPIC_0000001893370457__appmanagergetrunningprocessinformation  </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 3. How to Adjust IDE Memory Size?  </span></span><br><span class="line">In Android Studio, `org.gradle.jvmargs` in `gradle.properties` sets the IDE memory size. Does DevEco have a similar configuration?  </span><br><span class="line">Modify the `maxOldSpaceSize` field in `hvigor-config.json5` <span class="keyword">and</span> increase it appropriately based <span class="keyword">on</span> the <span class="keyword">project</span> size (e.g., <span class="keyword">set</span> to <span class="number">8192</span>):  </span><br><span class="line">```json</span><br><span class="line"><span class="string">&quot;nodeOptions&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;maxOldSpaceSize&quot;</span>: <span class="number">8192</span></span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 4. How to Handle Tabs Nested with Web Sliding Scenarios?  </span></span><br><span class="line">When Tabs components are nested with Web components, the following issues may occur during scrolling:  </span><br><span class="line"><span class="number">1</span>. Vertical scrolling <span class="keyword">on</span> the Web page mistakenly triggers Tab page swipe gestures.  </span><br><span class="line"><span class="number">2</span>. The Web component can still scroll vertically when switching Tabs.  </span><br><span class="line"></span><br><span class="line">- **Issue <span class="number">1</span>**: <span class="keyword">Set</span> the nested scroll property `nestedScroll` for the Web component.  </span><br><span class="line">- **Issue <span class="number">2</span>**: <span class="keyword">Set</span> the Web component&#x27;s scroll permission via `setScrollable`.  </span><br><span class="line"></span><br><span class="line">**Reference Code**:  </span><br><span class="line">```typescript</span><br><span class="line">import web_webview from &#x27;@ohos.web.webview&#x27;;</span><br><span class="line">import business_error from &#x27;@ohos.base&#x27;;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">@Entry</span><br><span class="line">struct TabWebPage2 &#123;</span><br><span class="line">  @State <span class="keyword">message</span>: <span class="keyword">string</span> = &#x27;Hello World&#x27;;</span><br><span class="line">  private tabsController = new TabsController();</span><br><span class="line">  private currentIndex: number = <span class="number">0</span>;</span><br><span class="line">  private webviewController: web_webview.WebviewController = new web_webview.WebviewController();</span><br><span class="line">  private panOption: PanGestureOptions = new PanGestureOptions(&#123; direction: PanDirection.Vertical &#125;)</span><br><span class="line">  // Control page switching via swiping</span><br><span class="line">  @State flag: boolean = <span class="keyword">true</span></span><br><span class="line">  build() &#123;</span><br><span class="line">    Tabs(&#123; barPosition: BarPosition.End, controller: this.tabsController &#125;) &#123;</span><br><span class="line">      TabContent() &#123;</span><br><span class="line">        Web(&#123; src: &#x27;https://m.xxx.com/&#x27;, controller: this.webviewController &#125;)// <span class="keyword">Set</span> nested scrolling</span><br><span class="line">          .nestedScroll(&#123;</span><br><span class="line">            scrollForward: NestedScrollMode.PARENT_FIRST,</span><br><span class="line">            scrollBackward: NestedScrollMode.SELF_FIRST</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;.tabBar(this.tabBuilder(&#x27;首页&#x27;, <span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">      TabContent() &#123;</span><br><span class="line">        Column() &#123;</span><br><span class="line">          Text(<span class="string">&quot;发现&quot;</span>)</span><br><span class="line">        &#125;.width(&#x27;<span class="number">100</span>%&#x27;).height(&#x27;<span class="number">100</span>%&#x27;)</span><br><span class="line">      &#125;.tabBar(this.tabBuilder(&#x27;发现&#x27;, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">      TabContent() &#123;</span><br><span class="line">        Column() &#123;</span><br><span class="line">          Text(<span class="string">&quot;推荐&quot;</span>)</span><br><span class="line">        &#125;.width(&#x27;<span class="number">100</span>%&#x27;).height(&#x27;<span class="number">100</span>%&#x27;)</span><br><span class="line">      &#125;.tabBar(this.tabBuilder(&#x27;推荐&#x27;, <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">      TabContent() &#123;</span><br><span class="line">        Column() &#123;</span><br><span class="line">          Text(<span class="string">&quot;我的&quot;</span>)</span><br><span class="line">        &#125;.width(&#x27;<span class="number">100</span>%&#x27;).height(&#x27;<span class="number">100</span>%&#x27;)</span><br><span class="line">      &#125;</span><br><span class="line">      .tabBar(this.tabBuilder(&#x27;我的&#x27;, <span class="number">3</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    .onChange((index: number) =&gt; &#123;</span><br><span class="line">      this.currentIndex = index;</span><br><span class="line">    &#125;)</span><br><span class="line">    .scrollable(this.flag)</span><br><span class="line">    .onAnimationStart((index: number, targetIndex: number, event: TabsAnimationEvent) =&gt; &#123;</span><br><span class="line">    &#125;)</span><br><span class="line">    .onAnimationEnd((index: number, event: TabsAnimationEvent) =&gt; &#123;</span><br><span class="line">      // Triggered when the switching animation ends; <span class="keyword">set</span> the Web component to scrollable</span><br><span class="line">      this.webviewController.setScrollable(<span class="keyword">true</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .onGestureSwipe((index: number, event: TabsAnimationEvent) =&gt; &#123;</span><br><span class="line">      // Triggered frame-by-frame during page swiping; <span class="keyword">set</span> the Web page to non-scrollable when switching Tabs</span><br><span class="line">      this.webviewController.setScrollable(<span class="keyword">false</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Builder</span><br><span class="line">  tabBuilder(title: <span class="keyword">string</span>, targetIndex: number) &#123;</span><br><span class="line">    Column() &#123;</span><br><span class="line">      Text(title)</span><br><span class="line">        .fontColor(this.currentIndex === targetIndex ? &#x27;<span class="comment">#1698CE&#x27; : &#x27;#6B6B6B&#x27;)</span></span><br><span class="line">    &#125;</span><br><span class="line">    .width(&#x27;<span class="number">100</span>%&#x27;)</span><br><span class="line">    .height(<span class="number">50</span>)</span><br><span class="line">    .justifyContent(FlexAlign.Center)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 5. Marquee Component Text Scrolling Shows Excessive Whitespace on the First Scroll. How to Avoid This?  </span></span><br><span class="line">When text in the Marquee component scrolls to the start of the control, it causes excessive whitespace. How can we make the text stop when the end of the text reaches the end of the control to avoid whitespace?  </span><br><span class="line"></span><br><span class="line">The Marquee currently does <span class="keyword">not</span> support stopping at the end of the text. Use a Scroll component instead to achieve text scrolling.  </span><br><span class="line"></span><br><span class="line">**Sample Code**:  </span><br><span class="line">```typescript</span><br><span class="line">@Observed</span><br><span class="line">class NewsTitle &#123;</span><br><span class="line">  public title: <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">  constructor(title: <span class="keyword">string</span>) &#123;</span><br><span class="line">    this.title = title;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Entry</span><br><span class="line">@Component</span><br><span class="line">struct Index &#123;</span><br><span class="line">  @State textList: <span class="keyword">string</span>[] = [</span><br><span class="line">    &#x27;this is a <span class="keyword">test</span> string1 this is a <span class="keyword">test</span> string1 this is a <span class="keyword">test</span> string1&#x27;,</span><br><span class="line">    &#x27;this is a <span class="keyword">test</span> string2 this is a <span class="keyword">test</span> string2&#x27;,</span><br><span class="line">    &#x27;this is a <span class="keyword">test</span> string3 this is a <span class="keyword">test</span> string3 this is a <span class="keyword">test</span> string3 this is a <span class="keyword">test</span> string3&#x27;,</span><br><span class="line">  ]</span><br><span class="line">  @State count: number = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">  build() &#123;</span><br><span class="line">    Row() &#123;</span><br><span class="line">      Column() &#123;</span><br><span class="line">        myMarqueeCard(&#123;</span><br><span class="line">          textList: $textList,</span><br><span class="line">          updateList: () =&gt; &#123;</span><br><span class="line">            this.textList = [</span><br><span class="line">              `这是测试数据<span class="variable">$&#123;this.count++&#125;</span>这是测试数据<span class="variable">$&#123;this.count++&#125;</span>这是测试数据<span class="variable">$&#123;this.count++&#125;</span>这是测试数据<span class="variable">$&#123;this.count++&#125;</span>`,</span><br><span class="line">              `这是测试数据<span class="variable">$&#123;this.count++&#125;</span>这是测试数据<span class="variable">$&#123;this.count++&#125;</span>这是测试数据<span class="variable">$&#123;this.count++&#125;</span>`,</span><br><span class="line">              `这是测试数据<span class="variable">$&#123;this.count++&#125;</span>这是测试数据<span class="variable">$&#123;this.count++&#125;</span>这是测试数据<span class="variable">$&#123;this.count++&#125;</span>这是测试数据<span class="variable">$&#123;this.count++&#125;</span>这是测试数据<span class="variable">$&#123;this.count++&#125;</span>`,</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .width(&#x27;<span class="number">100</span>%&#x27;)</span><br><span class="line">      .margin(<span class="number">20</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .height(&#x27;<span class="number">100</span>%&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Tmp &#123;</span><br><span class="line">  text: <span class="keyword">string</span> = &#x27;&#x27;</span><br><span class="line">  scroller: Scroller = new Scroller()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">struct myMarqueeCard &#123;</span><br><span class="line">  @Link @Watch(&#x27;handleNewList&#x27;) textList: <span class="keyword">string</span>[]</span><br><span class="line">  @State <span class="keyword">list</span>: <span class="keyword">string</span>[] = [];</span><br><span class="line">  scroller1: Scroller = new Scroller()</span><br><span class="line">  scroller2: Scroller = new Scroller()</span><br><span class="line">  scroller3: Scroller = new Scroller()</span><br><span class="line">  updateList?: () =&gt; void</span><br><span class="line"></span><br><span class="line">  handleNewList() &#123;</span><br><span class="line">    console.log(JSON.stringify(this.textList))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  build() &#123;</span><br><span class="line">    Column() &#123;</span><br><span class="line">      this.SingleText(&#123; text: this.textList[<span class="number">0</span>], scroller: this.scroller1 &#125;)</span><br><span class="line">      this.SingleText(&#123; text: this.textList[<span class="number">1</span>], scroller: this.scroller2 &#125;)</span><br><span class="line">      this.SingleText(&#123; text: this.textList[<span class="number">2</span>], scroller: this.scroller3 &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Builder</span><br><span class="line">  SingleText($$: Tmp) &#123;</span><br><span class="line">    Scroll($$.scroller) &#123;</span><br><span class="line">      Row() &#123;</span><br><span class="line">        Text($$.text).fontSize(<span class="number">30</span>).onAppear(() =&gt; &#123;</span><br><span class="line">          this.handleScroll($$.scroller)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .width(<span class="number">300</span>)</span><br><span class="line">    .scrollable(ScrollDirection.Horizontal)</span><br><span class="line">    .enableScrollInteraction(<span class="keyword">false</span>)</span><br><span class="line">    .scrollBar(BarState.<span class="keyword">Off</span>)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleScroll(scroller: Scroller) &#123;</span><br><span class="line">    let timer: number = setInterval(() =&gt; &#123;</span><br><span class="line">      const curOffset: OffsetResult = scroller.currentOffset()</span><br><span class="line">      scroller.scrollTo(&#123;</span><br><span class="line">        xOffset: curOffset.xOffset + <span class="number">50</span>, yOffset: curOffset.yOffset, animation: &#123;</span><br><span class="line">          duration: <span class="number">1000</span>,</span><br><span class="line">          curve: Curve.Linear</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">if</span> (scroller.isAtEnd()) &#123;</span><br><span class="line">        // clearInterval(timer);</span><br><span class="line">        <span class="keyword">if</span> (this.scroller1.isAtEnd() &amp;&amp; this.scroller2.isAtEnd() &amp;&amp; this.scroller3.isAtEnd()) &#123;</span><br><span class="line">          // Other operations</span><br><span class="line">          <span class="keyword">if</span> (this.updateList) &#123;</span><br><span class="line">            this.scroller1.scrollTo(&#123; xOffset: <span class="number">0</span>, yOffset: <span class="number">0</span>, animation: &#123; duration: <span class="number">0</span> &#125; &#125;)</span><br><span class="line">            this.scroller2.scrollTo(&#123; xOffset: <span class="number">0</span>, yOffset: <span class="number">0</span>, animation: &#123; duration: <span class="number">0</span> &#125; &#125;)</span><br><span class="line">            this.scroller3.scrollTo(&#123; xOffset: <span class="number">0</span>, yOffset: <span class="number">0</span>, animation: &#123; duration: <span class="number">0</span> &#125; &#125;)</span><br><span class="line">            this.updateList()</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">500</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/35/">35</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Qingkouwei</p>
  <div class="site-description" itemprop="description">Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">347</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Qingkouwei</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"harmonyostech.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="HarmonyOS Next IM Combat: Functional Anomaly of Event Cancellation Caused by Dual Navigation LifecyclesBackground IntroductionUsers of the IM application’s chat page reported being unable to view larg">
<meta property="og:type" content="article">
<meta property="og:title" content="HarmonyOS Next IM Combat: Functional Anomaly of Event Cancellation Caused by Dual Navigation Lifecycles">
<meta property="og:url" content="https://harmonyostech.github.io/2025/06/24/HarmonyOS%20Next%20IM%20Combat:%20Functional%20Anomaly%20of%20Event%20Cancellation%20Caused%20by%20Dual%20Navigation%20Lifecycles/index.html">
<meta property="og:site_name" content="HarmonyOS NEXT Knowledge Charging Station">
<meta property="og:description" content="HarmonyOS Next IM Combat: Functional Anomaly of Event Cancellation Caused by Dual Navigation LifecyclesBackground IntroductionUsers of the IM application’s chat page reported being unable to view larg">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://harmonyostech.github.io/images/HarmonyOS%20Next%20IM%E5%AE%9E%E6%88%98%EF%BC%9A%E5%8F%8CNavigation%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%BC%95%E8%B5%B7%E7%9A%84%E4%BA%8B%E4%BB%B6%E8%A2%AB%E5%8F%96%E6%B6%88%E5%8A%9F%E8%83%BD%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98.png">
<meta property="article:published_time" content="2025-06-24T07:09:32.000Z">
<meta property="article:modified_time" content="2025-06-24T08:09:29.285Z">
<meta property="article:author" content="Qingkouwei">
<meta property="article:tag" content="HarmonyOS Next">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://harmonyostech.github.io/images/HarmonyOS%20Next%20IM%E5%AE%9E%E6%88%98%EF%BC%9A%E5%8F%8CNavigation%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%BC%95%E8%B5%B7%E7%9A%84%E4%BA%8B%E4%BB%B6%E8%A2%AB%E5%8F%96%E6%B6%88%E5%8A%9F%E8%83%BD%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98.png">

<link rel="canonical" href="https://harmonyostech.github.io/2025/06/24/HarmonyOS%20Next%20IM%20Combat:%20Functional%20Anomaly%20of%20Event%20Cancellation%20Caused%20by%20Dual%20Navigation%20Lifecycles/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>HarmonyOS Next IM Combat: Functional Anomaly of Event Cancellation Caused by Dual Navigation Lifecycles | HarmonyOS NEXT Knowledge Charging Station</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">HarmonyOS NEXT Knowledge Charging Station</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Analysis of Core Technologies and Application Scenarios of HarmonyOS NEXT</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://harmonyostech.github.io/2025/06/24/HarmonyOS%20Next%20IM%20Combat:%20Functional%20Anomaly%20of%20Event%20Cancellation%20Caused%20by%20Dual%20Navigation%20Lifecycles/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Qingkouwei">
      <meta itemprop="description" content="Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HarmonyOS NEXT Knowledge Charging Station">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          HarmonyOS Next IM Combat: Functional Anomaly of Event Cancellation Caused by Dual Navigation Lifecycles
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-06-24 15:09:32 / Modified: 16:09:29" itemprop="dateCreated datePublished" datetime="2025-06-24T15:09:32+08:00">2025-06-24</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="HarmonyOS-Next-IM-Combat-Functional-Anomaly-of-Event-Cancellation-Caused-by-Dual-Navigation-Lifecycles"><a href="#HarmonyOS-Next-IM-Combat-Functional-Anomaly-of-Event-Cancellation-Caused-by-Dual-Navigation-Lifecycles" class="headerlink" title="HarmonyOS Next IM Combat: Functional Anomaly of Event Cancellation Caused by Dual Navigation Lifecycles"></a>HarmonyOS Next IM Combat: Functional Anomaly of Event Cancellation Caused by Dual Navigation Lifecycles</h1><h4 id="Background-Introduction"><a href="#Background-Introduction" class="headerlink" title="Background Introduction"></a>Background Introduction</h4><p>Users of the IM application’s chat page reported being unable to view large images by clicking on them. Code review showed that the large image click used the <code>ohos.events.emitter</code> event mechanism. Further investigation revealed that events were emitted but not consumed. Logs indicated successful event registration, but no event reception.  </p>
<h4 id="Problem-Diagnosis"><a href="#Problem-Diagnosis" class="headerlink" title="Problem Diagnosis"></a>Problem Diagnosis</h4><p>Further analysis showed the issue consistently occurred when cold-starting the app by clicking a notification, while hot-starting via a push notification worked normally. Both company apps integrated HarmonyOS’s PushKit to receive notifications when backgrounded or closed, but only one exhibited the problem.  </p>
<p>Log analysis revealed that cold-starting the app from a notification and entering the chat page triggered one <code>aboutToAppear</code> and one proactive <code>aboutToDisappear</code> in the chat page. Further inspection showed the chat page’s lifecycle was executed twice: Chat Page 1 <code>aboutToAppear</code> → Chat Page 2 <code>aboutToAppear</code> → Chat Page 2 <code>aboutToDisappear</code>.  </p>
<p>Initially suspected to relate to PushKit, the hypothesis was dismissed when the other app functioned normally. Clicking a notification triggers navigation to the chat page via <code>onNewWant</code>. Expert consultation suggested the issue might stem from multiple <code>Navigation</code> instances in the app.  </p>
<p>Code review revealed that after a cold start, the app did not immediately navigate to the chat page in <code>onNewWant</code> but waited for the home page to load, then navigated to the chat page in the home page’s <code>aboutToAppear</code>. The app loads a splash screen in <code>onWindowStageCreate</code>, navigates from the splash screen’s <code>aboutToAppear</code> to the home page, and then from the home page’s <code>aboutToAppear</code> to the chat page. The splash screen and home page are two <code>Navigation</code> instances sharing a <code>NavPathStack</code>.  </p>
<p>Understanding <code>Navigation</code> lifecycles: As a routing container, <code>Navigation</code> lifecycles are hosted on <code>NavDestination</code> components, exposed as component events. Lifecycles fall into three categories: custom component lifecycles, universal component lifecycles, and proprietary lifecycles. <code>aboutToAppear</code> and <code>aboutToDisappear</code> are custom component lifecycles (for the custom component wrapping <code>NavDestination</code>), while <code>onAppear</code> and <code>onDisappear</code> are universal component lifecycles. The remaining lifecycles are unique to <code>NavDestination</code>.  </p>
<p>Lifecycle timeline:<br><img src="/../images/HarmonyOS%20Next%20IM%E5%AE%9E%E6%88%98%EF%BC%9A%E5%8F%8CNavigation%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%BC%95%E8%B5%B7%E7%9A%84%E4%BA%8B%E4%BB%B6%E8%A2%AB%E5%8F%96%E6%B6%88%E5%8A%9F%E8%83%BD%E5%BC%82%E5%B8%B8%E9%97%AE%E9%A2%98.png" alt="text"></p>
<ul>
<li><strong>aboutToAppear</strong>: Executed after creating a custom component and before its <code>build()</code> function (before <code>NavDestination</code> creation). Allows modifying state variables, which take effect in the subsequent <code>build()</code> execution.  </li>
<li><strong>onWillAppear</strong>: Executed after <code>NavDestination</code> creation and before mounting to the component tree. State changes here take effect in the current frame.  </li>
<li><strong>onAppear</strong>: Universal lifecycle event triggered when <code>NavDestination</code> mounts to the component tree.  </li>
<li><strong>onWillShow</strong>: Executed before <code>NavDestination</code> is layout-displayed (not triggered when the app switches to the foreground).  </li>
<li><strong>onShown</strong>: Executed after <code>NavDestination</code> is layout-displayed, indicating layout completion.  </li>
<li><strong>onActive</strong>: Triggered when <code>NavDestination</code> is active (at the stack top and operable, with no special components obscuring it).  </li>
<li><strong>onWillHide</strong>: Executed before <code>NavDestination</code> is hidden (not triggered when the app switches to the background).  </li>
<li><strong>onInactive</strong>: Triggered when <code>NavDestination</code> is inactive (not at the stack top or obscured by special components when at the stack top).  </li>
<li><strong>onHidden</strong>: Executed after <code>NavDestination</code> is hidden (when a new page is pushed, the top page is popped, or the app switches to the background).  </li>
<li><strong>onWillDisappear</strong>: Executed before <code>NavDestination</code> is destroyed. If there is a transition animation, it triggers before the animation (when the top page is popped).  </li>
<li><strong>onDisappear</strong>: Universal lifecycle event triggered when <code>NavDestination</code> is unmounted and destroyed from the component tree.  </li>
<li><strong>aboutToDisappear</strong>: Executed before a custom component is destructed; state variable modifications are prohibited.</li>
</ul>
<p>The lifecycle when navigating from Page A to Page B is: A <code>aboutToAppear</code> → B <code>aboutToAppear</code> → A <code>aboutToDisappear</code>.  </p>
<p>The root cause was identified: When navigating to the chat page in the home page’s <code>aboutToAppear</code>, the splash screen’s <code>aboutToDisappear</code> had not completed, leaving both <code>Navigation</code> instances active. This caused the chat page to execute <code>aboutToAppear</code> twice. After the splash screen’s <code>aboutToDisappear</code>, the second chat page instance was automatically <code>aboutToDisappear</code>ed, canceling event subscriptions.  </p>
<h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><p>After identifying the problem, the fix involved adding a 20ms delay to the chat page navigation, resolving the issue. A more elegant solution is to navigate to the chat page after the splash screen’s <code>aboutDisappear</code> or modify the splash screen to a non-<code>Navigation</code> structure.  </p>
<h4 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h4><p>Step-by-step troubleshooting revealed the root cause: Cold-starting the app with two <code>Navigation</code> components (splash screen and home page) sharing a <code>NavPathStack</code> caused the chat page to be repeatedly created and destroyed when navigating from the home page’s <code>aboutToAppear</code> before the splash screen’s <code>aboutToDisappear</code> completed. This invalidated event subscriptions (as the second page instance did not register event consumption logic). Solutions include delaying navigation, adjusting navigation timing until the splash screen is destroyed, or restructuring the splash screen as a non-<code>Navigation</code> to eliminate multi-<code>Navigation</code> coexistence. This case highlights the complexity of <code>Navigation</code> lifecycle management in HarmonyOS, emphasizing the need to strictly follow component mounting&#x2F;unmounting order in multi-page navigation to avoid lifecycle conflicts.  </p>
<blockquote>
<p>Reference: Component Navigation (Navigation) (Recommended): <a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-navigation-navigation#%E9%A1%B5%E9%9D%A2%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F">https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-navigation-navigation#%E9%A1%B5%E9%9D%A2%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F</a>  </p>
</blockquote>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/HarmonyOS-Next/" rel="tag"># HarmonyOS Next</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/06/24/HarmonyOS%20Next%20IM%20Combat:%20Sharing%20the%20Optimization%20Process%20for%20Slow%20Database%20Queries/" rel="prev" title="HarmonyOS Next IM Combat: Sharing the Optimization Process for Slow Database Queries">
      <i class="fa fa-chevron-left"></i> HarmonyOS Next IM Combat: Sharing the Optimization Process for Slow Database Queries
    </a></div>
      <div class="post-nav-item">
    <a href="/2025/06/24/HarmonyOS-Next-IM-Combat-Best-Practices-for-PushKit-in-Assisting-IM-Message-Notification-Scenarios/" rel="next" title="HarmonyOS Next IM Combat: Best Practices for PushKit in Assisting IM Message Notification Scenarios">
      HarmonyOS Next IM Combat: Best Practices for PushKit in Assisting IM Message Notification Scenarios <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#HarmonyOS-Next-IM-Combat-Functional-Anomaly-of-Event-Cancellation-Caused-by-Dual-Navigation-Lifecycles"><span class="nav-number">1.</span> <span class="nav-text">HarmonyOS Next IM Combat: Functional Anomaly of Event Cancellation Caused by Dual Navigation Lifecycles</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Background-Introduction"><span class="nav-number">1.0.0.1.</span> <span class="nav-text">Background Introduction</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Problem-Diagnosis"><span class="nav-number">1.0.0.2.</span> <span class="nav-text">Problem Diagnosis</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Solution"><span class="nav-number">1.0.0.3.</span> <span class="nav-text">Solution</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Summary"><span class="nav-number">1.0.0.4.</span> <span class="nav-text">Summary</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Qingkouwei</p>
  <div class="site-description" itemprop="description">Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">183</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Qingkouwei</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"harmonyostech.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="HarmonyOS Private Repository Construction PracticeBackgroundIn Android and iOS development, dependencies and collaboration often rely on binary artifacts. Android uses Maven as the repository, while i">
<meta property="og:type" content="article">
<meta property="og:title" content="HarmonyOS Private Repository Construction Practice">
<meta property="og:url" content="https://harmonyostech.github.io/2025/06/30/C-HarmonyOS-Private-Repository-Construction-Practice/index.html">
<meta property="og:site_name" content="HarmonyOS NEXT Knowledge Charging Station">
<meta property="og:description" content="HarmonyOS Private Repository Construction PracticeBackgroundIn Android and iOS development, dependencies and collaboration often rely on binary artifacts. Android uses Maven as the repository, while i">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-06-30T13:50:17.000Z">
<meta property="article:modified_time" content="2025-07-13T09:18:42.881Z">
<meta property="article:author" content="Qingkouwei">
<meta property="article:tag" content="HarmonyOS Next">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://harmonyostech.github.io/2025/06/30/C-HarmonyOS-Private-Repository-Construction-Practice/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>HarmonyOS Private Repository Construction Practice | HarmonyOS NEXT Knowledge Charging Station</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">HarmonyOS NEXT Knowledge Charging Station</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Analysis of Core Technologies and Application Scenarios of HarmonyOS NEXT</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://harmonyostech.github.io/2025/06/30/C-HarmonyOS-Private-Repository-Construction-Practice/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Qingkouwei">
      <meta itemprop="description" content="Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HarmonyOS NEXT Knowledge Charging Station">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          HarmonyOS Private Repository Construction Practice
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-06-30 21:50:17" itemprop="dateCreated datePublished" datetime="2025-06-30T21:50:17+08:00">2025-06-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-07-13 17:18:42" itemprop="dateModified" datetime="2025-07-13T17:18:42+08:00">2025-07-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/HarmonyOS-Next-Tech/" itemprop="url" rel="index"><span itemprop="name">HarmonyOS Next Tech</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="HarmonyOS-Private-Repository-Construction-Practice"><a href="#HarmonyOS-Private-Repository-Construction-Practice" class="headerlink" title="HarmonyOS Private Repository Construction Practice"></a>HarmonyOS Private Repository Construction Practice</h1><h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p>In Android and iOS development, dependencies and collaboration often rely on binary artifacts. Android uses Maven as the repository, while iOS uses CocoaPods. Developers can leverage open-source libraries on official platforms, significantly improving development efficiency. However, some company-specific business libraries are not intended for external use, making it unsafe to upload them to public repositories. Many companies build internal private repositories, which enhance security and accelerate artifact management.  </p>
<p>HarmonyOS faces similar challenges. While developers can easily use third-party artifacts from official repositories, internal business dependencies require private repositories. This article describes how to build a private repository using official tools.  </p>
<h2 id="Introduction-to-HarmonyOS-Shared-Packages"><a href="#Introduction-to-HarmonyOS-Shared-Packages" class="headerlink" title="Introduction to HarmonyOS Shared Packages"></a>Introduction to HarmonyOS Shared Packages</h2><p>HarmonyOS shared packages are categorized into static and dynamic types:  </p>
<ul>
<li><strong>HAR (Harmony Archive)</strong>: A static shared package containing code, C++ libraries, resources, and configuration files. HAR enables multiple modules or projects to share ArkUI components, resources, and related code. Unlike HAP, HAR cannot be independently installed or run on devices and can only be referenced as a dependency of application modules.  </li>
<li><strong>HSP (Harmony Shared Package)</strong>: A dynamic shared package. Static shared packages are packaged into each dependent HAP, leading to larger package sizes and duplicate resources&#x2F;code. Dynamic shared packages allow multiple HAPs to share common resources and code. HSP only supports in-application sharing, not cross-application sharing.</li>
</ul>
<h2 id="Building-a-Private-Repository-with-ohpm-repo"><a href="#Building-a-Private-Repository-with-ohpm-repo" class="headerlink" title="Building a Private Repository with ohpm-repo"></a>Building a Private Repository with ohpm-repo</h2><p>The official ohpm-repo tool helps developers quickly set up a lightweight ohpm private repository, compatible with the ohpm package manager. It caches dependencies on demand to accelerate installations in private networks.  </p>
<p>ohpm-repo supports single-point and multi-instance deployments:  </p>
<ul>
<li><strong>Single-point deployment</strong>: ohpm-repo runs on a single machine.  </li>
<li><strong>Multi-instance deployment</strong>: ohpm-repo is deployed across multiple machines with identical configurations and shared data storage.</li>
</ul>
<h3 id="Dependent-Environment-Installation"><a href="#Dependent-Environment-Installation" class="headerlink" title="Dependent Environment Installation"></a>Dependent Environment Installation</h3><ol>
<li>ohpm-repo relies on Node.js (version 16.x or higher). Install Node.js and configure the environment. Download Node.js from the official website (<a target="_blank" rel="noopener" href="https://nodejs.org/download/release/latest/">https://nodejs.org/download/release/latest/</a>).</li>
</ol>
<h3 id="Downloading-ohpm-repo"><a href="#Downloading-ohpm-repo" class="headerlink" title="Downloading ohpm-repo"></a>Downloading ohpm-repo</h3><ol>
<li>Download the ohpm-repo tool from: <a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-software-download-0000001507075446">https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-software-download-0000001507075446</a>  </li>
<li>Unzip the ohpm-repo package.</li>
</ol>
<h3 id="Configuring-ohpm-repo-Environment-Variables"><a href="#Configuring-ohpm-repo-Environment-Variables" class="headerlink" title="Configuring ohpm-repo Environment Variables"></a>Configuring ohpm-repo Environment Variables</h3><ol>
<li>Add the path to the <code>bin</code> directory in the unzipped ohpm-repo package to the system environment variable <code>PATH</code>:<br><code>export PATH=$OHPM-REPO-PATH/bin:$PATH</code>  </li>
<li>Verify the installation by running <code>ohpm-repo -v</code> to check the version.</li>
</ol>
<h3 id="Configuring-the-ohpm-repo-Service-Configuration-File"><a href="#Configuring-the-ohpm-repo-Service-Configuration-File" class="headerlink" title="Configuring the ohpm-repo Service Configuration File"></a>Configuring the ohpm-repo Service Configuration File</h3><p>Go to the <code>conf</code> directory in the unzipped package and open <code>config.yaml</code>. The default configuration is as follows:  </p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##### server configuration section #####</span></span><br><span class="line"><span class="attr">listen:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span><span class="string">:8088</span></span><br><span class="line"><span class="comment"># listen:</span></span><br><span class="line"><span class="comment"># - localhost:8088            # 监听本机环回地址</span></span><br><span class="line"><span class="comment"># - http://localhost:8088     # 监听本机环回地址</span></span><br><span class="line"><span class="comment"># - 0.0.0.0:8088              # 监听本机所有地址 (INADDR_ANY)</span></span><br><span class="line"><span class="comment"># 协议可配置 http 或者 https，默认为 http</span></span><br><span class="line"><span class="comment"># port: 1-65535(Windows系统)/ 1024-65535(Linux或Mac系统）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可选 (listen 为 https 协议时必须配置)</span></span><br><span class="line"><span class="attr">https_key:</span> <span class="string">&#x27;&#x27;</span>                 <span class="comment"># https 服务使用的 key 的路径  (不配置默认为&#x27;&#x27;)</span></span><br><span class="line"><span class="attr">https_cert:</span> <span class="string">&#x27;&#x27;</span>                <span class="comment"># https 服务使用的 crt 的路径  (不配置默认为&#x27;&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##### server deploy root section #####</span></span><br><span class="line"><span class="attr">deploy_root:</span> <span class="string">&#x27;&#x27;</span>                <span class="comment"># 安装根目录 (不配置默认为 `&lt;现有用户home目录&gt;/ohpm-repo`)，只支持绝对路径，且路径目录必须存在</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##### server numeric limit section #####</span></span><br><span class="line"><span class="attr">max_package_size:</span> <span class="number">100</span>          <span class="comment"># 上传包大小限制，单位是MB (0, 100]，不配置默认为 100</span></span><br><span class="line"><span class="attr">max_extract_size:</span> <span class="number">500</span>          <span class="comment"># 压缩包解压后大小限制，单位是MB [max_package_size, 500]，不配置默认为 500</span></span><br><span class="line"><span class="attr">max_extract_file_num:</span> <span class="number">10240</span>    <span class="comment"># 压缩包解压后文件个数限制 (0, 102400]，不配置默认为 10240</span></span><br><span class="line"><span class="attr">user_rate_limit:</span> <span class="number">100</span>           <span class="comment"># 用户访问频率控制，单位是次/s (0, 10000]，不配置默认为 100</span></span><br><span class="line"><span class="attr">fetch_timeout:</span> <span class="number">60</span>              <span class="comment"># 请求/响应的超时时间，单位是秒 (0, 3600]，不配置默认为 60</span></span><br><span class="line"><span class="attr">keep_alive_timeout:</span> <span class="number">60</span>         <span class="comment"># TCP 保持连接的超时时间，单位是秒 (0, 3600]，不配置默认为 60</span></span><br><span class="line"><span class="attr">api_timeout:</span> <span class="number">60</span>                <span class="comment"># api超时时间，单位是秒(0, 3600]，不配置默认为 60</span></span><br><span class="line"><span class="attr">upload_lock_hour:</span> <span class="number">24</span>           <span class="comment"># 下架某一三方包所有版本后，限时禁止同名三方包上传，单位是小时 (0, 168]，不配置，默认为 24</span></span><br><span class="line"><span class="attr">upload_max_times:</span> <span class="number">100</span>          <span class="comment"># 单用户24小时内上传次数限制 (0, 10000]，不配置默认为 100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##### metadata storage section #####</span></span><br><span class="line"><span class="comment">## 数据存储类型 filedb 和 mysql 二选一，不可都配置</span></span><br><span class="line"><span class="attr">db:</span>                         <span class="comment"># 必须用 yaml 数组形式写法</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">filedb</span></span><br><span class="line">  <span class="attr">config:</span>                   <span class="comment"># 如果想修改存储路径且保留旧的数据，则需要把旧路径下的数据文件迁移至新路径</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">./db</span>              <span class="comment"># 本地数据存储路径，不配置默认为&lt;deploy_root&gt;/db;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#db:                        # 必须用yaml数组形式写法</span></span><br><span class="line"><span class="comment">#  type: mysql</span></span><br><span class="line"><span class="comment">#  config:</span></span><br><span class="line"><span class="comment">#    host: &quot;localhost&quot;      # 数据库主机地址</span></span><br><span class="line"><span class="comment">#    port: 3306             # 数据库端口 (0,65535]</span></span><br><span class="line"><span class="comment">#    username: root         # 数据库的用户名</span></span><br><span class="line"><span class="comment">#    password: &quot;password&quot;   # 数据库的用户密码（请配置明文, 最终在部署目录中会转换为密文）</span></span><br><span class="line"><span class="comment">#    database: &quot;repo&quot;       # 数据库名</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##### storage section #####</span></span><br><span class="line"><span class="comment">## 文件存储类型fs,sftp 和 custom 三选一，不可多选。</span></span><br><span class="line"></span><br><span class="line"><span class="attr">store:</span>                               <span class="comment"># 必须用 yaml 数组形式写法</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">fs</span></span><br><span class="line">  <span class="attr">config:</span>                            <span class="comment"># 上传资源后如若要修改存储路径，则需要把旧路径下的数据迁移至新路径中</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">./storage</span>                  <span class="comment"># 已上架三方库存储路径，不配置默认为 &lt;deploy_root&gt;/storage;</span></span><br><span class="line">    <span class="comment">#server: http://localhost:8088   # 三方库下载链接，不配置默认取值</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件存储类型为 sftp 时，最多配置三个 sftp服务</span></span><br><span class="line"><span class="comment">#store:                               # 必须用 yaml 数组形式写法</span></span><br><span class="line"><span class="comment">#  type: sftp                         # 当且仅当 db 的类型为 mysql 时，store 的类型才能为 sftp</span></span><br><span class="line"><span class="comment">#  config:</span></span><br><span class="line"><span class="comment">#    location:</span></span><br><span class="line"><span class="comment">#      -</span></span><br><span class="line"><span class="comment">#        name: test_one_sftp          # 主机名字，名字不能与其他sftp配置重复</span></span><br><span class="line"><span class="comment">#        host: &quot;localhost&quot;            # 主机地址</span></span><br><span class="line"><span class="comment">#        port: 22                     # 主机端口 (0,65535]</span></span><br><span class="line"><span class="comment">#        read_username: &quot;read&quot;        # 主机有读权限的用户名字</span></span><br><span class="line"><span class="comment">#        read_password: &quot;password&quot;    # 主机有读权限的用户密码（请配置明文, 最终在部署目录中会转换为密文）</span></span><br><span class="line"><span class="comment">#        write_username: &quot;write&quot;      # 主机有写权限的用户名字</span></span><br><span class="line"><span class="comment">#        write_password: &quot;password&quot;   # 主机有写权限的用户密码（请配置明文, 最终在部署目录中会转换为密文）</span></span><br><span class="line"><span class="comment">#        path: /source22              # 相对 sftp 根目录的文件路径，仅限/开头，且路径文件夹必须存在</span></span><br><span class="line"><span class="comment">#      -</span></span><br><span class="line"><span class="comment">#        name: test_two_sftp</span></span><br><span class="line"><span class="comment">#        host: &quot;localhost&quot;</span></span><br><span class="line"><span class="comment">#        port: 24</span></span><br><span class="line"><span class="comment">#        read_username: &quot;read&quot;</span></span><br><span class="line"><span class="comment">#        read_password: &quot;password&quot;</span></span><br><span class="line"><span class="comment">#        write_username: &quot;write&quot;</span></span><br><span class="line"><span class="comment">#        write_password: &quot;password&quot;</span></span><br><span class="line"><span class="comment">#        path: /source24</span></span><br><span class="line"><span class="comment">#    #server: http://localhost:8088   # 本地仓库下载链接地址，不配置默认取 listen 的值、</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#store:</span></span><br><span class="line"><span class="comment">#  type: custom                                            # custom是自定义存储插件类型，自定义存储插件开发流程见指导文档</span></span><br><span class="line"><span class="comment">#  config:</span></span><br><span class="line"><span class="comment">#    export_name: CustomStorage                            # 插件export的类名</span></span><br><span class="line"><span class="comment">#    plugin_path: ../plugins/CustomStorage.js              # 插件的绝对路径或者相对于ohpm-repo软件包的路径，建议将插件放在软件包的plugins目录下</span></span><br><span class="line"><span class="comment">#    custom_field: &quot;test&quot;                                  # 自定义字段，通过引入libs/common/getStorageConfigInfo.js的getStorageConfigInfo方法获取自定义字段的值</span></span><br><span class="line"><span class="comment">#    #server: http://localhost:8088                        # 本地仓库下载链接地址，不配置默认取listen的值</span></span><br><span class="line"><span class="comment">##### uplink section #####</span></span><br><span class="line"><span class="attr">uplink_cache_path:</span> <span class="string">./uplink</span>      <span class="comment"># 缓存路径，不配置默认为 &lt;deploy_root&gt;/uplink</span></span><br><span class="line"><span class="attr">uplink_cache_time:</span> <span class="number">168</span>           <span class="comment"># 远程包 metadata 缓存时间，单位为小时，默认 168 小时，取值范围为 (0, 8760]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##### log section #####</span></span><br><span class="line"><span class="attr">logs_path:</span> <span class="string">./logs</span>                <span class="comment"># 日志路径，不配置默认为 &lt;deploy_root&gt;/logs</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##### log level section #####</span></span><br><span class="line"><span class="comment"># 日志级别: 级别由低到高分别是 all、trace、debug、info、warn、error、fatal、mark、off</span></span><br><span class="line"><span class="comment"># run，operate 和 access 不配置或者配置错误，默认为 info</span></span><br><span class="line"><span class="attr">loglevel_run:</span> <span class="string">info</span></span><br><span class="line"><span class="attr">loglevel_operate:</span> <span class="string">info</span></span><br><span class="line"><span class="attr">loglevel_access:</span> <span class="string">info</span></span><br></pre></td></tr></table></figure>

<p>The configuration includes listening ports, HTTPS settings, private repository deployment directory <code>deploy_root</code>, server configurations, storage settings <code>db</code>, logs, etc. Configure them according to actual needs.  </p>
<p><strong>Storage module notes</strong>:  </p>
<ul>
<li><code>db</code> configures metadata storage, supporting fileDB (local) or MySQL.  </li>
<li><code>store</code> configures file storage, supporting local storage, SFTP storage, or custom plugin storage.</li>
</ul>
<p><strong>How to modify the configuration file after the private repository starts successfully</strong>:  </p>
<ul>
<li>If the configuration file was specified during the first startup with the <code>install</code> command: Modify the specified configuration file, then re-run <code>install</code> with the updated file and start the repository.  </li>
<li>If no configuration file was specified during the first startup: Modify the configuration file in the <code>conf</code> directory of the unzipped package, then re-run <code>install</code> and <code>start</code>.</li>
</ul>
<h3 id="Installation-and-Startup"><a href="#Installation-and-Startup" class="headerlink" title="Installation and Startup"></a>Installation and Startup</h3><p>Run <code>ohpm-repo install</code> to install. After installation, configure environment variables as needed, then start the service with <code>ohpm-repo start</code>.  </p>
<h2 id="Using-Private-Repository-Shared-Packages"><a href="#Using-Private-Repository-Shared-Packages" class="headerlink" title="Using Private Repository Shared Packages"></a>Using Private Repository Shared Packages</h2><p>By default, the ohpm client pulls dependencies only from the official public repository. To pull from a private repository, use one of the following configurations:  </p>
<ol>
<li>Configure the private repository for all projects:<br><code>ohpm config set registry &lt;private_repo_address&gt;/repos/ohpm</code>  </li>
<li>Configure for a specific dependency installation:<br><code>ohpm install @ohos/lottie --registry &lt;private_repo_address&gt;/repos/ohpm</code></li>
</ol>
<p>The <strong>private_repo_address</strong> is the <code>store.config.server</code> address in the configuration file. For example, if <code>store.config.server</code> is <code>http://127.0.0.1:8088</code>, the registry is <code>http://127.0.0.1:8088/repos/ohpm</code>. If <code>store.config.server</code> is not configured, use the default value.  </p>
<h2 id="Publishing-Shared-Packages"><a href="#Publishing-Shared-Packages" class="headerlink" title="Publishing Shared Packages"></a>Publishing Shared Packages</h2><p>Local shared packages (both static and dynamic) can be published via ohpm commands or a web interface. Command-line publishing is typically preferred for efficiency:  </p>
<ol>
<li>Generate an SSH key locally:<br><code>ssh-keygen -m PEM -t RSA -b 4096 -f &lt;your_key_path&gt;</code>  </li>
<li>Log in to the ohpm-repo management interface, go to Profile, add a public key, and paste the content of <code>&lt;your_key_path&gt;.pub</code>.  </li>
<li>Set the private key path:<br><code>ohpm config set key_path &lt;your_key_path&gt;</code>  </li>
<li>Log in to the ohpm-repo management interface, copy the publish ID from Profile.  </li>
<li>Configure the publish ID in <code>.ohpmrc</code>:<br><code>ohpm config set publish_id &lt;your_publish_id&gt;</code>  </li>
<li>Publish a static shared library:<br><code>ohpm publish demo.har</code>  </li>
<li>Publish a dynamic shared package:<br><code>ohpm publish demo.tgz</code>  <ul>
<li>HSP packages cannot be published directly; convert them to <code>.tgz</code> first.  </li>
<li>Switch to release mode during compilation to generate <code>.tgz</code> packages.</li>
</ul>
</li>
</ol>
<h3 id="Module-Configuration"><a href="#Module-Configuration" class="headerlink" title="Module Configuration"></a>Module Configuration</h3><p>In the library module (at the same level as the <code>src</code> folder), add the following files:  </p>
<ul>
<li><strong>README.md</strong>: Must include package introduction and usage. Add detailed descriptions as needed.  </li>
<li><strong>CHANGELOG.md</strong>: Record version updates for the HAR.  </li>
<li><strong>LICENSE</strong>: License file.</li>
</ul>
<p>The README.md is displayed on the private repository web platform, so clear documentation is essential.  </p>
<p><strong>oh_package.json5 configuration example</strong>:  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;  </span><br><span class="line">    &quot;parameterFile&quot;: &quot;../dependencies.json5&quot;,  </span><br><span class="line">    &quot;keywords&quot;: [  </span><br><span class="line">        &quot;asr&quot;  </span><br><span class="line">    ],  </span><br><span class="line">    &quot;name&quot;: &quot;@xx/base-asr&quot;,  </span><br><span class="line">    &quot;version&quot;: &quot;1.0.0-rc.9&quot;,  </span><br><span class="line">    &quot;repository&quot;: &quot;http://gerrit.google.com/mobile_harmony/base_asr&quot;,  </span><br><span class="line">    &quot;description&quot;: &quot;asr sdk&quot;,  </span><br><span class="line">    &quot;main&quot;: &quot;Index.ets&quot;,  </span><br><span class="line">    &quot;author&quot;: &quot;qingkouwei&quot;,  </span><br><span class="line">    &quot;license&quot;: &quot;Apache-2.0&quot;,  </span><br><span class="line">    &quot;dependencies&quot;: &#123;  </span><br><span class="line">        </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Module name, version, and description must meet requirements; otherwise, uploads will fail. Version numbers must increase sequentially (unlike Android’s SNAPSHOT overwrite capability).  </p>
<h2 id="Best-Practices"><a href="#Best-Practices" class="headerlink" title="Best Practices"></a>Best Practices</h2><p>In practical development, projects with multiple SDKs may require frequent uploads to the private repository for debugging. Manually compiling and uploading each SDK is tedious, especially when SDKs have dependencies.  </p>
<p>The optimal solution is to use scripts for one-click compilation, upload, and dependency-ordered publishing:  </p>
<ol>
<li>Create <code>version.json5</code> to store SDK versions:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;  </span><br><span class="line">  &quot;project&quot;: &#123;  </span><br><span class="line">    &quot;sdk_version&quot;: &quot;1.1.0-rc.1&quot;,  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>Automatic packaging script:</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">run_commands</span>(<span class="params">modulename, productname</span>):  </span><br><span class="line">    hvigor_home = <span class="string">&#x27;/Applications/DevEco-Studio.app/Contents/tools/hvigor&#x27;</span>  </span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 打包命令</span></span><br><span class="line">    command1 = <span class="string">&#x27;node %s/bin/hvigorw.js --mode module -p product=default -p module=%s@default -p buildMode=debug assembleHar --analyze --parallel --incremental --daemon&#x27;</span> %(hvigor_home,modulename)  </span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 等待第一个命令执行完成  </span></span><br><span class="line">    process1.wait()  </span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 上传命令  </span></span><br><span class="line">    ohpm publish productname</span><br><span class="line">    process2.wait()</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>Automatic version update script:</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">changeVersionAModule</span>():  </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;version.json5&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">        data = json5.load(f)  </span><br><span class="line">        versionName = data[<span class="string">&#x27;project&#x27;</span>][<span class="string">&#x27;sdk_version&#x27;</span>]  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;AModule/oh-package.json5&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">            aData = json5.load(f)  </span><br><span class="line">            aData[<span class="string">&#x27;version&#x27;</span>] = versionName  </span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;AModule/oh-package.json5&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:  </span><br><span class="line">                json.dump(aData, f, indent=<span class="number">4</span>)  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;dependencies.json5&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> depf:  </span><br><span class="line">            depData = json5.load(depf)  </span><br><span class="line">            depData[<span class="string">&#x27;version_base&#x27;</span>][<span class="string">&#x27;base-a&#x27;</span>] = versionName  </span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;dependencies.json5&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> depf:  </span><br><span class="line">                json.dump(depData, depf, indent=<span class="number">4</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>This article introduces the construction of HarmonyOS private repositories, the dependency and publishing process for shared packages, and best practices for one-click packaging&#x2F;uploading in complex module dependency scenarios.  </p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/ide-har-publish-0000001597973129-V5">Publishing Shared Packages</a>  </li>
<li><a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/ide-ohpm-repo-0000001749596668-V5">ohpm-repo Private Repository Tool</a></li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/HarmonyOS-Next/" rel="tag"># HarmonyOS Next</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/06/30/C-HarmonyOS-Next-Layout-Practice-1-Implementation-of-Common-TitleBar/" rel="prev" title="HarmonyOS Next Layout Practice 1: Implementation of Common TitleBar">
      <i class="fa fa-chevron-left"></i> HarmonyOS Next Layout Practice 1: Implementation of Common TitleBar
    </a></div>
      <div class="post-nav-item">
    <a href="/2025/06/30/C-HarmonyOS-Audio-Video-Audio-Capture-Practice/" rel="next" title="HarmonyOS Audio-Video: Audio Capture Practice">
      HarmonyOS Audio-Video: Audio Capture Practice <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#HarmonyOS-Private-Repository-Construction-Practice"><span class="nav-number">1.</span> <span class="nav-text">HarmonyOS Private Repository Construction Practice</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Background"><span class="nav-number">1.1.</span> <span class="nav-text">Background</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Introduction-to-HarmonyOS-Shared-Packages"><span class="nav-number">1.2.</span> <span class="nav-text">Introduction to HarmonyOS Shared Packages</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Building-a-Private-Repository-with-ohpm-repo"><span class="nav-number">1.3.</span> <span class="nav-text">Building a Private Repository with ohpm-repo</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Dependent-Environment-Installation"><span class="nav-number">1.3.1.</span> <span class="nav-text">Dependent Environment Installation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Downloading-ohpm-repo"><span class="nav-number">1.3.2.</span> <span class="nav-text">Downloading ohpm-repo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configuring-ohpm-repo-Environment-Variables"><span class="nav-number">1.3.3.</span> <span class="nav-text">Configuring ohpm-repo Environment Variables</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Configuring-the-ohpm-repo-Service-Configuration-File"><span class="nav-number">1.3.4.</span> <span class="nav-text">Configuring the ohpm-repo Service Configuration File</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Installation-and-Startup"><span class="nav-number">1.3.5.</span> <span class="nav-text">Installation and Startup</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Using-Private-Repository-Shared-Packages"><span class="nav-number">1.4.</span> <span class="nav-text">Using Private Repository Shared Packages</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Publishing-Shared-Packages"><span class="nav-number">1.5.</span> <span class="nav-text">Publishing Shared Packages</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Module-Configuration"><span class="nav-number">1.5.1.</span> <span class="nav-text">Module Configuration</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Best-Practices"><span class="nav-number">1.6.</span> <span class="nav-text">Best Practices</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Summary"><span class="nav-number">1.7.</span> <span class="nav-text">Summary</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#References"><span class="nav-number">1.8.</span> <span class="nav-text">References</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Qingkouwei</p>
  <div class="site-description" itemprop="description">Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">364</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Qingkouwei</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>

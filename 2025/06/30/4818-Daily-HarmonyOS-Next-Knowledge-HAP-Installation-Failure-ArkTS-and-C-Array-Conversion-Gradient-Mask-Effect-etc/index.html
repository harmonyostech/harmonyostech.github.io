<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"harmonyostech.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="[Daily HarmonyOS Next Knowledge] HAP Installation Failure, ArkTS and C++ Array Conversion, Gradient Mask Effect, etc.1. When starting debugging or running an application&#x2F;service, an error occurs">
<meta property="og:type" content="article">
<meta property="og:title" content="[Daily HarmonyOS Next Knowledge] HAP Installation Failure, ArkTS and C++ Array Conversion, Gradient Mask Effect, etc.">
<meta property="og:url" content="https://harmonyostech.github.io/2025/06/30/4818-Daily-HarmonyOS-Next-Knowledge-HAP-Installation-Failure-ArkTS-and-C-Array-Conversion-Gradient-Mask-Effect-etc/index.html">
<meta property="og:site_name" content="HarmonyOS NEXT Knowledge Charging Station">
<meta property="og:description" content="[Daily HarmonyOS Next Knowledge] HAP Installation Failure, ArkTS and C++ Array Conversion, Gradient Mask Effect, etc.1. When starting debugging or running an application&#x2F;service, an error occurs">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-06-30T09:21:40.000Z">
<meta property="article:modified_time" content="2025-06-30T09:22:07.897Z">
<meta property="article:author" content="Qingkouwei">
<meta property="article:tag" content="HarmonyOS Next">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://harmonyostech.github.io/2025/06/30/4818-Daily-HarmonyOS-Next-Knowledge-HAP-Installation-Failure-ArkTS-and-C-Array-Conversion-Gradient-Mask-Effect-etc/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>[Daily HarmonyOS Next Knowledge] HAP Installation Failure, ArkTS and C++ Array Conversion, Gradient Mask Effect, etc. | HarmonyOS NEXT Knowledge Charging Station</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">HarmonyOS NEXT Knowledge Charging Station</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Analysis of Core Technologies and Application Scenarios of HarmonyOS NEXT</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://harmonyostech.github.io/2025/06/30/4818-Daily-HarmonyOS-Next-Knowledge-HAP-Installation-Failure-ArkTS-and-C-Array-Conversion-Gradient-Mask-Effect-etc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Qingkouwei">
      <meta itemprop="description" content="Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HarmonyOS NEXT Knowledge Charging Station">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          [Daily HarmonyOS Next Knowledge] HAP Installation Failure, ArkTS and C++ Array Conversion, Gradient Mask Effect, etc.
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-06-30 17:21:40 / Modified: 17:22:07" itemprop="dateCreated datePublished" datetime="2025-06-30T17:21:40+08:00">2025-06-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Daily-HarmonyOS-Next-Knowledge/" itemprop="url" rel="index"><span itemprop="name">Daily HarmonyOS Next Knowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="Daily-HarmonyOS-Next-Knowledge-HAP-Installation-Failure-ArkTS-and-C-Array-Conversion-Gradient-Mask-Effect-etc"><a href="#Daily-HarmonyOS-Next-Knowledge-HAP-Installation-Failure-ArkTS-and-C-Array-Conversion-Gradient-Mask-Effect-etc" class="headerlink" title="[Daily HarmonyOS Next Knowledge] HAP Installation Failure, ArkTS and C++ Array Conversion, Gradient Mask Effect, etc."></a>[Daily HarmonyOS Next Knowledge] HAP Installation Failure, ArkTS and C++ Array Conversion, Gradient Mask Effect, etc.</h1><h2 id="1-When-starting-debugging-or-running-an-application-service-an-error-occurs-during-HAP-installation-with-the-message-“error-install-failed-due-to-older-sdk-version-in-the-device”"><a href="#1-When-starting-debugging-or-running-an-application-service-an-error-occurs-during-HAP-installation-with-the-message-“error-install-failed-due-to-older-sdk-version-in-the-device”" class="headerlink" title="1. When starting debugging or running an application&#x2F;service, an error occurs during HAP installation with the message “error: install failed due to older sdk version in the device”."></a>1. When starting debugging or running an application&#x2F;service, an error occurs during HAP installation with the message “error: install failed due to older sdk version in the device”.</h2><p>This is caused by a mismatch between the SDK version used for compilation and packaging and the device image version. Mismatch scenarios include:  </p>
<p><strong>Scenario 1</strong>: The device image version is lower than the SDK version used for compilation. Update the device image version. Command to query the device image version:  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br></pre></td><td class="code"><pre><span class="line">hdc shell param get const.ohos.apiversion</span><br><span class="line">```  </span><br><span class="line">If the API version provided by the image is 10 and the SDK version used for application compilation is also 10, but the error still occurs, it may be because the image version is too low to comply with the new SDK verification rules. Update the image version to the latest.  </span><br><span class="line"></span><br><span class="line">**Scenario 2**: For applications that need to run on OpenHarmony devices, confirm that `runtimeOS` has been changed to OpenHarmony.  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 2. When starting debugging or running an application/service, an error occurs during HAP installation with the message &quot;error: install sign info inconsistent&quot;.  </span><br><span class="line">This is due to inconsistent signatures between the installed application on the device and the new application to be installed. If &quot;Keep Application Data&quot; (overwrite installation without uninstalling the application) is checked in Edit Configurations and the signature is renewed, this error will occur.  </span><br><span class="line"></span><br><span class="line">**Solution**: Uninstall the installed application on the device, or uncheck &quot;Keep Application Data&quot; and reinstall the new application.  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 3. How to integrate RichEditor and a Component as a whole?  </span><br><span class="line">There is a Component above RichEditor, and the goal is to integrate RichEditor and the Component to enable adaptive scrolling based on the cursor position. Currently, using a Scroller cannot obtain the specific coordinates of the cursor in RichEditor (cursor x and y positions relative to RichEditor), making scrolling impossible.  </span><br><span class="line"></span><br><span class="line">**Solution**: Wrap RichEditor and the Component with a Scroll component. Use the `onAreaChange` callback to call `scroller.scrollBy` to adjust the height of the scrolling component.  </span><br><span class="line"></span><br><span class="line">**Reference code**:  </span><br><span class="line">```typescript</span><br><span class="line">@Entry</span><br><span class="line">@Component</span><br><span class="line">struct Index &#123;</span><br><span class="line">  editorController = new RichEditorController()</span><br><span class="line">  scroller: Scroller = new Scroller()</span><br><span class="line"></span><br><span class="line">  build() &#123;</span><br><span class="line">    Column() &#123;</span><br><span class="line">      Scroll(this.scroller) &#123;</span><br><span class="line">        Column() &#123;</span><br><span class="line">          Image($r(&#x27;app.media.startIcon&#x27;))</span><br><span class="line">            .width(&#x27;100%&#x27;)</span><br><span class="line">            .height(200)</span><br><span class="line">            .margin(&#123; bottom: 20 &#125;)</span><br><span class="line">          RichEditor(&#123; controller: this.editorController &#125;)</span><br><span class="line">            .id(&#x27;RichEditor&#x27;)</span><br><span class="line">            .width(&#x27;100%&#x27;)</span><br><span class="line">            .backgroundColor(Color.Yellow)</span><br><span class="line">            .onReady(() =&gt; &#123;</span><br><span class="line">              this.editorController.addImageSpan($r(&quot;app.media.startIcon&quot;),</span><br><span class="line">                &#123;</span><br><span class="line">                  imageStyle:</span><br><span class="line">                  &#123;</span><br><span class="line">                    size: [&quot;100px&quot;, &quot;100px&quot;]</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">              this.editorController.addTextSpan(&#x27;男生女生向前冲&#x27;,</span><br><span class="line">                &#123;</span><br><span class="line">                  style:</span><br><span class="line">                  &#123;</span><br><span class="line">                    fontColor: Color.Blue,</span><br><span class="line">                    fontSize: 30</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">            .onAreaChange((_, value) =&gt; &#123;</span><br><span class="line">              if (_.height !== value.height) &#123;</span><br><span class="line">                this.scroller.scrollBy(0, Number(value.height) - 200)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">          Button(&#x27;getSpans-文字&#x27;).onClick((event: ClickEvent) =&gt; &#123;</span><br><span class="line">            let getSpans = this.editorController.getSpans(&#123; start: 0 &#125;)</span><br><span class="line">            // Type casting is required to obtain text or image information</span><br><span class="line">            let span0 = getSpans[0] as RichEditorTextSpanResult</span><br><span class="line">          &#125;)</span><br><span class="line">          Button(&#x27;getSpans-图片&#x27;).onClick((event: ClickEvent) =&gt; &#123;</span><br><span class="line">            let getSpans = this.editorController.getSpans(&#123; start: 0 &#125;)</span><br><span class="line">            let span1 = getSpans[1] as RichEditorImageSpanResult</span><br><span class="line">          &#125;)</span><br><span class="line">          Button(&#x27;RichEditor获焦&#x27;).onClick(() =&gt; &#123;</span><br><span class="line">            focusControl.requestFocus(&#x27;RichEditor&#x27;)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      .scrollable(ScrollDirection.Vertical) // Vertical scrolling direction</span><br><span class="line">      .scrollBar(BarState.On) // Scrollbar always visible</span><br><span class="line">      .scrollBarColor(Color.Gray) // Scrollbar color</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 4. How to implement array conversion between ArkTS and C/C++?  </span><br><span class="line">### TS2NAPI  </span><br><span class="line">**TS-side code**:  </span><br><span class="line">```typescript</span><br><span class="line">Button(&quot;TS2NAPI&quot;)</span><br><span class="line">  .fontSize(50)</span><br><span class="line">  .fontWeight(FontWeight.Bold)</span><br><span class="line">  .onClick(() =&gt; &#123;</span><br><span class="line">    let napiArray: Int32Array = new Int32Array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</span><br><span class="line">    console.info(&quot;TS2NAPI: JS   &quot; + napiArray)</span><br><span class="line">    testNapi.TS2NAPI(napiArray)</span><br><span class="line">  &#125;)</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">**NAPI-side code**:  </span><br><span class="line">```cpp</span><br><span class="line">// Transmit TS array to NAPI layer</span><br><span class="line">static napi_value TS2NAPI(napi_env env, napi_callback_info info) &#123;</span><br><span class="line">  // Get parameters from TS layer</span><br><span class="line">  size_t argc = 1;</span><br><span class="line">  napi_value args;</span><br><span class="line">  napi_get_cb_info(env, info, &amp;argc, &amp;args, NULL, NULL);</span><br><span class="line">  napi_value input_array = args;</span><br><span class="line"></span><br><span class="line">  // Get typedarray information to generate input_buffer</span><br><span class="line">  napi_typedarray_type type; // Data type</span><br><span class="line">  napi_value input_buffer;</span><br><span class="line">  size_t byte_offset; // Data offset</span><br><span class="line">  size_t i, length;   // Data byte size</span><br><span class="line">  napi_get_typedarray_info(env, input_array, &amp;type, &amp;length, NULL, &amp;input_buffer, &amp;byte_offset);</span><br><span class="line"></span><br><span class="line">  // Get array data</span><br><span class="line">  void *data;</span><br><span class="line">  size_t byte_length;</span><br><span class="line">  napi_get_arraybuffer_info(env, input_buffer, &amp;data, &amp;byte_length);</span><br><span class="line"></span><br><span class="line">  if (type == napi_int32_array) &#123;</span><br><span class="line">    int32_t *data_bytes = (int32_t *)(data);</span><br><span class="line">    int32_t num = length / sizeof(int32_t);</span><br><span class="line"></span><br><span class="line">    string str = &quot;&quot;;</span><br><span class="line">    for (int32_t i = 0; i &lt; num; i++) &#123;</span><br><span class="line">      int32_t tmp = *((int32_t *)(data_bytes) + i);</span><br><span class="line">      str += (to_string(tmp) + &#x27; &#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    OH_LOG_INFO(LOG_APP, &quot;TS2NAPI: C++  %&#123;public&#125;s&quot;, str.c_str());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return NULL;</span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">### NAPI2TS  </span><br><span class="line">**TS-side code**:  </span><br><span class="line">```typescript</span><br><span class="line">Button(&quot;NAPI2TS&quot;)</span><br><span class="line">  .fontSize(50)</span><br><span class="line">  .fontWeight(FontWeight.Bold)</span><br><span class="line">  .onClick(() =&gt; &#123;</span><br><span class="line">    let napiArray: Int32Array = testNapi.NAPI2TS()</span><br><span class="line">    console.info(&quot;NAPI2TS: JS   &quot; + napiArray)</span><br><span class="line">  &#125;)</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">**NAPI-side code**:  </span><br><span class="line">```cpp</span><br><span class="line">// Transmit NAPI layer array to TS layer</span><br><span class="line">static napi_value NAPI2TS(napi_env env, napi_callback_info info) &#123;</span><br><span class="line">  // Number of data items</span><br><span class="line">  int num = 10;</span><br><span class="line"></span><br><span class="line">  // Create output_buffer</span><br><span class="line">  napi_value output_buffer;</span><br><span class="line">  void *output_ptr = NULL;</span><br><span class="line">  napi_create_arraybuffer(env, num * sizeof(int32_t), &amp;output_ptr, &amp;output_buffer);</span><br><span class="line"></span><br><span class="line">  // Create output_array</span><br><span class="line">  napi_value output_array;</span><br><span class="line">  napi_create_typedarray(env, napi_int32_array, num, output_buffer, 0, &amp;output_array);</span><br><span class="line"></span><br><span class="line">  // Assign values to output_ptr and output_buffer</span><br><span class="line">  int32_t *output_bytes = (int32_t *)output_ptr;</span><br><span class="line">  for (int32_t i = 0; i &lt; num; i++) &#123;</span><br><span class="line">    output_bytes[i] = i;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  string str = &quot;&quot;;</span><br><span class="line">  for (int32_t i = 0; i &lt; num; i++) &#123;</span><br><span class="line">    int32_t tmp = *((int32_t *)(output_ptr) + i);</span><br><span class="line">    str += (to_string(tmp) + &#x27; &#x27;);</span><br><span class="line">  &#125;</span><br><span class="line">  OH_LOG_INFO(LOG_APP, &quot;NAPI2TS: C++  %&#123;public&#125;s&quot;, str.c_str());</span><br><span class="line"></span><br><span class="line">  return output_array;</span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">### Practical scenario:  </span><br><span class="line">ArkTS reads a rawfile image, transmits it to the NAPI layer for processing, and then returns it to ArkTS for display:  </span><br><span class="line">```typescript</span><br><span class="line">Button(&quot;Test&quot;)</span><br><span class="line">  .fontSize(50)</span><br><span class="line">  .fontWeight(FontWeight.Bold)</span><br><span class="line">  .onClick(() =&gt; &#123;</span><br><span class="line"></span><br><span class="line">    getContext().resourceManager.getRawFileContent(&#x27;test.png&#x27;).then(value =&gt; &#123;</span><br><span class="line">      hilog.info(0x0000, &#x27;getRawFileContent&#x27;, &#x27;%&#123;public&#125;s&#x27;, &#x27;OK&#x27;);</span><br><span class="line">      const fileData: Uint8Array = value;</span><br><span class="line">      // Get the ArrayBuffer of the image</span><br><span class="line">      let buffer = fileData.buffer;</span><br><span class="line"></span><br><span class="line">      let input = new Uint8Array(buffer)</span><br><span class="line">      let output = testNapi.TEST(input);</span><br><span class="line"></span><br><span class="line">      let decodingOptions: image.DecodingOptions = &#123;</span><br><span class="line">        editable: true,</span><br><span class="line">        desiredPixelFormat: 3,</span><br><span class="line">      &#125;</span><br><span class="line">      let imageSource = image.createImageSource(output.buffer);</span><br><span class="line">      imageSource.createPixelMap(decodingOptions).then(map =&gt; &#123;</span><br><span class="line">        this.imageSrc = map;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;).catch((err: BusinessError) =&gt; &#123;</span><br><span class="line">      hilog.error(0x0000, &#x27;getRawFileContent&#x27;, &#x27;%&#123;public&#125;s&#x27;, err.message);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">Image(this.imageSrc)</span><br><span class="line">  .height(100)</span><br><span class="line">  .width(100)</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 5. How to implement a top gradient mask effect?  </span><br><span class="line">How to implement a gradient mask effect for the bullet comment list at the top of a live broadcast room?  </span><br><span class="line"></span><br><span class="line">**Solution**: Use `overlay` with the `linearGradient` property and `blendMode` to mix the current overlay with the underlying list for a gradient mask effect.  </span><br><span class="line">**Effect diagram**:  </span><br><span class="line">![[【每日学点鸿蒙知识】24.08.18.png]]  </span><br><span class="line"></span><br><span class="line">**Reference code**:  </span><br><span class="line">```typescript</span><br><span class="line">@Entry</span><br><span class="line">@Component</span><br><span class="line">struct Index &#123;</span><br><span class="line">  private arr: number[] = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span><br><span class="line"></span><br><span class="line">  @Builder</span><br><span class="line">  overlayBuilder() &#123;</span><br><span class="line">    Stack()</span><br><span class="line">      .height(&quot;100%&quot;)</span><br><span class="line">      .width(&quot;100%&quot;)</span><br><span class="line">      .linearGradient(&#123;</span><br><span class="line">        direction: GradientDirection.Bottom, // Gradient direction</span><br><span class="line">        colors: [[&quot;#00FFFFFF&quot;, 0.0], [&quot;#FFFFFFFF&quot;, 0.3]] // When the proportion of the last array element is less than 1, it satisfies the repeated coloring effect</span><br><span class="line">      &#125;)</span><br><span class="line">      .blendMode(BlendMode.DST_IN, BlendApplyType.OFFSCREEN)</span><br><span class="line">      .hitTestBehavior(HitTestMode.None)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  build() &#123;</span><br><span class="line">    Column() &#123;</span><br><span class="line">      List(&#123; space: 20, initialIndex: 0 &#125;) &#123;</span><br><span class="line">        ForEach(this.arr, (item: number) =&gt; &#123;</span><br><span class="line">          ListItem() &#123;</span><br><span class="line">            Text(&#x27;&#x27; + item)</span><br><span class="line">              .width(&#x27;100%&#x27;)</span><br><span class="line">              .height(100)</span><br><span class="line">              .fontSize(16)</span><br><span class="line">              .textAlign(TextAlign.Center)</span><br><span class="line">              .borderRadius(10)</span><br><span class="line">              .backgroundColor(0xFFFFFF)</span><br><span class="line">          &#125;</span><br><span class="line">          .onClick(() =&gt; &#123;</span><br><span class="line">            console.log(&#x27;is click&#x27;)</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;, (item: string) =&gt; item)</span><br><span class="line">      &#125;.width(&#x27;90%&#x27;)</span><br><span class="line">      .scrollBar(BarState.Off)</span><br><span class="line">      .overlay(this.overlayBuilder())</span><br><span class="line">      .blendMode(BlendMode.SRC_OVER, BlendApplyType.OFFSCREEN)</span><br><span class="line">    &#125;.width(&#x27;100%&#x27;).height(&#x27;100%&#x27;).backgroundColor(0xDCDCDC).padding(&#123; top: 5 &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/HarmonyOS-Next/" rel="tag"># HarmonyOS Next</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/06/30/4817-Daily-HarmonyOS-Next-Knowledge-Multiple-har-Dependencies-Specifying-Compilation-Architecture-Mutual-Calls-Between-ArkTS-and-C/" rel="prev" title="[Daily HarmonyOS Next Knowledge] Multiple har Dependencies, Specifying Compilation Architecture, Mutual Calls Between ArkTS and C++">
      <i class="fa fa-chevron-left"></i> [Daily HarmonyOS Next Knowledge] Multiple har Dependencies, Specifying Compilation Architecture, Mutual Calls Between ArkTS and C++
    </a></div>
      <div class="post-nav-item">
    <a href="/2025/06/30/4819-Learn-HarmonyOS-Next-Knowledge-Daily-ASON-Tool-Custom-Tabbar-musl-Text-Abnormal-Truncation-etc/" rel="next" title="[Learn HarmonyOS Next Knowledge Daily] ASON Tool, Custom Tabbar, musl, Text Abnormal Truncation, etc.">
      [Learn HarmonyOS Next Knowledge Daily] ASON Tool, Custom Tabbar, musl, Text Abnormal Truncation, etc. <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Daily-HarmonyOS-Next-Knowledge-HAP-Installation-Failure-ArkTS-and-C-Array-Conversion-Gradient-Mask-Effect-etc"><span class="nav-number">1.</span> <span class="nav-text">[Daily HarmonyOS Next Knowledge] HAP Installation Failure, ArkTS and C++ Array Conversion, Gradient Mask Effect, etc.</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-When-starting-debugging-or-running-an-application-service-an-error-occurs-during-HAP-installation-with-the-message-%E2%80%9Cerror-install-failed-due-to-older-sdk-version-in-the-device%E2%80%9D"><span class="nav-number">1.1.</span> <span class="nav-text">1. When starting debugging or running an application&#x2F;service, an error occurs during HAP installation with the message “error: install failed due to older sdk version in the device”.</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Qingkouwei</p>
  <div class="site-description" itemprop="description">Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">353</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Qingkouwei</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>

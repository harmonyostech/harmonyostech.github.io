<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"harmonyostech.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="[Daily HarmonyOS Next Knowledge] Web Cross-Origin Resources, Web Long-Press Menu, Web Request Interception, Screen Recording Prevention, Base64 Image Dimensions1. HarmonyOS Web Component Local Resourc">
<meta property="og:type" content="article">
<meta property="og:title" content="[Daily HarmonyOS Next Knowledge] Web Cross-Origin Resources, Web Long-Press Menu, Web Request Interception, Screen Recording Prevention, Base64 Image Dimensions">
<meta property="og:url" content="https://harmonyostech.github.io/2025/06/27/123-Daily-HarmonyOS-Next-Knowledge-Web-Cross-Origin-Resources-Web-Long-Press-Menu-Web-Request-Interception-Screen-Recording-Prevention-Base64-Image-Dimensions/index.html">
<meta property="og:site_name" content="HarmonyOS NEXT Knowledge Charging Station">
<meta property="og:description" content="[Daily HarmonyOS Next Knowledge] Web Cross-Origin Resources, Web Long-Press Menu, Web Request Interception, Screen Recording Prevention, Base64 Image Dimensions1. HarmonyOS Web Component Local Resourc">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-06-27T01:58:29.000Z">
<meta property="article:modified_time" content="2025-06-27T01:59:39.391Z">
<meta property="article:author" content="Qingkouwei">
<meta property="article:tag" content="HarmonyOS Next">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://harmonyostech.github.io/2025/06/27/123-Daily-HarmonyOS-Next-Knowledge-Web-Cross-Origin-Resources-Web-Long-Press-Menu-Web-Request-Interception-Screen-Recording-Prevention-Base64-Image-Dimensions/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>[Daily HarmonyOS Next Knowledge] Web Cross-Origin Resources, Web Long-Press Menu, Web Request Interception, Screen Recording Prevention, Base64 Image Dimensions | HarmonyOS NEXT Knowledge Charging Station</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">HarmonyOS NEXT Knowledge Charging Station</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Analysis of Core Technologies and Application Scenarios of HarmonyOS NEXT</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://harmonyostech.github.io/2025/06/27/123-Daily-HarmonyOS-Next-Knowledge-Web-Cross-Origin-Resources-Web-Long-Press-Menu-Web-Request-Interception-Screen-Recording-Prevention-Base64-Image-Dimensions/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Qingkouwei">
      <meta itemprop="description" content="Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HarmonyOS NEXT Knowledge Charging Station">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          [Daily HarmonyOS Next Knowledge] Web Cross-Origin Resources, Web Long-Press Menu, Web Request Interception, Screen Recording Prevention, Base64 Image Dimensions
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-06-27 09:58:29 / Modified: 09:59:39" itemprop="dateCreated datePublished" datetime="2025-06-27T09:58:29+08:00">2025-06-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Daily-HarmonyOS-Next-Knowledge/" itemprop="url" rel="index"><span itemprop="name">Daily HarmonyOS Next Knowledge</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h3 id="Daily-HarmonyOS-Next-Knowledge-Web-Cross-Origin-Resources-Web-Long-Press-Menu-Web-Request-Interception-Screen-Recording-Prevention-Base64-Image-Dimensions"><a href="#Daily-HarmonyOS-Next-Knowledge-Web-Cross-Origin-Resources-Web-Long-Press-Menu-Web-Request-Interception-Screen-Recording-Prevention-Base64-Image-Dimensions" class="headerlink" title="[Daily HarmonyOS Next Knowledge] Web Cross-Origin Resources, Web Long-Press Menu, Web Request Interception, Screen Recording Prevention, Base64 Image Dimensions"></a>[Daily HarmonyOS Next Knowledge] Web Cross-Origin Resources, Web Long-Press Menu, Web Request Interception, Screen Recording Prevention, Base64 Image Dimensions</h3><h4 id="1-HarmonyOS-Web-Component-Local-Resource-Cross-Origin-Issue"><a href="#1-HarmonyOS-Web-Component-Local-Resource-Cross-Origin-Issue" class="headerlink" title="1. HarmonyOS Web Component Local Resource Cross-Origin Issue"></a>1. HarmonyOS Web Component Local Resource Cross-Origin Issue</h4><p>For solutions to cross-origin resource issues, refer to the official documentation: <a target="_blank" rel="noopener" href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/web-cross-origin-V5">https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/web-cross-origin-V5</a>  </p>
<p><strong>Method 1</strong><br>To enable the Web component to access cross-origin resources, developers should use protocols like <code>http</code> or <code>https</code> instead of <code>file</code> or <code>resource</code> for loading. The replacement URL domain name should be a custom-constructed domain for personal or organizational use to avoid conflicts with actual internet domains. Meanwhile, use the Web component’s <code>onInterceptRequest</code> method to intercept and replace local resources.  </p>
<p>The following example demonstrates resolving cross-origin access failures for local resources. Here, <code>index.html</code> and <code>js/script.js</code> are placed in the project’s <code>rawfile</code> directory. Accessing <code>index.html</code> via the <code>resource</code> protocol will block <code>js/script.js</code> due to cross-origin restrictions. The example uses <code>https://www.example.com/</code> to replace the <code>resource</code> protocol and leverages the <code>onInterceptRequest</code> interface to replace resources, enabling <code>js/script.js</code> to load successfully and resolve cross-origin blocking.  </p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main/ets/pages/Index.ets</span></span><br><span class="line"><span class="keyword">import</span> &#123; webview &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkWeb&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entry</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">struct <span class="title class_">Index</span> &#123;</span><br><span class="line">  <span class="meta">@State</span> <span class="attr">message</span>: <span class="built_in">string</span> = <span class="string">&#x27;Hello World&#x27;</span>;</span><br><span class="line">  <span class="attr">webviewController</span>: webview.<span class="property">WebviewController</span> = <span class="keyword">new</span> webview.<span class="title class_">WebviewController</span>();</span><br><span class="line">  <span class="comment">// Mapping table for constructed domain names and local files</span></span><br><span class="line">  schemeMap = <span class="keyword">new</span> <span class="title class_">Map</span>([</span><br><span class="line">    [<span class="string">&quot;https://www.example.com/index.html&quot;</span>, <span class="string">&quot;index.html&quot;</span>],</span><br><span class="line">    [<span class="string">&quot;https://www.example.com/js/script.js&quot;</span>, <span class="string">&quot;js/script.js&quot;</span>],</span><br><span class="line">  ])</span><br><span class="line">  <span class="comment">// Mapping table for local files and constructed response MIME types</span></span><br><span class="line">  mimeTypeMap = <span class="keyword">new</span> <span class="title class_">Map</span>([</span><br><span class="line">    [<span class="string">&quot;index.html&quot;</span>, <span class="string">&#x27;text/html&#x27;</span>],</span><br><span class="line">    [<span class="string">&quot;js/script.js&quot;</span>, <span class="string">&quot;text/javascript&quot;</span>]</span><br><span class="line">  ])</span><br><span class="line"></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Row</span>() &#123;</span><br><span class="line">      <span class="title class_">Column</span>() &#123;</span><br><span class="line">        <span class="comment">// For local index.html, use http or https protocol instead of file or resource protocol, and construct a custom domain name.</span></span><br><span class="line">        <span class="comment">// This example uses www.example.com.</span></span><br><span class="line">        <span class="title class_">Web</span>(&#123; <span class="attr">src</span>: <span class="string">&quot;https://www.example.com/index.html&quot;</span>, <span class="attr">controller</span>: <span class="variable language_">this</span>.<span class="property">webviewController</span> &#125;)</span><br><span class="line">          .<span class="title function_">javaScriptAccess</span>(<span class="literal">true</span>)</span><br><span class="line">          .<span class="title function_">fileAccess</span>(<span class="literal">true</span>)</span><br><span class="line">          .<span class="title function_">domStorageAccess</span>(<span class="literal">true</span>)</span><br><span class="line">          .<span class="title function_">geolocationAccess</span>(<span class="literal">true</span>)</span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">          .<span class="title function_">height</span>(<span class="string">&quot;100%&quot;</span>)</span><br><span class="line">          .<span class="title function_">onInterceptRequest</span>(<span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!event) &#123;</span><br><span class="line">              <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// Intercept and replace local offline resources to bypass cross-origin restrictions</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">schemeMap</span>.<span class="title function_">has</span>(event.<span class="property">request</span>.<span class="title function_">getRequestUrl</span>())) &#123;</span><br><span class="line">              <span class="keyword">let</span> <span class="attr">rawfileName</span>: <span class="built_in">string</span> = <span class="variable language_">this</span>.<span class="property">schemeMap</span>.<span class="title function_">get</span>(event.<span class="property">request</span>.<span class="title function_">getRequestUrl</span>())!;</span><br><span class="line">              <span class="keyword">let</span> mimeType = <span class="variable language_">this</span>.<span class="property">mimeTypeMap</span>.<span class="title function_">get</span>(rawfileName);</span><br><span class="line">              <span class="keyword">if</span> (<span class="keyword">typeof</span> mimeType === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">let</span> response = <span class="keyword">new</span> <span class="title class_">WebResourceResponse</span>();</span><br><span class="line">                <span class="comment">// Construct response data. If the local file is in rawfile, set it as follows</span></span><br><span class="line">                response.<span class="title function_">setResponseData</span>($rawfile(rawfileName));</span><br><span class="line">                response.<span class="title function_">setResponseEncoding</span>(<span class="string">&#x27;utf-8&#x27;</span>);</span><br><span class="line">                response.<span class="title function_">setResponseMimeType</span>(mimeType);</span><br><span class="line">                response.<span class="title function_">setResponseCode</span>(<span class="number">200</span>);</span><br><span class="line">                response.<span class="title function_">setReasonMessage</span>(<span class="string">&#x27;OK&#x27;</span>);</span><br><span class="line">                response.<span class="title function_">setResponseIsReady</span>(<span class="literal">true</span>);</span><br><span class="line">                <span class="keyword">return</span> response;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">``</span><span class="string">`  </span></span><br><span class="line"><span class="string">`</span><span class="string">``</span>html</span><br><span class="line">&lt;!-- main/resources/rawfile/index.<span class="property">html</span> --&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1&quot;&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;script crossorigin src=&quot;./js/script.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">```  </span><br><span class="line">```javascript</span><br><span class="line">// main/resources/rawfile/js/script.js</span><br><span class="line">const body = document.body;</span><br><span class="line">const element = document.createElement(&#x27;div&#x27;);</span><br><span class="line">element.textContent = &#x27;success&#x27;;</span><br><span class="line">body.appendChild(element);</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**Method 2**  </span><br><span class="line">Set a path list using `setPathAllowingUniversalAccess`. When accessing resources in this list via the `file` protocol, cross-origin access to local files is allowed. Once the path list is set, the `file` protocol is restricted to accessing only resources in the list (the behavior of `fileAccess` will be overridden by this interface). Paths in the list must conform to either of the following formats:  </span><br><span class="line"></span><br><span class="line">1. Application file directory obtained via `Context.filesDir`, with subdirectory examples:  </span><br><span class="line">   - /data/storage/el2/base/files/example  </span><br><span class="line">   - /data/storage/el2/base/haps/entry/files/example  </span><br><span class="line"></span><br><span class="line">2. Application resource directory obtained via `Context.resourceDir`, with subdirectory examples:  </span><br><span class="line">   - /data/storage/el1/bundle/entry/resource/resfile  </span><br><span class="line">   - /data/storage/el1/bundle/entry/resource/resfile/example  </span><br><span class="line"></span><br><span class="line">If any path in the list fails to meet the above conditions, the system will throw an exception code 401 and mark the path list setup as failed. If the path list is empty, the accessible range of the `file` protocol will follow the rules of `fileAccess`, as shown in the example below.  </span><br><span class="line">```typescript</span><br><span class="line">// main/ets/pages/Index.ets</span><br><span class="line">import &#123; webview &#125; from &#x27;@kit.ArkWeb&#x27;;</span><br><span class="line">import &#123; BusinessError &#125; from &#x27;@kit.BasicServicesKit&#x27;;</span><br><span class="line"></span><br><span class="line">@Entry</span><br><span class="line">@Component</span><br><span class="line">struct WebComponent &#123;</span><br><span class="line">  controller: WebviewController = new webview.WebviewController();</span><br><span class="line"></span><br><span class="line">  build() &#123;</span><br><span class="line">    Row() &#123;</span><br><span class="line">      Web(&#123; src: &quot;&quot;, controller: this.controller &#125;)</span><br><span class="line">        .onControllerAttached(() =&gt; &#123;</span><br><span class="line">          try &#123;</span><br><span class="line">            // Set the path list allowing cross-origin access</span><br><span class="line">            this.controller.setPathAllowingUniversalAccess([</span><br><span class="line">              getContext().resourceDir,</span><br><span class="line">              getContext().filesDir + &quot;/example&quot;</span><br><span class="line">            ])</span><br><span class="line">            this.controller.loadUrl(&quot;file://&quot; + getContext().resourceDir + &quot;/index.html&quot;)</span><br><span class="line">          &#125; catch (error) &#123;</span><br><span class="line">            console.error(`ErrorCode: $&#123;(error as BusinessError).code&#125;,  Message: $&#123;(error as BusinessError).message&#125;`);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .javaScriptAccess(true)</span><br><span class="line">        .fileAccess(true)</span><br><span class="line">        .domStorageAccess(true)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line">```html</span><br><span class="line">&lt;!-- main/resource/rawfile/index.html --&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Demo&lt;/title&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover&quot;&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        function getFile() &#123;</span><br><span class="line">            var file = &quot;file:///data/storage/el1/bundle/entry/resources/resfile/js/script.js&quot;;</span><br><span class="line">      // Use file protocol to access local js files across origins via XMLHttpRequest</span><br><span class="line">            var xmlHttpReq = new XMLHttpRequest();</span><br><span class="line">            xmlHttpReq.onreadystatechange = function()&#123;</span><br><span class="line">                console.log(&quot;readyState:&quot; + xmlHttpReq.readyState);</span><br><span class="line">                console.log(&quot;status:&quot; + xmlHttpReq.status);</span><br><span class="line">                if(xmlHttpReq.readyState == 4)&#123;</span><br><span class="line">                    if (xmlHttpReq.status == 200) &#123;</span><br><span class="line">                // If the ets side correctly sets the path list, resources can be obtained here</span><br><span class="line">                        const element = document.getElementById(&#x27;text&#x27;);</span><br><span class="line">                        element.textContent = &quot;load &quot; + file + &quot; success&quot;;</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                // If the ets side does not set the path list, a CORS cross-origin check error will be triggered here</span><br><span class="line">                        const element = document.getElementById(&#x27;text&#x27;);</span><br><span class="line">                        element.textContent = &quot;load &quot; + file + &quot; failed&quot;;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            xmlHttpReq.open(&quot;GET&quot;, file);</span><br><span class="line">            xmlHttpReq.send(null);</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div class=&quot;page&quot;&gt;</span><br><span class="line">    &lt;button id=&quot;example&quot; onclick=&quot;getFile()&quot;&gt;stealFile&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div id=&quot;text&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br><span class="line">```  </span><br><span class="line">```javascript</span><br><span class="line">// main/resources/rawfile/js/script.js</span><br><span class="line">const body = document.body;</span><br><span class="line">const element = document.createElement(&#x27;div&#x27;);</span><br><span class="line">element.textContent = &#x27;success&#x27;;</span><br><span class="line">body.appendChild(element);</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 2. HarmonyOS Web: How to Implement Long-Press to Pop Up a Menu for Saving Images, Similar to getHitTestResult?  </span><br><span class="line">Refer to the `onContextMenuShow` event in the Web component. Long-pressing a specific element (e.g., image, link) or right-clicking the mouse will trigger the menu. For details, refer to: https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-basic-components-web-V5#oncontextmenushow9  </span><br><span class="line">Currently, conditions for the long-press pop-up cannot be controlled. You can try to control the selection box via H5-side events and CSS.  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 3. HarmonyOS Web: Demo for Intercepting App Navigation and Custom Request Responses  </span><br><span class="line">For Web interception and custom request responses, refer to the official documentation: https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/web-resource-interception-request-mgmt-V5  </span><br><span class="line"></span><br><span class="line">The Web component supports custom response capabilities after the app intercepts page requests. Developers can use the `onInterceptRequest()` interface to implement custom resource request responses, which can be applied to scenarios such as custom Web page responses and custom file resource responses.  </span><br><span class="line"></span><br><span class="line">Process: The Web page initiates a resource loading request → the app layer receives the resource request message → the app layer constructs a local resource response message and sends it to the Web kernel → the Web kernel parses the app layer&#x27;s response information and loads page resources based on this response.  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 4. HarmonyOS: How to Prevent Screen Recording/Screenshot for a Single Page or Dialog (e.g., Security Password Keyboard in a Dialog)  </span><br><span class="line">To prevent screen recording and screenshot for specific pages or dialogs, set the window to privacy mode using `setWindowPrivacyMode`. This will display a gray overlay during screen recording, screenshot, or screen sharing (privacy windows do not allow these operations).  </span><br><span class="line"></span><br><span class="line">Reference: https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-window-V5#setwindowprivacymode9  </span><br><span class="line"></span><br><span class="line">**setWindowPrivacyMode**  </span><br><span class="line">`setWindowPrivacyMode(isPrivacyMode: boolean, callback: AsyncCallback&lt;void&gt;): void`  </span><br><span class="line">Sets whether the window is in privacy mode using an asynchronous callback. A window in privacy mode cannot be screenshotted or screen-recorded, suitable for scenarios requiring protection against screenshots/screen recordings.  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 5. HarmonyOS: How to Obtain Original Dimensions of a Base64 Image  </span><br><span class="line">In image verification code scenarios, the server returns two base64-encoded images (background image and verification image). The scaling factor needs to be calculated based on the dimensions of the background and original images to determine the size and positioning of the verification image.  </span><br><span class="line"></span><br><span class="line">Use Image Kit capabilities. Reference: https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-image-V5#imageinfo  </span><br><span class="line"></span><br><span class="line">**Demo**:  </span><br><span class="line">```typescript</span><br><span class="line">import util from &#x27;@ohos.util&#x27;;</span><br><span class="line">import &#123; image &#125; from &#x27;@kit.ImageKit&#x27;;</span><br><span class="line">@Entry</span><br><span class="line">@Component</span><br><span class="line">struct Index &#123;</span><br><span class="line">  @State message: string = &#x27;getImage&#x27;;</span><br><span class="line">  @StorageLink(&#x27;test&#x27;) test: object = new Object;</span><br><span class="line">  @State imageBase64: string =</span><br><span class="line">    &#x27;iVBORw0KGgoAAAANSUhEUgAAADwAAAAUCAYAAADRA14pAAABN0lEQVR42mP4P8IAAy0Mjf6xAYxHnIcHo6cZaOlZYj38VbESjIech5E9SayHYZ5FxnT1cL7uFwxMbt4lxtPYPElLjzNg8ywhMWp6GOZBeiVzDA/jinFySmZSkzUpHn5oLosXk+1hYj2NXliRUnjh8hy5MYzP0wzEeIzUvEyNGCY3WZMUw5Qm61EPjzQPkwIGjYfp4VlsnianIULIs3gbHvT2LLZWFzVLZ7xNS3p7lBqAGM+CPZy6o+w/DGfvrv5ffagTjtuOT/4/8cxcOF50Zc3/5dc3wvHeh0fh+PDjk/8vv74Bx/c+PPz/8utrOP7559fg8LD/uqT/A4GpHdB7Q/XBmFBAMyBLPv70DCWWTjw7h2L42pvbUCxGdlTPqRkoji7Y24DiqdCN6f8HKnCRMcNA5bmBCmgACwohlRAJ3H4AAAAASUVORK5CYII=&#x27;</span><br><span class="line">  @State pixelMap: image.PixelMap | undefined = undefined;</span><br><span class="line">  build() &#123;</span><br><span class="line">    Column() &#123;</span><br><span class="line">      Text(this.message)</span><br><span class="line">        .id(&#x27;HelloWorld&#x27;)</span><br><span class="line">        .fontSize(50)</span><br><span class="line">        .fontWeight(FontWeight.Bold)</span><br><span class="line">        .onClick(async () =&gt; &#123;</span><br><span class="line">          let helper = new util.Base64Helper();</span><br><span class="line">          let buffer: ArrayBuffer = helper.decodeSync(this.imageBase64, util.Type.MIME).buffer as ArrayBuffer;</span><br><span class="line">          let imageSource = image.createImageSource(buffer);</span><br><span class="line">          let opts: image.DecodingOptions = &#123; editable: true &#125;;</span><br><span class="line">          this.pixelMap = await imageSource.createPixelMap(opts);</span><br><span class="line">          this.pixelMap.getImageInfo().then((imageInfo: image.ImageInfo) =&gt; &#123;</span><br><span class="line">            if (imageInfo == undefined) &#123;</span><br><span class="line">              console.error(`Failed to obtain the image pixel map information.`);</span><br><span class="line">            &#125;</span><br><span class="line">            let wit = imageInfo.size.width;</span><br><span class="line">            let hig = imageInfo.size.height;</span><br><span class="line">            console.log(`Succeeded in obtaining the image pixel map information., $&#123;JSON.stringify(wit)&#125;, $&#123;JSON.stringify(hig)&#125;`);</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .height(&#x27;100%&#x27;)</span><br><span class="line">    .width(&#x27;100%&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/HarmonyOS-Next/" rel="tag"># HarmonyOS Next</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/06/27/122-Daily-Harmony-Learnings-on-HarmonyOS-Next-Web-File-Upload-Continuous-Click-Monitoring-in-Four-Directions-Fold-Hover-String-Operations-and-Sandbox-Video-Playback/" rel="prev" title="[Daily Harmony Learnings on HarmonyOS Next] Web File Upload, Continuous Click Monitoring in Four Directions, Fold Hover, String Operations, and Sandbox Video Playback">
      <i class="fa fa-chevron-left"></i> [Daily Harmony Learnings on HarmonyOS Next] Web File Upload, Continuous Click Monitoring in Four Directions, Fold Hover, String Operations, and Sandbox Video Playback
    </a></div>
      <div class="post-nav-item">
    <a href="/2025/06/27/124-Daily-HarmonyOS-Next-Knowledge-Input-Box-Auto-Focus-JS-Bridge-Implementation-Popup-Full-Screen-Mask-Mouse-Event-Adaptation-Web-Cross-Domain/" rel="next" title="[Daily HarmonyOS Next Knowledge] Input Box Auto-Focus, JS Bridge Implementation, Popup Full-Screen Mask, Mouse Event Adaptation, Web Cross-Domain">
      [Daily HarmonyOS Next Knowledge] Input Box Auto-Focus, JS Bridge Implementation, Popup Full-Screen Mask, Mouse Event Adaptation, Web Cross-Domain <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Daily-HarmonyOS-Next-Knowledge-Web-Cross-Origin-Resources-Web-Long-Press-Menu-Web-Request-Interception-Screen-Recording-Prevention-Base64-Image-Dimensions"><span class="nav-number">1.</span> <span class="nav-text">[Daily HarmonyOS Next Knowledge] Web Cross-Origin Resources, Web Long-Press Menu, Web Request Interception, Screen Recording Prevention, Base64 Image Dimensions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-HarmonyOS-Web-Component-Local-Resource-Cross-Origin-Issue"><span class="nav-number">1.1.</span> <span class="nav-text">1. HarmonyOS Web Component Local Resource Cross-Origin Issue</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Qingkouwei</p>
  <div class="site-description" itemprop="description">Welcome to the HarmonyOS NEXT Knowledge Charging Station!  This is a hub for knowledge about HarmonyOS Next`s new-generation system. With its self-developed kernel, HarmonyOS NEXT achieves native smoothness, security, intelligence, and interconnectivity. We deeply analyze how its new distributed soft bus revolutionizes device connectivity experiences and explain the principles behind the enhanced perception and reasoning capabilities of the Xiaoyi intelligent agent based on the Pangu large model. Whether you are a developer exploring application development or an ordinary user eager to understand system features, you can "recharge" here and quickly grasp the essence of HarmonyOS NEXT.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">305</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Qingkouwei</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
